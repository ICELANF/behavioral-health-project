# è¡Œå¥å¹³å° â€” è§„åˆ™ä½“ç³»å®Œæ•´å‚è€ƒæ–‡æ¡£

**ç‰ˆæœ¬:** V5.2.6-complete
**æ›´æ–°æ—¶é—´:** 2026-02-24
**é€‚ç”¨èŒƒå›´:** è¡Œä¸ºå¥åº·æ•°å­—å¹³å°å…¨éƒ¨è§„åˆ™æ€§å†…å®¹çš„å”¯ä¸€æƒå¨å‚è€ƒ
**ä»£ç åº“:** `D:\behavioral-health-project`

---

## ç›®å½•

- [ä¸€ã€å¹³å°è¯­ä¹‰è§„åˆ™](#ä¸€å¹³å°è¯­ä¹‰è§„åˆ™)
  - [1.1 å…­çº§å››åŒé“è€…è§’è‰²ä½“ç³»](#11-å…­çº§å››åŒé“è€…è§’è‰²ä½“ç³»)
  - [1.2 TTM ä¸ƒé˜¶æ®µè¡Œä¸ºæ”¹å˜æ¨¡å‹](#12-ttm-ä¸ƒé˜¶æ®µè¡Œä¸ºæ”¹å˜æ¨¡å‹)
  - [1.3 ç”¨æˆ·åˆ†å±‚ä¸æƒé™æ¨¡å‹](#13-ç”¨æˆ·åˆ†å±‚ä¸æƒé™æ¨¡å‹)
  - [1.4 AIâ†’å®¡æ ¸â†’æ¨é€é“å¾‹](#14-aiå®¡æ ¸æ¨é€é“å¾‹)
- [äºŒã€äº¤äº’è§„åˆ’è§„åˆ™](#äºŒäº¤äº’è§„åˆ’è§„åˆ™)
  - [2.1 è¯„ä¼°ç®¡çº¿ (BAPS)](#21-è¯„ä¼°ç®¡çº¿-baps)
  - [2.2 Agent è·¯ç”±ä¸åä½œ](#22-agent-è·¯ç”±ä¸åä½œ)
  - [2.3 MasterAgent ä¹æ­¥ç®¡çº¿](#23-masteragent-ä¹æ­¥ç®¡çº¿)
  - [2.4 V4.0 å››å¤§é™ªä¼´ Agent](#24-v40-å››å¤§é™ªä¼´-agent)
  - [2.5 æ¨é€å®¡æ‰¹å·¥ä½œæµ](#25-æ¨é€å®¡æ‰¹å·¥ä½œæµ)
  - [2.6 æ¨é€æ¨èå¼•æ“ (å…­è§„åˆ™)](#26-æ¨é€æ¨èå¼•æ“å…­è§„åˆ™)
  - [2.7 æ–¹æ¡ˆç®¡ç†ä¸æŒ‘æˆ˜ç”Ÿå‘½å‘¨æœŸ](#27-æ–¹æ¡ˆç®¡ç†ä¸æŒ‘æˆ˜ç”Ÿå‘½å‘¨æœŸ)
  - [2.8 å®šæ—¶ä»»åŠ¡ä½“ç³» (20 Jobs)](#28-å®šæ—¶ä»»åŠ¡ä½“ç³»-20-jobs)
- [ä¸‰ã€è¡Œä¸ºå¤„æ–¹ç”Ÿæˆè§„åˆ™](#ä¸‰è¡Œä¸ºå¤„æ–¹ç”Ÿæˆè§„åˆ™)
  - [3.1 ä¸‰ç»´å¤„æ–¹æ¨¡å‹æ¦‚è¿°](#31-ä¸‰ç»´å¤„æ–¹æ¨¡å‹æ¦‚è¿°)
  - [3.2 ç»´åº¦ä¸€: TTM é˜¶æ®µâ†’ç­–ç•¥é€‰æ‹©](#32-ç»´åº¦ä¸€-ttm-é˜¶æ®µç­–ç•¥é€‰æ‹©)
  - [3.3 ç»´åº¦äºŒ: BigFive äººæ ¼â†’æ²Ÿé€šé£æ ¼](#33-ç»´åº¦äºŒ-bigfive-äººæ ¼æ²Ÿé€šé£æ ¼)
  - [3.4 ç»´åº¦ä¸‰: CAPACITYâ†’å¼ºåº¦æ ¡å‡†](#34-ç»´åº¦ä¸‰-capacityå¼ºåº¦æ ¡å‡†)
  - [3.5 å¾®è¡ŒåŠ¨ç”Ÿæˆè§„åˆ™](#35-å¾®è¡ŒåŠ¨ç”Ÿæˆè§„åˆ™)
  - [3.6 é˜»åŠ›é˜ˆå€¼ä¸å‡çº§è§„åˆ™](#36-é˜»åŠ›é˜ˆå€¼ä¸å‡çº§è§„åˆ™)
  - [3.7 å¤„æ–¹æœ‰æ•ˆæ€§è¯„ä¼° (IES)](#37-å¤„æ–¹æœ‰æ•ˆæ€§è¯„ä¼°-ies)
  - [3.8 æ··åˆè·¯ç”±: BehaviorRxâ†’LLM é™çº§](#38-æ··åˆè·¯ç”±-behaviorrxllm-é™çº§)
  - [3.9 Profileâ†’RxContext é€‚é…è§„åˆ™](#39-profilerxcontext-é€‚é…è§„åˆ™)
  - [3.10 æ²Ÿé€šé£æ ¼â†’å¹²é¢„è¯­è°ƒæ˜ å°„](#310-æ²Ÿé€šé£æ ¼å¹²é¢„è¯­è°ƒæ˜ å°„)
  - [3.11 Observerâ†’Grower åˆå§‹å¤„æ–¹ç”Ÿæˆè§„åˆ™](#311-observergrower-åˆå§‹å¤„æ–¹ç”Ÿæˆè§„åˆ™)
  - [3.12 å¤„æ–¹æŸ¥è¯¢ä¸æƒé™è§„åˆ™](#312-å¤„æ–¹æŸ¥è¯¢ä¸æƒé™è§„åˆ™)
- [å››ã€ç§¯åˆ†ä¸æ¿€åŠ±è§„åˆ™](#å››ç§¯åˆ†ä¸æ¿€åŠ±è§„åˆ™)
  - [4.1 ä¸‰ç»´ç§¯åˆ†ä½“ç³»](#41-ä¸‰ç»´ç§¯åˆ†ä½“ç³»)
  - [4.2 é‡Œç¨‹ç¢‘ä¸ä»ªå¼](#42-é‡Œç¨‹ç¢‘ä¸ä»ªå¼)
  - [4.3 å¾½ç« ç³»ç»Ÿ](#43-å¾½ç« ç³»ç»Ÿ)
  - [4.4 è¿ç»­æ‰“å¡ä¸ä¸­æ–­æ¢å¤](#44-è¿ç»­æ‰“å¡ä¸ä¸­æ–­æ¢å¤)
  - [4.5 æ™‹çº§èµ„æ ¼å››ç»´åº¦æ£€æŸ¥](#45-æ™‹çº§èµ„æ ¼å››ç»´åº¦æ£€æŸ¥)
- [äº”ã€å®‰å…¨ç®¡é“è§„åˆ™](#äº”å®‰å…¨ç®¡é“è§„åˆ™)
  - [5.1 å››å±‚å®‰å…¨ç®¡çº¿ (SafetyPipeline)](#51-å››å±‚å®‰å…¨ç®¡çº¿-safetypipeline)
  - [5.2 ä¸­åŒ»éª¨ä¼¤å®‰å…¨é—¨ (OrthoSafetyGate L1-L4)](#52-ä¸­åŒ»éª¨ä¼¤å®‰å…¨é—¨-orthosafetygate-l1-l4)
  - [5.3 ç­–ç•¥å¼•æ“äº”æ­¥ç®¡çº¿ (PolicyEngine)](#53-ç­–ç•¥å¼•æ“äº”æ­¥ç®¡çº¿-policyengine)
- [å…­ã€è®¾å¤‡é¢„è­¦è§„åˆ™](#å…­è®¾å¤‡é¢„è­¦è§„åˆ™)
- [ä¸ƒã€æ²»ç†ä¸åŒé“è€…è§„åˆ™ (V4.0)](#ä¸ƒæ²»ç†ä¸åŒé“è€…è§„åˆ™-v40)
- [å…«ã€å¹²é¢„åŒ…è§„åˆ™](#å…«å¹²é¢„åŒ…è§„åˆ™)
- [ä¹ã€å¹²é¢„ç­–ç•¥æ ‘](#ä¹å¹²é¢„ç­–ç•¥æ ‘)

---

## ä¸€ã€å¹³å°è¯­ä¹‰è§„åˆ™

### 1.1 å…­çº§å››åŒé“è€…è§’è‰²ä½“ç³»

> **æƒå¨æ¥æº:** `api/paths_api.py` `_LEVEL_THRESHOLDS` + `_LEVEL_META` + `_COMPANION_REQS`
> **DB æ‰§è¡Œ:** `core/learning_service.py` `ROLE_PROGRESSION_RULES`
> **æ˜¾ç¤º/è®¡ç®—:** `api/learning_api.py` `COACH_LEVEL_REQUIREMENTS`

#### è§’è‰²å±‚çº§

| ç­‰çº§ | è§’è‰² | æ ‡è¯† | è§’è‰²ä»£ç  | role_level |
|------|------|------|----------|-----------|
| L0 | è§‚å¯Ÿå‘˜ | ğŸ‘€ | OBSERVER | 1 |
| L1 | æˆé•¿è€… | ğŸŒ± | GROWER | 2 |
| L2 | åˆ†äº«è€… | ğŸ’¬ | SHARER | 3 |
| L3 | è¡Œä¸ºå¥åº·æ•™ç»ƒ | ğŸ¯ | COACH | 4 |
| L4 | è¡Œä¸ºå¥åº·ä¿ƒè¿›å¸ˆ | â­ | PROMOTER / SUPERVISOR | 5 |
| L5 | è¡Œä¸ºå¥åº·ä¿ƒè¿›å¤§å¸ˆ | ğŸ‘‘ | MASTER | 6 |
| â€” | ç³»ç»Ÿç®¡ç†å‘˜ | â€” | ADMIN | 99 |

#### æ™‹çº§ä¸‰ç»´ç§¯åˆ†é—¨æ§›

| æ™‹çº§è·¯å¾„ | æˆé•¿ç§¯åˆ† | è´¡çŒ®ç§¯åˆ† | å½±å“åŠ›ç§¯åˆ† | è€ƒè¯• | åŒé“è€…è¦æ±‚ |
|----------|---------|---------|-----------|------|-----------|
| L0â†’L1 | â‰¥100 | â€” | â€” | å¦ | â€” |
| L1â†’L2 | â‰¥500 | â‰¥50 | â€” | å¦ | â€” |
| L2â†’L3 | â‰¥800 | â‰¥200 | â‰¥50 | æ˜¯ | 4ä½ L1 æˆé•¿è€… |
| L3â†’L4 | â‰¥1500 | â‰¥600 | â‰¥200 | æ˜¯ | 4ä½ L2 åˆ†äº«è€… |
| L4â†’L5 | â‰¥3000 | â‰¥1500 | â‰¥600 | æ˜¯ | 4ä½ L3 æ•™ç»ƒ |

#### L0â†’L1 ç‰¹æ®Šè¦æ±‚ (Observerâ†’Grower å‡çº§)

L0â†’L1 ä¸èµ°ç§¯åˆ†é—¨æ§›, è€Œæ˜¯èµ°**è¯„ä¼°å®Œæˆæ£€æŸ¥** (`api/r4_role_upgrade_trigger.py`):

| è¯„ä¼°æ¨¡å— | å…¨ç§° | å¿…é¡»çŠ¶æ€ |
|----------|------|---------|
| ttm7 | TTM-7 è¡Œä¸ºé˜¶æ®µè¯„ä¼° (21é¢˜) | completed |
| big5 | å¤§äº”äººæ ¼ (50é¢˜) | completed |
| bpt6 | è¡Œä¸ºæ¨¡å¼åˆ†å‹ BPT-6 (18é¢˜) | completed |
| capacity | CAPACITY èƒ½åŠ›è¯„ä¼° (32é¢˜) | completed |
| spi | æˆåŠŸæ¦‚ç‡æŒ‡æ•° SPI (50é¢˜) | completed |

å‡çº§æ‰§è¡Œæµç¨‹: è¯„ä¼°æ£€æŸ¥ â†’ è§’è‰²æ›´æ–° â†’ åˆå§‹åŒ–æ‰“å¡è®°å½• â†’ ç”Ÿæˆè¡Œä¸ºå¤„æ–¹ â†’ ç”Ÿæˆæ¯æ—¥ä»»åŠ¡

#### ç­‰çº§è®¡ç®—é€»è¾‘

```
_compute_user_level(stats):
  ä» L5 å¾€ L0 é€çº§æ£€æŸ¥
  è‹¥ growth â‰¥ min_growth AND contribution â‰¥ min_contribution AND influence â‰¥ min_influence
  åˆ™è¿”å›è¯¥ç­‰çº§
  å¦åˆ™ç»§ç»­å‘ä¸‹æ£€æŸ¥
```

#### åŒé“è€…è®¡æ•°

ä¼˜å…ˆæŸ¥ `companion_relations` è¡¨, è‹¥ç¼ºå¤±åˆ™ fallback åˆ° `User.referred_by` å­—æ®µã€‚è¿”å›è¾¾åˆ°ç›®æ ‡è§’è‰²çš„è¢«å¼•é¢†äººæ•°ã€‚

---

### 1.2 TTM ä¸ƒé˜¶æ®µè¡Œä¸ºæ”¹å˜æ¨¡å‹

> **æƒå¨æ¥æº:** `behavior_rx/core/rx_schemas.py` + `core/models.py` `BehavioralStage`

| é˜¶æ®µ | ä»£ç  | ä¸­æ–‡ | æ ¸å¿ƒç‰¹å¾ | å¹²é¢„ç„¦ç‚¹ |
|------|------|------|---------|---------|
| S0 | å‰æ„è¯†æœŸ | Pre-contemplation | æ— æ„æ„¿æ”¹å˜ | æ„è¯†å”¤é†’, æƒ…ç»ªè§¦åŠ¨ |
| S1 | æ„è¯†æœŸ | Contemplation | è®¤è¯†åˆ°é—®é¢˜, ä½†çŠ¹è±« | è®¤çŸ¥æ·±åŒ–, å†³ç­–å¹³è¡¡ |
| S2 | å‡†å¤‡æœŸ | Preparation | å‡†å¤‡è¡ŒåŠ¨ | æ‰¿è¯º, è‡ªæˆ‘è§£æ”¾ |
| S3 | è¡ŒåŠ¨æœŸ | Action | ä¸»åŠ¨æ”¹å˜è¡Œä¸º | åˆºæ¿€æ§åˆ¶, ä¹ æƒ¯å åŠ  |
| S4 | ç»´æŒæœŸ | Maintenance | ä¿æŒæ–°è¡Œä¸º | å¤å‘é¢„é˜², è‡ªæˆ‘ç›‘æ§ |
| S5 | å·©å›ºæœŸ | Consolidation | è¡Œä¸ºè‡ªåŠ¨åŒ– | è‡ªä¸»ç»´æŒ |
| S6 | ç»ˆæ­¢æœŸ | Termination | å®Œå…¨å†…åŒ– | ç›‘æµ‹ |

**é˜¶æ®µç¨³å®šæ€§** (`StageStability`):
- STABLE (0.9): ç¨³å®šåœ¨å½“å‰é˜¶æ®µ
- SEMI_STABLE (0.5): åŠç¨³å®š
- UNSTABLE (0.2): ä¸ç¨³å®š, æœ‰å›é€€é£é™©

**é˜¶æ®µâ†’å¤„æ–¹é˜¶æ®µæ˜ å°„:**
- S0-S1 â†’ è®¤çŸ¥å”¤é†’
- S2 â†’ åŠ¨æœºæ¿€å‘
- S3 â†’ è¡Œä¸ºå¡‘é€ 
- S4-S6 â†’ ä¹ æƒ¯å¼ºåŒ–

---

### 1.3 ç”¨æˆ·åˆ†å±‚ä¸æƒé™æ¨¡å‹

> **æƒå¨æ¥æº:** `core/user_segments.py`

#### å››æ¥æº Ã— å››å±‚çº§

| æ¥æº | ä»£ç  | è¯´æ˜ |
|------|------|------|
| è‡ªç„¶æµé‡ | ORGANIC | Cç«¯å…¬å…±ç”¨æˆ· |
| æ•™ç»ƒå¼•è | COACH_REFERRED | æ•™ç»ƒæ¨èå®¢æˆ· |
| æœºæ„åˆä½œ | INSTITUTION | åŒ»ç–—æœºæ„/ç¤¾åŒºæœåŠ¡ |
| ä¼ä¸šå¥ç®¡ | ENTERPRISE | ä¼ä¸šå¥åº·ç®¡ç†è®¡åˆ’ |

| å±‚çº§ | åŸºç¡€åŠŸèƒ½ |
|------|---------|
| FREE | éœ€æ±‚è°ƒæŸ¥, å†…å®¹ä¿¡æ¯æµ, ç¤¾åŒºåªè¯» (3é¡¹) |
| BASIC | + è‡ªè¯„ä¼°, åŸºç¡€å­¦ä¹ , å·¥å…·åº“, è¿›åº¦è¿½è¸ª (7é¡¹) |
| PREMIUM | + å®Œæ•´å­¦ä¹ , ä¸“å®¶å’¨è¯¢, å°ç»„ä¼šè¯, ç¤¾åŒºäº’åŠ¨, AIä¼´è¡Œ (12é¡¹) |
| VIP | + 180å¤©è¯¾ç¨‹, ç§äººæ•™ç»ƒ, å±æœºæ”¯æŒ, å®¶åº­æ”¯æŒ (16é¡¹) |

#### æ¥æºè°ƒæ•´

- **COACH_REFERRED:** é¢å¤–è·å¾— AI_COMPANION
- **INSTITUTION:** é¢å¤–è·å¾— CRISIS_SUPPORT, é™åˆ¶ PRIVATE_COACH
- **ENTERPRISE:** é¢å¤–è·å¾— GROUP_SESSION

#### å…­ç§é¢„å®šä¹‰ç”¨æˆ·ç”»åƒ

1. **public_observer** (ORGANIC Ã— FREE): åŸºç¡€å‘ç°
2. **self_grower** (ORGANIC Ã— BASIC): è‡ªä¸»å­¦ä¹ 
3. **coach_client** (COACH_REFERRED Ã— PREMIUM): æ•™ç»ƒè¾…åŠ© + AIä¼´è¡Œ
4. **institution_patient** (INSTITUTION Ã— PREMIUM): æœºæ„ç…§æŠ¤ + å±æœºæ”¯æŒ
5. **enterprise_employee** (ENTERPRISE Ã— BASIC): å›¢ä½“å‚ä¸
6. **vip_member** (ORGANIC Ã— VIP): å…¨åŠŸèƒ½é«˜çº§ä¼šå‘˜

---

### 1.4 AIâ†’å®¡æ ¸â†’æ¨é€é“å¾‹

> **é“å¾‹:** æ‰€æœ‰æŒ‡å¯¼ã€å»ºè®®ã€æ¿€åŠ±ç­‰äº¤äº’æ€§å†…å®¹, å¿…é¡»å…ˆç”± AI ç”Ÿæˆå»ºè®®, å†äº¤ç”±è¡Œä¸ºå¥åº·ä¿ƒè¿›å¸ˆå®¡æ ¸ä¿®æ”¹åæ¨é€ã€‚ç»ä¸å…è®¸ AI å†…å®¹ç›´æ¥è§¦è¾¾ç”¨æˆ·ã€‚

**å®ç°æ¶æ„:**

```
AIæ¨èå¼•æ“ (push_recommendation_service)
    â†“ ç”Ÿæˆæ¨è
æ•™ç»ƒå®¡æ‰¹ç½‘å…³ (coach_push_queue_service)
    â†“ æ•™ç»ƒå®¡æ ¸/ä¿®æ”¹/æ‰¹å‡†
ç»Ÿä¸€æ¨é€è·¯ç”± (gateway/channels/push_router)
    â†“ å†™ notifications è¡¨ + å¤–éƒ¨æ¸ é“(å¾®ä¿¡/çŸ­ä¿¡/é‚®ä»¶)
ç”¨æˆ·æ”¶åˆ°é€šçŸ¥ (H5 Notifications.vue)
```

**æ¨é€çŠ¶æ€æµè½¬:**
```
pending â†’ approved â†’ sent
pending â†’ rejected (ç»ˆæ­¢)
pending â†’ expired (72å°æ—¶æœªå¤„ç†)
```

#### é€šçŸ¥è·¯ç”±çº§è”è§„åˆ™

> **æƒå¨æ¥æº:** `gateway/channels/push_router.py`

`send_notification()` çš„æ¸ é“é€‰æ‹©éµå¾ªä»¥ä¸‹ä¼˜å…ˆçº§:

```
1. æ°¸è¿œå…ˆå†™ in-app é€šçŸ¥ (notifications è¡¨)
2. æ¸ é“é€‰æ‹©:
   a. è‹¥æŒ‡å®š channel å‚æ•° â†’ ä½¿ç”¨æŒ‡å®šæ¸ é“
   b. è‹¥ç”¨æˆ·è®¾ç½® preferred_channel â†’ ä½¿ç”¨ç”¨æˆ·åå¥½
   c. å¦åˆ™çº§è” (cascade): wechat â†’ sms â†’ email â†’ in-app only
3. æ¸ é“æ•°æ®æ£€æŸ¥:
   - wechat éœ€è¦ wx_openid éç©º
   - sms éœ€è¦ phone éç©º
   - email éœ€è¦ email éç©º
4. æŒ‡å®šæ¸ é“ä½†æ•°æ®ç¼ºå¤± â†’ æ ‡è®° fallback=True, æŒ‰çº§è”é¡ºåºå°è¯•
```

**è¿”å›ç»“æ„:** `{"channel_used": "wechat|sms|email|in_app", "success": bool, "fallback": bool}`

#### é€šçŸ¥æ·±åº¦é“¾æ¥æ ¼å¼

```
æ ¼å¼: [link:/è·¯å¾„]
ç¤ºä¾‹: [link:/rx/rx_7e3492a63958]

è§£æè§„åˆ™ (H5 Notifications.vue):
  æ­£åˆ™: /\[link:([^\]]+)\]/
  åŒ¹é… â†’ æå–è·¯å¾„ â†’ router.push(è·¯å¾„)
  ä¸åŒ¹é… â†’ é€šçŸ¥ä¸å¯ç‚¹å‡»
```

#### P1 å¤„æ–¹å®¡æ‰¹â†’é€šçŸ¥ å®Œæ•´é—­ç¯

> **æƒå¨æ¥æº:** `api/r6_coach_flywheel_api_live.py` `approve_review()`

```
Step 1: UPDATE coach_review_queue SET status='approved'
Step 2: è‹¥ type='prescription' â†’ _activate_prescription()
        å†™å…¥ behavior_prescriptions (status='active')
        è¿”å› rx_id
Step 3: è§¦å‘ generate_daily_tasks_for_user() é‡æ–°ç”Ÿæˆæ¯æ—¥ä»»åŠ¡
Step 4: INSERT INTO coach_review_logs (action='approved')
Step 5: (commit å, non-blocking) push_router.send_notification()
        å«æ·±åº¦é“¾æ¥: "[link:/rx/{rx_id}]"
```

**å¤„æ–¹æ¿€æ´»è§„åˆ™ (`_activate_prescription`):**
- ç”Ÿæˆ `rx_id = "rx_{uuid[:12]}"` (å®¡æ‰¹æ¿€æ´»)
- INSERT INTO behavior_prescriptions, status='active', approved_by_review=review_id
- å­—æ®µæ¥æº: rx_json ä¸­çš„ target_behavior, frequency_dose, trigger_cue, obstacle_plan, domain, difficulty_level

---

## äºŒã€äº¤äº’è§„åˆ’è§„åˆ™

### 2.1 è¯„ä¼°ç®¡çº¿ (BAPS)

> **æƒå¨æ¥æº:** `api/assessment_pipeline_api.py`

#### äº”å¤§è¯„ä¼°æ¨¡å—

| æ¨¡å— | é¢˜æ•° | è¯„ä¼°ç»´åº¦ | å¿…é€‰æ€§ |
|------|------|---------|--------|
| TTM-7 | 21é¢˜ (7ç»„Ã—3) | è¡Œä¸ºæ”¹å˜é˜¶æ®µå°±ç»ªåº¦ | å¿…é€‰ |
| BigFive | 50é¢˜ | äººæ ¼äº”å› ç´  (O/C/E/A/N) | å¯é€‰ |
| BPT-6 | 18é¢˜ | è¡Œä¸ºæ¨¡å¼åˆ†å‹ (6ç±») | å¯é€‰ |
| CAPACITY | 32é¢˜ | å…­ç»´èƒ½åŠ› (ä¿¡å¿ƒ/èƒ½åŠ›/æ„ŸçŸ¥/èµ„æº/å…´è¶£/æ—¶é—´) | å¯é€‰ |
| SPI | 50é¢˜ | å¿ƒç†å±‚çº§ (L1-L5 æˆåŠŸæ¦‚ç‡) | å¯é€‰ |

#### TTM-7 é‡è¡¨ç»“æ„

| åˆ†ç»„ | é¢˜å· | æµ‹é‡ç»´åº¦ |
|------|------|---------|
| ç¬¬1ç»„ | TTM01-03 | å‰æ„è¯† (Pre-contemplation) |
| ç¬¬2ç»„ | TTM04-06 | é˜»æŠ— (Resistance) |
| ç¬¬3ç»„ | TTM07-09 | æ„è¯† (Contemplation) |
| ç¬¬4ç»„ | TTM10-12 | å‡†å¤‡ (Preparation) |
| ç¬¬5ç»„ | TTM13-15 | è¡ŒåŠ¨ (Action) |
| ç¬¬6ç»„ | TTM16-18 | ç»´æŒ (Maintenance) |
| ç¬¬7ç»„ | TTM19-21 | ç»ˆæ­¢ (Termination) |

#### BPT-6 å…­ç±»è¡Œä¸ºæ¨¡å¼

| åˆ†å‹ | ä»£ç  | ç‰¹å¾ |
|------|------|------|
| è¡ŒåŠ¨å‹ | action | åå¥½ç›´æ¥è¡ŒåŠ¨ |
| è®¤çŸ¥å‹ | knowledge | åå¥½å­¦ä¹ ç†è§£ |
| æƒ…æ„Ÿå‹ | emotion | æƒ…ç»ªé©±åŠ¨ |
| å…³ç³»å‹ | relation | ç¤¾äº¤é©±åŠ¨ |
| ç¯å¢ƒå‹ | environment | ç¯å¢ƒæ•æ„Ÿ |
| æ··åˆå‹ | mixed | å¤šç»´åº¦å‡è¡¡ |

#### CAPACITY å…­å› å­

| å› å­ | ä»£ç  | è¯´æ˜ |
|------|------|------|
| ä¿¡å¿ƒ | C | Confidence |
| èƒ½åŠ› | A | Ability |
| æ„ŸçŸ¥ | P | Perception |
| èµ„æº | A2 | Accessibility |
| å…´è¶£ | I | Interest |
| æ—¶é—´ | T | Time |

#### è¯„ä¼°æ•°æ®ç®¡çº¿

```
TTM-7 â†’ ç¡®å®šè¡Œä¸ºé˜¶æ®µ (S0-S6)
BigFive â†’ ç¡®å®šäººæ ¼ç”»åƒ (O/C/E/A/N å„ 0-100)
BPT-6 â†’ ç¡®å®šè¡Œä¸ºæ¨¡å¼åˆ†å‹
CAPACITY â†’ ç¡®å®šå…­ç»´èƒ½åŠ›å¾—åˆ† + å¼±é¡¹/å¼ºé¡¹
SPI â†’ ç¡®å®šå¿ƒç†å±‚çº§ (L1-L5) + æˆåŠŸæ¦‚ç‡ (0-100)
    â†“
å†™å…¥ BehavioralProfile (ç»Ÿä¸€ç”»åƒ)
    â†“
é©±åŠ¨å¤„æ–¹ç”Ÿæˆ + Agent è·¯ç”± + å†…å®¹æ¨è
```

---

### 2.2 Agent è·¯ç”±ä¸åä½œ

> **æƒå¨æ¥æº:** `core/agents/router.py`

#### è·¯ç”±å…­å¤§è§„åˆ™ (æŒ‰ä¼˜å…ˆçº§)

| è§„åˆ™ | æƒé‡ | æ¡ä»¶ | è¯´æ˜ |
|------|------|------|------|
| R1 å±æœºå¼ºåˆ¶ | ç«‹å³è¿”å› | domain=crisis + å±æœºå…³é”®è¯ | è·³è¿‡æ‰€æœ‰åç»­è§„åˆ™, ç›´æ¥è·¯ç”±åˆ° crisis agent |
| R2 é£é™©ç­‰çº§ | +50~100åˆ† | risk=critical/high + åŒ¹é…åŸŸ | é«˜é£é™©å¼ºåŒ–å¯¹åº”é¢†åŸŸæƒé‡ |
| R3a ç§Ÿæˆ·å…³é”®è¯ | +30Ã—boost | tenant keyword overrides å‘½ä¸­ | ç§Ÿæˆ·è‡ªå®šä¹‰å…³é”®è¯ä¼˜å…ˆçº§ |
| R3b å¹³å°å…³é”®è¯ | +30åˆ† | agent.matches_intent() å‘½ä¸­ | å¹³å°çº§å…³é”®è¯åŒ¹é… |
| R4 ç”¨æˆ·åå¥½ | +20åˆ† | preferences.focus == domain | ç”¨æˆ·è®¾ç½®çš„å…³æ³¨é¢†åŸŸ |
| R5 è®¾å¤‡æ•°æ® | +15åˆ†/å­—æ®µ | device_data å­—æ®µåŒ¹é… agent.data_fields | è®¾å¤‡æ•°æ®ç±»å‹æ˜ å°„ |
| R6 é¢†åŸŸå…³è” | è¡¥å…… | ä¸» agent å·²é€‰å®šå, æ·»åŠ å…³è” agent | å…³è” agent ä¹Ÿéœ€æœ‰å…³é”®è¯åŒ¹é… |

#### 16+4 Agent æ¸…å•

**9 ä¸ªä¸“ç§‘ Agent:**
metabolic (ä»£è°¢), sleep (ç¡çœ ), emotion (æƒ…ç»ª), motivation (åŠ¨æœº), coaching (æ•™ç»ƒ), nutrition (è¥å…»), exercise (è¿åŠ¨), tcm (ä¸­åŒ»), crisis (å±æœº)

**3 ä¸ªæ•´åˆ Agent:**
behavior_rx (è¡Œä¸ºå¤„æ–¹), weight (ä½“é‡), cardiac_rehab (å¿ƒè„åº·å¤)

**4 ä¸ª V4.0 Agent:**
journey_companion (æ—…ç¨‹ä¼´è¡Œ), growth_reflection (æˆé•¿å¤ç›˜), coach_copilot (æ•™ç»ƒå‰¯é©¾é©¶), life_designer (ç”Ÿå‘½è®¾è®¡å¸ˆ)

**4 ä¸ª BehaviorRx Expert Agent:**
BehaviorCoachAgent, MetabolicExpertAgent, CardiacExpertAgent, AdherenceExpertAgent

#### Agent åŸºç¡€æƒé‡ (AGENT_BASE_WEIGHTS)

> **æƒå¨æ¥æº:** `core/agents/base.py`

| Agent | åŸºç¡€æƒé‡ | è¯´æ˜ |
|-------|---------|------|
| crisis | 1.0 | æœ€é«˜ä¼˜å…ˆçº§ |
| glucose | 0.9 | â€” |
| behavior_rx | 0.9 | â€” |
| sleep | 0.85 | â€” |
| stress | 0.85 | â€” |
| mental | 0.85 | â€” |
| weight | 0.85 | â€” |
| cardiac_rehab | 0.85 | â€” |
| nutrition | 0.8 | â€” |
| exercise | 0.8 | â€” |
| motivation | 0.8 | â€” |
| tcm | 0.75 | æœ€ä½æƒé‡ |

#### åŸŸå…³è”ç½‘ç»œ (DOMAIN_CORRELATIONS)

> **æƒå¨æ¥æº:** `core/agents/base.py`

| ä¸»åŸŸ | å…³è”åŸŸ |
|------|-------|
| sleep | glucose, stress, mental, exercise |
| glucose | sleep, nutrition, exercise, weight, stress |
| stress | sleep, mental, exercise, cardiac_rehab |
| nutrition | glucose, exercise, weight, tcm |
| exercise | glucose, stress, sleep, weight, cardiac_rehab |
| mental | stress, sleep, behavior_rx, motivation |
| tcm | nutrition, sleep, mental, stress |
| crisis | mental, stress, behavior_rx |
| behavior_rx | mental, motivation, nutrition, exercise, sleep, glucose, weight, tcm, stress |
| weight | nutrition, exercise, glucose, sleep, mental, motivation, behavior_rx, tcm |
| cardiac_rehab | exercise, stress, sleep, nutrition, mental, glucose, weight, motivation, behavior_rx |

**ä½¿ç”¨è§„åˆ™:** ä¸» Agent é€‰å®šå, æŒ‰ R6 è§„åˆ™ä»å…³è”åŸŸä¸­é€‰æ‹© 1 ä¸ªè¾…åŠ© Agent (éœ€æœ‰å…³é”®è¯å‘½ä¸­)ã€‚

#### å¤š Agent åè°ƒä¹æ­¥ç®—æ³• (MultiAgentCoordinator)

> **æƒå¨æ¥æº:** `core/agents/coordinator.py`

```
Step 1: åˆ†é…æƒé‡ â€” AGENT_BASE_WEIGHTS Ã— agent.confidence
Step 2: æ£€æµ‹å†²çª â€” æ‰«ææ‰€æœ‰ Agent å¯¹, æŸ¥ CONFLICT_PRIORITY å­—å…¸
Step 3: è§£å†³å†²çª â€” ä½ä¼˜å…ˆåŸŸçš„ confidence Ã— 0.6
Step 4: åˆå¹¶å‘ç° â€” æ‹¼æ¥æ‰€æœ‰ Agent çš„ findings
Step 5: åˆå¹¶å»ºè®® â€” æŒ‰ (weight Ã— confidence) é™åºæ’åˆ—
Step 6: ç»¼åˆé£é™© â€” å–æœ€å¤§å€¼: CRITICAL > HIGH > MODERATE > LOW
Step 7: ç»¼åˆç½®ä¿¡åº¦ â€” åŠ æƒå¹³å‡: Î£(weight Ã— confidence) / Î£(weight)
Step 8: æå–å…±è¯† â€” å‡ºç°åœ¨ â‰¥2 ä¸ª Agent å»ºè®®ä¸­çš„è¯é¢˜
Step 9: ç”Ÿæˆæ‘˜è¦ â€” "ç»¼åˆ N ä¸ª Agent (domains...) ç»“è®º: é£é™©=X, ç½®ä¿¡åº¦=Y"
```

**å†²çªä¼˜å…ˆçº§è§„åˆ™ (CONFLICT_PRIORITY):**

| Agent A | Agent B | èƒœè€… | ç†ç”± |
|---------|---------|------|------|
| glucose | nutrition | glucose | è¡€ç³–ä¼˜å…ˆ |
| sleep | exercise | sleep | ç¡çœ ä¼˜å…ˆ |
| stress | exercise | stress | å‹åŠ›ç®¡ç†ä¼˜å…ˆ |
| mental | exercise | mental | å¿ƒç†å¥åº·ä¼˜å…ˆ |

---

### 2.3 MasterAgent ä¹æ­¥ç®¡çº¿

> **æƒå¨æ¥æº:** `core/master_agent_v0.py`

```
Step 1: æ¥æ”¶ç”¨æˆ·è¾“å…¥ (TEXT/VOICE/DEVICE/FORM/ASSESSMENT/TASK_REPORT)
Step 2: æ›´æ–° User Master Profile
  Step 2.5: [V005] å®‰å…¨ç®¡çº¿è¾“å…¥è¿‡æ»¤ (SafetyPipeline.input_filter)
Step 3: Agent Router åˆ¤å®šé—®é¢˜ç±»å‹ + é£é™©ä¼˜å…ˆçº§
  Step 3.5: [BehaviorRx] ExpertAgentRouter é€‰æ‹©ä¸“å®¶ Agent
Step 4: è°ƒç”¨ 1-2 ä¸ªä¸“ç§‘ Agent
Step 5: Multi-Agent Coordinator ç»Ÿä¸€ä¸Šä¸‹æ–‡ä¸ç»“æœ
Step 6: Intervention Planner ç”Ÿæˆä¸ªæ€§åŒ–è¡Œä¸ºè·¯å¾„
Step 7: Response Synthesizer ä»¥æ•™ç»ƒé£æ ¼è¾“å‡º
  Step 7.5: [V005] å®‰å…¨ç®¡çº¿ç”Ÿæˆå®ˆå« (SafetyPipeline.generation_guard)
Step 8: å†™å› Master Profile + ç”Ÿæˆæ¯æ—¥ä»»åŠ¡
  Step 8.5: [V005] å®‰å…¨ç®¡çº¿è¾“å‡ºè¿‡æ»¤ (SafetyPipeline.output_filter)
Step 9: è¿”å›æœ€ç»ˆå“åº”
```

**é£é™©ç­‰çº§:**
- CRITICAL: éœ€ç«‹å³å¹²é¢„
- HIGH: ä¼˜å…ˆå¤„ç†
- MODERATE: å¸¸è§„å¤„ç†
- LOW: ç»´æŒæ€§å¹²é¢„

---

### 2.4 V4.0 å››å¤§é™ªä¼´ Agent

> **æƒå¨æ¥æº:** `core/agents/v4_agents.py`

#### JourneyCompanionAgent â€” æ—…ç¨‹ä¼´è¡Œ

| å±æ€§ | å€¼ |
|------|------|
| é¢†åŸŸ | COACHING |
| ä¼˜å…ˆçº§ | 1 (æœ€é«˜) |
| æƒé‡ | 0.90 |
| å…³é”®è¯ | æ—…ç¨‹, é™ªä¼´, é˜¶æ®µ, å›°éš¾, åšæŒä¸ä¸‹å», ä¾ä», æ‰“å¡, è¿ç»­, ä¸­æ–­ |

**é˜¶æ®µæ„ŸçŸ¥å¼•å¯¼:**

| é˜¶æ®µ | è¯­è°ƒ | å¼•å¯¼ç­–ç•¥ |
|------|------|---------|
| S0 | æ¸©å’Œæ¥çº³ | å»ºç«‹å®‰å…¨æ„Ÿ |
| S1 | å¥½å¥‡æ¢ç´¢ | å¸®åŠ©çœ‹è§ç°çŠ¶ |
| S2 | é¼“åŠ±è€å¿ƒ | æ”¯æŒå°è¯• |
| S3 | åä½œèµ‹èƒ½ | å·©å›ºè·¯å¾„ |
| S4 | åæ€æ·±å±‚ | å†…åŒ–èº«ä»½ |
| S5 | å°Šé‡å¹³ç­‰ | åº†ç¥ä¼ æ‰¿ |

**Agency æ¨¡å¼é€‚é…:**
- passive â†’ ä¸»åŠ¨å¼•å¯¼
- transitional â†’ åä½œæ¢ç´¢
- active â†’ é•œå­è§’è‰² (å€¾å¬åæ˜ )

**é¢„è­¦ä¿¡å·:**
- ä¾ä»ç‡ <50% â†’ å…³æ³¨å¹¶å»ºè®®å›é¡¾ä¸­æ–­åŸå› 
- ä¾ä»ç‡ <30% â†’ é£é™©æ ‡è®° MODERATE
- æ£€æµ‹åˆ°æ”¾å¼ƒå…³é”®è¯ ("æ”¾å¼ƒ", "æ²¡ç”¨") â†’ æ¥çº³ + æ¢ç´¢å·®å¼‚æ€§

#### GrowthReflectionAgent â€” æˆé•¿å¤ç›˜

| å±æ€§ | å€¼ |
|------|------|
| ä¼˜å…ˆçº§ | 3 |
| æƒé‡ | 0.80 |
| å…³é”®è¯ | æˆé•¿, å¤ç›˜, åæ€, è§‰å¯Ÿ, æ¨¡å¼, å‘ç°, å˜åŒ–, æˆ‘æ³¨æ„åˆ°, æˆ‘æ„è¯†åˆ° |

**åæ€æ·±åº¦è¯„ä¼°:**

| æ·±åº¦åˆ†å€¼ | å±‚çº§ | å¼•å¯¼ |
|----------|------|------|
| â‰¥0.8 | èº«ä»½å±‚åæ€ | "éå¸¸æ·±å…¥, å¯æ¢ç´¢ç†æƒ³è‡ªæˆ‘" |
| 0.5-0.8 | æ¨¡å¼è§‰å¯Ÿ | "å‘ç°è§„å¾‹, è®°å½•æ„Ÿå—" |
| 0.2-0.5 | è¡¨é¢è§‰å¯Ÿ | "å¥½çš„ç¬¬ä¸€æ­¥, ç»ƒä¹ ç»†èŠ‚" |
| <0.2 | åˆå§‹é˜¶æ®µ | "ä»æ„å¤–äº‹ä»¶å¼€å§‹ç»ƒä¹ " |

**Agency æ¨¡å¼ä»»åŠ¡åˆ†é…:**
- passive â†’ "è¿™å‘¨æœ€å¼€å¿ƒ/å›°æ‰°çš„äº‹æ˜¯?" + guided_reflection ä»»åŠ¡
- transitional â†’ "æ³¨æ„åˆ°æ–°è¡Œä¸ºæ¨¡å¼?" + pattern_journal (7å¤©)
- active â†’ "å¦‚ä½•æ”¹å˜è‡ªæˆ‘è®¤çŸ¥?" + identity_reflection (1æ¬¡)

#### CoachCopilotAgent â€” æ•™ç»ƒå‰¯é©¾é©¶

| å±æ€§ | å€¼ |
|------|------|
| ä¼˜å…ˆçº§ | 2 |
| æƒé‡ | 0.85 |
| æ•°æ®æ¥å…¥ | CGM, Sleep, HRV, Steps |

**é¢„è­¦æ£€æµ‹:**

| æŒ‡æ ‡ | é˜ˆå€¼ | æ ‡ç­¾ |
|------|------|------|
| CGM | >11.1 mmol/L | è¡€ç³–å¼‚å¸¸åé«˜ |
| CGM | <3.9 mmol/L | è¡€ç³–å¼‚å¸¸åä½ |
| Sleep | <5h | ç¡çœ ä¸¥é‡ä¸è¶³ |
| HRV | <20ms | å‹åŠ›/ç–²åŠ³ä¿¡å· |

**å­¦å‘˜ä¾ä»ç‡è¡ŒåŠ¨å»ºè®®:**
- <30% â†’ ç®€åŒ–å¾®è¡ŒåŠ¨ + ç”µè¯è·Ÿè¿› + æ¢ç´¢é˜»ç¢ (1å¤©å†…)
- 30-60% â†’ å›é¡¾éš¾åº¦åŒ¹é… (3å¤©å†…)

#### LifeDesignerAgent â€” ç”Ÿå‘½è®¾è®¡å¸ˆ

| å±æ€§ | å€¼ |
|------|------|
| ä¼˜å…ˆçº§ | 4 |
| æƒé‡ | 0.75 |
| å…³é”®è¯ | äººç”Ÿ, èº«ä»½, ä»·å€¼è§‚, ä½¿å‘½, æ„ä¹‰, æˆä¸º, æœªæ¥, ç”Ÿå‘½è®¾è®¡, LifeOS |

**é˜¶æ®µé€‚é…:**
- S0-S2 (æ—©æœŸ): ä½ç½®ä¿¡åº¦ (0.4), "å½“å‰èšç„¦è¡Œä¸ºæ”¹å˜åŸºç¡€, èº«ä»½æ¢ç´¢è‡ªç„¶æµ®ç°"
- S3+ (è¿›é˜¶): è§¦å‘èº«ä»½å·¥ä½œ
  - "èº«ä»½"/"æˆ‘æ˜¯è°" â†’ identity_chain ç»ƒä¹  (1æ¬¡)
  - "æœªæ¥"/"ç›®æ ‡"/"æ¢¦æƒ³" â†’ LifeOS design (7å¤©)
  - "æ„ä¹‰"/"ä½¿å‘½" â†’ narrative_rewrite (1æ¬¡)

---

### 2.5 æ¨é€å®¡æ‰¹å·¥ä½œæµ

> **æƒå¨æ¥æº:** `core/coach_push_queue_service.py`

#### æ¨é€é˜Ÿåˆ—æ¡ç›®åˆ›å»º

```
create_queue_item(
  coach_id, student_id,
  source_type: challenge | device_alert | micro_action | ai_recommendation | system,
  title, content, content_extra,
  suggested_time, priority: high | normal | low
) â†’ CoachPushQueue (status=pending)
```

#### ç”Ÿå‘½å‘¨æœŸ

```
pending (åˆ›å»º) â”€â†’ approved (æ•™ç»ƒæ‰¹å‡†) â”€â†’ sent (å·²æŠ•é€’)
     â”‚                                          â†‘
     â”œâ”€â†’ rejected (æ•™ç»ƒé€€å›)          deliver_item() æ‰§è¡Œ:
     â”‚                                 1. åˆ›å»º CoachMessage / Reminder / MicroActionTask
     â””â”€â†’ expired (72h æœªå¤„ç†)         2. push_router å†™ notifications è¡¨ + å¤–éƒ¨æ¨é€
```

#### ä¼˜å…ˆçº§æ’åº

```
high (order=0) > normal (order=1) > low (order=2)
åŒä¼˜å…ˆçº§å†…æŒ‰ created_at DESC (æœ€æ–°ä¼˜å…ˆ)
```

#### æŠ•é€’ç‰©å·®å¼‚åŒ–

| source_type | æŠ•é€’åŠ¨ä½œ |
|-------------|---------|
| coach_reminder | åˆ›å»º Reminder (å« cron_expr/next_fire_at) |
| coach_message | åˆ›å»º CoachMessage (ä¿ç•™ message_type) |
| assessment_push | æ›´æ–° AssessmentAssignment.status='pushed' + CoachMessage |
| micro_action_assign | åˆ›å»º MicroActionTask + é€šçŸ¥ CoachMessage |
| å…¶ä»– | CoachMessage + é€šç”¨ Reminder |

---

### 2.6 æ¨é€æ¨èå¼•æ“ (å…­è§„åˆ™)

> **æƒå¨æ¥æº:** `core/push_recommendation_service.py`

| æ­¥éª¤ | è§„åˆ™ | æ•°æ®æº |
|------|------|--------|
| 1 | æŸ¥è¯¢æ•™ç»ƒåä¸‹å­¦å‘˜ | coach_student_bindings |
| 2 | é‡‡é›† 7 å¤©è®¾å¤‡ä¿¡å· | glucose, heart_rate, sleep, activity |
| 3 | åˆ†æè¡Œä¸ºäº‹å® | BehaviorFactsService |
| 4 | æŸ¥è¯¢è¡Œä¸ºç”»åƒ | BehavioralProfile (stage, big5, capacity) |
| 5 | è®¡ç®—è·ä¸Šæ¬¡è¯„ä¼°å¤©æ•° | assessment_sessions |
| 6 | æ£€æŸ¥å¾…å¤„ç†è¯„ä¼° | assessment_assignments |

**ä¼˜å…ˆçº§æ’åº:** high (0) > medium (1) > low (2)

---

### 2.7 æ–¹æ¡ˆç®¡ç†ä¸æŒ‘æˆ˜ç”Ÿå‘½å‘¨æœŸ

> **æƒå¨æ¥æº:** `core/challenge_service.py` + `core/program_service.py`

#### æŒ‘æˆ˜çŠ¶æ€æœº

```
æ¨¡æ¿çŠ¶æ€:
  DRAFT â”€â†’ PENDING_REVIEW â”€â†’ REVIEW_PARTIAL â”€â†’ PUBLISHED
    â†‘                                              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ REJECTED (ä»»ä¸€å®¡æ ¸å‘˜é€€å›) â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æŠ¥åçŠ¶æ€:
  ENROLLED â”€â†’ ACTIVE â”€â†’ COMPLETED
```

**åŒä¸“å®¶å®¡æ ¸è§„åˆ™:**
- æœ€ä½åˆ›å»ºç­‰çº§: L3 (coach)
- æœ€ä½å®¡æ ¸ç­‰çº§: L4 (promoter/supervisor)
- éœ€ä¸¤ä½ä¸“å®¶å‡æ‰¹å‡†æ–¹å¯å‘å¸ƒ
- ä»»ä¸€é€€å›åˆ™å›åˆ° DRAFT

#### æ–¹æ¡ˆå¼•æ“ (ProgramEngine)

- æ¨¡æ¿é©±åŠ¨: å«æ¯æ—¥æ¨é€å†…å®¹ + å¾®è°ƒæŸ¥ + è¡Œä¸ºæŒ‡å¯¼
- ä¸‰æ—¶æ®µæ¨é€: 09:00 (æ™¨é—´) / 11:30 (åˆé—´) / 17:30 (å‚æ™š)
- æ¯æ—¥æ¨è¿›: 00:05 è‡ªåŠ¨æ¨è¿› active æŠ¥åçš„ current_day
- 23:00 æ‰¹é‡åˆ†æ: æ›´æ–°è¡Œä¸ºç‰¹å¾

---

### 2.8 å®šæ—¶ä»»åŠ¡ä½“ç³» (20 Jobs)

> **æƒå¨æ¥æº:** `core/scheduler.py`, å…¨éƒ¨ä½¿ç”¨ `@with_redis_lock` åˆ†å¸ƒå¼äº’æ–¥

| ä»»åŠ¡ | è§¦å‘æ—¶é—´ | é” TTL | è¯´æ˜ |
|------|---------|--------|------|
| daily_task_generation | 06:00 æ¯æ—¥ | 600s | ä¸ºæ´»è·ƒç”¨æˆ·ç”Ÿæˆå¾®è¡ŒåŠ¨ |
| reminder_check | æ¯ 1 åˆ†é’Ÿ | 60s | è§¦å‘åˆ°æœŸæé†’ |
| expired_task_cleanup | 23:59 æ¯æ—¥ | 300s | æ ‡è®°è¿‡æœŸä»»åŠ¡ |
| process_approved_pushes | æ¯ 5 åˆ†é’Ÿ | 300s | æŠ•é€’å·²å®¡æ‰¹çš„å®šæ—¶æ¨é€ |
| expire_stale_queue_items | 06:30 æ¯æ—¥ | 300s | æ¸…ç† 72h+ æœªå®¡æ‰¹æ¡ç›® |
| knowledge_freshness_check | 07:00 æ¯æ—¥ | 300s | é™çº§è¿‡æœŸçŸ¥è¯†æ–‡æ¡£ |
| program_advance_day | 00:05 æ¯æ—¥ | 600s | æ¨è¿›æ–¹æ¡ˆæ—¥æœŸ |
| program_push_morning | 09:00 æ¯æ—¥ | 300s | æ–¹æ¡ˆæ™¨é—´æ¨é€ |
| program_push_noon | 11:30 æ¯æ—¥ | 300s | æ–¹æ¡ˆåˆé—´æ¨é€ |
| program_push_evening | 17:30 æ¯æ—¥ | 300s | æ–¹æ¡ˆå‚æ™šæ¨é€ |
| program_batch_analysis | 23:00 æ¯æ—¥ | 600s | æ‰¹é‡è¡Œä¸ºç‰¹å¾æ›´æ–° |
| morning_notifications | 06:15 æ¯æ—¥ | 300s | æ™¨é—´æé†’ (P3) |
| midday_notifications | 08:00 æ¯æ—¥ | 300s | åˆé—´æé†’ (P3) |
| evening_notifications | 22:00 æ¯æ—¥ | 300s | æ™šé—´æé†’ (P3) |
| analytics_daily | 03:00 æ¯æ—¥ | 600s | æ¯æ—¥åˆ†æèšåˆ (P5) |
| + å…¶ä»– V004/V005/V006/P6B ä»»åŠ¡ | â€” | 300s | â€” |

**äº’æ–¥é”æœºåˆ¶:**
```
Redis SETNX "scheduler:{job_name}" â†’ æˆåŠŸåˆ™æ‰§è¡Œ, TTL åè‡ªåŠ¨é‡Šæ”¾
Redis ä¸å¯ç”¨ â†’ ä¼˜é›…é™çº§, ç›´æ¥æ‰§è¡Œ (å•å®ä¾‹åœºæ™¯æ— å†²çª)
```

---

## ä¸‰ã€è¡Œä¸ºå¤„æ–¹ç”Ÿæˆè§„åˆ™

### 3.1 ä¸‰ç»´å¤„æ–¹æ¨¡å‹æ¦‚è¿°

> **æƒå¨æ¥æº:** `behavior_rx/core/behavior_rx_engine.py` (899è¡Œ)

è¡Œä¸ºå¤„æ–¹ç”±ä¸‰ä¸ªç»´åº¦äº¤å‰å†³å®š:

```
ç»´åº¦ 1: TTM é˜¶æ®µ (S0-S6) â”€â†’ ç­–ç•¥é€‰æ‹© (12ç§ç­–ç•¥)
ç»´åº¦ 2: BigFive äººæ ¼ â”€â”€â”€â”€â”€â”€â†’ æ²Ÿé€šé£æ ¼ (6ç§é£æ ¼)
ç»´åº¦ 3: CAPACITY åˆ†å€¼ â”€â”€â”€â”€â†’ å¼ºåº¦æ ¡å‡† (5çº§å¼ºåº¦) + èŠ‚å¥ (3ç§)
```

**æ€§èƒ½æŒ‡æ ‡:** <200ms P99 å»¶è¿Ÿ (ç¡®å®šæ€§å¼•æ“, æ—  LLM è°ƒç”¨)

---

### 3.2 ç»´åº¦ä¸€: TTM é˜¶æ®µâ†’ç­–ç•¥é€‰æ‹©

#### 12 ç§è¡Œä¸ºæ”¹å˜ç­–ç•¥

| ç­–ç•¥ | ä¸­æ–‡ | é€‚ç”¨é˜¶æ®µ | æœºåˆ¶ |
|------|------|---------|------|
| consciousness_raising | æ„è¯†å”¤é†’ | S0-S2 | æå‡å¯¹é—®é¢˜çš„è®¤çŸ¥ |
| dramatic_relief | æˆå‰§æ€§è§£è„± | S0-S1 | æƒ…ç»ªè§¦åŠ¨ä¿ƒè¿›è§‰é†’ |
| self_reevaluation | è‡ªæˆ‘å†è¯„ä»· | S1-S2 | é‡æ–°å®¡è§†è‡ªæˆ‘ä¸è¡Œä¸º |
| decisional_balance | å†³ç­–å¹³è¡¡ | S1-S2 | æƒè¡¡æ”¹å˜çš„åˆ©å¼Š |
| cognitive_restructuring | è®¤çŸ¥é‡æ„ | S2-S3 | ä¿®æ­£ä¸è‰¯è®¤çŸ¥æ¨¡å¼ |
| self_liberation | è‡ªæˆ‘è§£æ”¾ | S2 | åšå‡ºæ”¹å˜æ‰¿è¯º |
| stimulus_control | åˆºæ¿€æ§åˆ¶ | S3-S4 | ç®¡ç†ç¯å¢ƒè§¦å‘å› ç´  |
| contingency_management | å¼ºåŒ–ç®¡ç† | S3-S5 | å¥–æƒ©ç³»ç»Ÿ |
| habit_stacking | ä¹ æƒ¯å åŠ  | S3-S4 | å°†æ–°è¡Œä¸ºé™„åŠ åˆ°å·²æœ‰ä¹ æƒ¯ |
| systematic_desensitization | ç³»ç»Ÿè„±æ• | ç‰¹æ®Š | æ¸è¿›å¼å…‹æœææƒ§ |
| relapse_prevention | å¤å‘é¢„é˜² | S3-S6 | é˜²æ­¢è¡Œä¸ºå€’é€€ |
| self_monitoring | è‡ªæˆ‘ç›‘æ§ | S2-S6 | è¡Œä¸ºè‡ªæˆ‘è·Ÿè¸ª |

#### é˜¶æ®µâ†’ç­–ç•¥çŸ©é˜µ (STAGE_STRATEGY_MATRIX)

| é˜¶æ®µ | ä¸»ç­–ç•¥ (æŒ‰ä¼˜å…ˆçº§æ’åˆ—) |
|------|----------------------|
| S0 å‰æ„è¯† | æ„è¯†å”¤é†’, æˆå‰§æ€§è§£è„± |
| S1 æ„è¯† | æ„è¯†å”¤é†’, è‡ªæˆ‘å†è¯„ä»·, æˆå‰§æ€§è§£è„±, å†³ç­–å¹³è¡¡ |
| S2 å‡†å¤‡ | å†³ç­–å¹³è¡¡, è‡ªæˆ‘è§£æ”¾, è‡ªæˆ‘å†è¯„ä»·, è®¤çŸ¥é‡æ„, è‡ªæˆ‘ç›‘æ§ |
| S3 è¡ŒåŠ¨ | åˆºæ¿€æ§åˆ¶, å¼ºåŒ–ç®¡ç†, ä¹ æƒ¯å åŠ , è‡ªæˆ‘ç›‘æ§, è®¤çŸ¥é‡æ„, å¤å‘é¢„é˜² |
| S4 ç»´æŒ | å¤å‘é¢„é˜², å¼ºåŒ–ç®¡ç†, åˆºæ¿€æ§åˆ¶, è‡ªæˆ‘ç›‘æ§, ä¹ æƒ¯å åŠ  |
| S5 å·©å›º | è‡ªæˆ‘ç›‘æ§, å¤å‘é¢„é˜², å¼ºåŒ–ç®¡ç† |
| S6 ç»ˆæ­¢ | è‡ªæˆ‘ç›‘æ§, å¤å‘é¢„é˜² |

#### Agent ç±»å‹ç­–ç•¥åå¥½åŠ æˆ

| Agent ç±»å‹ | åå¥½ç­–ç•¥ (+åŠ æˆå€¼) |
|-----------|-------------------|
| BEHAVIOR_COACH | æ„è¯†å”¤é†’(+0.3), è®¤çŸ¥é‡æ„(+0.25), å†³ç­–å¹³è¡¡(+0.2), è‡ªæˆ‘å†è¯„ä»·(+0.2), è‡ªæˆ‘è§£æ”¾(+0.15) |
| METABOLIC_EXPERT | åˆºæ¿€æ§åˆ¶(+0.3), è‡ªæˆ‘ç›‘æ§(+0.25), å¼ºåŒ–ç®¡ç†(+0.2), ä¹ æƒ¯å åŠ (+0.2) |
| CARDIAC_EXPERT | ç³»ç»Ÿè„±æ•(+0.35), åˆºæ¿€æ§åˆ¶(+0.2), è‡ªæˆ‘ç›‘æ§(+0.2), å¤å‘é¢„é˜²(+0.15) |
| ADHERENCE_EXPERT | ä¹ æƒ¯å åŠ (+0.3), åˆºæ¿€æ§åˆ¶(+0.25), å¼ºåŒ–ç®¡ç†(+0.2), è®¤çŸ¥é‡æ„(+0.15) |

#### éšœç¢â†’ç­–ç•¥æ˜ å°„

| éšœç¢ç±»å‹ | å¼ºåŒ–ç­–ç•¥ |
|---------|---------|
| ææƒ§ (fear) | ç³»ç»Ÿè„±æ•, è®¤çŸ¥é‡æ„ |
| é—å¿˜ (forgetfulness) | ä¹ æƒ¯å åŠ , åˆºæ¿€æ§åˆ¶ |
| ä½åŠ¨æœº (low_motivation) | æˆå‰§æ€§è§£è„±, å†³ç­–å¹³è¡¡ |
| è®¤çŸ¥éšœç¢ (cognitive) | æ„è¯†å”¤é†’, è®¤çŸ¥é‡æ„ |
| ç»æµéšœç¢ (economic) | å†³ç­–å¹³è¡¡ |
| å…³ç³»éšœç¢ (relational) | è‡ªæˆ‘è§£æ”¾ |

---

### 3.3 ç»´åº¦äºŒ: BigFive äººæ ¼â†’æ²Ÿé€šé£æ ¼

#### å…­ç§æ²Ÿé€šé£æ ¼

| é£æ ¼ | ä¸­æ–‡ | è§¦å‘æ¡ä»¶ | ç‰¹ç‚¹ |
|------|------|---------|------|
| EMPATHETIC | å…±æƒ…å‹ | N â‰¥ 65 (æœ€é«˜ä¼˜å…ˆçº§) | æ¸©æš–æ¥çº³, æƒ…ç»ªä¼˜å…ˆ |
| DATA_DRIVEN | æ•°æ®é©±åŠ¨å‹ | C â‰¥ 65 | ç»“æ„åŒ–, è¯æ®å¯¼å‘ |
| CHALLENGE | æŒ‘æˆ˜å‹ | E â‰¥ 65 | é¼“åŠ±çªç ´, æ­£é¢æ¿€åŠ± |
| SOCIAL_PROOF | ç¤¾ä¼šè¯æ˜å‹ | A â‰¥ 65 | åŒä¼´æ¡ˆä¾‹, ç¾¤ä½“å½’å± |
| EXPLORATORY | æ¢ç´¢å‹ | O â‰¥ 65 | å¥½å¥‡å¼•å¯¼, å¼€æ”¾è®¨è®º |
| NEUTRAL | ä¸­ç«‹å‹ | é»˜è®¤ | å¹³è¡¡å®¢è§‚ |

**ä¼˜å…ˆçº§è§„åˆ™:** N > C > E > A > O > é»˜è®¤ (é«˜ç¥ç»è´¨ç”¨æˆ·ä¼˜å…ˆè·å¾—å…±æƒ…æ”¯æŒ)

#### äººæ ¼å¯¹ç­–ç•¥è¯„åˆ†çš„å½±å“

```
é«˜ N (â‰¥65): ç³»ç»Ÿè„±æ• +0.15, è®¤çŸ¥é‡æ„ +0.10
é«˜ C (â‰¥65): è‡ªæˆ‘ç›‘æ§ +0.15, åˆºæ¿€æ§åˆ¶ +0.10
é«˜ E (â‰¥65): å¼ºåŒ–ç®¡ç† +0.10, ä¹ æƒ¯å åŠ  +0.10
é«˜ A (â‰¥65): è‡ªæˆ‘è§£æ”¾ +0.10
é«˜ O (â‰¥65): æ„è¯†å”¤é†’ +0.10, å†³ç­–å¹³è¡¡ +0.10

ä½ N (<35): æŒ‘æˆ˜å‹ç­–ç•¥ +0.05
ä½ C (<35): ä¹ æƒ¯å åŠ  +0.10 (éœ€æ›´å¤šå¤–éƒ¨ç»“æ„)
```

#### äººæ ¼å¯¹å¥–åŠ±ç±»å‹çš„é€‚é…

- é«˜ E + praise â†’ ä¿æŒ "praise" (ç¤¾äº¤å¥–åŠ±æœ‰æ•ˆ)
- é«˜ C + praise â†’ åˆ‡æ¢ä¸º "badge" (æˆå°±å¥–åŠ±æ›´æœ‰æ•ˆ)

---

### 3.4 ç»´åº¦ä¸‰: CAPACITYâ†’å¼ºåº¦æ ¡å‡†

#### å¼ºåº¦çŸ©é˜µ (INTENSITY_MATRIX)

| é˜¶æ®µ \ èƒ½åŠ› | ä½ (<0.33) | ä¸­ (0.33-0.66) | é«˜ (>0.66) |
|-------------|-----------|----------------|-----------|
| S0 å‰æ„è¯† | æä½ | æä½ | ä½ |
| S1 æ„è¯† | æä½ | ä½ | ä½ |
| S2 å‡†å¤‡ | ä½ | ä¸­ç­‰ | ä¸­ç­‰ |
| S3 è¡ŒåŠ¨ | ä¸­ç­‰ | ä¸­ç­‰ | é«˜ |
| S4 ç»´æŒ | ä¸­ç­‰ | é«˜ | é«˜ |
| S5 å·©å›º | ä½ | ä¸­ç­‰ | ä¸­ç­‰ |
| S6 ç»ˆæ­¢ | æä½ | ä½ | ä½ |

**äº”çº§å¼ºåº¦:**
- minimal (æä½): æœ€å°å¹²é¢„, ä¿¡æ¯æä¾›
- low (ä½): è½»åº¦å¼•å¯¼
- moderate (ä¸­ç­‰): æ ‡å‡†å¹²é¢„
- high (é«˜): å¯†é›†å¹²é¢„
- intensive (å¼ºåŒ–): å±æœºçº§å¹²é¢„

#### èŠ‚å¥å†³å®šè§„åˆ™

```
è§„åˆ™ (æŒ‰ä¼˜å…ˆçº§):
1. S0-S1 æˆ– capacity < 0.3 â†’ slow (æ…¢èŠ‚å¥)
2. é«˜N ä¸” stability < 0.4 â†’ slow (å®‰å…¨ä¼˜å…ˆ)
3. S4+ ä¸” capacity > 0.7 ä¸” stability > 0.6 â†’ fast (å¿«èŠ‚å¥)
4. å…¶ä»– â†’ standard (æ ‡å‡†èŠ‚å¥)
```

---

### 3.5 å¾®è¡ŒåŠ¨ç”Ÿæˆè§„åˆ™

> **æƒå¨æ¥æº:** `behavior_rx_engine.py` `_generate_micro_actions()`

#### éš¾åº¦æ ¡å‡†å…¬å¼

```
adjusted_difficulty = raw_difficulty

if capacity < 0.3:
    adjusted_difficulty *= 0.6    # å¤§å¹…é™ä½
elif capacity < 0.5:
    adjusted_difficulty *= 0.8    # é€‚åº¦é™ä½
elif capacity > 0.7:
    adjusted_difficulty *= 1.1    # ç•¥å¾®æé«˜

æœ€ç»ˆ clamp åˆ° [0.05, 0.9]
```

**è®¾è®¡åŸåˆ™:** èƒ½åŠ›è¶Šä½, å¾®è¡ŒåŠ¨è¶Šç®€å•; ç¡®ä¿æ¯ä¸ªç”¨æˆ·éƒ½èƒ½å¼€å§‹

#### å¾®è¡ŒåŠ¨ç»“æ„

```
{
  action: "å…·ä½“å¯æ‰§è¡Œçš„è¡Œä¸ºæè¿°",
  difficulty: 0.0-1.0 (æ ¡å‡†å),
  trigger: "ä½•æ—¶/ä½•åœ°è§¦å‘",
  duration_min: æ‰§è¡Œæ—¶é•¿ (åˆ†é’Ÿ),
  frequency: "daily | weekly | on_trigger",
  domain: "nutrition | exercise | sleep | ..."
}
```

---

### 3.6 é˜»åŠ›é˜ˆå€¼ä¸å‡çº§è§„åˆ™

#### é˜»åŠ›é˜ˆå€¼è®¡ç®—

```python
base = 0.3

# äººæ ¼è°ƒæ•´
é«˜ N (â‰¥65): base -= 0.08    # æ›´æ—©åˆ‡æ¢ç­–ç•¥ (æƒ…ç»ªæ•æ„Ÿ)
é«˜ C (â‰¥65): base += 0.05    # æ›´æœ‰è€å¿ƒåšæŒ
ä½ C (<35): base -= 0.05    # æ›´æ—©åˆ‡æ¢

# èƒ½åŠ›è°ƒæ•´
base += (capacity - 0.5) * 0.1

# é˜¶æ®µè°ƒæ•´
S0-S1: base -= 0.05    # æ—©æœŸæ›´æ•æ„Ÿ

æœ€ç»ˆ clamp åˆ° [0.15, 0.50]
```

**å«ä¹‰:** é˜ˆå€¼è¶Šä½, ç³»ç»Ÿè¶Šæ—©åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªç­–ç•¥ (å¯¹è„†å¼±ç”¨æˆ·æ›´æ•æ„Ÿ)

#### å‡çº§è§„åˆ™ (Escalation Rules)

| è§„åˆ™ | ä¼˜å…ˆçº§ | æ¡ä»¶ | åŠ¨ä½œ |
|------|--------|------|------|
| é˜»åŠ›è¶…é˜ˆ | 5 | è¿ç»­3æ¬¡ resistance_score > threshold | åˆ‡æ¢ç­–ç•¥ |
| é˜¶æ®µå›é€€ | 8 | TTM é˜¶æ®µä¸‹é™ â‰¥2 çº§ | ç§»äº¤ BEHAVIOR_COACH |
| è‡ªæˆ‘æ•ˆèƒ½å´©å¡Œ | 10 | self_efficacy < 0.2 ä¸” stability < 0.3 | ç§»äº¤ BEHAVIOR_COACH |
| ä»£è°¢ç”¨è¯é—æ¼ | 7 | 7å¤©å†…æ¼è¯ >3 æ¬¡ (ä»… METABOLIC) | ç§»äº¤ ADHERENCE_EXPERT |
| å¿ƒè„è¿åŠ¨ææƒ§ | 8 | exercise_fear > 0.8 + å›é¿è¡Œä¸º (ä»… CARDIAC) | åˆ‡æ¢ç­–ç•¥ |
| å¿ƒç‡è¶…é™ | 10 | heart_rate > å®‰å…¨ä¸Šé™ (ä»… CARDIAC) | é€šçŸ¥æ•™ç»ƒ |
| é«˜Nè´Ÿé¢æƒ…ç»ª | 9 | negative_emotion > 0.85 è¿ç»­2æ¬¡ (é«˜Nç”¨æˆ·) | é€šçŸ¥æ•™ç»ƒ |

---

### 3.7 å¤„æ–¹æœ‰æ•ˆæ€§è¯„ä¼° (IES)

> **æƒå¨æ¥æº:** `behavior_rx_engine.py` `evaluate_effectiveness()`

#### IES ç»¼åˆæœ‰æ•ˆæ€§åˆ†å€¼ (0-1)

```
IES = å®Œæˆç‡ Ã— 0.40           # å¾®è¡ŒåŠ¨å®Œæˆåº¦
    + min(å¤©æ•°/30, 1.0) Ã— 0.20  # æŒç»­æ—¶é•¿
    + é˜¶æ®µå˜åŒ–åˆ† Ã— 0.25         # è¡Œä¸ºè¿›æ­¥
    - é˜»åŠ›æƒ©ç½š Ã— 0.15          # é˜»åŠ›æ‰£åˆ†

é˜¶æ®µå˜åŒ–åˆ† = max(0, min(stage_change+1, 3)) / 3
é˜»åŠ›æƒ©ç½š = min(resistance/10, 0.3)
```

#### IES å†³ç­–å»ºè®®

| IES åˆ†å€¼ | å»ºè®® | å«ä¹‰ |
|----------|------|------|
| â‰¥ 0.7 | continue | ç­–ç•¥æœ‰æ•ˆ, ç»§ç»­æ‰§è¡Œ |
| 0.4 - 0.7 | adjust | éœ€å¾®è°ƒå‚æ•° (å¼ºåº¦/èŠ‚å¥) |
| < 0.4 | switch_strategy | ç­–ç•¥æ— æ•ˆ, åˆ‡æ¢åˆ°ä¸‹ä¸€å€™é€‰ç­–ç•¥ |

---

### 3.8 æ··åˆè·¯ç”±: BehaviorRxâ†’LLM é™çº§

> **æƒå¨æ¥æº:** `api/v14/copilot_routes.py` `generate-prescription`

```
POST /copilot/generate-prescription {"student_id": N}

è·¯ç”±é€»è¾‘:
1. æŸ¥è¯¢ BehavioralProfile (user_id = student_id)
2. è‹¥ profile å­˜åœ¨ä¸” current_stage æœ‰å€¼:
   a. profile_to_rx_context() é€‚é…ä¸º RxContext
   b. select_agent_type() é€‰æ‹© ExpertAgentType
   c. BehaviorRxEngine.compute_rx() (<200ms)
   d. rx_dto_to_copilot_json() æ˜ å°„ä¸º 6-key æ ¼å¼
   e. å†™å…¥ behavior_prescriptions (status=draft)
   f. meta.source = "behavior_rx"
3. è‹¥å¤±è´¥æˆ–æ—  profile:
   a. é™çº§åˆ° CopilotPrescriptionService (LLM è·¯å¾„)
   b. LLM timeout=20s, å¤±è´¥åˆ™çº¯è§„åˆ™å¼•æ“
   c. meta.source = "llm" | "llm_merged" | "fallback"
```

**è¿”å›æ ¼å¼ (6-key, å…¼å®¹ admin-portal 5 æ ‡ç­¾é¡µ):**

```json
{
  "diagnosis": {è¯„ä¼°è¯Šæ–­},
  "prescription": {å¤„æ–¹æ–¹æ¡ˆ},
  "ai_suggestions": [AIå»ºè®®åˆ—è¡¨],
  "health_summary": {å¥åº·æ‘˜è¦},
  "intervention_plan": {å¹²é¢„è®¡åˆ’},
  "meta": {æ¥æº/ç½®ä¿¡åº¦/rx_id}
}
```

#### å¤„æ–¹ ID æ ¼å¼ä¸æŒä¹…åŒ–è§„åˆ™

| åœºæ™¯ | ID æ ¼å¼ | åˆå§‹çŠ¶æ€ | æ¥æº |
|------|---------|---------|------|
| copilot ç”Ÿæˆ (æ•™ç»ƒå·¥ä½œå°) | `rx_{uuid[:12]}` | draft | copilot_routes.py |
| æ•™ç»ƒå®¡æ‰¹æ¿€æ´» | `rx_{uuid[:12]}` | active | r6_coach_flywheel_api_live.py |
| Observerâ†’Grower åˆå§‹å¤„æ–¹ | `rx_init_{uuid[:8]}` | active | r4_role_upgrade_trigger.py |

**æŒä¹…åŒ–è¡¨:** `behavior_prescriptions`
**å†²çªç­–ç•¥:** `ON CONFLICT (id) DO NOTHING` (copilot/r4), ç›´æ¥ INSERT (å®¡æ‰¹æ¿€æ´»)
**å¤±è´¥å¤„ç†:** copilot â†’ db.rollback() + ç»§ç»­è¿”å›ç»“æœ (non-blocking); r4 â†’ fallback åˆ°é»˜è®¤å¤„æ–¹

#### CopilotPrescriptionService LLM è·¯å¾„è§„åˆ™

> **æƒå¨æ¥æº:** `core/copilot_prescription_service.py` (839è¡Œ)

**é˜¶æ®µâ†’SPI èŒƒå›´æ˜ å°„:**

| é˜¶æ®µ | ä¸­æ–‡ | SPI èŒƒå›´ | å¹²é¢„é˜¶æ®µ |
|------|------|---------|---------|
| S0 | æ— çŸ¥æ— è§‰ | 5â€“15 | è®¤çŸ¥å”¤é†’ |
| S1 | å¼ºçƒˆæŠ—æ‹’ | 10â€“25 | è®¤çŸ¥å”¤é†’ |
| S2 | è¢«åŠ¨æ‰¿è¯º | 20â€“40 | åŠ¨æœºæ¿€å‘ |
| S3 | å‹‰å¼ºæ¥å— | 35â€“55 | è¡Œä¸ºå¡‘é€  |
| S4 | ä¸»åŠ¨å°è¯• | 50â€“70 | ä¹ æƒ¯å¼ºåŒ– |
| S5 | è§„å¾‹è·µè¡Œ | 65â€“85 | è‡ªä¸»ç»´æŒ |
| S6 | å†…åŒ–ä¸ºå¸¸ | 80â€“95 | è‡ªä¸»ç»´æŒ |

**æ•°æ®é‡‡é›†çª—å£:**
- è¿‘æœŸè®¾å¤‡æ•°æ®: 7 å¤© (è¡€ç³–/ç¡çœ /è¿åŠ¨/å¾®è¡ŒåŠ¨)
- ä½“å¾æ•°æ®: æœ€è¿‘ 5 æ¡è®°å½•
- è¯„ä¼°æ•°æ®: æœ€æ–°ä¸€æ¬¡ (æ— æ—¶é—´çª—å£é™åˆ¶)

**LLM å†·å´è§„åˆ™:** å¤±è´¥å 300 ç§’ (5 åˆ†é’Ÿ) å†…ä¸é‡è¯•, ç›´æ¥èµ°è§„åˆ™å¼•æ“é™çº§è·¯å¾„

---

### 3.9 Profileâ†’RxContext é€‚é…è§„åˆ™

> **æƒå¨æ¥æº:** `core/rx_context_adapter.py`

#### åŸŸâ†’Expert Agent ç±»å‹æ˜ å°„ (DOMAIN_AGENT_MAP)

| primary_domain | ExpertAgentType | è¯´æ˜ |
|----------------|----------------|------|
| metabolic | METABOLIC_EXPERT | ä»£è°¢ä¸“å®¶ |
| glucose | METABOLIC_EXPERT | è¡€ç³–ç®¡ç† |
| nutrition | BEHAVIOR_COACH | è¥å…»è¡Œä¸º |
| exercise | BEHAVIOR_COACH | è¿åŠ¨è¡Œä¸º |
| sleep | BEHAVIOR_COACH | ç¡çœ è¡Œä¸º |
| emotion | BEHAVIOR_COACH | æƒ…ç»ªç®¡ç† |
| cardiac | CARDIAC_EXPERT | å¿ƒè„åº·å¤ |
| cardiac_rehab | CARDIAC_EXPERT | å¿ƒè„åº·å¤ |
| (æ— åŒ¹é…/æ— åŸŸ) | BEHAVIOR_COACH | é»˜è®¤ |

**é€‰æ‹©é€»è¾‘:** éå† `BehavioralProfile.primary_domains` åˆ—è¡¨, ç¬¬ä¸€ä¸ªå‘½ä¸­ DOMAIN_AGENT_MAP çš„åŸŸå†³å®š Agent ç±»å‹ã€‚

#### ORMâ†’DTO å­—æ®µè½¬æ¢è§„åˆ™

| ORM å­—æ®µ | è½¬æ¢è§„åˆ™ | DTO å­—æ®µ | é™çº§é»˜è®¤å€¼ |
|---------|---------|---------|-----------|
| current_stage (enum) | _STAGE_INT_MAP: S0=0..S6=6 | ttm_stage | 0 (S0) |
| stage_stability (enum) | STABLE=0.9, SEMI_STABLE=0.5, UNSTABLE=0.2 | stage_stability | 0.5 |
| big5_scores (JSON) | è¯»å– O/C/E/A/N å„é¡¹ | personality | å„é¡¹é»˜è®¤50 |
| capacity_total (0-100) | Ã·100, clamp [0,1] | capacity_score | 0.5 |
| spi_score (0-100) | Ã·100, clamp [0,1] | self_efficacy | 0.5 |
| stage_confidence | ç›´æ¥ä½¿ç”¨ | stage_readiness | 0.5 |
| domain_details (JSON) | ç›´æ¥ä½¿ç”¨ | domain_data | {} |
| user_id (int) | uuid5(NAMESPACE_DNS, "bhp-user-{id}") | user_id (UUID) | â€” |
| (æ— å†å²æ•°æ®) | â€” | recent_adherence | 0.5 |

#### Barrier æ˜ å°„è§„åˆ™ (CAPACITY å¼±é¡¹â†’éšœç¢ç±»å‹)

ä» `capacity_weak` åˆ—è¡¨ä¸­æå–éšœç¢å…³é”®è¯:

| å¼±é¡¹å…³é”®è¯ | éšœç¢ç±»å‹ | å«ä¹‰ |
|-----------|---------|------|
| åŠ¨æœº / M_ | low_motivation | ä½åŠ¨æœº |
| æ—¶é—´ / T_ | forgetfulness | é—å¿˜/æ— æš‡ |
| ä¿¡å¿ƒ / C_ | fear | ææƒ§/ä¿¡å¿ƒä¸è¶³ |
| èµ„æº / A2_ | economic | ç»æµ/èµ„æºéšœç¢ |
| è®¤çŸ¥ | cognitive | è®¤çŸ¥éšœç¢ |

#### é£é™©æ ‡è®°è§„åˆ™

| risk_flags å«å€¼ | risk_level |
|----------------|-----------|
| dropout_risk æˆ– relapse_risk | elevated |
| (æ— åŒ¹é…) | normal |

---

### 3.10 æ²Ÿé€šé£æ ¼â†’å¹²é¢„è¯­è°ƒæ˜ å°„

> **æƒå¨æ¥æº:** `core/rx_response_mapper.py` `_comm_to_tone()`

| æ²Ÿé€šé£æ ¼ | å¹²é¢„è¯­è°ƒ | æè¿° |
|---------|---------|------|
| empathetic (å…±æƒ…å‹) | gentle_accepting | æ¸©å’Œæ¥çº³ |
| data_driven (æ•°æ®é©±åŠ¨å‹) | structured_analytical | ç»“æ„åŒ–åˆ†æ |
| challenge (æŒ‘æˆ˜å‹) | encouraging_practical | é¼“åŠ±åŠ¡å® |
| social_proof (ç¤¾ä¼šè¯æ˜å‹) | encouraging_practical | é¼“åŠ±åŠ¡å® |
| exploratory (æ¢ç´¢å‹) | gentle_accepting | æ¸©å’Œæ¥çº³ |
| neutral (ä¸­ç«‹å‹) | gentle_accepting | æ¸©å’Œæ¥çº³ |

**å¼ºåº¦â†’éš¾åº¦æ•°å€¼æ˜ å°„:**
minimal=1, low=2, moderate=3, high=4, intensive=5

---

### 3.11 Observerâ†’Grower åˆå§‹å¤„æ–¹ç”Ÿæˆè§„åˆ™

> **æƒå¨æ¥æº:** `api/r4_role_upgrade_trigger.py` `_generate_initial_prescription()`

```
L0â†’L1 å‡çº§å®Œæˆå:
1. è¯»å– BPT-6 åˆ†å‹ (assessment_sessions.module_type='bpt6')
2. è¯»å– SPI å¿ƒç†å±‚çº§ (assessment_sessions.module_type='spi')
3. æ ¹æ® L å±‚çº§å†³å®šæœ€å¤§å¤„æ–¹æ•°: L1=1, L2=1, L3=2, L4=3, L5=5
4. å°è¯• BehaviorRx å¼•æ“:
   a. æŸ¥è¯¢ BehavioralProfile
   b. profile_to_rx_context() â†’ select_agent_type()
   c. engine.compute_rx() â†’ å†™å…¥ behavior_prescriptions (status='active')
   d. rx_id æ ¼å¼: "rx_init_{uuid[:8]}"
5. BehaviorRx å¤±è´¥ â†’ é™çº§åˆ°é»˜è®¤å¤„æ–¹é›†:
   a. è¥å…»: è®°å½•ä¸‰é¤é¥®é£Ÿ
   b. è¿åŠ¨: æ¯æ—¥æ•£æ­¥15åˆ†é’Ÿ
   c. ç›‘æµ‹: è¡€ç³–ç›‘æµ‹ (å¦‚é€‚ç”¨)
```

---

### 3.12 å¤„æ–¹æŸ¥è¯¢ä¸æƒé™è§„åˆ™

> **æƒå¨æ¥æº:** `api/main.py` rx ç«¯ç‚¹

#### GET /api/v1/rx/my â€” ç”¨æˆ·å¤„æ–¹åˆ—è¡¨

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| status | "active" | è¿‡æ»¤çŠ¶æ€ (active/draft/completed/paused/cancelled) |
| limit | 20 | æœ€å¤§è¿”å›æ•° |

**æƒé™:** ä»…è¿”å› `current_user.id` çš„å¤„æ–¹ã€‚

#### GET /api/v1/rx/{rx_id} â€” å¤„æ–¹è¯¦æƒ…

**æƒé™æ£€æŸ¥:**

```
1. user_id == current_user.id â†’ å…è®¸ (è‡ªå·±çš„å¤„æ–¹)
2. current_user.role âˆˆ {COACH, PROMOTER, SUPERVISOR, MASTER, ADMIN} â†’ å…è®¸
3. å¦åˆ™ â†’ 403 æ— æƒé™
```

#### GET /api/v1/notifications/system â€” ç³»ç»Ÿé€šçŸ¥èšåˆ

èšåˆä¸‰ä¸ªæ•°æ®æº:
1. `credit_events` è¡¨: ç§¯åˆ†å˜åŠ¨é€šçŸ¥
2. `user_milestones` è¡¨: é‡Œç¨‹ç¢‘è¾¾æˆé€šçŸ¥
3. `notifications` è¡¨: æ¨é€é€šçŸ¥ (å«å¤„æ–¹å®¡æ‰¹é€šçŸ¥)

**æ·±åº¦é“¾æ¥è§£æ:** ä» body ä¸­æå– `[link:xxx]` æ ¼å¼, è½¬ä¸º `link` å­—æ®µä¾› H5 å¯¼èˆªã€‚

---

## å››ã€ç§¯åˆ†ä¸æ¿€åŠ±è§„åˆ™

### 4.1 ä¸‰ç»´ç§¯åˆ†ä½“ç³»

> **æƒå¨æ¥æº:** `configs/point_events.json`

#### æˆé•¿ç§¯åˆ†äº‹ä»¶ (Growth Points)

| äº‹ä»¶ | ç§¯åˆ† | æ¯æ—¥ä¸Šé™ | æœ€ä½è§’è‰² | è¯´æ˜ |
|------|------|---------|---------|------|
| daily_checkin | +5 | 1æ¬¡/æ—¥ | observer | æ¯æ—¥ç­¾åˆ° |
| complete_lesson | +20 | 5æ¬¡/æ—¥ | observer | å®Œæˆè¯¾ç¨‹, è”åŠ¨å­¦åˆ† |
| complete_assessment | +50 | 2æ¬¡/æ—¥ | observer | å®Œæˆè¯„ä¼°, è”åŠ¨å­¦åˆ† |
| behavior_attempt | +10 | 3æ¬¡/æ—¥ | observer | è¡Œä¸ºå°è¯• |
| stage_transition | +30 | æ— é™ | grower | é˜¶æ®µè·ƒè¿ |
| behavior_stable_30d | +50 | é‡Œç¨‹ç¢‘ | grower | 30å¤©ç¨³å®š |
| behavior_stable_90d | +100 | é‡Œç¨‹ç¢‘ | grower | 90å¤©ç¨³å®š |
| metric_improved | +20 | æ— é™ | grower | æŒ‡æ ‡æ”¹å–„ |
| complete_case | +50 | æ— é™ | coach | å®Œæˆæ¡ˆä¾‹ |
| complete_180day | +500 | é‡Œç¨‹ç¢‘ | grower | å®Œæˆ180å¤©è¯¾ç¨‹ |
| use_tool | +10 | 3æ¬¡/æ—¥ | observer | ä½¿ç”¨å·¥å…· |
| training_hour | +5/h | 8h/æ—¥ | sharer | åŸ¹è®­å­¦æ—¶ |

#### è´¡çŒ®ç§¯åˆ†äº‹ä»¶ (Contribution Points)

| äº‹ä»¶ | ç§¯åˆ† | æ¯æ—¥ä¸Šé™ | æœ€ä½è§’è‰² |
|------|------|---------|---------|
| path_contribute | +10 | 3æ¬¡/æ—¥ | grower |
| data_archive | +5 | 5æ¬¡/æ—¥ | grower |
| publish_content | +30 | 3æ¬¡/æ—¥ | sharer |
| case_share | +30 | 2æ¬¡/æ—¥ | coach |
| template_contribute | +50 | æ— é™ | coach |
| course_develop | +100 | æ— é™ | promoter |
| rule_contribute | +30 | æ— é™ | coach |
| mentee_graduated | +30 | æ— é™ | grower |
| community_reply | +10 | 10æ¬¡/æ—¥ | sharer |

#### å½±å“åŠ›ç§¯åˆ†äº‹ä»¶ (Influence Points)

| äº‹ä»¶ | ç§¯åˆ† | æœ€ä½è§’è‰² |
|------|------|---------|
| invite_observer | +10 | observer |
| companion_train_l0 | +10 | grower |
| companion_train_l1 | +30 | sharer |
| companion_train_l2 | +50 | coach |
| companion_train_l3 | +80 | promoter |
| companion_train_l4 | +150 | master |
| content_spread | +5 (5æ¬¡/æ—¥) | sharer |
| host_workshop | +150 | coach |
| industry_event | +50 | promoter |
| standard_participate | +100 | master |

#### V4.0 æ²»ç†ç§¯åˆ†äº‹ä»¶

| äº‹ä»¶ | ç§¯åˆ† | ç±»å‹ | æœ€ä½è§’è‰² |
|------|------|------|---------|
| ethics_test_complete | +50 | æˆé•¿ | sharer |
| self_assessment_complete | +30 | æˆé•¿ | observer |
| credential_renewal | +20 | æˆé•¿ | coach |
| ethics_pledge_sign | +30 | è´¡çŒ® | sharer |
| conflict_disclosure_update | +20 | è´¡çŒ® | promoter |
| alert_handled_timely | +15 | è´¡çŒ® | coach |
| message_reply_timely | +10 | è´¡çŒ® | coach |
| agent_feedback_reply | +10 | è´¡çŒ® | coach |
| supervision_meeting | +50 | å½±å“åŠ› | promoter |
| knowledge_contribute | +30 | å½±å“åŠ› | coach |

#### å­¦ä¹ å†…å®¹ç§¯åˆ†é…ç½®

| å†…å®¹ç±»å‹ | åŸºç¡€ç§¯åˆ† | é™„åŠ è§„åˆ™ |
|---------|---------|---------|
| video | 10 | +1/åˆ†é’Ÿ, æµ‹éªŒ+5 |
| course | 50 | +10/ç« èŠ‚, å®Œæˆ+20 |
| article | 5 | +2/åƒå­— |
| card | 3 | å®Œæˆ+2 |
| audio | 8 | +0.5/åˆ†é’Ÿ |

#### æµ‹éªŒç§¯åˆ†é…ç½®

```
é€šè¿‡åŸºç¡€: 10åˆ†
æ»¡åˆ†é¢å¤–: 5åˆ†
æ¯ç­”å¯¹ä¸€é¢˜: 2åˆ†
é¦–æ¬¡é€šè¿‡é¢å¤–: 3åˆ†
```

---

### 4.2 é‡Œç¨‹ç¢‘ä¸ä»ªå¼

> **æƒå¨æ¥æº:** `configs/milestones.json`

| é‡Œç¨‹ç¢‘ | è§¦å‘ | å­¦åˆ† | ç§¯åˆ†å¥–åŠ± | å¾½ç«  | è§£é”åŠŸèƒ½ | ä»ªå¼ |
|--------|------|------|---------|------|---------|------|
| FIRST_LOGIN | æ³¨å†Œ | 15 | æˆé•¿+15 | ğŸŒ± first_step | å¾®è¯„ä¼°å…¥å£, è§‚å¯Ÿè€…ä¸ƒæ­¥ | ç§å­èŒèŠ½ (3s) |
| DAY_3 | è¿ç»­3å¤© | 25 | æˆé•¿+25, è¿ç»­+5 | ğŸ”¥ 3day_flame | è¡Œä¸ºé“¾å¡ç‰‡, ç¤¾åŒºæµè§ˆ | ç§å­åˆ°èŠ½ (2.5s) |
| DAY_7 | è¿ç»­7å¤© | 40 | æˆé•¿+30, è¿ç»­+10 | â­ week_star | å¾®è¡Œä¸ºæŒ‘æˆ˜, åŒé“è€…é‚€è¯· | æ ¹ç³»å»¶ä¼¸ (3s) |
| DAY_14 | è¿ç»­14å¤© | 50 | æˆé•¿+35, è´¡çŒ®+15 | ğŸŒ¸ half_month | è¡Œä¸ºé“¾æ„è¯†, CGMåŸºçº¿, æˆé•¿æ¡£æ¡ˆ | èŠ±å¼€ç»½æ”¾ (4s, å¯é€‰èŠ±å‹) |
| DAY_21 | è¿ç»­21å¤© | 60 | æˆé•¿+40, è´¡çŒ®+20 | ğŸ 21day_gold | ç¤¾åŒºå‘å¸–, å†…å®¹åˆ†äº«, è¿›é˜¶é€‰ä¿® | æœå®ç”Ÿé•¿ (4s) |
| DAY_30 | è¿ç»­30å¤© | 80 | æˆé•¿+50+50, è´¡çŒ®+30, å½±å“åŠ›+10 | ğŸ¦‹ 30day_diamond + butterfly | L0â†’L1 æ™‹çº§é€šé“ | è¶å˜é‡ç”Ÿ (8s, å›é¡¾æ—…ç¨‹) |

**Day 3 ç¿»ç‰Œå¥–åŠ±æ± :**
- é¢å¤–å­¦åˆ† +10 (æƒé‡ 40%)
- å«©èŠ½å£çº¸ (æƒé‡ 35%)
- ç¨€æœ‰è¡Œä¸ºå¡ (æƒé‡ 25%)

---

### 4.3 å¾½ç« ç³»ç»Ÿ

> **æƒå¨æ¥æº:** `configs/badges.json`

#### ç¨€æœ‰åº¦ä½“ç³»

| ç¨€æœ‰åº¦ | é¢œè‰² | è§†è§‰æ•ˆæœ |
|--------|------|---------|
| common | ç°è‰² | åŸºç¡€æ¸å˜ |
| uncommon | ç»¿è‰² #10B981 | â€” |
| rare | è“è‰² #3B82F6 | â€” |
| epic | ç´«è‰² #8B5CF6 | â€” |
| legendary | é‡‘è‰² #F59E0B | å…‰èŠ’é—ªçƒ |

#### å››å¤§å¾½ç« ç±»åˆ«

**1. é‡Œç¨‹ç¢‘å¾½ç«  (7æš):** FIRST_LOGIN â†’ DAY_30 (å‚è§é‡Œç¨‹ç¢‘è¡¨)

**2. å­¦ä¹ æ—¶é•¿å¾½ç«  (6æš):**

| æ—¶é•¿ | å¾½ç«  | ç¨€æœ‰åº¦ |
|------|------|--------|
| 1 å°æ—¶ | ğŸ“– bronze | common |
| 10 å°æ—¶ | ğŸ“š silver | uncommon |
| 20 å°æ—¶ | âš–ï¸ gold | rare |
| 40 å°æ—¶ | ğŸ… gold | rare |
| 80 å°æ—¶ | ğŸ“ epic | epic |
| 120 å°æ—¶ | ğŸ’ legend | legendary |

**3. æ¨¡å—ç²¾é€šå¾½ç«  (M1-M4 Ã— 4 é˜¶):**

| æ¨¡å— | T1 è§‰å¯Ÿè€… | T2 å®è·µè€… | T3 è®¾è®¡å¸ˆ | T4 å¤§å¸ˆ |
|------|----------|----------|----------|--------|
| M1 è¡Œä¸º | è¡Œä¸ºè§‰å¯Ÿè€… | è¡Œä¸ºè§£æ„è€… | è¡Œä¸ºè®¾è®¡å¸ˆ | é“¾ç¯ä¹‹ä¸» |
| M2 ç”Ÿæ´»æ–¹å¼ | èŠ‚å¾‹ä½“éªŒè€… | èŠ‚å¾‹å®è·µè€… | èŠ‚å¾‹è®¾è®¡å¸ˆ | äº”ç»´å¤§å¸ˆ |
| M3 å¿ƒæ™º | æ€ç»´è§‰å¯Ÿè€… | æ€ç»´é‡æ„è€… | æ€ç»´å»ºç­‘å¸ˆ | å¿ƒæ™ºä¹‹å…‰ |
| M4 æ•™ç»ƒ | é™ªä¼´ä½“éªŒè€… | é™ªä¼´æŠ€æœ¯è€… | é™ªä¼´å¼•é¢†è€… | åŒè¡Œä¹‹ç¯ |

**æ¨¡å—ç²¾é€šå­¦åˆ†é—¨æ§›:**

| å±‚çº§ | M1 è¡Œä¸º | M2 ç”Ÿæ´»æ–¹å¼ | M3 å¿ƒæ™º | M4 æ•™ç»ƒ |
|------|--------|-----------|--------|--------|
| T1 è§‰å¯Ÿè€… | 20 å­¦åˆ† | 20 å­¦åˆ† | 20 å­¦åˆ† | 20 å­¦åˆ† |
| T2 å®è·µè€… | 60 å­¦åˆ† | 60 å­¦åˆ† | 60 å­¦åˆ† | 60 å­¦åˆ† |
| T3 è®¾è®¡å¸ˆ | 120 å­¦åˆ† | 100 å­¦åˆ† | 120 å­¦åˆ† | 100 å­¦åˆ† |
| T4 å¤§å¸ˆ | 300 å­¦åˆ† | 250 å­¦åˆ† | 300 å­¦åˆ† | 250 å­¦åˆ† |

**ç»„åˆå¾½ç« :** å››ç»´è§‰é†’ (å…¨T1) + å››ç»´å¤§å¸ˆ (å…¨T4, legendary)

**4. æ™‹çº§ä»ªå¼å¾½ç«  (5æš):**

| æ™‹çº§ | ä»ªå¼ | çºªå¿µå“ | è§£é” |
|------|------|--------|------|
| L0â†’L1 | ğŸ£ ç ´å£³ç¤¼ | æˆé•¿æ ‘è‰ºæœ¯ | åŒé“è€…é‚€è¯·, ç¤¾åŒºäº’åŠ¨, è¿›é˜¶è¯¾ç¨‹, æ•°æ®åˆ†æ |
| L1â†’L2 | ğŸ•¯ï¸ ä¼ ç¯ç¤¼ | æ•°å­—ç¯ç¬¼ | å†…å®¹å‘å¸ƒ, ç»éªŒåˆ†äº«, ä¸“å±æ¨¡æ¿, é™ªä¼´æŠ€æœ¯ |
| L2â†’L3 | ğŸª„ æˆæ–ç¤¼ | æ•™ç»ƒç”»åƒ | 1v1æ•™ç»ƒ, å¤„æ–¹è®¾è®¡, æ¡ˆä¾‹åº“, AI Co-Pilot |
| L3â†’L4 | ğŸ›ï¸ ç«‹æŸ±ç¤¼ | å­¦å‘˜æ—è°± | è¯¾ç¨‹å¼€å‘, å¸ˆèµ„åŸ¹è®­, ç£å¯¼æƒé™ |
| L4â†’L5 | ğŸŒŠ å½’æºç¤¼ | è´¡çŒ®çƒ­åŠ›å›¾ | ç†è®ºåˆ›æ–°, æ ‡å‡†åˆ¶å®š, å­¦æœ¯å‘è¡¨ |

---

### 4.4 è¿ç»­æ‰“å¡ä¸ä¸­æ–­æ¢å¤

#### è¿ç»­æ‰“å¡é‡Œç¨‹ç¢‘

| å¤©æ•° | å¥–åŠ±å | ç§¯åˆ† |
|------|--------|------|
| 3å¤© | ä¸‰æ—¥åšæŒ ğŸ”¥ | +5 |
| 7å¤© | ä¸€å‘¨è¾¾æˆ ğŸ’ª | +15 |
| 14å¤© | ä¸¤å‘¨çªç ´ â­ | +30 |
| 21å¤© | ä¹ æƒ¯å…»æˆ ğŸ¯ | +50 |
| 30å¤© | æœˆåº¦å† å†› ğŸ¥‡ | +100 |
| 100å¤© | ç™¾æ—¥ä¼ å¥‡ ğŸ… | +500 |

#### ä¸­æ–­æ¢å¤æœºåˆ¶

| æ¢å¤æ–¹å¼ | æ¡ä»¶ | è¯´æ˜ |
|---------|------|------|
| å®½é™æœŸ | ä¸­æ–­ â‰¤36 å°æ—¶ | è‡ªåŠ¨æ¢å¤ |
| å…è´¹æ¢å¤ | 1æ¬¡/æœˆ | æ¯æœˆä¸€æ¬¡å…è´¹ |
| å­¦åˆ†æ¢å¤ | æ¶ˆè€— 10 å­¦åˆ† | ç”¨å­¦åˆ†æ¢è¿ç»­ |
| åŒé“è€…æ•‘æ´ | éœ€ companion_relation | åŒé“è€…å¸®åŠ©æ¢å¤ |

---

### 4.5 æ™‹çº§èµ„æ ¼å››ç»´åº¦æ£€æŸ¥

> **æƒå¨æ¥æº:** `core/promotion_service.py`

```
æ™‹çº§èµ„æ ¼ = å­¦åˆ†ç»´åº¦ AND ç§¯åˆ†ç»´åº¦ AND åŒé“è€…ç»´åº¦ AND å®è·µç»´åº¦

1. å­¦åˆ†ç»´åº¦: total_min, mandatory_min, elective_min, m1-m4_min
   æ¥æº: v_user_total_credits è§†å›¾

2. ç§¯åˆ†ç»´åº¦: growth_min, contribution_min, influence_min
   æ¥æº: v_promotion_progress è§†å›¾

3. åŒé“è€…ç»´åº¦: graduated_min (æ¯•ä¸šå­¦å‘˜æ•°), quality_min (å¹³å‡è´¨é‡åˆ†)
   æ¥æº: v_companion_stats è§†å›¾

4. å®è·µç»´åº¦: passed=None (éœ€äººå·¥å®¡æ ¸)
   æ¥æº: è§„åˆ™é…ç½®ä¸­çš„å®è·µæ ‡å‡†
```

**ç»“æœç»“æ„:**
```json
{
  "eligible": true/false/null,
  "credits": {"passed": bool},
  "points": {"passed": bool},
  "companions": {"passed": bool},
  "practice": {"passed": null, "requires_manual_review": true},
  "auto_checks_passed": bool
}
```

#### é€çº§æ™‹çº§è¯¦ç»†è¦æ±‚

> **æƒå¨æ¥æº:** `configs/promotion_rules.json`

**L0â†’L1 (è§‚å¯Ÿå‘˜â†’æˆé•¿è€…)** â€” æœ€çŸ­ ~3 ä¸ªæœˆ, ç†è®º:å®è·µ = 8:2

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| å­¦åˆ† | æ€» 100 (å¿…ä¿® 60: M1=20,M2=20,M3=10,M4=10; é€‰ä¿® 40) |
| ç§¯åˆ† | æˆé•¿â‰¥100 |
| åŒé“è€… | 4 åè§‚å¯Ÿå‘˜ (invite æ¨¡å¼, ä¸è¦æ±‚è´¨é‡åˆ†) |
| å®è·µ | behavior_attemptsâ‰¥15, understanding_scoreâ‰¥4, ä¼¦ç†é€šè¿‡ |

**L1â†’L2 (æˆé•¿è€…â†’åˆ†äº«è€…)** â€” æœ€çŸ­ ~3 ä¸ªæœˆ, ç†è®º:å®è·µ = 7:3

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| å­¦åˆ† | æ€» 200 (å¿…ä¿® 120: M1=40,M2=40,M3=20,M4=20; é€‰ä¿® 80) |
| ç§¯åˆ† | æˆé•¿â‰¥300, è´¡çŒ®â‰¥30, å½±å“åŠ›â‰¥10 |
| åŒé“è€… | 4 åè§‚å¯Ÿå‘˜ (mentor æ¨¡å¼, ç”Ÿå‘½å‘¨æœŸ S0â†’S4) |
| å®è·µ | ç¨³å®šè¡Œä¸º 90 å¤©, æŒ‡æ ‡æ”¹å–„â‰¥2, æ•°æ®è´¡çŒ®â‰¥3, é˜¶æ®µ S0-S4 å…¨éƒ¨å®Œæˆ |

**L2â†’L3 (åˆ†äº«è€…â†’æ•™ç»ƒ)** â€” æœ€çŸ­ ~10 ä¸ªæœˆ, ç†è®º:å®è·µ = 5:5

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| å­¦åˆ† | æ€» 800 (å¿…ä¿® 380: M1=120,M2=100,M3=70,M4=90; é€‰ä¿® 420) |
| ç§¯åˆ† | æˆé•¿â‰¥800, è´¡çŒ®â‰¥100, å½±å“åŠ›â‰¥50 |
| åŒé“è€… | 4 åæˆé•¿è€… (mentor, qualityâ‰¥3.5) |
| å®è·µ | 240 å°æ—¶(scoreâ‰¥400), 10 æ¡ˆä¾‹, å¯è§£é‡Šæ€§â‰¥0.8, åŒé“è€…æ—¶é•¿â‰¥50h, åŸ¹è®­â‰¥40h, ä¼¦ç†é€šè¿‡ |

**L3â†’L4 (æ•™ç»ƒâ†’ä¿ƒè¿›å¸ˆ)** â€” æœ€çŸ­ ~15 ä¸ªæœˆ, ç†è®º:å®è·µ = 4:6

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| å­¦åˆ† | æ€» 1500 (å¿…ä¿® 690: M1=180,M2=150,M3=120,M4=240; é€‰ä¿® 810) |
| ç§¯åˆ† | æˆé•¿â‰¥1500, è´¡çŒ®â‰¥500, å½±å“åŠ›â‰¥200 |
| åŒé“è€… | 4 ååˆ†äº«è€… (mentor, qualityâ‰¥4.0), å·²åŸ¹å…» L3+â‰¥5 |
| å®è·µ | é¡¹ç›®â‰¥2, è¯¾ç¨‹å¼€å‘â‰¥1, æ¨¡æ¿è¢«é‡‡ç”¨â‰¥2 |

**L4â†’L5 (ä¿ƒè¿›å¸ˆâ†’å¤§å¸ˆ)** â€” æœ€çŸ­ ~24 ä¸ªæœˆ, ç†è®º:å®è·µ = 3:7

| ç»´åº¦ | è¦æ±‚ |
|------|------|
| å­¦åˆ† | æ€» 3000 (å¿…ä¿® 1200: M1=300,M2=250,M3=250,M4=400; é€‰ä¿® 1800) |
| ç§¯åˆ† | æˆé•¿â‰¥3000, è´¡çŒ®â‰¥1500, å½±å“åŠ›â‰¥800 |
| åŒé“è€… | 4 åæ•™ç»ƒ (mentor, qualityâ‰¥4.5), å·²åŸ¹å…» L3â‰¥15, L4â‰¥4 |
| å®è·µ | åŸåˆ›æ–¹æ³•è®º, å‚ä¸æ ‡å‡†åˆ¶å®š, ä¸“å®¶ä¸€è‡´è®¤å¯ |

---

## äº”ã€å®‰å…¨ç®¡é“è§„åˆ™

### 5.1 å››å±‚å®‰å…¨ç®¡çº¿ (SafetyPipeline)

> **æƒå¨æ¥æº:** `core/safety/` ç›®å½•

```
ç”¨æˆ·è¾“å…¥ â†’ [L1 è¾“å…¥è¿‡æ»¤] â†’ [L2 RAGå®‰å…¨] â†’ [L3 ç”Ÿæˆå®ˆå«] â†’ [L4 è¾“å‡ºè¿‡æ»¤] â†’ å®‰å…¨è¾“å‡º
```

| å±‚çº§ | ä½ç½® | åŠŸèƒ½ |
|------|------|------|
| L1 input_filter | MasterAgent Step 2.5 | è¿‡æ»¤æ¶æ„è¾“å…¥, æ£€æµ‹ prompt injection |
| L2 rag_safety | RAG æ£€ç´¢å | éªŒè¯æ£€ç´¢æ–‡æ¡£çš„å®‰å…¨æ€§å’Œç›¸å…³æ€§ |
| L3 generation_guard | MasterAgent Step 7.5 | LLM ç”Ÿæˆè¿‡ç¨‹ä¸­çš„å®‰å…¨çº¦æŸ |
| L4 output_filter | MasterAgent Step 8.5 | æœ€ç»ˆè¾“å‡ºæ£€æŸ¥, ç§»é™¤ä¸å®‰å…¨å†…å®¹ |

#### å®‰å…¨ç®¡çº¿å…·ä½“é˜ˆå€¼

> **æƒå¨æ¥æº:** `configs/safety_rules.json`

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|------|------|
| max_input_length | 5000 å­—ç¬¦ | è¶…é•¿è¾“å…¥æˆªæ–­ |
| max_output_length | 8000 å­—ç¬¦ | è¶…é•¿è¾“å‡ºæˆªæ–­ |
| crisis_auto_escalate | true | å±æœºè‡ªåŠ¨å‡çº§ |
| pii_log_enabled | false | ä¸è®°å½•ä¸ªäººèº«ä»½ä¿¡æ¯ |
| review_queue_enabled | true | å¯ç”¨å®¡æ ¸é˜Ÿåˆ— |

**è¯æ®åˆ†çº§æƒé‡ (RAG å¤šæºéªŒè¯):**

| ç­‰çº§ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| T1 | 1.0 | æœ€é«˜è¯æ®çº§ (RCT/Metaåˆ†æ) |
| T2 | 0.8 | ä¸­ç­‰è¯æ® |
| T3 | 0.5 | è¾ƒä½è¯æ® |
| T4 | 0.2 | æœ€ä½è¯æ® (ä¸“å®¶æ„è§) |

**ä¸¥é‡åº¦â†’åŠ¨ä½œæ˜ å°„:**

| ä¸¥é‡åº¦ | åŠ¨ä½œ | é€šçŸ¥ç®¡ç†å‘˜ | è®°å½•è¾“å…¥ |
|--------|------|----------|---------|
| critical | block_and_escalate | æ˜¯ | æ˜¯ |
| high | flag_for_review | æ˜¯ | æ˜¯ |
| medium | add_disclaimer | å¦ | æ˜¯ |
| low | pass | å¦ | å¦ |

**ç™½åå•åŸŸ (å®‰å…¨æ¨èç±»åˆ«):** nutrition, exercise, sleep, motivation, tcm

**å±æœºè”ç³»æ–¹å¼:** çƒ­çº¿ 400-161-9995, ç®¡ç†å‘˜é€šçŸ¥å·²å¯ç”¨

---

### 5.2 ä¸­åŒ»éª¨ä¼¤å®‰å…¨é—¨ (OrthoSafetyGate L1-L4)

> **æƒå¨æ¥æº:** `core/safety/safety_rules_ortho.py`

#### L1 çº¢æ——æ€¥ç—‡ (59 æ¨¡å¼, ç«‹å³æ‹¨æ‰“ 120)

è¦†ç›–: ä¸¥é‡å¤´ç—›ä¼´ç¥ç»ç—‡çŠ¶, æ„è¯†ä¸§å¤±/ç™«ç—«, èƒ¸ç—›ä¼´å¿ƒè„ç—‡çŠ¶, ç–‘ä¼¼ä¸­é£, ä¸¥é‡åˆ›ä¼¤éª¨æŠ˜, è„Šé«“æŸä¼¤, é©¬å°¾ç»¼åˆå¾, ä¸¥é‡å‡ºè¡€

#### L2 é«˜å±è½¬è¯Š (9 æ¨¡å¼, ç´§æ€¥åŒ»ç–—è½¬è¯Š)

è¦†ç›–: VAS/NRS 8-10åˆ†æŒç»­, å¤œç—›>2å‘¨, ä¸æ˜åŸå› ä½“é‡ä¸‹é™, å‘çƒ­ä¼´å…³èŠ‚ç—›, è¿›è¡Œæ€§åŠ é‡, æ”¾å°„æ€§ç¥ç»ç—‡çŠ¶, åˆ›ä¼¤åæŒç»­æ¶åŒ–, é•¿æœŸ NSAID, æ€¥æ€§å…³èŠ‚ç‚/ç—›é£, ä¸¥é‡éª¨è´¨ç–æ¾ (T<-2.5)

#### L3 æ‰§ä¸šè¾¹ç•Œ (6 æ¨¡å¼)

ç¦æ­¢: å¼€å¤„æ–¹, ä¸‹è¯Šæ–­, æ‰‹æœ¯å’¨è¯¢, ä¾µå…¥æ€§æ“ä½œ, é˜¿ç‰‡ç±»è¯ç‰©, å½±åƒå­¦æ£€æŸ¥å»ºè®®

#### L4 ç‰¹æ®Šäººç¾¤ç¦å¿Œ (5 ç±»)

| äººç¾¤ | ç¦å¿Œ |
|------|------|
| å­•å¦‡ | åˆè°·, ä¸‰é˜´äº¤, æ˜†ä»‘, è‚©äº•ç©´ä½ç¦ç”¨ |
| å„¿ç«¥ | ç¦æˆäººåŠ›åº¦æ‰‹æ³•, ç¦æ­£éª¨ |
| ä¸¥é‡éª¨è´¨ç–æ¾ | ç¦è„ŠæŸ±æ‰‹æ³•, ç¦é‡åŠ›åº¦ |
| è‚¿ç˜¤ | ç¦å±€éƒ¨æ¨æ‹¿, ç¦æ‚£å¤„çƒ­æ•· |
| å‡è¡€éšœç¢ | ç¦æ‹”ç½, ç¦æ·±åˆº |

---

### 5.3 ç­–ç•¥å¼•æ“äº”æ­¥ç®¡çº¿ (PolicyEngine)

> **æƒå¨æ¥æº:** `api/policy_api.py`

```
Step 1: Rules â€” åŠ è½½æ¡ä»¶è¡¨è¾¾å¼ (JSON-Logic)
Step 2: Candidates â€” æŒ‰ä¼˜å…ˆçº§è¿‡æ»¤åŒ¹é…è§„åˆ™
Step 3: Conflict â€” è§£å†³è§„åˆ™å†²çª
Step 4: Cost â€” è¯„ä¼°æ‰§è¡Œæˆæœ¬
Step 5: Trace â€” è®°å½•å†³ç­–è½¨è¿¹
```

**è§„åˆ™ç±»å‹:**

| ç±»å‹ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| platform | å…¨å±€ | ç³»ç»Ÿçº§è§„åˆ™ |
| tenant | ç§Ÿæˆ·çº§ | ç§Ÿæˆ·è‡ªå®šä¹‰ |
| emergency | å…¨å±€ | å±æœºè§„åˆ™ (æœ€é«˜ä¼˜å…ˆ) |
| dynamic | è¿è¡Œæ—¶ | åŠ¨æ€ç”Ÿæˆè§„åˆ™ |

**è§„åˆ™å±æ€§:**
- priority: 0-100 (æ•°å€¼è¶Šå¤§è¶Šå…ˆæ‰§è¡Œ)
- condition_expr: JSON-Logic æ¡ä»¶
- action_type: select_agent / block / adjust_weight / downgrade_model
- evidence_tier: T1-T5 è¯æ®åˆ†çº§

---

## å…­ã€è®¾å¤‡é¢„è­¦è§„åˆ™

> **æƒå¨æ¥æº:** `configs/alert_thresholds.json`

### è¡€ç³–é¢„è­¦

| çº§åˆ« | æ¡ä»¶ | é˜ˆå€¼ |
|------|------|------|
| å±é™©é«˜ | â‰¥13.9 mmol/L | ç«‹å³é¢„è­¦ |
| è­¦å‘Šé«˜ | â‰¥10.0 mmol/L | è­¦å‘Šé¢„è­¦ |
| å±é™©ä½ | â‰¤3.0 mmol/L | ç«‹å³é¢„è­¦ |
| è­¦å‘Šä½ | â‰¤3.9 mmol/L | è­¦å‘Šé¢„è­¦ |

### å¿ƒç‡é¢„è­¦ (é™æ¯)

| çº§åˆ« | æ¡ä»¶ | é˜ˆå€¼ |
|------|------|------|
| å±é™©é«˜ | â‰¥150 bpm | ä»…é™æ¯æ—¶ |
| è­¦å‘Šé«˜ | â‰¥120 bpm | ä»…é™æ¯æ—¶ |
| å±é™©ä½ | â‰¤40 bpm | â€” |
| è­¦å‘Šä½ | â‰¤50 bpm | â€” |

### è¿åŠ¨/ç¡çœ /ä¹…å

| æŒ‡æ ‡ | é˜ˆå€¼ | è¯´æ˜ |
|------|------|------|
| è¿‡é‡è¿åŠ¨ | >180 åˆ†é’Ÿ/æ—¥ | â€” |
| ä¹…å | >600 åˆ†é’Ÿ/æ—¥ | â€” |
| ç¡çœ è´¨é‡ | <50 åˆ† | â€” |
| ç¡çœ ä¸è¶³ | <300 åˆ†é’Ÿ | â€” |

**å»é‡è§„åˆ™:** åŒä¸€æ•°æ®ç±»å‹ + åŒä¸€ç”¨æˆ·, ç›¸åŒçº§åˆ«çš„é¢„è­¦åœ¨é…ç½®æ—¶é—´çª—å£å†… (é»˜è®¤ 1 å°æ—¶) ä»…è§¦å‘ä¸€æ¬¡ã€‚

### R0-R4 äº”çº§é£é™©åŒºé—´

> **æƒå¨æ¥æº:** `configs/risk_thresholds.json`

#### è¡€ç³– (mmol/L)

| ç­‰çº§ | èŒƒå›´ | è¯´æ˜ |
|------|------|------|
| R0 å®‰å…¨ | 3.9â€“7.0 | æ— éœ€å“åº” |
| R1 æ³¨æ„ | 3.5â€“10.0 | é€šçŸ¥ç”¨æˆ· |
| R2 è­¦å‘Š | 3.0â€“13.9 | é€šçŸ¥ç”¨æˆ·+æ•™ç»ƒ |
| R3 é«˜å± | 2.5â€“16.6 | å¼ºåˆ¶æ•™ç»ƒä»‹å…¥ |
| R4 å±æ€¥ | <2.5 æˆ– >16.7 | å±æœºæ¥ç®¡+ç´§æ€¥è”ç³»äºº |

#### å¿ƒç‡ (bpm)

| ç­‰çº§ | èŒƒå›´ |
|------|------|
| R0 | 55â€“100 |
| R1 | 50â€“110 |
| R2 | 45â€“130 |
| R3 | 40â€“150 |
| R4 | <40 æˆ– >150 |

#### è¡€å‹ (æ”¶ç¼©å‹ / èˆ’å¼ å‹, mmHg)

| ç­‰çº§ | æ”¶ç¼©å‹ | èˆ’å¼ å‹ |
|------|--------|--------|
| R0 | 100â€“139 | 60â€“89 |
| R1 | 90â€“159 | â‰¤99 |
| R2 | 80â€“179 | â‰¤109 |
| R3 | 70â€“199 | â‰¤119 |
| R4 | <70 æˆ– >200 | >120 |

#### è¡€æ°§é¥±å’Œåº¦ (SpO2, %)

| ç­‰çº§ | é˜ˆå€¼ |
|------|------|
| R0 | â‰¥96% |
| R1 | â‰¥93% |
| R2 | â‰¥90% |
| R3 | â‰¥85% |
| R4 | <85% |

#### é£é™©ç­‰çº§â†’å“åº” SLA

| ç­‰çº§ | å“åº”æ—¶é—´ | åŠ¨ä½œ |
|------|---------|------|
| R0 | æ—  | log_only |
| R1 | 24 å°æ—¶ | log + notify_user |
| R2 | 4 å°æ—¶ | notify_user + notify_coach |
| R3 | 1 å°æ—¶ | force_coach + supervisor_notify |
| R4 | 1 å°æ—¶ | crisis_takeover + emergency_contact |

### è®¾å¤‡é¢„è­¦åŒé€šçŸ¥é“¾

> **æƒå¨æ¥æº:** `core/device_alert_service.py`

```
è®¾å¤‡æ•°æ®å¼‚å¸¸æ£€æµ‹ â†’ å»é‡æ£€æŸ¥ (1h çª—å£)
  â†“ é€šè¿‡
1. æ•™ç»ƒé€šçŸ¥: CoachMessage (ç›´æ¥æ¶ˆæ¯)
2. ç”¨æˆ·é€šçŸ¥: Reminder (æé†’)
3. å®¡æ‰¹é˜Ÿåˆ—: CoachPushQueue (ä¾›æ•™ç»ƒå†³ç­–åç»­å¹²é¢„)
```

---

## ä¸ƒã€æ²»ç†ä¸åŒé“è€…è§„åˆ™ (V4.0)

> **æƒå¨æ¥æº:** `api/governance_api.py` + `core/peer_tracking_service.py`

### Agency ä¸‰æ€æ¨¡å‹

| æ¨¡å¼ | ä»£ç  | è¯´æ˜ |
|------|------|------|
| è¢«åŠ¨ | passive | æ•™ç»ƒä¸»å¯¼, ç”¨æˆ·æ¥å— |
| è¿‡æ¸¡ | transitional | æ•™ç»ƒå¼•å¯¼, ç”¨æˆ·å‚ä¸ |
| ä¸»åŠ¨ | active | ç”¨æˆ·è‡ªä¸», æ•™ç»ƒç›‘ç£ |

**DB å­˜å‚¨:** `users.agency_mode` ä¸º PostgreSQL enum ç±»å‹, é String

### åŒé“è€…åŒ¹é…ç­–ç•¥

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| é˜¶æ®µæ¥è¿‘åº¦ | 0.30 | ä¼˜å…ˆåŒ¹é…é˜¶æ®µç›¸è¿‘è€… |
| è¡Œä¸ºç›¸ä¼¼åº¦ | 0.25 | BPT-6 åˆ†å‹ç›¸ä¼¼ |
| ç›®æ ‡å¯¹é½åº¦ | 0.25 | ç›®æ ‡é‡å åº¦ |
| äº’è¡¥æ€§ | 0.20 | äº’è¡¥é…å¯¹ |

### åŒé“è€…å…³ç³»ç”Ÿå‘½å‘¨æœŸ

```
PENDING â†’ ACTIVE â†’ COOLING (7å¤©æ— äº’åŠ¨)
                      â†“
                   DORMANT (14å¤©æ— äº’åŠ¨)
                      â†“
                   DISSOLVED (30å¤©æˆ–æ‰‹åŠ¨)
```

**è‡ªåŠ¨è§£æ•£è§„åˆ™:**
- DORMANT çŠ¶æ€æŒç»­ 30 å¤© â†’ è‡ªåŠ¨è§£æ•£
- å†·å´é˜ˆå€¼: 7 å¤©æ— äº’åŠ¨
- ä¼‘çœ é˜ˆå€¼: 14 å¤©æ— äº’åŠ¨

### åŒè½¨æ™‹çº§åˆ¶åº¦

- 4 ç§æ™‹çº§çŠ¶æ€: max_level (å·²è¾¾ä¸Šé™), pending_check (å¾…å®¡), ineligible (ä¸æ»¡è¶³), eligible (æ»¡è¶³)
- è¦æ±‚ç»´åº¦: èƒ½åŠ›è¦æ±‚ + è€ƒè¯• + è¡Œä¸ºè¦æ±‚ + ä¼¦ç†è¦æ±‚
- æœ€çŸ­åœ¨ä½æœŸé™æ‰§è¡Œ
- åŒé“è€…è¦æ±‚è¿½è¸ª (total_required, graduated_required)

### åä½œå¼Šè§„åˆ™ (12 MEUs)

Stage Authority (C3 å®¡è®¡ä¿®å¤): é˜¶æ®µæ™‹çº§éœ€è¦æ²»ç†å¼•æ“æˆæƒ, é˜²æ­¢è·³çº§ã€‚Field Sync Guard (C4 å®¡è®¡ä¿®å¤): ORM ä¸ DB å­—æ®µåŒæ­¥å®ˆå«, é˜²æ­¢æ•°æ®æ¼‚ç§»ã€‚

---

## å…«ã€å¹²é¢„åŒ…è§„åˆ™

> **æƒå¨æ¥æº:** `configs/intervention_packs.json`

10 ä¸ªä¸´åºŠå¹²é¢„åŒ…, ç”±è®¾å¤‡é¢„è­¦æˆ–è¡Œä¸ºæ£€æµ‹è§¦å‘, å«å¾®è¡ŒåŠ¨ä»»åŠ¡ + æ•™ç»ƒè„šæœ¬ã€‚

### å¹²é¢„åŒ…æ€»è§ˆ

| ID | åç§° | è§¦å‘æ ‡ç­¾ | ä¼˜å…ˆçº§ | é£é™© | æœ€ä½æ•™ç»ƒçº§ |
|----|------|---------|--------|------|----------|
| IP-GLU-001 | é«˜è¡€ç³–ç´§æ€¥å¹²é¢„ | high_glucose, glucose_spike | 1 | high/mid | L1 |
| IP-GLU-002 | ä½è¡€ç³–é¢„é˜²ä¸åº”å¯¹ | low_glucose | 1 | high | L1 |
| IP-GLU-003 | è¡€ç³–æ³¢åŠ¨ç®¡ç† | glucose_fluctuation, glucose_spike | 2 | mid/low | L2 |
| IP-DIET-001 | æš´é¥®æš´é£Ÿè¡Œä¸ºå¹²é¢„ | overeating | 2 | high/mid | L2 |
| IP-DIET-002 | é«˜ç¢³æ°´é¥®é£Ÿè°ƒæ•´ | high_carb, irregular_meals | 3 | mid/low | L1 |
| IP-EXR-001 | ä¹…åè¡Œä¸ºå¹²é¢„ | sedentary, low_activity | 3 | mid/low | L1 |
| IP-MED-001 | ç”¨è¯ä¾ä»æ€§æå‡ | missed_medication, irregular_medication | 2 | high/mid | L1 |
| IP-SLP-001 | ç¡çœ è´¨é‡æ”¹å–„ | poor_sleep, insomnia | 3 | mid/low | L1 |
| IP-STR-001 | å‹åŠ›ä¸ç„¦è™‘ç®¡ç† | high_stress, anxiety | 2 | high/mid | L2 |
| IP-EXR-002 | è¿åŠ¨ä¹ æƒ¯å…»æˆ | low_activity | 3 | low/normal | L1 |

### å„å¹²é¢„åŒ…è¯¦æƒ…

**IP-GLU-001 é«˜è¡€ç³–ç´§æ€¥å¹²é¢„** (é€‚ç”¨é˜¶æ®µ: å‰æ„è¯†/æ„è¯†/å‡†å¤‡)
- ä»»åŠ¡ 1: é¤åè¡€ç³–ç›‘æµ‹ (7 å¤©)
- ä»»åŠ¡ 2: ç¢³æ°´æ›¿æ¢å®éªŒ
- ä»»åŠ¡ 3: é¤å 15 åˆ†é’Ÿæ•£æ­¥
- æ•™ç»ƒ: è¡€ç³–æ•°æ®è§£è¯»å¯¹è¯ â†’ è¡Œä¸ºå®éªŒå…±åˆ› â†’ MI åŠ¨æœºè®¿è°ˆ

**IP-GLU-002 ä½è¡€ç³–é¢„é˜²** (é€‚ç”¨é˜¶æ®µ: æ„è¯†/å‡†å¤‡/è¡ŒåŠ¨)
- ä»»åŠ¡ 1: ä½è¡€ç³–ç—‡çŠ¶è¯†åˆ«
- ä»»åŠ¡ 2: åº”æ€¥é£Ÿç‰©å‡†å¤‡ (15g å¿«é€Ÿç¢³æ°´)
- æ•™ç»ƒ: åº”æ€¥æ¼”ç»ƒ + ä¿¡å¿ƒå»ºç«‹

**IP-GLU-003 è¡€ç³–æ³¢åŠ¨ç®¡ç†** (é€‚ç”¨é˜¶æ®µ: å‡†å¤‡/è¡ŒåŠ¨/ç»´æŒ)
- ä»»åŠ¡ 1: 3D è¡€ç³–-é¥®é£Ÿ-è¿åŠ¨è®°å½•
- ä»»åŠ¡ 2: ä¸ªæ€§åŒ–é¥®é£Ÿæ–¹æ¡ˆæ‰§è¡Œ
- æ•™ç»ƒ: æ¨¡å¼åˆ†æ â†’ æ–¹æ¡ˆå¾®è°ƒ

**IP-DIET-001 æš´é¥®æš´é£Ÿå¹²é¢„** (é€‚ç”¨é˜¶æ®µ: å‰æ„è¯†â†’è¡ŒåŠ¨)
- ä»»åŠ¡ 1: æƒ…ç»ª-é¥®é£Ÿæ—¥è®°
- ä»»åŠ¡ 2: 3 ä¸ªæ›¿ä»£è¡Œä¸º (æ·±å‘¼å¸/æ•£æ­¥/æ‰“ç”µè¯)
- æ•™ç»ƒ: æƒ…ç»ªè§¦å‘æ¢ç´¢ â†’ æ­£å¿µé¥®é£ŸæŒ‡å¯¼ â†’ å…±æƒ…æ”¯æŒ

**IP-DIET-002 é«˜ç¢³æ°´è°ƒæ•´** (é€‚ç”¨é˜¶æ®µ: æ„è¯†/å‡†å¤‡/è¡ŒåŠ¨)
- ä»»åŠ¡ 1: æ¯æ—¥ç¢³æ°´æ‘„å…¥è®°å½•
- ä»»åŠ¡ 2: ç¢³æ°´å‡åŠå®éªŒ
- æ•™ç»ƒ: è¥å…»æ•™è‚² (ç™½ç±³é¥­ 60g ç¢³æ°´å¯¹æ¯”) â†’ æ¸è¿›è°ƒæ•´

**IP-EXR-001 ä¹…åå¹²é¢„** (é€‚ç”¨é˜¶æ®µ: å‰æ„è¯†â†’è¡ŒåŠ¨)
- ä»»åŠ¡ 1: å±å¹•æ—¶é—´è®°å½•
- ä»»åŠ¡ 2: æ¯å°æ—¶ 2-5 åˆ†é’Ÿèµ·èº«æ´»åŠ¨
- ä»»åŠ¡ 3: æ­¥è¡Œé€šå‹¤å®éªŒ (2000+æ­¥/å¤©)
- æ•™ç»ƒ: ä¹…åå±å®³æ•™è‚² â†’ åŠå…¬ç¯å¢ƒé‡è®¾è®¡

**IP-MED-001 ç”¨è¯ä¾ä»** (é€‚ç”¨é˜¶æ®µ: æ„è¯†â†’ç»´æŒ)
- ä»»åŠ¡ 1: 14 å¤©æœè¯è®°å½•
- ä»»åŠ¡ 2: ä¹ æƒ¯å åŠ  (å¦‚åˆ·ç‰™ååƒè¯, 21 å¤©)
- æ•™ç»ƒ: ç”¨è¯æ„ä¹‰å¯¹è¯ â†’ éšœç¢æ’é™¤

**IP-SLP-001 ç¡çœ æ”¹å–„** (é€‚ç”¨é˜¶æ®µ: æ„è¯†â†’ç»´æŒ)
- ä»»åŠ¡ 1: 14 å¤©ç¡çœ æ—¥è®°
- ä»»åŠ¡ 2: 30 åˆ†é’Ÿç¡å‰ä»ªå¼ (æˆ’å±/æ¸©æ°´æ³¡è„š/4-7-8 å‘¼å¸)
- ä»»åŠ¡ 3: 7 å¤©å›ºå®šä½œæ¯æ—¶é—´è¡¨
- æ•™ç»ƒ: ç¡çœ å«ç”Ÿæ•™è‚² â†’ å¤±çœ ç„¦è™‘é‡æ„

**IP-STR-001 å‹åŠ›ç®¡ç†** (é€‚ç”¨é˜¶æ®µ: å‰æ„è¯†â†’è¡ŒåŠ¨)
- ä»»åŠ¡ 1: 7 å¤©å‹åŠ›äº‹ä»¶æ—¥è®° (æ¯å¤© 3 äº‹ä»¶)
- ä»»åŠ¡ 2: æ¯æ—¥ 15 åˆ†é’Ÿæ¸è¿›å¼è‚Œè‚‰æ”¾æ¾ (PMR)
- ä»»åŠ¡ 3: è®¤çŸ¥é‡æ„ç»ƒä¹ 
- æ•™ç»ƒ: å‹åŠ›æºåˆ†æ (å¯æ§ vs ä¸å¯æ§) â†’ 4-7-8 å‘¼å¸æ³• â†’ å…±æƒ…æ”¯æŒ

**IP-EXR-002 è¿åŠ¨ä¹ æƒ¯** (é€‚ç”¨é˜¶æ®µ: å‡†å¤‡/è¡ŒåŠ¨/ç»´æŒ)
- ä»»åŠ¡ 1: å‘¨æ­¥æ•°æŒ‘æˆ˜ (æ¯å‘¨ +1000 æ­¥, ç›®æ ‡ 8000/å¤©)
- ä»»åŠ¡ 2: 21 å¤©å›ºå®šè¿åŠ¨æ—¶é—´é”šç‚¹
- æ•™ç»ƒ: ä¸ªæ€§åŒ–è¿åŠ¨æ–¹æ¡ˆå…±åˆ› â†’ è¿›åº¦å›é¡¾+æ­£å‘å¼ºåŒ–

---

## ä¹ã€å¹²é¢„ç­–ç•¥æ ‘

> **æƒå¨æ¥æº:** `configs/intervention_strategies.json`

5 ä¸ªå°±ç»ªåº¦ç­‰çº§ Ã— 24 ä¸ªåŸå› åˆ†ç±» = 50+ å¹²é¢„ç­–ç•¥è·¯å¾„

### äº”çº§å°±ç»ªåº¦

| ç­‰çº§ | ä¸­æ–‡ | è¯´æ˜ |
|------|------|------|
| L1 | å®Œå…¨å¯¹æŠ— | æ— æ”¹å˜æ„æ„¿, éœ€æœ€æ¸©å’Œæ¥è§¦ |
| L2 | æŠ—æ‹’ä¸åæ€ | æœ‰çŸ›ç›¾, å¯å¼•å¯¼åæ€ |
| L3 | å¦¥åä¸æ¥å— | æ„¿æ„å°è¯•å°æ­¥éª¤ |
| L4 | é¡ºåº”ä¸è°ƒæ•´ | ä¸»åŠ¨è°ƒæ•´è¡Œä¸º |
| L5 | å…¨é¢è‡£æœ | å®Œå…¨æŠ•å…¥, å¯å‡åä¸ºä½¿å‘½ |

### 24 åŸå› åˆ†ç±»

#### å†…åœ¨é©±åŠ¨ (C1-C4)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C1 | ä»·å€¼è§‚é‡å¡‘ | "æœ€é‡è¦çš„ç”Ÿæ´»ä»·å€¼?" | "æœ¬å‘¨ä»å“ªä»¶äº‹å¼€å§‹?" | "æƒ³ä¼ é€’ç»™è°?" |
| C2 | èº«ä»½è®¤åŒè½¬å˜ | "ç†æƒ³ä¸­è‡ªå·±ä»€ä¹ˆæ ·?" | èº«ä»½å®éªŒ | èº«ä»½å·©å›º+ä¼ é€’ |
| C3 | æ„ä¹‰æ„Ÿä¸ä½¿å‘½ | "æœ€é—æ†¾çš„äº‹?" | ä»·å€¼å‘ç° | ä½¿å‘½å‡å |
| C4 | è‡ªä¸»æŒæ§æ¬² | "èƒ½å®Œå…¨æŒæ§ä»€ä¹ˆ?" | é€‰æ‹©èµ‹æƒ | å…¨é¢è‡ªä¸» |

#### å¤–éƒ¨äº‹ä»¶ (C5-C8)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C5 | å…³é”®å¥åº·äº‹ä»¶ | "æ£€æŸ¥ç»“æœä»€ä¹ˆæ„Ÿå—?" | "åŒ»ç”Ÿå»ºè®®æ€ä¹ˆå¼€å§‹?" | æ•°æ®éªŒè¯+ä¼ æ’­ |
| C6 | é‡å¤§ç”Ÿæ´»å˜è¿ | å˜åŒ–æ˜¯å®¡è§†æœºä¼š | é‡å»ºè§„å¾‹ | å½±å“åŠ›æ‰©å±• |
| C7 | ç¤¾ä¼šå‹åŠ› | "å“ªäº›å‹åŠ›æƒ³å›åº”?" | åŒä¼´æ”¯æŒ | æˆä¸ºæ¦œæ · |
| C8 | ç»æµå‹åŠ› | åŒ»ç–—è´¹ç”¨åˆ†æ | é›¶æˆæœ¬æ–¹æ¡ˆ | ç»éªŒåˆ†äº« |

#### æƒ…ç»ªå› ç´  (C9-C12)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C9 | ææƒ§ä¸ç„¦è™‘ | "æœ€æ‹…å¿ƒå…·ä½“ä»€ä¹ˆ?" | å®‰å…¨è¡ŒåŠ¨ | ææƒ§è½¬åŒ– |
| C10 | æ„¤æ€’ä¸ä¸ç”˜ | "æœ€æƒ³æ”¹å˜ç¬¬ä¸€ä»¶äº‹?" | è¡ŒåŠ¨å®£è¨€ | æ­£å‘ä¼ é€’ |
| C11 | ç¾è€»ä¸å†…ç–š | "ç»™è‡ªå·±é‡æ–°å¼€å§‹?" | å‹‡æ°”è¡ŒåŠ¨ | æˆåŠŸåˆ†äº« |
| C12 | ç§¯ææƒ…ç»ª | "ä»€ä¹ˆè®©æ‚¨æœ‰å¯å‘?" | æ­£å‘å¾ªç¯ | å–œæ‚¦åˆ†äº« |

#### è®¤çŸ¥å› ç´  (C13-C16)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C13 | é¡¿æ‚Ÿæ—¶åˆ» | "çªç„¶æ„è¯†åˆ°ä»€ä¹ˆ?" | è§‰å¯Ÿæ·±åŒ– | æ™ºæ…§ç»“æ™¶ |
| C14 | çŸ¥è¯†è¡¥å…… | "æƒ³äº†è§£ä»€ä¹ˆ?" | å®è·µéªŒè¯ | æ•™å­¦ä¼ æ‰¿ |
| C15 | é£é™©è§‰çŸ¥ | "é£é™©è‡ªè¯„ 1-10?" | è¡ŒåŠ¨è®¡åˆ’ | ä¼ æ’­é¢„é˜² |
| C16 | æœªæ¥æ€ç»´ | "äº”å¹´åçš„è‡ªå·±?" | å†³ç­–çŸ©é˜µ (æ”¹å˜ vs ä¸æ”¹å˜) | äººç”Ÿå¯¼å¸ˆ |

#### èƒ½åŠ›èµ„æº (C17-C20)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C17 | æ—¶é—´èµ„æº | "æœ€æ”¾æ¾æ—¶æ®µ?" | ç¢ç‰‡åŒ–è®¾è®¡ (5åˆ†é’Ÿ) | æ—¶é—´ç®¡ç†ä¼ æˆ |
| C18 | ç»æµèµ„æº | é›¶æˆæœ¬æ–¹æ¡ˆ | æŠ•èµ„å›æŠ¥åˆ†æ | èµ„æºå…±äº« |
| C19 | æŠ€èƒ½æå‡ | "å·²ç»ä¼šåšä»€ä¹ˆ?" | æŠ€èƒ½è¿›é˜¶ | æŠ€èƒ½ä¼ æˆ |
| C20 | ç¯å¢ƒæ”¹å–„ | "æ”¯æŒ vs é˜»ç¢å› ç´ ?" | ç¯å¢ƒæ”¹é€  | ç¯å¢ƒå€¡å¯¼ |

#### ç¤¾ä¼šå› ç´  (C21-C24)

| # | åˆ†ç±» | L1 ç­–ç•¥ | L3 ç­–ç•¥ | L5 ç­–ç•¥ |
|---|------|--------|--------|--------|
| C21 | æ¦œæ ·å½±å“ | "æƒ³å˜æˆé‚£æ ·çš„äºº?" | æ¦œæ ·æ•…äº‹ | æˆä¸ºæ¦œæ · |
| C22 | åŒä¼´ç¤¾ç¾¤ | "ç¤¾ç¾¤å…±åŒåŠªåŠ›?" | ç¤¾ç¾¤åŒ¹é… | ç¤¾ç¾¤é¢†å¯¼ |
| C23 | å®¶åº­æ”¯æŒ | "å®¶äººæ€åº¦?" | å®¶åº­å…±å»º | å®¶åº­æ•™è‚²è€… |
| C24 | ä¸“ä¸šæŒ‡å¯¼ | "ä¸“ä¸šæ–¹æ¡ˆæ›´æœ‰ä¿¡å¿ƒ?" | æ•™ç»ƒåä½œ | è§’è‰²å‡çº§ (æ•™ç»ƒåŸ¹è®­) |

---

## é™„å½•: æƒå¨æ¥æºæ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶ | è¡Œæ•° | è§„åˆ™å†…å®¹ |
|------|------|---------|
| `api/paths_api.py` | ~200 | å…­çº§é—¨æ§›, ç­‰çº§è®¡ç®— |
| `api/learning_api.py` | ~700 | ç­‰çº§è¦æ±‚, å­¦æ—¶/æµ‹éªŒ/è¿ç»­ç§¯åˆ† |
| `api/assessment_pipeline_api.py` | ~300 | BAPSè¯„ä¼°ç®¡çº¿ |
| `api/r4_role_upgrade_trigger.py` | ~570 | Observerâ†’Growerå‡çº§ + BehaviorRxé›†æˆ |
| `api/r6_coach_flywheel_api_live.py` | ~456 | æ•™ç»ƒå®¡æ‰¹5æ­¥é—­ç¯, å¤„æ–¹æ¿€æ´», é€šçŸ¥æ¨é€ |
| `api/governance_api.py` | ~400 | V4.0æ²»ç†26ç«¯ç‚¹ |
| `api/policy_api.py` | ~200 | ç­–ç•¥å¼•æ“12ç«¯ç‚¹ |
| `api/main.py` (rxç«¯ç‚¹) | ~94 | å¤„æ–¹æŸ¥è¯¢æƒé™, é€šçŸ¥èšåˆ+æ·±åº¦é“¾æ¥è§£æ |
| `api/v14/copilot_routes.py` | ~330 | æ··åˆè·¯ç”±: BehaviorRxâ†’LLMé™çº§ |
| `core/learning_service.py` | ~400 | è§’è‰²æ™‹çº§5è§„åˆ™, åŒé“è€…è®¡æ•° |
| `core/user_segments.py` | ~550 | 4æ¥æºÃ—4å±‚çº§, 6ç”»åƒ |
| `core/promotion_service.py` | ~210 | 4ç»´æ™‹çº§æ£€æŸ¥ |
| `core/challenge_service.py` | ~590 | æŒ‘æˆ˜ç”Ÿå‘½å‘¨æœŸ, åŒå®¡æ ¸ |
| `core/coach_push_queue_service.py` | ~515 | æ¨é€å®¡æ‰¹å·¥ä½œæµ |
| `core/push_recommendation_service.py` | ~100 | 6è§„åˆ™æ¨èå¼•æ“ |
| `core/copilot_prescription_service.py` | ~840 | LLM+è§„åˆ™å¼•æ“å¤„æ–¹, é˜¶æ®µâ†’SPIæ˜ å°„, LLMå†·å´ |
| `core/scheduler.py` | ~300 | 20å®šæ—¶ä»»åŠ¡ |
| `core/master_agent_v0.py` | ~400 | 9æ­¥ç®¡çº¿ |
| `core/agents/router.py` | ~120 | 6ä¼˜å…ˆçº§è·¯ç”± |
| `core/agents/base.py` | ~180 | AgentåŸºç¡€æƒé‡ + åŸŸå…³è”ç½‘ç»œ |
| `core/agents/coordinator.py` | ~200 | å¤šAgentåè°ƒ9æ­¥ç®—æ³• + å†²çªä¼˜å…ˆçº§ |
| `core/agents/v4_agents.py` | ~390 | 4ä¸ªV4 Agent |
| `core/rx_context_adapter.py` | ~126 | Profileâ†’RxContexté€‚é…, åŸŸâ†’Agentæ˜ å°„, Barrieræ˜ å°„ |
| `core/rx_response_mapper.py` | ~213 | DTOâ†’Copilot JSONæ˜ å°„, æ²Ÿé€šé£æ ¼â†’è¯­è°ƒ |
| `core/safety/safety_rules_ortho.py` | ~140 | L1-L4å®‰å…¨é—¨ |
| `core/peer_tracking_service.py` | ~300 | åŒé“è€…åŒ¹é…ä¸ç”Ÿå‘½å‘¨æœŸ |
| `core/device_alert_service.py` | ~250 | è®¾å¤‡é¢„è­¦åŒé€šçŸ¥é“¾, å»é‡ |
| `gateway/channels/push_router.py` | ~129 | é€šçŸ¥è·¯ç”±çº§è”è§„åˆ™, æ¸ é“é€‰æ‹© |
| `behavior_rx/core/behavior_rx_engine.py` | ~900 | ä¸‰ç»´å¤„æ–¹å¼•æ“å…¨éƒ¨è§„åˆ™ |
| `behavior_rx/core/rx_schemas.py` | ~300 | DTOå®šä¹‰, æšä¸¾ |
| `configs/point_events.json` | ~430 | 30+ç§¯åˆ†äº‹ä»¶å®šä¹‰ |
| `configs/milestones.json` | ~300 | 7é‡Œç¨‹ç¢‘+ç¿»ç‰Œ+æ¢å¤ |
| `configs/badges.json` | ~130 | 20+å¾½ç« +ç¨€æœ‰åº¦+å­¦åˆ†é—¨æ§› |
| `configs/alert_thresholds.json` | ~100 | è®¾å¤‡é¢„è­¦åŸºç¡€é˜ˆå€¼ |
| `configs/risk_thresholds.json` | ~180 | R0-R4äº”çº§é£é™©åŒºé—´ + å“åº”SLA |
| `configs/promotion_rules.json` | ~350 | é€çº§æ™‹çº§è¯¦ç»†è¦æ±‚ (å­¦åˆ†/å®è·µ/æ¯”ä¾‹/æ—¶é•¿) |
| `configs/safety_rules.json` | ~70 | å®‰å…¨é˜ˆå€¼/è¯æ®æƒé‡/ä¸¥é‡åº¦åŠ¨ä½œ/å±æœºçƒ­çº¿ |
| `configs/intervention_packs.json` | ~600 | 10ä¸ªå¹²é¢„åŒ…å®šä¹‰ |
| `configs/intervention_strategies.json` | ~1100 | 24å› Ã—5çº§å¹²é¢„ç­–ç•¥æ ‘ |

---

*æœ¬æ–‡æ¡£ç‰ˆæœ¬ V5.2.6-complete, ä¸ä»£ç åº“åŒæ­¥ã€‚è¦†ç›– 9 å¤§ç« èŠ‚, 39 ä¸ªé…ç½®/ä»£ç æƒå¨æ¥æº, 500+ æ¡è§„åˆ™ã€‚æ‰€æœ‰æ•°æ®å‡ä»ç”Ÿäº§ä»£ç å’Œé…ç½®æ–‡ä»¶ç›´æ¥æå–ã€‚*

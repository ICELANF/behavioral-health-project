# 行为健康平台 - 逻辑关系图

## 一、总体架构关系图

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                          行为健康平台 (八爪鱼架构)                            ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
                                      │
        ┌─────────────────────────────┼─────────────────────────────┐
        │                             │                             │
        ▼                             ▼                             ▼
┌───────────────┐           ┌─────────────────┐           ┌─────────────────┐
│    表1,3,4    │           │     表1,16      │           │      表1        │
│   工具平台    │◄─────────►│     大脑层      │◄─────────►│    数据池       │
│  Dify/Docker  │           │  Ollama/Models  │           │ Obsidian/RAG    │
└───────┬───────┘           └────────┬────────┘           └────────┬────────┘
        │                            │                             │
        │         ┌──────────────────┼──────────────────┐          │
        │         │                  │                  │          │
        ▼         ▼                  ▼                  ▼          ▼
┌─────────────────────┐   ┌─────────────────┐   ┌─────────────────────┐
│      表5,6          │   │     表5,7       │   │       表5,8         │
│  触手1:专家Chatflow │   │ 触手2:用户养成  │   │  触手3:教练培养     │
│    服务对象:专家    │   │ 服务对象:患者   │   │   服务对象:教练     │
└──────────┬──────────┘   └────────┬────────┘   └──────────┬──────────┘
           │                       │                       │
           ▼                       ▼                       ▼
   ┌───────────────┐       ┌───────────────┐       ┌───────────────┐
   │  Dify Agent   │       │   H5 应用     │       │ Admin Portal  │
   │   (已完成)    │       │   (待开发)    │       │  (开发中)     │
   └───────────────┘       └───────────────┘       └───────────────┘
```

---

## 二、表格分类关系图

```
                    ┌─────────────────────────────────┐
                    │         18张表格总览            │
                    └────────────────┬────────────────┘
                                     │
        ┌────────────────┬───────────┼───────────┬────────────────┐
        │                │           │           │                │
        ▼                ▼           ▼           ▼                ▼
┌───────────────┐ ┌───────────┐ ┌─────────┐ ┌─────────┐ ┌─────────────┐
│  架构层(4张)  │ │业务层(6张)│ │关键词   │ │状态管理 │ │ 配置文件    │
│               │ │           │ │ (3张)   │ │ (3张)   │ │   (2张)     │
├───────────────┤ ├───────────┤ ├─────────┤ ├─────────┤ ├─────────────┤
│ 表1:架构组件  │ │ 表5:主线  │ │表11:架构│ │表14:状态│ │ 表17:文件   │
│ 表2:层次结构  │ │ 表6:触手1 │ │表12:业务│ │表15:变更│ │ 表18:环境   │
│ 表3:工具平台  │ │ 表7:触手2 │ │表13:理论│ │表16:模型│ └─────────────┘
│ 表4:Docker    │ │ 表8:触手3 │ └─────────┘ └─────────┘
└───────────────┘ │ 表9:等级  │
                  │ 表10:TTM  │
                  └───────────┘
```

---

## 三、三触手详细关系图

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                              三条业务主线关系                                   ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

┌─────────────────────────────────────────────────────────────────────────────────┐
│ 触手1: 专家Chatflow (表5,6)                                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   专家入驻 ──► 知识上传 ──► Prompt设计 ──► Chatflow配置 ──► 对话服务           │
│      │            │            │              │               │                │
│      │            ▼            │              ▼               │                │
│      │      ┌─────────┐        │       ┌───────────┐          │                │
│      │      │ 表1     │        │       │  表6      │          │                │
│      │      │ 数据池  │◄───────┘       │ L0-L4分层 │          │                │
│      │      └─────────┘                └───────────┘          │                │
│      │                                                        ▼                │
│      │    ┌─────────────────────────────────────────────────────────┐          │
│      └───►│ 专家个人品牌 + 知识变现                                 │          │
│           └─────────────────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                              ┌─────────┴─────────┐
                              │ 共享: 大脑(表16)  │
                              │ Ollama Models     │
                              └─────────┬─────────┘
                                        │
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 触手2: 用户行为养成 (表5,7,10)                                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   用户注册 ──► TTM评估 ──► 目标设定 ──► 行为干预 ──► 习惯追踪 ──► 行为养成      │
│                  │           │            │            │                       │
│                  ▼           ▼            ▼            ▼                       │
│            ┌─────────┐ ┌─────────┐  ┌─────────┐  ┌─────────┐                   │
│            │ 表10    │ │ 表13    │  │  表7    │  │  表7    │                   │
│            │TTM5阶段 │ │ SMART   │  │ L2能力  │  │ L1数据  │                   │
│            └─────────┘ └─────────┘  └─────────┘  └─────────┘                   │
│                                                                                 │
│    ┌─────────────────────────────────────────────────────────────────────┐      │
│    │ 用户健康改善 + 行为习惯养成                                         │      │
│    └─────────────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                              ┌─────────┴─────────┐
                              │ 连接: 教练服务    │
                              └─────────┬─────────┘
                                        │
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 触手3: 教练培养体系 (表5,8,9)                                                   │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│   教练注册 ──► 课程学习 ──► 考试认证 ──► 等级晋升 ──► 带学员 ──► 督导          │
│                  │            │            │           │          │            │
│                  ▼            ▼            ▼           ▼          ▼            │
│            ┌─────────┐  ┌─────────┐  ┌─────────┐ ┌─────────┐ ┌─────────┐       │
│            │  表8    │  │  表8    │  │  表9    │ │ 触手2   │ │  表9    │       │
│            │ L3应用  │  │ L2能力  │  │ L0-L4   │ │  用户   │ │  L4级   │       │
│            └─────────┘  └─────────┘  └─────────┘ └─────────┘ └─────────┘       │
│                                                                                 │
│    ┌─────────────────────────────────────────────────────────────────────┐      │
│    │ 教练能力认证 + 职业发展路径                                         │      │
│    └─────────────────────────────────────────────────────────────────────┘      │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 四、分层架构关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            五层架构模型                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│  ┌─────────────────────────────────────────────────────────────────────┐   │
│  │ L4 呈现层    │ Dify UI │ H5应用 │ Admin Portal │    ← 表6,7,8      │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼──────────────────────────────────────┐   │
│  │ L3 应用层    │ Chatflow │ 干预流程 │ 培训认证 │    ← 表6,7,8       │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼──────────────────────────────────────┐   │
│  │ L2 能力层    │ Prompt │ TTM评估 │ 等级体系 │       ← 表6,7,8,9,10  │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼──────────────────────────────────────┐   │
│  │ L1 数据层    │ 知识库 │ 用户档案 │ 教练档案 │      ← 表1,6,7,8     │   │
│  └──────────────────────────────┬──────────────────────────────────────┘   │
│                                 │                                           │
│  ┌──────────────────────────────▼──────────────────────────────────────┐   │
│  │ L0 模型层    │ qwen2.5:14b │ deepseek-r1:7b │       ← 表1,16       │   │
│  └─────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 五、关键词关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          关键词层级关系 (表11,12,13)                         │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│                         ┌─────────────┐                                     │
│                         │  平台级     │                                     │
│                         │ 八爪鱼架构  │                                     │
│                         └──────┬──────┘                                     │
│                                │                                            │
│         ┌──────────────────────┼──────────────────────┐                     │
│         │                      │                      │                     │
│         ▼                      ▼                      ▼                     │
│   ┌───────────┐         ┌───────────┐         ┌───────────┐                │
│   │ 架构级    │         │ 业务级    │         │ 理论级    │                │
│   │ (表11)    │         │ (表12)    │         │ (表13)    │                │
│   ├───────────┤         ├───────────┤         ├───────────┤                │
│   │ • 大脑    │         │ • 专家    │         │ • TTM     │                │
│   │ • 数据池  │         │ • Chatflow│         │ • MI      │                │
│   │ • 触手    │         │ • 用户    │         │ • SMART   │                │
│   │ • 工具    │         │ • 教练    │         │           │                │
│   │           │         │ • 学员    │         │           │                │
│   │           │         │ • 督导    │         │           │                │
│   └───────────┘         └───────────┘         └───────────┘                │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 六、状态与生命周期关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        模块状态生命周期 (表14,15)                            │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│    ⏳待开发 ────► 🔨开发中 ────► ✅已完成 ────► 🔒已冻结                    │
│        │              │              │              │                       │
│        │              │              │              │                       │
│        ▼              ▼              ▼              ▼                       │
│   ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐                    │
│   │ 用户H5  │   │教练管理 │   │考试系统 │   │Dify配置 │                    │
│   │ 触手2   │   │ 触手3   │   │ 触手3   │   │ 工具层  │                    │
│   └─────────┘   └─────────┘   └─────────┘   └─────────┘                    │
│                                                                             │
│   ════════════════════════════════════════════════════════════════         │
│                                                                             │
│   变更控制规则:                                                             │
│   ┌─────────────┬────────────────────┬──────────────┐                      │
│   │ 新增功能    │ 新建文件，不改已有 │ 无需审批     │                      │
│   │ Bug修复     │ 最小改动          │ 无需审批     │                      │
│   │ 重构优化    │ 评估影响范围      │ 需确认       │                      │
│   │ 冻结模块改  │ 原则禁止          │ 需明确提出   │                      │
│   └─────────────┴────────────────────┴──────────────┘                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 七、数据流向关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                            系统数据流向                                      │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   ┌─────────┐      ┌─────────┐      ┌─────────┐      ┌─────────┐          │
│   │  专家   │      │  用户   │      │  教练   │      │  督导   │          │
│   └────┬────┘      └────┬────┘      └────┬────┘      └────┬────┘          │
│        │                │                │                │                │
│        ▼                ▼                ▼                ▼                │
│   ┌─────────────────────────────────────────────────────────────┐          │
│   │                      API Gateway (Dify/FastAPI)             │          │
│   └─────────────────────────────┬───────────────────────────────┘          │
│                                 │                                           │
│        ┌────────────────────────┼────────────────────────┐                 │
│        │                        │                        │                 │
│        ▼                        ▼                        ▼                 │
│   ┌─────────┐            ┌───────────┐            ┌─────────┐              │
│   │ 知识库  │◄──────────►│   大脑    │◄──────────►│ 业务库  │              │
│   │Obsidian │            │  Ollama   │            │ PgSQL   │              │
│   │ (RAG)   │            │           │            │         │              │
│   └─────────┘            └───────────┘            └─────────┘              │
│       │                        │                        │                  │
│       │     ┌──────────────────┴──────────────────┐     │                  │
│       │     │         表1,3,4,16,17,18            │     │                  │
│       │     └─────────────────────────────────────┘     │                  │
│       │                                                 │                  │
│       └────────────────────┬────────────────────────────┘                  │
│                            │                                               │
│                            ▼                                               │
│                    ┌───────────────┐                                       │
│                    │   向量数据库   │                                       │
│                    │   Weaviate    │                                       │
│                    └───────────────┘                                       │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 八、实现优先级关系图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         实现优先级路线图                                     │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Phase 0 (已完成)          Phase 1 (当前)           Phase 2 (下一步)       │
│   ════════════════          ═══════════════          ═══════════════        │
│                                                                             │
│   ┌─────────────┐          ┌─────────────┐          ┌─────────────┐        │
│   │ Dify平台    │ ───────► │ 教练管理    │ ───────► │ 用户H5      │        │
│   │ ✅完成      │          │ 🔨进行中    │          │ ⏳待开发    │        │
│   └─────────────┘          └─────────────┘          └─────────────┘        │
│                                                                             │
│   ┌─────────────┐          ┌─────────────┐          ┌─────────────┐        │
│   │ 吃动守恒    │ ───────► │ 更多专家    │ ───────► │ 专家社区    │        │
│   │ ✅完成      │          │ 🔨规划中    │          │ ⏳待规划    │        │
│   └─────────────┘          └─────────────┘          └─────────────┘        │
│                                                                             │
│   ┌─────────────┐          ┌─────────────┐          ┌─────────────┐        │
│   │ 课程考试    │ ───────► │ 晋级审核    │ ───────► │ 督导系统    │        │
│   │ ✅完成      │          │ 🔨进行中    │          │ ⏳待开发    │        │
│   └─────────────┘          └─────────────┘          └─────────────┘        │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

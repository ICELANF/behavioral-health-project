# è¡Œå¥å¹³å° V4.0 â€” å¥‘çº¦æ³¨å†Œè¡¨å¢é‡æ›´æ–°æ—¥å¿— V2.0

**ç‰ˆæœ¬**: V2.0 (åˆå¹¶å®‰å…¨åŠ å›ºDelta V1.0 + MVP Week1 äº¤ä»˜ç‰©)  
**æ—¥æœŸ**: 2026-02-15  
**ç¼–åˆ¶**: åŸºäº V3.7.1 å¥‘çº¦æ³¨å†Œè¡¨ + å®‰å…¨åŠ å›ºDelta V1.0 + Week1 å®ç°

---

## ä¸€ã€æ–‡æ¡£å˜æ›´æ€»è§ˆ

| å˜æ›´æ‰¹æ¬¡ | æ¥æº | å½±å“Sheet | å˜æ›´é¡¹æ•° |
|---------|------|-----------|---------|
| å®‰å…¨åŠ å›ºDelta V1.0 | æ¸—é€æµ‹è¯•ä¿®å¤ | â‘ â‘¤â‘¨â‘©â‘® | 22é¡¹FIX + 12å®‰å…¨æ¨¡å— |
| Week1-Task1 | è§‚å¯Ÿå‘˜åˆ†å±‚å®ç° | â‘¢â‘¤â‘¨â‘© | 4ä¸ªæ–°æ–‡ä»¶ + 1ä¸ªè¿ç§» |
| Week1-Task2 | æ²»ç†ç§¯åˆ†é…ç½® | â‘¦â‘© | 15ä¸ªç§¯åˆ†äº‹ä»¶é…ç½® |
| Week1-Task3 | å‰ç«¯é€»è¾‘ä¿®å¤ | â‘©â‘® | 11ä¸ªç«¯ç‚¹ä¿®å¤æ¨¡æ¿ |
| Week1-Task4 | å®¡è®¡æ—¥å¿—è¡¥å…¨ | â‘¨â‘©â‘® | 14ä¸ªæ–°å®¡è®¡è§¦ç‚¹ |

---

## äºŒã€å®‰å…¨åŠ å›º Delta V1.0 â†’ å¥‘çº¦æ³¨å†Œè¡¨æ˜ å°„

### 2.1 æ•°æ®æ¨¡å‹å˜æ›´ â†’ Sheetâ‘© æŠ€æœ¯å®æ–½æ˜ å°„

| æ¨¡å‹ | å˜æ›´ | FIXç¼–å· | è¿ç§» |
|------|------|---------|------|
| User | æ–°å¢ public_id (UUID, unique, indexed) | FIX-17 | 035 |
| User | æ–°å¢ password_changed_at (DateTime) | FIX-05 | 035 |
| active_tokens | æ–°å¢ token_hash (String64, indexed) | FIX-13 | 035 |
| active_tokens | token_value åºŸå¼ƒ (å“ˆå¸Œæ›¿ä»£æ˜æ–‡) | FIX-13 | 035 |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**: æ•°æ®æ¨¡å‹æ€»æ•°ä» 119+ æ›´æ–°ä¸º 126 è¡¨ (å« migration 035-036 æ–°å¢)ã€‚

### 2.2 API ç«¯ç‚¹è¡Œä¸ºå˜æ›´ â†’ Sheetâ‘¤ æœåŠ¡æƒç›Š

| ç«¯ç‚¹ | å˜æ›´ | å‰ç«¯å½±å“ |
|------|------|---------|
| POST /auth/register | æ–°å¢é™æµ 5æ¬¡/å°æ—¶/IP (429) | å‰ç«¯éœ€å¤„ç†429å“åº” |
| POST /auth/login | Redis æ»‘åŠ¨çª—å£é™æµ + token_hash å­˜å‚¨ | Token å­˜å‚¨æ–¹å¼å˜æ›´ |
| POST /auth/logout | é»‘åå•è¿ç§»åˆ° Redis (TTL è‡ªåŠ¨è¿‡æœŸ) | æ—  |
| GET /auth/me | å“åº”æ–°å¢ public_id å­—æ®µ | å‰ç«¯å¯ä½¿ç”¨ public_id æ›¿ä»£è‡ªå¢ID |
| ALL /api/* | å…¨å±€é™æµ 60æ¬¡/åˆ†é’Ÿ/IP | å‰ç«¯éœ€å¤„ç†429 |
| ALL /assessment/* | å¼ºåˆ¶ Bearer é‰´æƒ | æ—§ç‰ˆæ— tokenè°ƒç”¨å°†è¢«æ‹’ç» |
| GET /docs, /redoc | ç”Ÿäº§ç¯å¢ƒç¦ç”¨ | ä»…å¼€å‘ç¯å¢ƒå¯ç”¨ |
| GET /learning/* | IDOR ç»†ç²’åº¦æ§åˆ¶ (8å¤„) | æ•™ç»ƒä»…é™æŸ¥çœ‹è‡ªå·±å­¦å‘˜ |
| POST /learning/events | å­¦ä¹ æ—¶é•¿ä¸Šé™ â‰¤480 åˆ†é’Ÿ | è¾“å…¥éªŒè¯ |
| ALL å¼‚å¸¸å“åº” | 500 è¿”å› error_id æ›¿ä»£å †æ ˆ | å‰ç«¯ç»Ÿä¸€é”™è¯¯å¤„ç† |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**: API ç«¯ç‚¹è¡Œä¸ºä¸­ 11 å¤„éœ€æ›´æ–°, æ€»è·¯ç”±æ•°ä» 646 ç›®æ ‡æ›´æ–°ä¸º 622 å·²å®ç° (96%)ã€‚

### 2.3 å®‰å…¨ç®¡é“å±‚ â†’ Sheetâ‘¤â‘® æ–°å¢

5 å±‚å®‰å…¨ä¸­é—´ä»¶é“¾ (register_all_security):
1. HTTPS é‡å®šå‘
2. å®‰å…¨å“åº”å¤´ (X-Content-Type-Options, X-Frame-Options, HSTS)
3. å…¨å±€é™æµ (60 req/min/IP)
4. æ—§ç‰ˆé‰´æƒæ‹¦æˆª
5. CSRF å®¡è®¡

12 ä¸ªæ–°å¢å®‰å…¨æ¨¡å—:

| æ¨¡å— | èŒè´£ | FIX |
|------|------|-----|
| core/rate_limiter.py | Redis æ»‘åŠ¨çª—å£é™æµ | FIX-03/04 |
| core/security_headers.py | å®‰å…¨å“åº”å¤´ | FIX-01 |
| core/error_handlers.py | é”™è¯¯ä¿¡æ¯è„±æ• | FIX-02 |
| core/password_policy.py | å¯†ç å¼ºåº¦ç­–ç•¥ | FIX-05 |
| core/input_validator.py | å­¦ä¹ æ—¶é•¿æ ¡éªŒ | FIX-06 |
| core/api_docs_config.py | æ–‡æ¡£è®¿é—®æ§åˆ¶ | FIX-07 |
| core/cors_config.py | CORS ç™½åå• | FIX-08 |
| core/idor_protection.py | IDOR æƒé™æ£€æŸ¥ | FIX-09 |
| core/token_blacklist.py | Redis Token é»‘åå• | FIX-10 |
| core/global_rate_limit.py | å…¨å±€é™æµä¸­é—´ä»¶ | FIX-11 |
| core/token_hash.py | Token å“ˆå¸Œå­˜å‚¨ | FIX-13 |
| core/public_id.py | å…¬å¼€IDç”Ÿæˆ | FIX-17 |

### 2.4 CI/CD â†’ Sheetâ‘© æ–°å¢ç±»åˆ«

| Workflow | è§¦å‘æ¡ä»¶ | å†…å®¹ |
|----------|---------|------|
| security-check.yml | PR + main push | å®‰å…¨é—¨ç¦æ£€æŸ¥ |
| test-and-deploy.yml | main push | æµ‹è¯• + éƒ¨ç½² |
| dependency-audit.yml | weekly | ä¾èµ–æ¼æ´æ‰«æ |

### 2.5 Redis åŸºç¡€è®¾æ–½ä¾èµ– â†’ å…¨Sheetå½±å“

**é‡è¦å£°æ˜**: Redis ä»å¯é€‰ç»„ä»¶å‡çº§ä¸º**å¿…éœ€åŸºç¡€è®¾æ–½**ã€‚

æ‰¿è½½åŠŸèƒ½:
- é™æµ (rate_limiter + global_rate_limit)
- Token é»‘åå• (token_blacklist)
- Token å“ˆå¸Œç¼“å­˜ (token_hash)
- è§‚å¯Ÿå‘˜ä½“éªŒç‰ˆé¢åº¦ç¼“å­˜ (Week1-Task1 æ–°å¢)
- å®¡è®¡ Redis Stream (Week1-Task4 æ–°å¢)

é™çº§ç­–ç•¥:
- é™æµ: å›é€€å†…å­˜å­—å…¸ (å•å®ä¾‹æœ‰æ•ˆ)
- é»‘åå•: å›é€€ DB æŸ¥è¯¢ (æ€§èƒ½ä¸‹é™)
- ç¼“å­˜: å›é€€ DB ç›´æŸ¥

---

## ä¸‰ã€Week1 å®ç° â†’ å¥‘çº¦æ³¨å†Œè¡¨æ˜ å°„

### 3.1 Task1: è§‚å¯Ÿå‘˜åˆ†å±‚ â†’ Sheetâ‘¢â‘¤â‘¨â‘©

**æ–°å¢æ–‡ä»¶**:

| æ–‡ä»¶ | ç±»å‹ | å¯¹åº”Sheet |
|------|------|-----------|
| observer_access_middleware.py | åç«¯ä¸­é—´ä»¶ | â‘¢AèŠ‚ |
| observer_trial_model.py | ORM + Migration 037 | â‘¢AèŠ‚ |
| observer_route_guard.js | å‰ç«¯è·¯ç”±å®ˆå« | â‘¤æƒç›ŠçŸ©é˜µ |
| trial_api_endpoints.py | APIç«¯ç‚¹ (4ä¸ª) | â‘¢AèŠ‚ |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**:
- Sheetâ‘¢ AèŠ‚ã€Œè§‚å¯Ÿå‘˜åˆ†å±‚ã€: å®ç°çŠ¶æ€ä»ã€Œæœªå®ç°ã€â†’ã€Œå·²å®ç°ã€
- Sheetâ‘¤: å…æ³¨å†Œ/æ³¨å†Œè§‚å¯Ÿå‘˜æƒç›ŠçŸ©é˜µé€šè¿‡ä¸­é—´ä»¶è½åœ°
- Sheetâ‘©: P0 ä»»åŠ¡ã€Œè§‚å¯Ÿå‘˜åˆ†å±‚è®¿é—®æ§åˆ¶ã€æ ‡è®°å·²å®Œæˆ
- æ•°æ®æ¨¡å‹: æ–°å¢ observer_trial_usage è¡¨ (è¿ç§» 037)
- API ç«¯ç‚¹: æ–°å¢ 4 ä¸ª /v1/trial/* ç«¯ç‚¹
- æµ‹è¯•: 10 ä¸ª pytest cases å…¨éƒ¨ PASS (OBS-01~OBS-10)

### 3.2 Task2: æ²»ç†ç§¯åˆ†é…ç½® â†’ Sheetâ‘¦â‘©

**æ–°å¢é…ç½®**:

| ç±»åˆ« | æ•°é‡ | ç§¯åˆ†ç±»å‹åˆ†å¸ƒ |
|------|------|-------------|
| æ²»ç†ç§¯åˆ†äº‹ä»¶ | 10 | æˆé•¿3 + è´¡çŒ®5 + å½±å“åŠ›2 |
| Agentç”Ÿæ€äº‹ä»¶ | 5 | è´¡çŒ®2 + å½±å“åŠ›3 |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**:
- Sheetâ‘¦: æ²»ç†10ç§ç§¯åˆ†äº‹ä»¶é…ç½®å®Œæˆ, point_events.json å¯åˆå¹¶
- Sheetâ‘©: P0 ä»»åŠ¡ã€Œæ²»ç†ç§¯åˆ†ç±»å‹é…ç½®ã€æ ‡è®°å·²å®Œæˆ
- ç§¯åˆ†è¦†ç›–ç‡: ä» 14% (~4/30) æå‡è‡³ ~63% (19/30)
- é˜²åˆ·ç­–ç•¥æ˜ å°„: å…¨éƒ¨10äº‹ä»¶ Ã— AS-01~AS-06 å…³è”å®Œæˆ
- æµ‹è¯•: 10 ä¸ª pytest cases å…¨éƒ¨ PASS (GPT-01~GPT-10)

### 3.3 Task3: å‰ç«¯é€»è¾‘ä¿®å¤ â†’ Sheetâ‘©â‘®

**11 ä¸ªé”™è¯¯è¯Šæ–­ç»“æœ**:

| ä¿®å¤ç±»åˆ« | æ•°é‡ | ä¼˜å…ˆçº§åˆ†å¸ƒ |
|---------|------|-----------|
| payload_mismatch | 7 | P0Ã—1, P1Ã—4, P2Ã—2 |
| type_error | 2 | P0Ã—1, P2Ã—1 |
| missing_field | 1 | P1Ã—1 |
| db_constraint | 1 | P0Ã—1 |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**:
- Sheetâ‘©: å‰ç«¯é›†æˆçŠ¶æ€ä»ã€Œ43âœ… 9âŒ 11ğŸ’¥ã€â†’ ä¿®å¤æ¨¡æ¿å·²äº§å‡º
- Sheetâ‘®: å·¥å…·å¼•æ“æ²»ç†ä¸­ 11 ä¸ªç«¯ç‚¹å®¡è®¡çŠ¶æ€å¾…æ›´æ–°
- å„ä¿®å¤é™„å¸¦å‰ç«¯+åç«¯åŒç«¯ä¿®å¤ä»£ç 

### 3.4 Task4: å®¡è®¡æ—¥å¿—è¡¥å…¨ â†’ Sheetâ‘¨â‘©â‘®

**æ–°å¢ 14 ä¸ªå®¡è®¡è§¦ç‚¹**:

| ç”¨æˆ·æ—…ç¨‹é˜¶æ®µ | æ–°å¢å®¡è®¡åŠ¨ä½œ | æ•°é‡ |
|-------------|------------|------|
| æ³¨å†Œå…¥å£ | user_register, user_login, role_upgrade | 3 |
| è¯„ä¼°è·¯å¾„ | assessment_started, assessment_submitted | 2 |
| AIå¯¹è¯ | chat_session_start, chat_message_sent | 2 |
| è¡Œä¸ºå¹²é¢„ | micro_action_completed, challenge_joined, checkin_completed | 3 |
| ç§¯åˆ†æ™‹çº§ | points_awarded, promotion_initiated | 2 |
| æ•°æ®ç®¡ç† | health_data_recorded, device_bound | 2 |

**å¥‘çº¦æ³¨å†Œè¡¨æ›´æ–°**:
- Sheetâ‘¨: å®¡è®¡è¦†ç›–ç‡ä» 16% (6/30) â†’ 66.7% (20/30)
- Sheetâ‘©: P0 ä»»åŠ¡ã€Œå®¡è®¡æ—¥å¿—æ ¸å¿ƒè·¯å¾„ã€æ ‡è®°å·²å®Œæˆ
- PHI è‡ªåŠ¨è„±æ•: é«˜æ•æ„Ÿå®¡è®¡äº‹ä»¶è‡ªåŠ¨ç§»é™¤å¥åº·æ•°å€¼/å¯¹è¯å†…å®¹
- Redis Stream: medium/high æ•æ„Ÿå®¡è®¡åŒæ­¥å†™å…¥å®æ—¶ç›‘æ§æµ
- æµ‹è¯•: 10 ä¸ª pytest cases å…¨éƒ¨ PASS (AUD-01~AUD-10)

---

## å››ã€åˆå¹¶åæŒ‡æ ‡æ›´æ–°

| ç»´åº¦ | åˆå¹¶å‰ (å®¡è®¡åŸºçº¿) | åˆå¹¶å (V2.0) | å˜åŒ– |
|------|------------------|--------------|------|
| æ•°æ®æ¨¡å‹ | 126 è¡¨ | 127 è¡¨ (+observer_trial_usage) | +1 |
| API ç«¯ç‚¹ | 622 è·¯ç”± | 626 è·¯ç”± (+4 trial) | +4 |
| è¿ç§» | 036 | 037 | +1 |
| æµ‹è¯• | 384 passed | 424 passed (+40 æ–°æµ‹è¯•) | +40 |
| å®‰å…¨æ¨¡å— | 12 | 12 (ä¸å˜) | - |
| RBAC è¦†ç›– | 93% | 94% (+è§‚å¯Ÿå‘˜åˆ†å±‚) | +1% |
| å®¡è®¡è¦†ç›– | 16% | 66.7% | +50.7% |
| ç§¯åˆ†è¦†ç›– | 14% | ~63% | +49% |
| å‰ç«¯é›†æˆ | 43âœ… 9âŒ 11ğŸ’¥ | 43âœ… 9âŒ 11ğŸ’¥â†’ä¿®å¤æ¨¡æ¿ | æ¨¡æ¿å°±ç»ª |

---

## äº”ã€ä¸‹ä¸€æ­¥ (Week 2-4)

ä»¥ä¸‹ä»»åŠ¡åœ¨ Week1 å®Œæˆåå¯åŠ¨:

| ä»»åŠ¡ | æ¥æº | å·¥æœŸ | ä¾èµ– |
|------|------|------|------|
| åŒè½¨æ™‹çº§å¼•æ“é›†æˆ | Sheetâ‘£â‘© | 1.5 å‘¨ | Task1 è§’è‰²ç³»ç»Ÿ |
| å…­ç§é˜²åˆ·ç­–ç•¥å¼•æ“é›†æˆ | Sheetâ‘¦â‘© | 2 å‘¨ | Task2 ç§¯åˆ†é…ç½® |
| S0-S5 é˜¶æ®µå‰ç«¯å¯è§†åŒ– | Sheetâ‘ª | 1 å‘¨ | StageEngine (å·²æœ‰20 cases) |
| è´£ä»»è¿½è¸ªæœåŠ¡+æ²»ç†ä»ªè¡¨ç›˜ | Sheetâ‘¥â‘© | 2 å‘¨ | Task4 å®¡è®¡æ¡†æ¶ |
| ä½“éªŒç‰ˆè¯„ä¼°+AIè¯•ç”¨ | Sheetâ‘¢â‘© | 4 å¤© | Task1 è§‚å¯Ÿå‘˜åˆ†å±‚ |

---

*æœ¬æ–‡æ¡£åº”ä¸ è¡Œå¥å¹³å°-å¥‘çº¦æ³¨å†Œè¡¨-v4_0_æ•´åˆç‰ˆ_updated.xlsx (15 Sheet) é…åˆä½¿ç”¨ã€‚*
*ä¸‹æ¬¡å…¨é‡æ›´æ–°æ—¶æœº: Week 2-4 ç¬¬äºŒæ‰¹ä»»åŠ¡å®Œæˆåã€‚*

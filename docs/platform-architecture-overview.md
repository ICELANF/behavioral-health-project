# è¡Œä¸ºå¥åº·æ•°å­—å¹³å° â€” æ¶æ„æ€»è§ˆ

> æœ€åæ›´æ–°: 2026-02-07
> ç‰ˆæœ¬: v18
> çŠ¶æ€: Multi-Agent åä½œè¿è¡Œ + ä¸“å®¶ç™½æ ‡å¹³å°

---

## ä¸€ã€å¹³å°å…¨æ™¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ç”¨æˆ·æ¥å…¥å±‚ (Frontend)                                â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Admin Portal   â”‚  â”‚  H5 ç§»åŠ¨ç«¯     â”‚  â”‚ ä¸“å®¶å·¥ä½œå°    â”‚  â”‚ H5-Patient-App â”‚  â”‚
â”‚  â”‚ :5174 (Docker) â”‚  â”‚ :5173 (Docker) â”‚  â”‚ :8501        â”‚  â”‚  (å¤‡ç”¨/ç‹¬ç«‹)    â”‚  â”‚
â”‚  â”‚ Vue3+AntDesign â”‚  â”‚  Vue3+Vant4    â”‚  â”‚  Streamlit   â”‚  â”‚  Vue3+Vant4    â”‚  â”‚
â”‚  â”‚ 78 é¡µé¢        â”‚  â”‚  20 é¡µé¢       â”‚  â”‚  ä¸“å®¶ç£å¯¼     â”‚  â”‚  10 é¡µé¢       â”‚  â”‚
â”‚  â”‚ 5 stores       â”‚  â”‚  3 stores      â”‚  â”‚              â”‚  â”‚  4 stores      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                   â”‚                   â”‚                              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                              â”‚
â”‚                     â”‚ nginxåä»£ /api â†’ bhp-api   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP / WebSocket           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼     API ç½‘å…³å±‚ (FastAPI)    â–¼                              â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ä¸» API ç½‘å…³  :8000  (bhp-api)                        â”‚   â”‚
â”‚  â”‚  FastAPI + Uvicorn (4 workers) + APScheduler                            â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  è®¤è¯ â”€â”€â”€ ç”¨æˆ·ç®¡ç† â”€â”€â”€ æ•™ç»ƒç«¯ â”€â”€â”€ è¯„ä¼° â”€â”€â”€ å¾®è¡ŒåŠ¨ â”€â”€â”€ æŒ‘æˆ˜æ´»åŠ¨          â”‚   â”‚
â”‚  â”‚  è®¾å¤‡ â”€â”€â”€ é¢„è­¦ â”€â”€â”€ æ¶ˆæ¯ â”€â”€â”€ æé†’ â”€â”€â”€ å†…å®¹ â”€â”€â”€ å­¦ä¹ æ¿€åŠ±                  â”‚   â”‚
â”‚  â”‚  æ¨é€é˜Ÿåˆ— â”€â”€â”€ æœç´¢ â”€â”€â”€ Agentåä½œ â”€â”€â”€ é«˜é¢‘é¢˜ç›® â”€â”€â”€ AIæ¨é€å»ºè®®            â”‚   â”‚
â”‚  â”‚  é£Ÿç‰©è¯†åˆ« â”€â”€â”€ ä¸“å®¶ç§Ÿæˆ·                                                    â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  æ€»è®¡: 29 è·¯ç”±æ¨¡å— Â· 306+ API ç«¯ç‚¹ Â· 5 å®šæ—¶ä»»åŠ¡                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                 â”‚                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æ ¸å¿ƒå¼•æ“å±‚ (Core Engines)                           â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ MasterAgent  â”‚ â”‚ è¯„ä¼°ç®¡é“       â”‚ â”‚ Brainå¼•æ“     â”‚ â”‚ BAPSä½“ç³»    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 9æ­¥åè°ƒæµç¨‹  â”‚ â”‚ BAPSâ†’Profile   â”‚ â”‚ StageRuntime  â”‚ â”‚ 4å¤§é‡è¡¨     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 12ä¸“ä¸šAgent  â”‚ â”‚ â†’Stageâ†’Interv  â”‚ â”‚ PolicyGate    â”‚ â”‚ è¯„åˆ†+æŠ¥å‘Š   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ å¾®è¡ŒåŠ¨æœåŠ¡   â”‚ â”‚ æ¨é€å®¡æ‰¹ç½‘å…³   â”‚ â”‚ è®¾å¤‡é¢„è­¦æœåŠ¡  â”‚ â”‚ æŒ‘æˆ˜æœåŠ¡    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ ç”Ÿæˆ/å®Œæˆ/æœŸ â”‚ â”‚ ç»Ÿä¸€å®¡æ‰¹å…¥å£   â”‚ â”‚ é˜ˆå€¼+å»é‡     â”‚ â”‚ CRUD/æŠ¥å   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ DeviceBridge â”‚ â”‚ æ•™ç»ƒç¡®è®¤â†’æŠ•é€’  â”‚ â”‚ åŒé€šçŸ¥        â”‚ â”‚ æ‰“å¡/é—®å·   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  æ€»è®¡: 31 æœåŠ¡æ–‡ä»¶ Â· 38 æ•°æ®æ¨¡å‹ Â· 10 è¿ç§»ç‰ˆæœ¬                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AI / LLM å±‚ (Intelligence)                             â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Ollama :11434    â”‚                    â”‚  Dify :8080                     â”‚   â”‚
â”‚  â”‚ qwen2.5:0.5b     â”‚                    â”‚  Â·å·¥ä½œæµç¼–æ’                    â”‚   â”‚
â”‚  â”‚ qwen2.5vl:7b     â”‚                    â”‚  Â·çŸ¥è¯†åº“RAG                     â”‚   â”‚
â”‚  â”‚ Â·å¯¹è¯/è¯„ä¼°/è·Ÿè¿›  â”‚                    â”‚  Â·å¤šAgentè·¯ç”±                   â”‚   â”‚
â”‚  â”‚ Â·é£Ÿç‰©å›¾åƒè¯†åˆ«    â”‚                    â”‚  Â·Proactive Health Coach        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ•°æ®å±‚ (Data)                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ Redis        â”‚  â”‚ Weaviate     â”‚  â”‚ æ–‡ä»¶å­˜å‚¨      â”‚        â”‚
â”‚  â”‚ :5432        â”‚  â”‚ :6379        â”‚  â”‚ å‘é‡æ•°æ®åº“   â”‚  â”‚ knowledge/    â”‚        â”‚
â”‚  â”‚ 38 å¼ æ•°æ®è¡¨  â”‚  â”‚ ä¼šè¯ç¼“å­˜     â”‚  â”‚ è¯­ä¹‰æ£€ç´¢     â”‚  â”‚ ObsidiançŸ¥è¯†åº“â”‚        â”‚
â”‚  â”‚ 10 è¿ç§»ç‰ˆæœ¬  â”‚  â”‚ Tokené»‘åå•  â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€Docker è¿è¡Œæ¶æ„

### 2.1 åº”ç”¨æœåŠ¡ (`docker-compose.app.yaml`)

| å®¹å™¨ | ç«¯å£ | æŠ€æœ¯ | å¥åº·æ£€æŸ¥ | è¯´æ˜ |
|------|------|------|---------|------|
| **bhp-api** | 8000-8002 | Python/FastAPI | `GET /health` 30s | ä¸»APIç½‘å…³ + å†³ç­–å¼•æ“ï¼Œ4Gå†…å­˜ä¸Šé™ |
| **bhp-h5** | 5173â†’80 | nginx+Vue3 | â€” | H5ç§»åŠ¨ç«¯ï¼Œä¾èµ– bhp-api healthy |
| **bhp-admin-portal** | 5174â†’80 | nginx+Vue3 | â€” | ç®¡ç†åå°ï¼Œä¾èµ– bhp-api healthy |
| **bhp-expert-workbench** | 8501 | Streamlit | `GET /_stcore/health` | ä¸“å®¶å·¥ä½œå°ï¼Œ1Gå†…å­˜ä¸Šé™ |

### 2.2 åŸºç¡€è®¾æ–½ (`docker-compose.yaml` â€” Dify)

| å®¹å™¨ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| dify-api | 5001 | Difyåç«¯API |
| dify-web | 3000 | Difyå‰ç«¯ |
| dify-nginx | 8080/8443 | Difyç½‘å…³ |
| dify-worker | 5001 | Difyå¼‚æ­¥Worker |
| dify-db | 5432 | PostgreSQL |
| dify-redis | 6379 | Redis |
| dify-weaviate | â€” | å‘é‡æ•°æ®åº“ |
| dify-sandbox | â€” | ä»£ç æ²™ç®± |
| dify-ssrf_proxy | 3128 | SSRFé˜²æŠ¤ä»£ç† |

**ç½‘ç»œ**: æ‰€æœ‰å®¹å™¨å…±äº« `dify_dify-network` å¤–éƒ¨ç½‘ç»œã€‚

---

## ä¸‰ã€åç«¯ API å±‚

### 3.1 è·¯ç”±æ¨¡å—æ¸…å• (29 ä¸ª)

| æ¨¡å— | å‰ç¼€ | ç«¯ç‚¹æ•° | åŠŸèƒ½ |
|------|------|--------|------|
| `auth_api.py` | `/api/v1/auth` | 6 | ç™»å½•/æ³¨å†Œ/åˆ·æ–°/æ”¹å¯†/ç™»å‡º/ä¸ªäººä¿¡æ¯ |
| `user_api.py` | `/api/v1/admin` | 11 | ç”¨æˆ·CRUD/ç»Ÿè®¡/åˆ†é…/æ•™ç»ƒåˆ—è¡¨ |
| `coach_api.py` | `/api/v1/coach` | 12 | å­¦å‘˜çœ‹æ¿/ç»©æ•ˆ/ç”»åƒ/4ç±»å¥åº·æ•°æ® |
| `coach_message_api.py` | `/api/v1/coach/messages` | 6 | æ•™ç»ƒâ†”å­¦å‘˜æ¶ˆæ¯/æ”¶ä»¶ç®±/å·²è¯» |
| `coach_push_queue_api.py` | `/api/v1/coach/push-queue` | 7 | æ¨é€å®¡æ‰¹é˜Ÿåˆ—/ç»Ÿè®¡/æ‰¹é‡æ“ä½œ |
| `micro_action_api.py` | `/api/v1/micro-actions` | 6 | ä»Šæ—¥ä»»åŠ¡/å®Œæˆ/è·³è¿‡/å†å²/ç»Ÿè®¡ |
| `reminder_api.py` | `/api/v1/reminders` | 5 | æé†’CRUD/æ•™ç»ƒä»£å»º |
| `challenge_api.py` | `/api/v1/challenges` | 28 | æŒ‘æˆ˜æ¨¡æ¿CRUD/å®¡æ ¸/æŠ¥å/æ‰“å¡/é—®å·/æ•™ç»ƒåˆ†é… |
| `assessment_api.py` | `/api/assessment` | 5 | è¯„ä¼°æäº¤/å†å²/è¯¦æƒ… |
| `assessment_pipeline_api.py` | `/api/v1/assessment` | 4 | BAPSâ†’ç”»åƒâ†’é˜¶æ®µâ†’å¹²é¢„å…¨æµç¨‹ |
| `assessment_assignment_api.py` | `/api/v1/assessment-assignments` | 9 | æ•™ç»ƒåˆ†é…/å®¡æ ¸/æ¨é€è¯„ä¼° |
| `device_rest_api.py` | `/api/v1/devices` | 11 | è®¾å¤‡ç»‘å®š/å¥åº·æ•°æ® |
| `device_data.py` | `/api/v1/mp/device` | 23 | è¡€ç³–/ä½“é‡/è¡€å‹/ç¡çœ /è¿åŠ¨/HR/HRV |
| `device_alert_api.py` | `/api/v1/alerts` | 4 | æˆ‘çš„é¢„è­¦/æ•™ç»ƒé¢„è­¦/å·²è¯»/è§£å†³ |
| `high_freq_api.py` | `/api/v1/high-freq-questions` | 4 | HF-20/HF-50 é¢„è®¾é¢˜ç»„ |
| `push_recommendation_api.py` | `/api/v1/push-recommendations` | 3 | AIæ¨é€å»ºè®®/æŒ‰å­¦å‘˜/åº”ç”¨ |
| `content_api.py` | `/api/v1/content` | 24 | è¯¾ç¨‹/è§†é¢‘/æµ‹éªŒ/æ¡ˆä¾‹/å­¦ä¹ è¿›åº¦ |
| `learning_api.py` | `/api/v1/learning` | 14 | ç§¯åˆ†/æ—¶é•¿/è¿ç»­æ‰“å¡/å¥–åŠ±/æ’è¡Œæ¦œ |
| `chat_rest_api.py` | `/api/v1/chat` | 5 | ä¼šè¯/æ¶ˆæ¯/åˆ é™¤ |
| `agent_api.py` | `/api/v1/agent` | 7 | Agentåˆ—è¡¨/è¿è¡Œ/å®¡æ ¸/åé¦ˆ/ç»Ÿè®¡/å†å²/çŠ¶æ€ |
| `search_api.py` | `/api/v1/search` | 2 | å…¨å¹³å°æœç´¢ï¼ˆç”¨æˆ·/æŒ‘æˆ˜/å¾®è¡ŒåŠ¨/é¢„è­¦/æ¶ˆæ¯ï¼‰ |
| `paths_api.py` | `/api/v1/paths` | 46 | å…­å¤§è·¯å¾„ï¼ˆå¹²é¢„/ä¸“å®¶/çŸ¥è¯†/å®è·µ/ç¤¾åŒº/æ•™ç»ƒï¼‰ |
| `segments_api.py` | `/api/v1/segments` | 11 | æƒé™/åŠŸèƒ½/è§’è‰²/å±‚çº§/å‡çº§å»ºè®® |
| `miniprogram.py` | `/api/v1/mp` | 18 | å°ç¨‹åºç«¯ï¼ˆä»»åŠ¡/åé¦ˆ/å¯¹è¯/è¿›åº¦/é£é™©ï¼‰ |
| `websocket_api.py` | WebSocket | 1 | å®æ—¶æ¨é€ |
| `baps_api.py` | â€” | 3 | é—®å·/è¯„åˆ† |
| `food_recognition_api.py` | `/api/v1/food` | 2 | é£Ÿç‰©å›¾åƒè¯†åˆ«(qwen2.5vl)/å†å² |
| `tenant_api.py` | `/api/v1/tenants` | 10 | ä¸“å®¶ç§Ÿæˆ·CRUD/å®¢æˆ·/Agent/ç»Ÿè®¡ |
| `routes.py` | `/api/v1` | 6 | é€šç”¨è·¯ç”± |

**æ€»è®¡: 306+ ç«¯ç‚¹** (å¦æœ‰ v14 é—ç•™è·¯ç”± 50 ç«¯ç‚¹)

### 3.2 è®¤è¯ä¸æƒé™

```
JWT Token (python-jose + passlib/bcrypt)
â”œâ”€â”€ access_token (30min)
â”œâ”€â”€ refresh_token (7d)
â””â”€â”€ token_blacklist (ç™»å‡ºå³å¤±æ•ˆ)

æƒé™å®ˆå« (api/dependencies.py):
â”œâ”€â”€ get_current_user       â†’ è§£æJWTï¼Œè¿”å›å½“å‰ç”¨æˆ·
â”œâ”€â”€ require_admin          â†’ role_level >= 99
â””â”€â”€ require_coach_or_admin â†’ role_level >= 4

è§’è‰²å±‚çº§:
  observer(1) â†’ grower(2) â†’ sharer(3) â†’ coach(4)
  â†’ promoter/supervisor(5) â†’ master(6) â†’ admin(99)
```

### 3.3 APScheduler å®šæ—¶ä»»åŠ¡ (5 ä¸ª)

| ä»»åŠ¡ | è§¦å‘ | è¯´æ˜ |
|------|------|------|
| `daily_task_generation` | Cron æ¯å¤© 06:00 | ä¸ºæ‰€æœ‰æ´»è·ƒç”¨æˆ·ç”Ÿæˆä»Šæ—¥å¾®è¡ŒåŠ¨ä»»åŠ¡ |
| `reminder_check` | Interval æ¯ 1 åˆ†é’Ÿ | æ£€æŸ¥åˆ°æœŸæé†’å¹¶è§¦å‘ |
| `expired_task_cleanup` | Cron æ¯å¤© 23:59 | æ ‡è®°è¿‡æœŸæœªå®Œæˆä»»åŠ¡ä¸º expired |
| `process_approved_pushes` | Interval æ¯ 5 åˆ†é’Ÿ | æŠ•é€’å·²å®¡æ‰¹ä¸”åˆ°æ—¶çš„æ¨é€ |
| `expire_stale_queue_items` | Cron æ¯å¤© 06:30 | æ¸…ç† 72h è¶…æ—¶æœªå®¡æ‰¹çš„æ¨é€æ¡ç›® |

---

## å››ã€æ ¸å¿ƒå¼•æ“å±‚

### 4.1 æ•°æ®æ¨¡å‹ (38 ä¸ª)

| åˆ†ç±» | æ¨¡å‹ | è¯´æ˜ |
|------|------|------|
| **ç”¨æˆ·** | User | ç”¨æˆ·ä¸»è¡¨ï¼ˆè§’è‰²/å¯†ç /çŠ¶æ€ï¼‰ |
| **è¯„ä¼°** | Assessment, TriggerRecord, BehavioralProfile | è¯„ä¼°è®°å½•ã€è§¦å‘å› å­ã€è¡Œä¸ºç”»åƒ |
| **å¹²é¢„** | Intervention | å¹²é¢„æ–¹æ¡ˆ |
| **ä¼šè¯** | UserSession, ChatSession, ChatMessage | ç”¨æˆ·ä¼šè¯ã€AIå¯¹è¯ |
| **è®¾å¤‡** | UserDevice, GlucoseReading, HeartRateReading, HRVReading, SleepRecord, ActivityRecord, WorkoutRecord, VitalSign, HealthData | è®¾å¤‡ç»‘å®š + 9 ç±»å¥åº·æ•°æ® |
| **å¾®è¡ŒåŠ¨** | MicroActionTask, MicroActionLog | æ¯æ—¥ä»»åŠ¡ + æ‰§è¡Œæ—¥å¿— |
| **æ¶ˆæ¯** | CoachMessage, Reminder | æ•™ç»ƒæ¶ˆæ¯ + æé†’ |
| **è¯„ä¼°æ¨é€** | AssessmentAssignment, CoachReviewItem | æ•™ç»ƒåˆ†é…è¯„ä¼° + å®¡æ ¸ |
| **è®¾å¤‡é¢„è­¦** | DeviceAlert | é˜ˆå€¼é¢„è­¦ |
| **æŒ‘æˆ˜** | ChallengeTemplate, ChallengeDayPush, ChallengeEnrollment, ChallengeSurveyResponse, ChallengePushLog | æŒ‘æˆ˜æ´»åŠ¨å…¨ç”Ÿå‘½å‘¨æœŸ |
| **æ¨é€é˜Ÿåˆ—** | CoachPushQueue | ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ |
| **è¡Œä¸ºå®¡è®¡** | BehaviorAuditLog, BehaviorHistory, BehaviorTrace | è¡Œä¸ºå˜åŒ–è¿½è¸ª |
| **é£Ÿç‰©è¯†åˆ«** | FoodAnalysis | é£Ÿç‰©å›¾åƒè¯†åˆ«ç»“æœ+è¥å…»æ•°æ® |
| **ä¸“å®¶ç§Ÿæˆ·** | ExpertTenant, TenantClient, TenantAgentMapping, TenantAuditLog | ç™½æ ‡å·¥ä½œå®¤+å®¢æˆ·+Agentæ˜ å°„+å®¡è®¡ |

### 4.2 æ•°æ®åº“è¿ç§» (10 ä¸ªç‰ˆæœ¬)

| ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|
| 001 | åˆå§‹ schema â€” åŸºç¡€è¡¨ |
| 002 | å®Œæ•´ schema â€” æ‰€æœ‰æ¨¡å‹æ˜¾å¼å»ºè¡¨ |
| 003 | behavioral_profiles â€” ç»Ÿä¸€è¡Œä¸ºç”»åƒ |
| 004 | micro_actions + messaging â€” å¾®è¡ŒåŠ¨ + æ•™ç»ƒæ¶ˆæ¯ + æé†’ |
| 005 | assessment_assignments â€” è¯„ä¼°åˆ†é…ä¸å®¡æ ¸ |
| 006 | device_alerts â€” è®¾å¤‡é¢„è­¦ |
| 007 | challenge_tables â€” æŒ‘æˆ˜æ´»åŠ¨ 5 å¼ è¡¨ |
| 008 | coach_push_queue â€” ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ |
| 009 | food_analyses â€” é£Ÿç‰©è¯†åˆ«ç»“æœè¡¨ |
| 010 | tenant_tables â€” ä¸“å®¶ç§Ÿæˆ·4å¼ è¡¨(expert_tenants/tenant_clients/tenant_agent_mappings/tenant_audit_logs) |

### 4.3 æ ¸å¿ƒæœåŠ¡ (31 ä¸ª)

| æœåŠ¡æ–‡ä»¶ | åŠŸèƒ½ |
|---------|------|
| `behavioral_profile_service.py` | BAPSè¯„ä¼°â†’ç»Ÿä¸€è¡Œä¸ºç”»åƒï¼ˆé˜¶æ®µ/å¿ƒç†/äº¤äº’æ¨¡å¼/åŸŸéœ€æ±‚ï¼‰ |
| `micro_action_service.py` | æ¯æ—¥å¾®è¡ŒåŠ¨ç”Ÿæˆ/å®Œæˆ/è·³è¿‡/è¿‡æœŸ/æ•™ç»ƒä»»åŠ¡ |
| `challenge_service.py` | æŒ‘æˆ˜æ¨¡æ¿CRUD/ä¸“å®¶å®¡æ ¸/æŠ¥å/æ‰“å¡/é—®å· |
| `coach_push_queue_service.py` | ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ï¼ˆæŒ‘æˆ˜/é¢„è­¦/å¾®è¡ŒåŠ¨/AIâ†’æ•™ç»ƒå®¡æ‰¹â†’æŠ•é€’ï¼‰ |
| `device_alert_service.py` | é˜ˆå€¼ç›‘æµ‹/1hå»é‡/åŒé€šçŸ¥ï¼ˆç”¨æˆ·+æ•™ç»ƒï¼‰ |
| `device_behavior_bridge.py` | è®¾å¤‡æ•°æ®â†’è‡ªåŠ¨å®Œæˆå¾®è¡ŒåŠ¨ï¼ˆè¡€ç³–/è¡€å‹/è¿åŠ¨æ˜ å°„ï¼‰ |
| `push_recommendation_service.py` | 6è§„åˆ™AIæ¨é€å»ºè®®å¼•æ“ |
| `reminder_service.py` | æé†’CRUD + cronè¡¨è¾¾å¼è§£æ |
| `high_freq_question_service.py` | HF-20/HF-50é¢„è®¾é¢˜ç»„åŠ è½½/éƒ¨åˆ†è¯„åˆ† |
| `content_access_service.py` | è§’è‰²çº§å†…å®¹é—¨æ§ |
| `data_visibility_service.py` | å­—æ®µçº§å¯è§æ€§è¿‡æ»¤ |
| `intervention_matcher.py` | åŸŸå¹²é¢„åŒ¹é…ï¼ˆrx_libraryï¼‰ |
| `behavior_facts_service.py` | è¡Œä¸ºäº‹å®èšåˆ |
| `assessment_engine.py` | è¯„ä¼°è®¡ç®—å¼•æ“ |
| `scheduler.py` | APScheduler 5ä»»åŠ¡è°ƒåº¦ |
| `master_agent.py` | ä¸­æ¢Agentå…¥å£ |
| `master_agent_v0.py` | MasterAgent 9æ­¥æµç¨‹å®Œæ•´å®ç° (254KB) |
| `brain/stage_runtime.py` | StageRuntimeBuilderï¼ˆcurrent_stageå”¯ä¸€å†™å…¥è€…ï¼‰ |
| `brain/policy_gate.py` | RuntimePolicyGate |
| `brain/decision_engine.py` | è¡Œä¸ºå†³ç­–å¼•æ“ |
| `pipeline.py` | è¯„ä¼°/å¹²é¢„ç®¡é“ç¼–æ’ |
| `dify_client.py` | Difyå·¥ä½œæµé›†æˆ |
| `trigger_engine.py` | äº‹ä»¶è§¦å‘å¤„ç† |
| `decision_core.py` | å¹²é¢„è·¯ç”±å†³ç­– |
| `health.py` | ç³»ç»Ÿå¥åº·ç›‘æµ‹ |
| `middleware.py` | CORSç™½åå•/å®‰å…¨å¤´/æ—¥å¿—/é™æµ |
| `database.py` | SQLAlchemyå¼•æ“/ä¼šè¯ç®¡ç† |
| `user_segments.py` | ç”¨æˆ·åˆ†å±‚é€»è¾‘ |
| `limiter.py` | é™æµ |
| `logging_config.py` | æ—¥å¿—é…ç½® |
| `metrics.py` | ç³»ç»ŸæŒ‡æ ‡é‡‡é›† |

### 4.4 Multi-Agent ç³»ç»Ÿ

#### 12 ä¸ªä¸“ä¸š Agent

| Agent | ç±»å‹ | èŒè´£ |
|-------|------|------|
| ä»£è°¢ç®¡ç†Agent | metabolic | è¡€ç³–ã€ä½“é‡ã€ä»£è°¢ç›¸å…³åˆ†æä¸å»ºè®® |
| ç¡çœ ç®¡ç†Agent | sleep | ç¡çœ è´¨é‡åˆ†æã€ä½œæ¯ä¼˜åŒ–å»ºè®® |
| æƒ…ç»ªç®¡ç†Agent | emotion | æƒ…ç»ªè¯„ä¼°ã€å‹åŠ›ç®¡ç†ã€å¿ƒç†æ”¯æŒ |
| åŠ¨æœºæ¿€åŠ±Agent | motivation | è¡Œä¸ºåŠ¨æœºåˆ†æã€é˜¶æ®µæ¨è¿›ã€æ¿€åŠ±ç­–ç•¥ |
| æ•™ç»ƒé£æ ¼Agent | coaching | ç»Ÿä¸€æ•™ç»ƒé£æ ¼è¾“å‡ºã€å›å¤åˆæˆ |
| è¥å…»ç®¡ç†Agent | nutrition | è†³é£Ÿåˆ†æã€è¥å…»å»ºè®® |
| è¿åŠ¨åº·å¤Agent | exercise | è¿åŠ¨æ–¹æ¡ˆã€åº·å¤æŒ‡å¯¼ |
| ä¸­åŒ»å…»ç”ŸAgent | tcm | ä¸­åŒ»ä½“è´¨åˆ†æã€å…»ç”Ÿå»ºè®® |
| å±æœºå¹²é¢„Agent | crisis | é«˜é£é™©è¯†åˆ«ä¸å±æœºå¹²é¢„ |
| è¡Œä¸ºå¤„æ–¹Agent | behavior_rx | è¡Œä¸ºå¤„æ–¹åˆ¶å®šã€ä¹ æƒ¯å¹²é¢„ã€ä¾ä»æ€§ç®¡ç†ã€æˆ’çƒŸæˆ’é…’ |
| ä½“é‡ç®¡ç†Agent | weight | ä½“é‡/BMIç›‘æµ‹ã€å‡é‡æ–¹æ¡ˆã€èº«ä½“æˆåˆ†åˆ†æ |
| å¿ƒè„åº·å¤Agent | cardiac_rehab | å¿ƒè¡€ç®¡åº·å¤è¯„ä¼°ã€è¿åŠ¨å¤„æ–¹ã€é£é™©åˆ†å±‚ã€æœ¯ååº·å¤ |

#### MasterAgent 9æ­¥å¤„ç†æµç¨‹

```
Step 1-2: æ¥æ”¶ç”¨æˆ·è¾“å…¥/è®¾å¤‡æ•°æ®
Step 3:   æ›´æ–° User Master Profile
Step 4:   Agent Router â†’ é—®é¢˜ç±»å‹ + é£é™©ä¼˜å…ˆçº§
Step 4.5: æ•°æ®æ´å¯Ÿç”Ÿæˆ
Step 5-6: è°ƒç”¨ä¸“ä¸šAgent + Multi-Agent Coordinator æ•´åˆ
Step 7:   Intervention Planner â†’ ä¸ªæ€§åŒ–å¹²é¢„è·¯å¾„
Step 8:   Response Synthesizer â†’ ç»Ÿä¸€æ•™ç»ƒé£æ ¼è¾“å‡º
Step 9:   å†™å› Profile + ç”Ÿæˆä»Šæ—¥ä»»åŠ¡/è¿½è¸ªç‚¹
```

#### Agent API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ |
|------|------|------|
| `/api/v1/agent/list` | GET | è·å–æ‰€æœ‰Agentåˆ—è¡¨ä¸çŠ¶æ€ |
| `/api/v1/agent/run` | POST | è¿è¡ŒæŒ‡å®šAgentä»»åŠ¡ |
| `/api/v1/agent/pending-reviews` | GET | å¾…æ•™ç»ƒå®¡æ ¸çš„Agentè¾“å‡º |
| `/api/v1/agent/feedback` | POST | æäº¤å®¡æ ¸åé¦ˆï¼ˆé€šè¿‡/æ‹’ç»/ä¿®æ”¹/è¯„åˆ†ï¼‰ |
| `/api/v1/agent/stats/{id}` | GET | Agentæ‰§è¡Œç»Ÿè®¡ |
| `/api/v1/agent/history` | GET | æ‰§è¡Œå†å²æŸ¥è¯¢ |
| `/api/v1/agent/status` | GET | Multi-Agentç³»ç»Ÿæ•´ä½“çŠ¶æ€ |

---

## äº”ã€æ¨é€å®¡æ‰¹ç½‘å…³æ¶æ„

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   æ•°æ®æº         â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ æŒ‘æˆ˜æ¯æ—¥æ¨é€     â”‚â”€â”€â”
                    â”‚ è®¾å¤‡é¢„è­¦         â”‚â”€â”€â”¤
                    â”‚ å¾®è¡ŒåŠ¨åˆ°æœŸ       â”‚â”€â”€â”¼â”€â”€â†’ CoachPushQueue (pending)
                    â”‚ AIæ¨é€å»ºè®®       â”‚â”€â”€â”¤         â”‚
                    â”‚ Agentåˆ†æç»“æœ    â”‚â”€â”€â”˜         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  æ•™ç»ƒå®¡æ‰¹         â”‚
                                          â”‚  approve/modify   â”‚
                                          â”‚  /reject          â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â–¼              â–¼              â–¼
                              CoachMessage     Reminder      çŠ¶æ€æ›´æ–°
                              (å­¦å‘˜æ¶ˆæ¯)      (å®šæ—¶æé†’)    (approved
                                                             /rejected)
                                    â”‚              â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â–¼
                                    å­¦å‘˜æ”¶åˆ°é€šçŸ¥
                                    (Notificationsé¡µ)

å®šæ—¶ä»»åŠ¡:
  â”œâ”€â”€ æ¯5åˆ†é’Ÿ: æŠ•é€’å·²å®¡æ‰¹ä¸”åˆ°æ—¶çš„æ¨é€
  â””â”€â”€ æ¯å¤©06:30: æ¸…ç†72hè¶…æ—¶æœªå®¡æ‰¹æ¡ç›®
```

---

## å…­ã€å‰ç«¯åº”ç”¨å±‚

### 6.1 Admin Portal (ç®¡ç†åå°) â€” ç«¯å£ 5174

**Vue 3 + TypeScript + Ant Design Vue 4**
**78 ä¸ªé¡µé¢ Â· 5 ä¸ª Store**

| è§’è‰² | å…¥å£è·¯ç”± | æ ¸å¿ƒåŠŸèƒ½ |
|------|---------|---------|
| **ç®¡ç†å‘˜** | `/admin/*` | ç”¨æˆ·ç®¡ç†ã€åˆ†é…ã€æŒ‘æˆ˜ç®¡ç†ã€Promptç®¡ç†ã€å¹²é¢„åŒ…ã€ç³»ç»Ÿè®¾ç½® |
| **æ•™ç»ƒ** | `/coach-portal` | å­¦å‘˜çœ‹æ¿(Kanban)ã€7ä¸ªå¹²é¢„å·¥å…·ã€è¯„ä¼°/ç›®æ ‡/æ¨é€æŠ½å±‰ã€æŒ‘æˆ˜åˆ†é…ã€æ¨é€é˜Ÿåˆ—å®¡æ‰¹ã€å…¨å¹³å°æœç´¢ |
| **ä¸“å®¶** | `/expert-portal` | ç£å¯¼çœ‹æ¿ã€æ¡ˆä¾‹å®¡æ ¸ã€æ•™ç»ƒè¯„ä¼°ã€ç ”ç©¶æ•°æ®ã€ç™½æ ‡å·¥ä½œå®¤ç®¡ç† |
| **Cç«¯ç”¨æˆ·** | `/client` | å¥åº·ä»ªè¡¨ç›˜ã€AIå¯¹è¯ã€è®¾å¤‡æ•°æ®ã€å­¦ä¹ è¿›åº¦ã€è¯„ä¼°é—®å· |

```
è·¯ç”±æ ‘:
â”œâ”€â”€ /login                  ç™»å½•
â”œâ”€â”€ /dashboard              å·¥ä½œå°æ¦‚è§ˆ
â”œâ”€â”€ /admin
â”‚   â”œâ”€â”€ /user-management    ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ /distribution       ç”¨æˆ·åˆ†é…
â”‚   â”œâ”€â”€ /challenges         æŒ‘æˆ˜æ´»åŠ¨ç®¡ç†
â”‚   â”œâ”€â”€ /prompts/*          Promptæ¨¡æ¿
â”‚   â””â”€â”€ /interventions      å¹²é¢„åŒ…ç®¡ç†
â”œâ”€â”€ /coach-portal           æ•™ç»ƒä¸»å·¥ä½œå° (CoachHome)
â”œâ”€â”€ /coach
â”‚   â”œâ”€â”€ /student-list       å­¦å‘˜åˆ—è¡¨
â”‚   â”œâ”€â”€ /messages           æ¶ˆæ¯ä¸­å¿ƒ
â”‚   â”œâ”€â”€ /student-profile    å­¦å‘˜è¡Œä¸ºç”»åƒ
â”‚   â”œâ”€â”€ /student-health     å­¦å‘˜å¥åº·æ•°æ®
â”‚   â”œâ”€â”€ /student-assessment å­¦å‘˜è¯„ä¼°
â”‚   â”œâ”€â”€ /review             å®¡æ ¸
â”‚   â”œâ”€â”€ /content-sharing    å†…å®¹åˆ†äº«
â”‚   â”œâ”€â”€ /copilot            AIå‰¯é©¾
â”‚   â”œâ”€â”€ /ai-review          AIå®¡æ ¸
â”‚   â””â”€â”€ /my/*               æˆ‘çš„(å­¦å‘˜/å·¥å…·/ç»©æ•ˆ/è®¤è¯)
â”œâ”€â”€ /expert-portal          ä¸“å®¶ä¸»å·¥ä½œå°
â”œâ”€â”€ /expert/dashboard/:id   ä¸“å®¶ç™½æ ‡å·¥ä½œå®¤ç®¡ç†(4-tab)
â”œâ”€â”€ /expert/my/*            æˆ‘çš„(ç£å¯¼/ç ”ç©¶/å®¡æ ¸)
â”œâ”€â”€ /client                 Cç«¯é¦–é¡µ
â”œâ”€â”€ /client/chat            AIå¯¹è¯
â”œâ”€â”€ /client/my/*            æˆ‘çš„(æ¡£æ¡ˆ/è¯„ä¼°/è½¨è¿¹/è®¾å¤‡)
â”œâ”€â”€ /client/assessment/*    è¯„ä¼°(åˆ—è¡¨/åšé¢˜/ç»“æœ)
â”œâ”€â”€ /content/*              å†…å®¹ç®¡ç†(æ–‡ç« /å¡ç‰‡/æ¡ˆä¾‹/è§†é¢‘/å®¡æ ¸)
â”œâ”€â”€ /course/*               è¯¾ç¨‹ç®¡ç†
â”œâ”€â”€ /exam/*                 è€ƒè¯•ç®¡ç†
â”œâ”€â”€ /live/*                 ç›´æ’­ç®¡ç†
â”œâ”€â”€ /portal/*               é—¨æˆ·(å…¬å…±/åŒ»ç–—åŠ©æ‰‹)
â””â”€â”€ /settings               ç³»ç»Ÿè®¾ç½®
```

**Store æ¸…å•:**

| Store | ç®¡ç†çš„çŠ¶æ€ |
|-------|-----------|
| `auth.ts` | token/refreshToken/user/ç™»å½•/ç™»å‡º/æƒé™æ£€æŸ¥ |
| `agent.ts` | agentsåˆ—è¡¨/å¾…å®¡æ ¸/å½“å‰è¾“å‡º/è¿è¡Œ/åé¦ˆ/ç»Ÿè®¡ |
| `exam.ts` | è€ƒè¯•CRUD/ç»Ÿè®¡/ç­›é€‰ |
| `question.ts` | é¢˜åº“CRUD/ç­›é€‰ |

### 6.2 H5 ç§»åŠ¨ç«¯ â€” ç«¯å£ 5173

**Vue 3 + TypeScript + Vant 4**
**20 ä¸ªé¡µé¢ Â· 3 ä¸ª Store Â· 5 ä¸ª API æ¨¡å—**

```
è·¯ç”± (19æ¡):
â”œâ”€â”€ /login                  ç™»å½•ï¼ˆå«å¿«é€Ÿä½“éªŒæŒ‰é’®ï¼‰
â”œâ”€â”€ /                       é¦–é¡µï¼ˆå¾®è¡ŒåŠ¨å¡ç‰‡+è¿ç»­æ‰“å¡+æŒ‘æˆ˜å¡ç‰‡+é¢„è­¦æ¨ªå¹…ï¼‰
â”œâ”€â”€ /chat                   AIå¯¹è¯
â”œâ”€â”€ /tasks                  å¾®è¡ŒåŠ¨ä»»åŠ¡ç®¡ç†
â”œâ”€â”€ /dashboard              å¥åº·æ•°æ®çœ‹æ¿
â”œâ”€â”€ /profile                ä¸ªäººèµ„æ–™
â”œâ”€â”€ /health-records         å¥åº·æ¡£æ¡ˆ
â”œâ”€â”€ /history-reports        å†å²æŠ¥å‘Š
â”œâ”€â”€ /data-sync              è®¾å¤‡æ•°æ®åŒæ­¥
â”œâ”€â”€ /notifications          é€šçŸ¥ï¼ˆæ•™ç»ƒæ¶ˆæ¯/æé†’/å¾…è¯„ä¼°/å¥åº·é¢„è­¦ï¼‰
â”œâ”€â”€ /account-settings       è´¦æˆ·è®¾ç½®
â”œâ”€â”€ /privacy-policy         éšç§æ”¿ç­–
â”œâ”€â”€ /about-us               å…³äºæˆ‘ä»¬
â”œâ”€â”€ /behavior-assessment    è¡Œä¸ºè¯„ä¼°ï¼ˆTTM7+ä¸ªé¢˜æ¨¡å¼+åˆ†é…æ”¯æŒï¼‰
â”œâ”€â”€ /my-stage               æˆ‘çš„é˜¶æ®µï¼ˆè¡Œä¸ºé˜¶æ®µä»ªè¡¨ç›˜+å¾®è¡ŒåŠ¨ï¼‰
â”œâ”€â”€ /my-plan                æˆ‘çš„è®¡åˆ’ï¼ˆæ•™ç»ƒæ¨é€çš„ç®¡ç†æ–¹æ¡ˆï¼‰
â”œâ”€â”€ /challenges             æŒ‘æˆ˜æ´»åŠ¨åˆ—è¡¨ï¼ˆæµè§ˆ/æŠ¥åï¼‰
â”œâ”€â”€ /challenge-day/:id      æŒ‘æˆ˜æ‰“å¡æ—¥ï¼ˆæ¯æ—¥æ¨é€+é—®å·äº¤äº’ï¼‰
â”œâ”€â”€ /expert-hub             ä¸“å®¶ç›®å½•ï¼ˆå…¬å¼€ï¼Œæœç´¢+å¡ç‰‡åˆ—è¡¨ï¼‰
â””â”€â”€ /studio/:tenantId       ç™½æ ‡å·¥ä½œå®¤ï¼ˆå…¬å¼€ï¼Œå“ç‰Œä¸»é¢˜+Agentåˆ—è¡¨+æœåŠ¡åŒ…ï¼‰
```

### 6.3 ä¸“å®¶å·¥ä½œå° â€” ç«¯å£ 8501

**Streamlit** â€” ä¸“å®¶æ¡ˆä¾‹å®¡æ ¸ã€æ•™ç»ƒè¯„ä¼°ã€è´¨é‡ç›‘ç£ã€‚

### 6.4 H5-Patient-App (ç‹¬ç«‹å¤‡ç”¨)

**Vue 3 + Vant 4 Â· 10 é¡µé¢ Â· 4 Store Â· 5 API æ¨¡å—**

ç‹¬ç«‹çš„æ‚£è€…ç«¯åº”ç”¨ï¼ˆéä¸» H5 Appï¼‰ï¼Œæä¾›å¥åº·æ•°æ®å½•å…¥ã€å†å²åˆ†æã€AIå¯¹è¯ç­‰åŠŸèƒ½ã€‚

---

## ä¸ƒã€BAPS è¯„ä¼°ä½“ç³»

**å¹³å°æ ¸å¿ƒç«äº‰åŠ›** â€” å››ç»´è¡Œä¸ºè¯„ä¼°æ¡†æ¶:

| é‡è¡¨ | é¢˜æ•° | è¯„ä¼°ç»´åº¦ | äº§å‡º |
|------|------|---------|------|
| **å¤§äº”äººæ ¼** BigFive | 50 | å¤–å‘æ€§/ç¥ç»è´¨/å°½è´£æ€§/å®œäººæ€§/å¼€æ”¾æ€§ | äººæ ¼åŸºçº¿ç”»åƒ |
| **BPT-6 è¡Œä¸ºåˆ†å‹** | 18 | æ‰§è¡Œå‹/çŸ¥è¯†å‹/æƒ…ç»ªå‹/å…³ç³»å‹/ç¯å¢ƒå‹/çŸ›ç›¾å‹ | è¡Œä¸ºæ”¹å˜æ¨¡å¼ |
| **CAPACITY æ”¹å˜åŠ›** | 32 | æ„è¯†/è‡ªä¸»/åŒ¹é…/èµ„æº/æ‰¿è¯º/è®¤åŒ/æ—¶é—´/æœŸæœ› | æ”¹å˜å‡†å¤‡åº¦(32-160åˆ†) |
| **SPI æˆåŠŸæŒ‡æ•°** | 50 | åŠ¨æœº30%/èƒ½åŠ›25%/æ”¯æŒ20%/ç¯å¢ƒ15%/å†å²10% | æˆåŠŸç‡é¢„æµ‹ |

**è¯„ä¼°ç®¡é“:**

```
BAPSå››ç»´è¯„ä¼°(150é¢˜)
  â†“
è¯„åˆ†å¼•æ“ (scoring_engine.py) â€” åå‘è®¡åˆ†/ç»´åº¦åˆ†æ/æ˜Ÿçº§è¯„å®š/äº¤å‰åˆ†æ
  â†“
BehavioralProfile â€” ç»Ÿä¸€è¡Œä¸ºç”»åƒ
  â†“
StageRuntimeBuilder â€” TTMé˜¶æ®µåˆ¤å®š(å‰æ„å‘â†’æ„å‘â†’å‡†å¤‡â†’è¡ŒåŠ¨â†’ç»´æŒâ†’ç»ˆæ­¢)
  â†“
InterventionMatcher â€” åŸŸå¹²é¢„åŒ¹é…(rx_library)
  â†“
MicroActionService â€” æ¯æ—¥å¾®è¡ŒåŠ¨ç”Ÿæˆ
  â†“
æ•™ç»ƒå®¡æ ¸ â†’ æ¨é€ç»™å­¦å‘˜
```

---

## å…«ã€æ•°æ®æµå‘

### 8.1 è®¾å¤‡æ•°æ®æµ

```
å¯ç©¿æˆ´è®¾å¤‡/CGM
  â†“ æ•°æ®ä¸Šä¼ 
DeviceRestAPI â†’ å­˜å‚¨åˆ°å„Readingè¡¨
  â†“
DeviceAlertService â†’ é˜ˆå€¼æ£€æµ‹ â†’ è¶…é˜ˆå€¼?
  â”œâ”€â”€ æ˜¯ â†’ DeviceAlert + å»é‡(1h) + åŒé€šçŸ¥(ç”¨æˆ·+æ•™ç»ƒ)
  â”‚         â””â”€â”€ è¿›å…¥ CoachPushQueue
  â””â”€â”€ å¦ â†’ æ­£å¸¸å­˜å‚¨
  â†“
DeviceBehaviorBridge â†’ æ˜ å°„è®¾å¤‡æ•°æ® â†’ è‡ªåŠ¨å®Œæˆå¾®è¡ŒåŠ¨
```

### 8.2 è¯„ä¼°æ•°æ®æµ

```
å­¦å‘˜å¡«å†™è¯„ä¼° (H5 BehaviorAssessment)
  â†“
AssessmentAPI â†’ BehavioralProfileService
  â†“
StageRuntime + PolicyGate â†’ é˜¶æ®µåˆ¤å®š
  â†“
InterventionMatcher â†’ åŸŸå¹²é¢„æ–¹æ¡ˆ
  â†“
æ•™ç»ƒå®¡æ ¸ (CoachHome è¯„ä¼°æŠ½å±‰)
  â†“
æ¨é€ç»™å­¦å‘˜ (CoachPushQueue â†’ CoachMessage)
```

### 8.3 æ•™ç»ƒå¹²é¢„æµ

```
æ•™ç»ƒåœ¨ CoachHome ä¸­:
  â”œâ”€â”€ æŸ¥çœ‹å­¦å‘˜Kanbançœ‹æ¿
  â”œâ”€â”€ ä½¿ç”¨7ä¸ªå¹²é¢„å·¥å…·
  â”œâ”€â”€ æŸ¥çœ‹AIæ¨é€å»ºè®® (PushRecommendationService)
  â”œâ”€â”€ å®¡æ‰¹æ¨é€é˜Ÿåˆ— (CoachPushQueue)
  â”œâ”€â”€ åˆ†é…æŒ‘æˆ˜æ´»åŠ¨
  â”œâ”€â”€ åˆ†é…è¯„ä¼°é—®å·
  â””â”€â”€ å‘é€æ¶ˆæ¯/è®¾ç½®æé†’
          â”‚
          â–¼
    å­¦å‘˜æ”¶åˆ°é€šçŸ¥
    (H5 Notificationsé¡µ)
```

---

## ä¹ã€ä¸“å®¶ç™½æ ‡å¹³å°æ¶æ„

### 9.1 å¤šç§Ÿæˆ·æ¨¡å‹

```
ExpertTenant (slug PK: "dr-chen-endo")
â”œâ”€â”€ expert_user_id â†’ User (Integer FK)
â”œâ”€â”€ brand_* (name/tagline/avatar/logo_url/colors/theme_id)
â”œâ”€â”€ welcome_message, expert_title, expert_specialties
â”œâ”€â”€ enabled_agents (JSON array)
â”œâ”€â”€ service_packages (JSON array)
â”œâ”€â”€ tier (basic/premium/strategic_partner)
â”œâ”€â”€ max_clients, revenue_share_expert
â”‚
â”œâ”€â”€ TenantClient[]
â”‚   â”œâ”€â”€ user_id â†’ User (Integer FK)
â”‚   â”œâ”€â”€ status (active/graduated/paused/exited)
â”‚   â””â”€â”€ service_package, enrolled_at, total_sessions
â”‚
â”œâ”€â”€ TenantAgentMapping[]
â”‚   â”œâ”€â”€ agent_type (12ç§)
â”‚   â”œâ”€â”€ enabled, display_name, persona_prompt
â”‚   â””â”€â”€ welcome_message, priority
â”‚
â””â”€â”€ TenantAuditLog[]
    â”œâ”€â”€ actor_id (Integer)
    â””â”€â”€ action, details(JSON)
```

### 9.2 å“ç‰Œä¸»é¢˜ç³»ç»Ÿ

```
CSS å˜é‡ â†’ åŠ¨æ€æ³¨å…¥:
  --brand-primary   ä¸»è‰²è°ƒ
  --brand-accent    å¼ºè°ƒè‰²
  --brand-bg        èƒŒæ™¯è‰²
  --brand-text      æ–‡å­—è‰²

5 å¥—é¢„è®¾ä¸»é¢˜:
  medicalBlue   (#1E40AF) â€” å†…åˆ†æ³Œä»£è°¢
  tcmGreen      (#2D5A3D) â€” ä¸­åŒ»å…»ç”Ÿ
  healingPurple (#6D28D9) â€” å¿ƒç†æƒ…ç»ª
  cardiacRed    (#DC2626) â€” å¿ƒè„åº·å¤
  warmSand      (#D97706) â€” è¡Œä¸ºå¹²é¢„
```

### 9.3 API ç«¯ç‚¹ (10 ä¸ª)

| ç«¯ç‚¹ | æ–¹æ³• | æƒé™ | åŠŸèƒ½ |
|------|------|------|------|
| `/api/v1/tenants/hub` | GET | å…¬å¼€ | ä¸“å®¶ç›®å½•åˆ—è¡¨ |
| `/api/v1/tenants/{id}/public` | GET | å…¬å¼€ | ä¸“å®¶å…¬å¼€ä¿¡æ¯ |
| `/api/v1/tenants/{id}` | GET | è®¤è¯(owner/admin) | ç§Ÿæˆ·å®Œæ•´è¯¦æƒ… |
| `/api/v1/tenants/{id}` | PATCH | è®¤è¯(owner/admin) | æ›´æ–°å“ç‰Œ/é…ç½® |
| `/api/v1/tenants/{id}/clients` | GET | coach/admin | å®¢æˆ·åˆ—è¡¨(?status) |
| `/api/v1/tenants/{id}/clients` | POST | coach/admin | æ·»åŠ å®¢æˆ· |
| `/api/v1/tenants/{id}/clients/{cid}` | PATCH | coach/admin | æ›´æ–°å®¢æˆ· |
| `/api/v1/tenants/{id}/agents` | GET | è®¤è¯ | Agentæ˜ å°„åˆ—è¡¨ |
| `/api/v1/tenants/{id}/agents` | PUT | è®¤è¯ | æ‰¹é‡æ›´æ–°Agenté…ç½® |
| `/api/v1/tenants/{id}/stats` | GET | è®¤è¯ | å®¢æˆ·ç»Ÿè®¡ |

### 9.4 å‰ç«¯é¡µé¢

| åº”ç”¨ | é¡µé¢ | è·¯ç”± | è¯´æ˜ |
|------|------|------|------|
| H5 | ExpertHub.vue | /expert-hub | ä¸“å®¶ç›®å½• (Vant 4, å…¬å¼€) |
| H5 | ExpertStudio.vue | /studio/:tenantId | ç™½æ ‡å·¥ä½œå®¤ (Vant 4, å…¬å¼€, åŠ¨æ€ä¸»é¢˜) |
| Admin | ExpertDashboard.vue | /expert/dashboard/:tenantId | 4-tabç®¡ç†é¢æ¿ (æ¦‚è§ˆ/å®¢æˆ·/Agent/å“ç‰Œ) |

---

## åã€æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚ | æŠ€æœ¯ |
|----|------|
| **å‰ç«¯ (æ¡Œé¢)** | Vue 3 + TypeScript + Vite + Ant Design Vue 4 |
| **å‰ç«¯ (ç§»åŠ¨)** | Vue 3 + TypeScript + Vite + Vant 4 |
| **ä¸“å®¶å·¥ä½œå°** | Python + Streamlit |
| **åç«¯** | Python 3.10+ + FastAPI + Uvicorn |
| **ORM** | SQLAlchemy + Alembic |
| **æ•°æ®åº“** | PostgreSQL + Redis + Weaviate |
| **è®¤è¯** | JWT (python-jose) + bcrypt (passlib) + Tokené»‘åå• |
| **å®šæ—¶ä»»åŠ¡** | APScheduler (AsyncIOScheduler) |
| **LLM** | Ollama (qwen2.5:0.5b) + Dify |
| **å®¹å™¨** | Docker Compose (4åº”ç”¨ + 9åŸºç¡€è®¾æ–½) |
| **åå‘ä»£ç†** | nginx (å‰ç«¯å®¹å™¨å†…) |
| **å®æ—¶é€šä¿¡** | WebSocket + SSE |

---

## åä¸€ã€é‡åŒ–ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| SQLAlchemy æ•°æ®æ¨¡å‹ | 38 ä¸ª |
| æ•°æ®åº“è¿ç§»ç‰ˆæœ¬ | 10 ä¸ª |
| API è·¯ç”±æ¨¡å— | 29 ä¸ª (+ v14 é—ç•™ 5ä¸ª) |
| API ç«¯ç‚¹æ€»æ•° | 306+ (+ v14 é—ç•™ 50) |
| æ ¸å¿ƒæœåŠ¡æ–‡ä»¶ | 31 ä¸ª |
| å®šæ—¶ä»»åŠ¡ | 5 ä¸ª |
| Docker å®¹å™¨ | 13 ä¸ª (4 åº”ç”¨ + 9 åŸºç¡€è®¾æ–½) |
| Admin Portal é¡µé¢ | 78 ä¸ª .vue |
| H5 ç§»åŠ¨ç«¯é¡µé¢ | 20 ä¸ª .vue |
| H5-Patient-App é¡µé¢ | 10 ä¸ª .vue |
| Pinia Store | 12 ä¸ª (Admin 5 + H5 3 + Patient 4) |
| ä¸“ä¸š Agent | 12 ä¸ª |
| BAPS è¯„ä¼°é¢˜ç›® | 150 é¢˜ (4 é‡è¡¨) |
| è§’è‰²å±‚çº§ | 7 çº§ (observer â†’ admin) |

---

## åäºŒã€ç³»ç»ŸçŠ¶æ€

### å·²è¿è¡Œ âœ…

| æ¨¡å— | çŠ¶æ€ |
|------|------|
| å…¨éƒ¨ 38 ä¸ªæ•°æ®æ¨¡å‹ + 10 ç‰ˆè¿ç§» | âœ… æ•°æ®åº“å°±ç»ª |
| 29 ä¸ª API è·¯ç”±æ¨¡å— (306+ ç«¯ç‚¹) | âœ… å…¨éƒ¨æ³¨å†Œ |
| JWT è®¤è¯ + 7 çº§ RBAC | âœ… è¿è¡Œä¸­ |
| APScheduler 5 ä¸ªå®šæ—¶ä»»åŠ¡ | âœ… å·²å¯åŠ¨ |
| 12 ä¸ªä¸“ä¸š Agent + MasterAgent | âœ… åœ¨çº¿ |
| æ¨é€å®¡æ‰¹ç½‘å…³ | âœ… è¿è¡Œä¸­ |
| Docker 4 åº”ç”¨å®¹å™¨ | âœ… healthy |
| Admin Portal å…¨å¹³å°æœç´¢ | âœ… è¿è¡Œä¸­ |
| H5 å¿«é€Ÿä½“éªŒç™»å½• | âœ… è¿è¡Œä¸­ |
| Dify + Ollama LLM | âœ… è¿è¡Œä¸­ |
| é£Ÿç‰©è¯†åˆ« (qwen2.5vl:7b) | âœ… è¿è¡Œä¸­ |
| ä¸“å®¶ç™½æ ‡å¹³å° (5ä¸“å®¶/10ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |

### å¾…ä¼˜åŒ– ğŸ”²

| æ¨¡å— | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| Agent çœŸå® LLM è°ƒç”¨ | å½“å‰Agent fallbackä¸ºæ¨¡æ‹Ÿç»“æœï¼Œéœ€æ¥å…¥Ollama/Dify | ğŸŸ¡ ä¸­ |
| ç«¯åˆ°ç«¯æµ‹è¯• | å…¨æµç¨‹è‡ªåŠ¨åŒ–æµ‹è¯• | ğŸŸ¡ ä¸­ |
| ç”Ÿäº§éƒ¨ç½²é…ç½® | SSL/åŸŸå/æ—¥å¿—æ”¶é›†/ç›‘æ§å‘Šè­¦ | ğŸŸ¡ ä¸­ |
| æ€§èƒ½ä¼˜åŒ– | æ•°æ®åº“ç´¢å¼•/ç¼“å­˜ç­–ç•¥/åˆ†é¡µä¼˜åŒ– | ğŸŸ¢ ä½ |

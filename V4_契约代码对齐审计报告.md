# BehaviorOS V4.0 å¥‘çº¦Ã—ä»£ç å¯¹é½å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¶é—´**: 2026-02-14 (æŠ¥å‘Šæ›´æ–°: P0ä¿®å¤ + P1æ¸…ç†å)
**å®¡è®¡èŒƒå›´**: `core/models.py` (119 ORMæ¨¡å‹) | `api/` (62 APIæ¨¡å—) | `core/` (44 æœåŠ¡) | `agents/` | `behavior_rx/` | `schemas/`
**å¯¹é½æ ‡çš„**: å¥‘çº¦æ³¨å†Œè¡¨ 14 Sheet

---

## å®¡è®¡æ¦‚è¦

| ç»´åº¦ | æ€»æ•° | å·²å¯¹é½ğŸŸ¢ | éƒ¨åˆ†å¯¹é½âš ï¸ | æœªå®ç°âŒ | è„±ç®¡ğŸŸ¡ |
|------|------|---------|-----------|---------|--------|
| **æ³¨å†Œè¡¨ Sheet (æ­£å‘)** | 14 | 7 | 6 | 1 | â€” |
| **API æ¨¡å— (åå‘)** | 62 | 48 | â€” | â€” | 10 |
| **ORM æ¨¡å‹ (åå‘)** | 119 | 105 | â€” | â€” | 14 |
| **Core æœåŠ¡ (åå‘)** | 44 | 32 | â€” | â€” | 12 |

**æ­£å‘å¯¹é½ç‡**: 90.0% (7 å®Œå…¨ + 6 éƒ¨åˆ† + 1 æœªå®ç°)
**åå‘è„±ç®¡ç‡**: API 16% | ORM 12% | æœåŠ¡ 27%

---

# ä¸€ã€æ­£å‘å¯¹é½ï¼ˆæ³¨å†Œè¡¨ â†’ ä»£ç ï¼‰

## â‘  å¹³å°è§’è‰²æ¶æ„ â€” âœ… å·²å¯¹é½ (95%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| Observerâ†’Master 6çº§æšä¸¾ | âœ… | `core/models.py:27-51` UserRole enum å« OBSERVER/GROWER/SHARER/COACH/PROMOTER/SUPERVISOR/MASTER/ADMIN |
| ROLE_LEVEL æƒå¨æ˜ å°„ | âœ… | `core/models.py:62-74` OBSERVERâ†’1, GROWERâ†’2, SHARERâ†’3, COACHâ†’4, PROMOTER/SUPERVISORâ†’5, MASTERâ†’6, ADMINâ†’99 |
| L2.5 å®ä¹ æ•™ç»ƒ | âš ï¸ | `schemas/role_architecture.py:15` GovernanceTrack.intern_coach å­˜åœ¨ä½†æœªèå…¥ UserRole æšä¸¾; `api/peer_support_api.py` æœ‰ check_intern_coach_eligibility() |
| åŒè½¨åˆ¶(æˆé•¿+æ²»ç†) | âš ï¸ | `schemas/role_architecture.py` GovernanceTrack enum å®šä¹‰äº† intern_coach/ethics_auditor/quality_reviewer ä½†ä»£ç ä¸­æ— è¿è¡Œæ—¶åŒºåˆ†é€»è¾‘ |
| RBAC å®ç° | âœ… | `api/dependencies.py` get_current_user, require_admin, require_coach_or_admin |

## â‘¡ æ²»ç†è½¨å¥‘çº¦ â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (80%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| Admin/Supervisor æ²»ç†é€»è¾‘ | âœ… | `core/models.py:46` SUPERVISOR = "supervisor" (ä¸ PROMOTER å¹³çº§ L4) |
| 7é¡¹ç£å¯¼ä¸“å®¶æŒ‡æ ‡ | âœ… | `core/responsibility_tracker.py:72-85` PRO-01~07 (ç£å¯¼ä¸‹çº§/è¯æ®åˆ†çº§/Agentè´¨é‡/å·¥ä½œå®¤è¿è¥/åŸ¹è®­ä¹‰åŠ¡/çŸ¥è¯†è´¡çŒ®/åˆ©ç›Šå†²çª) |
| ä¸‰é‡è§’è‰²åŒºåˆ† | âŒ | ä»£ç æœªåŒºåˆ†"é¢†åŸŸä¸“å®¶ / è´¨é‡ç£å¯¼ / ç”Ÿæ€å»ºè®¾"ä¸‰ç§å­è§’è‰², å…¨éƒ¨åˆå¹¶ä¸º PRO æŒ‡æ ‡ |

## â‘¢ è®¿å®¢ä¸å…¥å£å¥‘çº¦ â€” âœ… å·²å¯¹é½ (90%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| Observer åˆ†å±‚(å…æ³¨å†Œ/æ³¨å†Œ) | âœ… | `api/governance_api.py:525-573` tier = "unregistered" / "registered" é€»è¾‘ |
| ä½“éªŒç‰ˆè¯„ä¼°é™1æ¬¡ | âœ… | `api/governance_api.py` assessment_trial é™åˆ¶ |
| AIä½“éªŒå¯¹è¯é™3è½® | âœ… | `core/models.py:4028` observer_dialog_count å­—æ®µè¿½è¸ª |
| å››æ¸ é“å…¥å£è¯†åˆ« | âœ… | `core/models.py:196-197` conversion_source = "self/community/institution/paid" |

## â‘£ æ™‹çº§å¥‘çº¦ â€” âœ… å·²å¯¹é½ (95%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| DualTrackStatus æ¨¡å‹ | âœ… | `core/models.py:4172-4188` status å­—æ®µå«4æ€ |
| 4ç§æ™‹çº§çŠ¶æ€ | âœ… | normal_growth / waiting_verify / growth_first / promotion_ready |
| åŒè½¨æ ¡éªŒå¼•æ“ | âœ… | `core/dual_track_engine.py` POINTS_THRESHOLDS + GROWTH_REQUIREMENTS |
| æ™‹çº§ä»ªå¼è§¦å‘ | âš ï¸ | promotion_ready çŠ¶æ€å­˜åœ¨ä½†æ— æ˜¾å¼"ä»ªå¼"é€»è¾‘(ceremony_pending å¯¹åº” promotion_ready) |

## â‘¤ æœåŠ¡æƒç›Šå¥‘çº¦ â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (70%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| 66è¡ŒÃ—10åˆ—æƒç›ŠçŸ©é˜µ | âš ï¸ | `core/user_segments.py` æœ‰ ServiceTier(4çº§) + FeatureModule(~20ç§), ä½†æœªè§å®Œæ•´66Ã—10çŸ©é˜µ |
| å†…å®¹ç­‰çº§é—¨æ§ L0-L5 | âœ… | `api/content_api.py:232,276` get_access_status(user_level, item.level) |
| RBAC åŠŸèƒ½é—¨ç¦ | âœ… | `core/content_access_service.py` + `core/data_visibility_service.py` å­—æ®µçº§è¿‡æ»¤ |

## â‘¥ è´£ä»»è¿½è¸ªå¥‘çº¦ â€” âœ… å·²å¯¹é½ (100%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| ResponsibilityMetric æ¨¡å‹ | âœ… | `core/models.py:4122-4137` user_id, metric_code, metric_value, threshold_value, status |
| 28æ¡è´£ä»»æŒ‡æ ‡ | âœ… | `core/responsibility_tracker.py` GRW-01~06, SHR-01~05, COA-01~10, PRO-01~07, MAS-01~06 |
| governance_health_check | âœ… | `core/responsibility_tracker.py` get_governance_health() å¹³å°çº§å¥åº·çœ‹æ¿ |

## â‘¦ ç§¯åˆ†å¥‘çº¦ â€” âœ… å·²å¯¹é½ (95%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| ä¸‰ç±»ç§¯åˆ†(æˆé•¿/è´¡çŒ®/å½±å“åŠ›) | âœ… | `core/models.py:3152` PointTransaction + `3167` UserPoint + `3229` PointEvent + `3247` UserPointBalance |
| 6ç§é˜²åˆ·ç­–ç•¥ AS-01~06 | âœ… | `core/anti_cheat_engine.py` check_daily_cap/apply_quality_weight/apply_time_decay/require_cross_validation/check_growth_track/detect_anomaly |
| 10ç§æ²»ç†ç§¯åˆ†äº‹ä»¶ | âš ï¸ | `schemas/point_events.py:78-104` å®é™…5ç§æ²»ç†äº‹ä»¶ + 6ç§è§‰å¯Ÿäº‹ä»¶ = 11ç§(éä¸¥æ ¼10ç§æ²»ç†) |
| AntiCheatEvent æ¨¡å‹ | âœ… | `core/models.py:4139-4151` strategy/event_type/details/action_taken/resolved |

## â‘§ ç”Ÿå‘½å‘¨æœŸå¥‘çº¦ â€” âœ… å·²å¯¹é½ (90%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| S0-S5 é˜¶æ®µæµè½¬ | âœ… | `core/models.py:3985-4041` JourneyState (s0_authorizationâ†’s5_graduation) |
| StageEngine æ¨è¿›/å›é€€ | âœ… | `core/stage_engine.py` advance_stage() + record_interruption() + graduate_user() |
| 90å¤©ç¨³å®šéªŒè¯ | âœ… | `core/stage_engine.py:264-267` stability_start_date + stability_days åœ¨è¿›å…¥ s4 æ—¶é‡ç½® |
| ä¸­æ–­æ£€æµ‹+è‡ªåŠ¨é€€å‡º | âœ… | `core/auto_exit_handler.py` è®¾å¤‡å¼‚å¸¸/å…³é”®è¯/é£é™©/è¡Œä¸ºè§¦å‘ |
| Journey API | âœ… | `api/journey_api.py` 15 endpoints (activate/progress/advance/interrupt/graduate/transitions/config) |
| **é˜¶æ®µåŒå‘åŒæ­¥** | âœ… | `core/stage_engine.py:162-181` Journeyâ†’Profile; `core/behavioral_profile_service.py:97-119` Profileâ†’Journey |

## â‘¨ æ²»ç†è§¦ç‚¹å¥‘çº¦ â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (75%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| 22è¡Œæ²»ç†è§¦ç‚¹ | âš ï¸ | `api/policy_api.py` 12 endpoints + `api/safety_api.py` 8 endpoints + `api/governance_api.py` 26 endpoints = è¦†ç›–å¤§éƒ¨åˆ†è§¦ç‚¹, ä½†æ— é€é¡¹22è¡Œå¯¹ç…§ |
| ç­–ç•¥å¼•æ“ | âœ… | `core/policy_engine.py` V007 5-step pipeline (Rulesâ†’Candidatesâ†’Conflictâ†’Costâ†’Trace) |
| å®‰å…¨ç®¡é“ | âœ… | `core/safety/pipeline.py` V005 4-layer (inputâ†’ragâ†’generationâ†’output) |

## â‘© æŠ€æœ¯å®æ–½æ˜ å°„ â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (65%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| 55è¡Œæ˜ å°„é¡¹ | âš ï¸ | `schemas/` 10ä¸ª F-001~F-010 æ–‡ä»¶è¦†ç›–è§’è‰²/å¥‘çº¦/ç§¯åˆ†/æ™‹çº§/è¯„ä¼°/é£é™©/Agent/å®‰å…¨/IES/BPT6 |
| configs/ é…ç½®æ–‡ä»¶ | âœ… | risk_thresholds.json, safety_keywords.json, safety_rules.json, rx_strategies.json, agent_templates_seed.json ç­‰ |
| æ— é€é¡¹55è¡Œæ¸…å• | âš ï¸ | æ¡†æ¶å·²å»ºä½†æ— å®Œæ•´55è¡Œæ˜ å°„éªŒè¯ |

## â‘ª æ•™ç»ƒä½“ç³»ç®¡ç† â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (80%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| æ•™ç»ƒKPIçº¢ç»¿ç¯ä»ªè¡¨ç›˜(10é¡¹) | âœ… | `api/analytics_api.py` 6 endpoints + `core/responsibility_tracker.py` COA-01~10 |
| 5çº§æ•™ç»ƒå±‚çº§ç®¡ç† | âœ… | `api/paths_api.py` _LEVEL_THRESHOLDS L0â†’L5 |
| åŒé“è€…è¿½è¸ª | âœ… | `api/companion_api.py` 6 endpoints |
| æ•™ç»ƒä¸‰è½¨å…¥å£(å†…ç”Ÿ/å¤–éƒ¨/å¹³å°) | âš ï¸ | `api/expert_registration_api.py` ä»…è¦†ç›–"å¤–éƒ¨"å…¥å£; å†…ç”Ÿ/å¹³å°å…¥å£é€»è¾‘ä¸æ˜¾å¼ |
| 400åˆ†åˆ¶è€ƒæ ¸ | âŒ | æœªè§æ˜¾å¼400åˆ†åˆ¶å®ç° |
| æ”¶ç›Šåˆ†é… | âŒ | æœªè§æ”¶ç›Šåˆ†é…ç³»ç»Ÿå®ç° |

## â‘« ç£å¯¼ä¸“å®¶Ã—Agentç”Ÿæ€ â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (85%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| AgentåŒå±‚æ¶æ„(ç”¨æˆ·å±‚/æ•™ç»ƒå±‚) | âš ï¸ | v0 MasterAgent(ç”¨æˆ·å±‚) + v6 template-aware(æ•™ç»ƒå±‚) å­˜åœ¨ä½†éç‰©ç†åˆ†ç¦» |
| 10é¢†åŸŸÃ—Agentæ˜ å°„ | âœ… | `core/agents/base.py:24-36` AgentDomain 12é¢†åŸŸ + `configs/agent_templates_seed.json` 12 presets |
| Agentå¸‚åœºå‘å¸ƒâ†’å®¡æ ¸â†’ä¸Šæ¶ | âœ… | `api/agent_ecosystem_api.py` 11 endpoints: marketplace/publish/review/install |
| ä¸“å®¶Agentè‡ªåŠ©ç®¡ç† | âœ… | `api/expert_agent_api.py` 6 endpoints: CRUD/toggle/test-routing |

## â‘¬ Rxå¼•æ“Ã—Agentå››çº§æ²»ç† â€” âš ï¸ éƒ¨åˆ†å¯¹é½ (75%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| å››çº§æ²»ç†(é¢„è®¾/è®¤è¯/æ ‡å‡†/åŸºç¡€) | âœ… | `core/models.py` AgentTemplate.governance_level å­—æ®µ |
| Rxå¼•æ“ä¸‰ç»´+SPIå››ç»´ | âœ… | `behavior_rx/behavior_rx_engine.py` 3-dim RxContext + `baps/` SPIè¯„åˆ† |
| 12ç­–ç•¥Ã—é¢†åŸŸå˜ä½“ | âœ… | `behavior_rx/core/rx_models.py:53-66` RxStrategyType enum (12ç§) + `configs/rx_strategies.json` |
| rx_strategy_templates è¡¨ | âœ… | `behavior_rx/core/rx_models.py` RxStrategyTemplate ORM (migration 030) |
| æ²™ç®±æµ‹è¯•å¼•æ“ | âŒ | sandbox_test_results è¡¨æœªè§äº core/models.py |

## â‘­ é‡‡é›†Ã—æµ‹è¯„Ã—äº¤ä»˜æ²»ç† â€” âœ… å·²å¯¹é½ (90%)

| éœ€æ±‚é¡¹ | çŠ¶æ€ | æ–‡ä»¶:è¡Œå· |
|--------|------|-----------|
| 26+ æ•°æ®æºé‡‡é›† | âœ… | `api/device_rest_api.py` + `api/device_data.py` è¦†ç›– glucose/HR/HRV/sleep/activity/BP/SpO2/weight + food_recognition |
| 5é‡è¡¨171é¢˜ BAPS | âœ… | `core/baps/scoring_engine.py` TTM7(21é¢˜)+BIG5(50é¢˜)+BPT6(18é¢˜)+CAPACITY(32é¢˜)+SPI(50é¢˜) = 171é¢˜ |
| 5äº¤ä»˜é€šé“æ²»ç† | âš ï¸ | å­˜åœ¨ chat/push/micro_action/program/coach_message ç­‰é€šé“, ä½†æ— æ˜¾å¼"5äº¤ä»˜é€šé“"é…ç½® |

---

# äºŒã€åå‘æ‰«æï¼ˆä»£ç  â†’ æ³¨å†Œè¡¨ï¼‰

## API æ¨¡å— (62ä¸ª)

### ğŸŸ¢ å¯¹é½ â€” 48ä¸ªæ¨¡å— (~403 endpoints)

| æ¨¡å— | ç«¯ç‚¹æ•° | å¯¹åº”Sheet |
|------|--------|-----------|
| auth_api.py | 6 | â‘  |
| user_api.py | 13 | â‘¡ |
| coach_api.py | 13 | â‘ª |
| learning_api.py | 15 | â‘¦ |
| credits_api.py | 8 | â‘¦ |
| paths_api.py | 6 | â‘£ |
| segments_api.py | 10 | â‘¤ |
| content_api.py | 28 | â‘ â‘­ |
| assessment_api.py | 5 | â‘­ |
| assessment_pipeline_api.py | 4 | â‘§ |
| assessment_assignment_api.py | 8 | â‘§ |
| micro_action_api.py | 6 | â‘  |
| coach_message_api.py | 6 | â‘ª |
| reminder_api.py | 5 | â‘  |
| device_rest_api.py | 11 | â‘­ |
| device_alert_api.py | 4 | â‘­ |
| challenge_api.py | 23 | â‘  |
| chat_rest_api.py | 5 | â‘  |
| companion_api.py | 6 | â‘£ |
| promotion_api.py | 6 | â‘£ |
| analytics_api.py | 6 | â‘¥ |
| admin_analytics_api.py | 7 | â‘¥ |
| exam_api.py | 7 | â‘  |
| exam_session_api.py | 4 | â‘  |
| question_api.py | 5 | â‘  |
| survey_api.py | 10 | â‘  |
| survey_response_api.py | 3 | â‘  |
| survey_stats_api.py | 3 | â‘  |
| tenant_api.py | 14 | â‘ª |
| program_api.py | 13 | â‘  |
| push_recommendation_api.py | 3 | â‘  |
| high_freq_api.py | 4 | â‘­ |
| agent_api.py | 10 | â‘« |
| agent_template_api.py | 10 | â‘« |
| agent_ecosystem_api.py | 12 | â‘« |
| expert_agent_api.py | 6 | â‘« |
| policy_api.py | 12 | â‘¨ |
| expert_content_api.py | 8 | â‘  |
| content_manage_api.py | 7 | â‘  |
| batch_ingestion_api.py | 4 | â‘­ |
| content_contribution_api.py | 7 | â‘  |
| safety_api.py | 8 | â‘¨ |
| knowledge_sharing_api.py | 9 | â‘« |
| agent_feedback_api.py | 8 | â‘« |
| user_stats_api.py | 5 | â‘  |
| food_recognition_api.py | 2 | â‘­ |
| expert_registration_api.py | 9 | â‘£ |
| search_api.py | 1 | â‘  |

### ğŸŸ¡ è„±ç®¡ â€” 10ä¸ªæ¨¡å— (~89 endpoints)

| æ¨¡å— | ç«¯ç‚¹æ•° | åŠŸèƒ½ | å»ºè®® |
|------|--------|------|------|
| governance_api.py | 26 | V4.0 åŒè½¨/é˜²åˆ·/è´£ä»»/è¿è§„/çœ‹æ¿ | çº³å…¥â‘¡â‘¥â‘¨ |
| journey_api.py | 15 | V4.0 ç”¨æˆ·æ—…ç¨‹/é˜¶æ®µ/ä¸»ä½“æ€§/ä¿¡ä»» | çº³å…¥â‘§ |
| agency_api.py | 8 | V4.0 ä¸»ä½“æ€§/ä¿¡ä»»6ä¿¡å·å¼•æ“ | çº³å…¥â‘§ |
| peer_matching_api.py | 4 | åŒä¼´åŒ¹é…ä¸å¯¼å¸ˆåˆ†é… | æ–°å¢Sheet |
| peer_support_api.py | 5 | åŒä¼´æ”¯æŒäº’åŠ¨è¿½è¸ª | æ–°å¢Sheet |
| reflection_api.py | 5 | ç”¨æˆ·åæ€/æ—¥å¿—ç³»ç»Ÿ | çº³å…¥â‘  |
| incentive_phase_api.py | 7 | V003 æ¿€åŠ±é˜¶æ®µç®¡ç† | çº³å…¥â‘¦ |
| ies_api.py | 4 | IES æ•ˆæœè¯„åˆ† | çº³å…¥â‘§ |
| ecosystem_v4_api.py | 12 | V4.0 ç”Ÿæ€åº¦é‡/Agentå¥åº· | çº³å…¥â‘« |
| advanced_rights_api.py | 3 | é«˜çº§åŠŸèƒ½æƒé™ç®¡ç† | çº³å…¥â‘¤ |

### âš« åºŸå¼ƒ â€” 1ä¸ªæ¨¡å—

| æ¨¡å— | åŸå›  |
|------|------|
| contract_api.py | æ–°å»ºä½†æœªå®Œæ•´é›†æˆåˆ°æ²»ç†æµç¨‹ |

## ORM æ¨¡å‹ (119ä¸ª)

- **ğŸŸ¢ å¯¹é½: 105ä¸ª** â€” è¦†ç›–æ³¨å†Œè¡¨14ä¸ªSheetçš„æ ¸å¿ƒæ•°æ®ç»“æ„
- **ğŸŸ¡ è„±ç®¡: 14ä¸ª** â€” V4.0æ–°å¢æ¨¡å‹ (JourneyState, DualTrackStatus, AntiCheatEvent, GovernanceViolation, UserContract, EthicalDeclaration, IESScore, IESDecisionLog, TrustScoreLog, AgencyScoreLog, StageTransitionLogV4, ResponsibilityMetric, PointEvent, UserPointBalance)
- **âš« åºŸå¼ƒ: 0ä¸ª**

## Core æœåŠ¡ (44ä¸ª)

- **ğŸŸ¢ å¯¹é½: 32ä¸ª** â€” è¦†ç›–learning/promotion/challenge/device/push/survey/program/milestone/agent/knowledge/policyç­‰
- **ğŸŸ¡ è„±ç®¡: 12ä¸ª** â€” agency_engine, dual_track_engine, anti_cheat_engine, stage_engine, peer_matching_service, peer_support_service, reflection_service, incentive_phase_engine, bpt6_rx_engine, governanceæ¨¡å—, trust_score_service, agency_service
- **âš« åºŸå¼ƒ: 1ä¸ª** â€” intervention_tracker.py (å¹¶è¡ŒORMå®šä¹‰, åº”ä½¿ç”¨core/models.py)

---

# ä¸‰ã€å†²çªæ¸…å•

## C1. Agentç³»ç»Ÿä¸‰å¤„å¹¶å­˜ â€” é£é™©: ä¸­ç­‰

### æ¶‰åŠæ–‡ä»¶

| ç³»ç»Ÿ | è·¯å¾„ | æ–‡ä»¶æ•° | çŠ¶æ€ |
|------|------|--------|------|
| **Legacy agents/** | `agents/` | 13 | âš ï¸ 13å¤„ import (10æ–‡ä»¶): orchestrator(6), octopus_engine(4), base_agent(2), snapshot_factory(1) |
| **V6 core/agents/** | `core/agents/` | 12 | âœ… æ´»è·ƒ(æ¨¡æ¿è·¯ç”±) |
| **BehaviorRx experts** | `behavior_rx/agents/` | 4 | âœ… æ´»è·ƒ(çŒ´å­è¡¥ä¸) |
| **V0 orchestrator** | `core/master_agent_v0.py` | 1 (257KB) | âœ… ä¸»è·¯å¾„ |
| **Facade wrapper** | `core/master_agent.py` | 1 | âœ… æ—¥å¿—å°è£… |

### è°ƒç”¨å…³ç³»

```
APIè¯·æ±‚ â†’ /api/v1/agent/chat
  â””â”€ get_master_agent() â†’ core/master_agent.MasterAgent (v0 facade)
     â””â”€ core/master_agent_v0.MasterAgent.process()
        â””â”€ Step 4: route_agents()
           â”œâ”€ [expertåŒ¹é…] â†’ behavior_rx/ExpertAgentRouter (å¯åŠ¨æ—¶çŒ´å­è¡¥ä¸)
           â”‚  â””â”€ CollaborationOrchestrator â†’ 4 Expert Agents
           â””â”€ [å¦åˆ™] â†’ core/agents/router.py AgentRouter â†’ 12 Hardcoded Agents

APIè¯·æ±‚ â†’ /api/v1/agent/list, /status
  â””â”€ get_agent_master() â†’ core/agents/master_agent.MasterAgent (v6)
     â””â”€ AgentRouter.route() with template correlations
```

### å†²çªæè¿°
1. **ä¸¤ä¸ªMasterAgentå•ä¾‹å¹¶å­˜**: `_master_agent`(v0) å’Œ `_agent_master`(v6) åœ¨ main.py ä¸­ç‹¬ç«‹åˆå§‹åŒ–
2. **é¢†åŸŸä»£ç†é‡å¤**: Metabolic/Cardiac åŒæ—¶æœ‰ core/agents/ (è½»é‡) å’Œ behavior_rx/ (é‡é‡) ä¸¤å¥—å®ç°
3. **Legacy agents/ éæ­»ä»£ç **: åŸºäº LlamaIndex ChatEngine çš„æ—§æ¶æ„, 13å¤„ active import (orchestratorÃ—6, octopus_engineÃ—4, base_agentÃ—2, snapshot_factoryÃ—1) åˆ†å¸ƒåœ¨ api/device_trigger, api/routes, api/xingjian_api, core/master_agent_v0, core/workflow + xingjian-agent/ é•œåƒ

### å»ºè®®å¤„ç†
- **çŸ­æœŸ**: ä¸å¯ç›´æ¥ç§»é™¤ `agents/`(13å¤„æ´»è·ƒimport); éœ€å…ˆåˆ†æ orchestrator/octopus_engine æ˜¯å¦å·²è¢« core/ æ›¿ä»£, å†é€æ­¥è¿ç§» import
- **ä¸­æœŸ**: åˆå¹¶v6æ¨¡æ¿èƒ½åŠ›åˆ°v0ç¼–æ’å™¨, æ¶ˆé™¤åŒå•ä¾‹
- **é•¿æœŸ**: ç»Ÿä¸€æ‰€æœ‰Agentä¸ºæ¨¡æ¿é©±åŠ¨, ç§»é™¤ç¡¬ç¼–ç 12-agentå­—å…¸

---

## C2. Policy/ç­–ç•¥ å¤šå¤„å®ç° â€” é£é™©: ä½

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | åˆ†ç±» | æ´»è·ƒçŠ¶æ€ |
|------|------|----------|
| `core/policy_engine.py` | **ä¸»å…¥å£** V007 5æ­¥ç®¡é“ | âœ… æ´»è·ƒ |
| `core/conflict_resolver.py` | **ä¸‹æ¸¸** Step 3 (5ç­–ç•¥ä»²è£) | âœ… è¢« PolicyEngine è°ƒç”¨ |
| `core/rule_registry.py` | **ä¸‹æ¸¸** Step 1 (è§„åˆ™åŠ è½½) | âœ… è¢« PolicyEngine è°ƒç”¨ |
| `core/decision_trace.py` | **ä¸‹æ¸¸** Step 5 (å†³ç­–è¿½è¸ª) | âœ… è¢« PolicyEngine è°ƒç”¨ |
| `core/cost_controller.py` | **ä¸‹æ¸¸** Step 4 (æˆæœ¬æ§åˆ¶) | âœ… è¢« PolicyEngine è°ƒç”¨ |
| `core/agents/policy_gate.py` | **å¹¶è¡Œ** è¿è¡Œæ—¶é—¸é—¨(Â§11) | âœ… è¢« v6 MasterAgent è°ƒç”¨ |
| `core/brain/policy_gate.py` | **å¹¶è¡Œ** è¯„ä¼°ç®¡é“é—¸é—¨ (RuntimeStateæ¥å£) | âœ… è¢« assessment_pipeline/assignment/decision_engine è°ƒç”¨ |
| `behavior_rx/core/rx_conflict_resolver.py` | **æ‰©å±•** ç¬¬6ç­–ç•¥(çŒ´å­è¡¥ä¸) | âš ï¸ è¡¥ä¸å‡½æ•°ä»æœªè¢«è°ƒç”¨ |

### è°ƒç”¨å…³ç³»

```
api/policy_api.py:199 â†’ PolicyEngine(db)
  â”œâ”€ Step 1: RuleRegistry.get_applicable_rules()
  â”œâ”€ Step 2: _build_candidates()
  â”œâ”€ Step 3: ConflictResolver.resolve()
  â”œâ”€ Step 4: CostController.check_budget()
  â””â”€ Step 5: DecisionTraceRecorder.record()

core/agents/master_agent.py:202 â†’ PolicyEngine.evaluate() [æ¡ä»¶åŠ è½½]
core/agents/master_agent.py:232 â†’ RuntimePolicyGate.evaluate() [é—¸é—¨]
```

### å†²çªæè¿°
1. **ä¸¤ä¸ª RuntimePolicyGate å¹¶è¡ŒæœåŠ¡ä¸åŒç®¡é“** (éæ­»ä»£ç ):
   - `core/brain/policy_gate.py` â€” è¯„ä¼°ç®¡é“: `evaluate(runtime_state: RuntimeState)` â†’ PolicyDecision (è¢« assessment_pipeline_api:171, assessment_assignment_api:363, decision_engine:172 è°ƒç”¨)
   - `core/agents/policy_gate.py` â€” Agentè·¯ç”±ç®¡é“: `evaluate(current_stage, stability, ...)` â†’ GateResult (è¢« master_agent.py:232 è°ƒç”¨)
   - ä¸¤è€…é€»è¾‘ç›¸åŒ(5æ¡è§„åˆ™é“¾)ä½†æ¥å£ä¸å…¼å®¹, å±æœ‰æ„åˆ†å±‚è®¾è®¡
2. **rx_conflict_resolver çŒ´å­è¡¥ä¸å¤±æ•ˆ**: `integrate_behavioral_priority()` å‡½æ•°ç­¾åä¸ ConflictResolver.resolve() ä¸åŒ¹é…, ä¸”ä»æœªè¢«è°ƒç”¨
3. **RiskLevel æšä¸¾7å¤„å®šä¹‰, 2å¥—ä¸å…¼å®¹å€¼ä½“ç³»**:
   - **R0-R4 (5çº§, è®¾å¤‡é£é™©)**: `core/models.py:100`(æƒå¨), ~~`core/assessment_engine.py:24`~~(âœ…å·²ç»Ÿä¸€import models), `schemas/risk_levels.py:13`
   - **CRITICAL/HIGH/MODERATE/LOW (4çº§, Agentè·¯ç”±)**: `core/agents/base.py:16`, `core/master_agent_v0.py:52`, `disclosure/signature.py:41`
   - **å…¶ä»–**: `services/logic_engine/schema/rules_definition.py:28`(L1-L4), `api/miniprogram.py:71`(LOW/MEDIUM/HIGH/CRITICAL å¤§å†™)

### å»ºè®®å¤„ç†
- **çŸ­æœŸ**: ä¿®å¤æˆ–ç§»é™¤ rx_conflict_resolver çŒ´å­è¡¥ä¸; R0-R4 ç»„å·²ç»Ÿä¸€ (assessment_engineâ†’import models); CRITICAL/HIGH/MODERATE/LOW ç»„éœ€ç‹¬ç«‹ä¿ç•™(è¯­ä¹‰ä¸åŒ)
- **ä¸­æœŸ**: åˆå¹¶ä¸¤ä¸ª RuntimePolicyGate ä¸ºç»Ÿä¸€æ¥å£ (é€‚é…å™¨æ¨¡å¼); ç§»é™¤ `_HAS_POLICY_ENGINE` æ¡ä»¶åˆ¤æ–­

---

## C3. Stage/é˜¶æ®µ å¤šå¤„å®ç° â€” é£é™©: ä½ (å·²ä¿®å¤åŒå‘åŒæ­¥)

### æ¶‰åŠæ–‡ä»¶

| æ–‡ä»¶ | å®šä¹‰çš„é˜¶æ®µä½“ç³» | æ´»è·ƒçŠ¶æ€ |
|------|--------------|----------|
| `core/stage_engine.py` | V4.0 Journey: s0_authorizationâ†’s5_graduation (6é˜¶æ®µ) | âœ… æ´»è·ƒ |
| `core/brain/stage_runtime.py` | TTM: StageRuntimeBuilder + StageInput | âœ… è¢« assessment_pipeline è°ƒç”¨ |
| `core/stage_aware_selector.py` | V007: TTM S0-S6 Agenté€‰æ‹© | âš ï¸ å®šä¹‰å­˜åœ¨ä½†æ— è¿è¡Œæ—¶è°ƒç”¨ |
| `agents/octopus_fsm.py` | Legacy: ç©ºæ–‡ä»¶ | âŒ æ­»ä»£ç  |
| `core/stage_mapping.py` | æœªæ‰¾åˆ° | â€” |

### ä¸‰å¥—é˜¶æ®µæšä¸¾

| æ¥æº | å­—æ®µ | å€¼æ ¼å¼ | è¡Œå· |
|------|------|--------|------|
| User.current_stage | String(4) | "S0","S1"... | models.py:189 (å·²æ ‡è®° DEPRECATED) |
| BehavioralProfile.current_stage | SQLEnum(BehavioralStage) | S0 â†’ S6 | models.py:997 |
| JourneyState.journey_stage | String(30) | s0_authorization â†’ s5_graduation | models.py:3999 |

### âœ… åŒå‘åŒæ­¥å·²å®ç° (P0 ä¿®å¤å®Œæˆ)

**æ˜ å°„å…³ç³»** (TTM â†” Journey):
```
S0 (pre_contemplation) â†” s0_authorization
S1 (contemplation)     â†” s1_awareness
S2 (preparation)       â†” s2_trial
S3 (action)            â†” s3_pathway
S4 (maintenance)       â†” s4_internalization
S5 (termination)       â†” s5_graduation
S6 (å†…åŒ–ä¸ºå¸¸)          â†’ s5_graduation
```

**4ä¸ªåŒæ­¥ç‚¹**:
1. `core/stage_engine.py:304` â€” `advance_stage()` æ¨è¿›å â†’ åŒæ­¥ BehavioralProfile.current_stage
2. `core/stage_engine.py:357` â€” `record_interruption()` å›é€€å â†’ åŒæ­¥ BehavioralProfile.current_stage
3. `core/behavioral_profile_service.py:151` â€” `generate_profile()` TTM7è¯„ä¼°å â†’ åŒæ­¥ JourneyState.journey_stage
4. `core/behavioral_profile_service.py:240` â€” `update_stage()` é˜¶æ®µæ›´æ–°å â†’ åŒæ­¥ JourneyState.journey_stage

**è¾¹ç•Œå¤„ç†**: Profile/JourneyState ä¸å­˜åœ¨æ—¶ logger.warning + è·³è¿‡; æ—¥å¿—æ ¼å¼ `"Stage sync: user={} journey={} â†’ profile={}"`

### User.current_stage å·²æ ‡è®°åºŸå¼ƒ
- `core/models.py:188` æ·»åŠ æ³¨é‡Š: `# DEPRECATED: ä½¿ç”¨ JourneyState.journey_stage æˆ– BehavioralProfile.current_stage`
- è¯¥å­—æ®µæ—  API è¯»å–, ä¸º Legacy v3 é—ç•™

### å‰©ä½™å»ºè®®
- **çŸ­æœŸ**: åˆ›å»ºç»Ÿä¸€ Stage æŠ½è±¡å±‚, æ¶ˆé™¤ä¸‰å¥—æšä¸¾æ­§ä¹‰
- **ä¸­æœŸ**: å¾…ç¡®è®¤æ— å¤–éƒ¨ä¾èµ–åç§»é™¤ User.current_stage å­—æ®µ

---

## C4. æ¨¡å‹å­—æ®µå†—ä½™ â€” é£é™©: ä½ (StageåŒæ­¥å·²ä¿®å¤)

### ç¡®è®¤çš„å†—ä½™å­—æ®µ

| å­—æ®µ | User (è¡Œå·) | BehavioralProfile (è¡Œå·) | JourneyState (è¡Œå·) | åŒæ­¥æœºåˆ¶ |
|------|------------|------------------------|---------------------|----------|
| agency_mode | 192 | 1026 | 4002 | âœ… `core/agency_service.py:156-184` ä¸‰å†™ |
| agency_score | 193 | 1027 | 4003 | âœ… `core/agency_service.py:159,174,182` ä¸‰å†™ |
| trust_score | 194 | 1028 | 4008 | âœ… `core/trust_score_service.py:133-160` ä¸‰å†™ |
| current_stage | 189 (DEPRECATED) | 997 | 3999 | âœ… **å·²ä¿®å¤** â€” åŒå‘åŒæ­¥ (è§ C3) |

### åŒæ­¥çŠ¶æ€
- **agency_mode/score, trust_score**: JourneyState ä¸ºæƒå¨æº â†’ å†™å…¥ååŒæ­¥åˆ° User + BehavioralProfile, å•æ¬¡ db.flush()
- **current_stage**: âœ… BehavioralProfile â†” JourneyState åŒå‘åŒæ­¥å·²å®ç°; User.current_stage å·²æ ‡è®° DEPRECATED

### API è¯»å–æ¥æº
- API ä»…ä» JourneyState è¯»å– agency/trust (journey_api, agent_api, governance_api)
- API ä»…ä» BehavioralProfile è¯»å– current_stage (admin_analytics_api:155, assessment_assignment_api:329)
- User.agency_mode/trust_score/current_stage **ä»æœªè¢« API æŸ¥è¯¢** â€” çº¯å†™å…¥å¿«æ·å­—æ®µ

### å‰©ä½™å»ºè®®
- **çŸ­æœŸ**: è¯„ä¼°æ˜¯å¦éœ€è¦ User è¡¨ä¸­çš„å¿«æ·å­—æ®µ(å½“å‰æœªè¢«è¯»å–)
- **é•¿æœŸ**: ç§»é™¤ User.current_stage/agency_mode/agency_score/trust_score (æ­»å­—æ®µ)

---

## C5. è·¯ç”±ç‰ˆæœ¬å¹¶å­˜ â€” é£é™©: ä½

### æ¶‰åŠæ–‡ä»¶

| ç›®å½• | æ–‡ä»¶æ•° | å‰ç¼€ | æ³¨å†ŒçŠ¶æ€ |
|------|--------|------|----------|
| `api/*.py` | 62 | `/api/v1/*` | âœ… ä¸»åŠ›è·¯ç”±, main.py æ³¨å†Œ |
| `api/routers/` | 8 | `/api/v3/*` | âœ… å°‘é‡æ³¨å†Œ (auth, assessment, health) |
| `api/v14/` | 5 | `/api/v14/*` | âœ… å°‘é‡æ³¨å†Œ (admin_routes) |
| `v3/routers/` | 8 | `/api/v3/*` | âœ… æ³¨å†Œ (auth, assessment, health, chat, knowledge, incentive, tracking) |

### main.py æ³¨å†Œåˆ†æ

```python
# ä¸»åŠ›: api/*.py (lines 260-468, ~50ä¸ªè·¯ç”±)
app.include_router(auth_router)          # api/auth_api.py
app.include_router(assessment_router)    # api/assessment_api.py
...

# V3 å…¼å®¹å±‚ (lines 487-493)
app.include_router(v3_health.router)     # v3/routers/health.py
app.include_router(v3_auth.router)       # v3/routers/auth.py (prefix=/api/v3/auth)
app.include_router(v3_assessment.router) # v3/routers/assessment.py

# V14 è¡Œä¸ºæ²»ç† (line 1242)
app.include_router(admin_behavior_router) # api/v14/admin_routes.py
```

### å†²çªæ£€æµ‹
- **æ— è·¯å¾„å†²çª**: v1/v3/v14 ä¸‰ä¸ªç‰ˆæœ¬å‰ç¼€ä¸åŒ
- **v3 æ˜¯å…¼å®¹å±‚**: ä¸ºæ—§å®¢æˆ·ç«¯ä¿ç•™çš„ /api/v3/ è·¯ç”±
- **v14 æ˜¯ V4.0 è¡Œä¸ºæ²»ç†**: admin è¡Œä¸ºç®¡ç†æ–°ç«¯ç‚¹

### å»ºè®®å¤„ç†
- **çŸ­æœŸ**: åœ¨ main.py æ·»åŠ æ³¨é‡Šè¯´æ˜ä¸‰å±‚è·¯ç”±åˆ†å·¥
- **ä¸­æœŸ**: è¯„ä¼° v3 å…¼å®¹å±‚æ˜¯å¦ä»éœ€ä¿ç•™(å®¢æˆ·ç«¯æ˜¯å¦å·²è¿ç§»è‡³ v1)
- **é•¿æœŸ**: ç»Ÿä¸€åˆ° v1 å‰ç¼€

---

## C6. çŸ¥è¯†åº“é‡å  â€” é£é™©: ä¸­ç­‰

### æ¶‰åŠæ–‡ä»¶

| ç³»ç»Ÿ | è·¯å¾„ | å‘é‡å­˜å‚¨ | åµŒå…¥æ¨¡å‹ | æ´»è·ƒçŠ¶æ€ |
|------|------|---------|---------|----------|
| **PRIMARY** | `core/knowledge/` (9æ–‡ä»¶) | PostgreSQL (JSONåˆ— + numpyä½™å¼¦) | Ollama nomic-embed-text | âœ… ç”Ÿäº§æ´»è·ƒ |
| **EXPERIMENTAL** | `core/rag/` (4æ–‡ä»¶) | Qdrant (å¤–éƒ¨å‘é‡DB) | LLMClient (å¯é…ç½®) | âŒ æ­»ä»£ç  |
| **BRIDGE** | `backend/services/` (5æ–‡ä»¶) | çº¯é‡å¯¼å‡º | sentence-transformers / Ollama | âš ï¸ æµ‹è¯•å…¼å®¹ |

### è°ƒç”¨å…³ç³»

```
ç”Ÿäº§è·¯å¾„:
  api/chat_rest_api.py:237 â†’ core.knowledge.rag_enhance()
  api/main.py:613 â†’ core.knowledge.rag_enhance()
  api/batch_ingestion_api.py:50 â†’ core.knowledge.batch_ingestion_service

å®éªŒè·¯å¾„ (æœªè¿æ¥):
  api/dependencies.py:162-196 â†’ get_rag_pipeline() â†’ core.rag.pipeline.RAGPipeline
  â†‘ å‡½æ•°å·²å®šä¹‰ä½†ä»æœªè¢«è·¯ç”±è°ƒç”¨

æ¡¥æ¥è·¯å¾„:
  backend/services/retriever.py â†’ re-export core.knowledge.retriever
  tests/ â†’ import from backend.services.*
```

### é‡å¤ç‚¹
1. **Markdownåˆ†å—**: ä¸‰å¤„å„æœ‰ä¸åŒç®—æ³• (heading split / sliding window / paragraph overlap)
2. **åµŒå…¥é›†æˆ**: ä¸‰å¤„ä½¿ç”¨ä¸åŒæ¨¡å‹ (nomic / å¯é…ç½® / text2vec-base-chinese)
3. **ä½œç”¨åŸŸåŠ æƒ**: ä»… core/knowledge/retriever.py å®ç° 3-tier SCOPE_BOOST (tenant +0.15 > domain +0.08 > platform +0)

### å»ºè®®å¤„ç†
- **ç«‹å³**: âœ… å·²åˆ›å»º `core/rag/DEPRECATED.md` (æ ‡è®°ä¸º Qdrant å®éªŒä»£ç , è®¡åˆ’ V4.1 ç§»é™¤); æ³¨æ„: 14æ–‡ä»¶ä»æœ‰ import (v3/, api/dependencies, core/llm/coach_agent, tests/ ç­‰)
- **çŸ­æœŸ**: ç»Ÿä¸€åˆ†å—ç®—æ³•åˆ° `core/knowledge/chunker.py`
- **ä¸­æœŸ**: è¯„ä¼°æ˜¯å¦éœ€ä» JSONåˆ—+numpy è¿ç§»åˆ° pgvector åŸç”Ÿ

---

# å››ã€è¡ŒåŠ¨å»ºè®®

## P0 â€” ç«‹å³ä¿®å¤ (æ•°æ®ä¸€è‡´æ€§é£é™©)

| # | è¡ŒåŠ¨ | æ¶‰åŠæ–‡ä»¶ | çŠ¶æ€ |
|---|------|---------|------|
| 1 | ~~**Stage åŒå‘åŒæ­¥**~~ | `core/stage_engine.py`, `core/behavioral_profile_service.py`, `core/models.py` | âœ… **å·²å®Œæˆ** â€” 4åŒæ­¥ç‚¹ + DEPRECATEDæ³¨é‡Š |
| 2 | ~~**åˆ é™¤ core/brain/policy_gate.py**~~ | `core/brain/policy_gate.py` | âŒ **æ’¤å›** â€” æœ‰3å¤„ç”Ÿäº§è°ƒç”¨ (assessment_pipeline/assignment/decision_engine), éæ­»ä»£ç ; é™çº§ä¸ºP2åˆå¹¶ |

## P1 â€” çŸ­æœŸæ¸…ç† (1-2å‘¨)

| # | è¡ŒåŠ¨ | æ¶‰åŠæ–‡ä»¶ | çŠ¶æ€ |
|---|------|---------|------|
| 3 | ~~å½’æ¡£ `agents/` ç›®å½•~~ | `agents/` 13æ–‡ä»¶ | âŒ **é˜»å¡** â€” 13å¤„æ´»è·ƒimport(10æ–‡ä»¶), éæ­»ä»£ç , éœ€å…ˆè¿ç§»orchestrator/octopus_engineè°ƒç”¨ |
| 4 | æ ‡è®° `core/rag/` åºŸå¼ƒ | `core/rag/DEPRECATED.md` | âœ… **å·²å®Œæˆ** â€” DEPRECATED.md å·²åˆ›å»º; 14æ–‡ä»¶ä»æœ‰import(v3å…¼å®¹å±‚+coach_agent) |
| 5 | ä¿®å¤æˆ–ç§»é™¤ rx_conflict_resolver çŒ´å­è¡¥ä¸ (ç­¾åä¸åŒ¹é…) | `behavior_rx/core/rx_conflict_resolver.py:397-436` | å¾…æ‰§è¡Œ |
| 6 | ~~ç»Ÿä¸€ RiskLevel æšä¸¾~~ | 7å¤„å®šä¹‰ | âš ï¸ **éƒ¨åˆ†å®Œæˆ** â€” `assessment_engine.py` å·²æ”¹ä¸º `from core.models import RiskLevel`; agents/base.py + master_agent_v0.py å±ä¸åŒå€¼ä½“ç³»(CRITICAL/HIGH/MODERATE/LOW â‰  R0-R4), ä¸å¯å¼ºè¡Œç»Ÿä¸€ |
| 7 | å°†10ä¸ªè„±ç®¡APIæ¨¡å—çº³å…¥æ³¨å†Œè¡¨å¯¹åº”Sheet | governance_apiâ†’â‘¡â‘¥â‘¨, journey_apiâ†’â‘§, agency_apiâ†’â‘§ ç­‰ | å¾…æ‰§è¡Œ |

## P2 â€” ä¸­æœŸæ¶æ„ä¼˜åŒ– (1ä¸ªæœˆ)

| # | è¡ŒåŠ¨ | æ”¶ç›Š |
|---|------|------|
| 8 | åˆå¹¶åŒ MasterAgent å•ä¾‹ (v0+v6 â†’ ç»Ÿä¸€ç¼–æ’å™¨) | æ¶ˆé™¤æ¶æ„æ··æ·† |
| 8b | åˆå¹¶åŒ RuntimePolicyGate (brain+agents â†’ ç»Ÿä¸€æ¥å£, é€‚é…å™¨æ¨¡å¼) | æ¶ˆé™¤ C2 å¹¶è¡Œé—¸é—¨ |
| 9 | ç§»é™¤ User è¡¨æ­»å­—æ®µ (agency_mode/agency_score/trust_score/current_stage) | å‡å°‘å­˜å‚¨ (current_stage å·²æ ‡è®° DEPRECATED) |
| 10 | åˆ›å»ºç»Ÿä¸€ Stage æŠ½è±¡ (æ¶ˆé™¤ä¸‰å¥—é˜¶æ®µæšä¸¾) | é˜²æ­¢è¯­ä¹‰é”™è¯¯ (åŒå‘åŒæ­¥å·²åˆ°ä½, ä¼˜å…ˆçº§é™ä½) |
| 11 | è¡¥å…… â‘¤ æœåŠ¡æƒç›Š 66Ã—10 çŸ©é˜µå®Œæ•´å®ç° | è¡¥é½æœ€å¤§Gap |
| 12 | è¡¥å…… â‘ª æ•™ç»ƒ 400åˆ†åˆ¶è€ƒæ ¸ + æ”¶ç›Šåˆ†é… | å®Œå–„æ•™ç»ƒä½“ç³» |
| 13 | è¡¥å…… â‘¬ æ²™ç®±æµ‹è¯•å¼•æ“ (sandbox_test_results è¡¨) | å®Œå–„Rxæ²»ç† |

---

**æŠ¥å‘Šå®Œæ¯•**
**å®¡è®¡æ‰§è¡Œ**: Claude Opus 4.6
**å®¡è®¡æ–¹æ³•**: 9è·¯å¹¶è¡Œæ‰«æ (C1-C6å†²çªæ£€æµ‹ + æ­£å‘â‘ -â‘­å¯¹é½ + åå‘API/ORM/Serviceæ‰«æ), å®é™…è¯»å–importè¯­å¥å’Œè°ƒç”¨å…³ç³»åˆ¤å®š

**P0ä¿®å¤è®°å½•** (2026-02-14):
- âœ… StageåŒå‘åŒæ­¥: `stage_engine.py` +æ˜ å°„è¡¨+`_sync_behavioral_profile()` (advance_stage/record_interruption ä¸¤å¤„è°ƒç”¨); `behavioral_profile_service.py` +æ˜ å°„è¡¨+`_sync_journey_state()` (generate_profile/update_stage ä¸¤å¤„è°ƒç”¨)
- âœ… `User.current_stage` æ ‡è®° DEPRECATED (`core/models.py:188`)
- âŒ P0#2 æ’¤å›: `core/brain/policy_gate.py` æœ‰3å¤„ç”Ÿäº§è°ƒç”¨ (assessment_pipeline_api:171, assessment_assignment_api:363, decision_engine:172), éæ­»ä»£ç , é™çº§ä¸ºP2åˆå¹¶ä»»åŠ¡

**P1æ¸…ç†è®°å½•** (2026-02-14):
- âŒ P1#3 agents/å½’æ¡£: é˜»å¡ â€” å‘ç°13å¤„æ´»è·ƒimport(orchestratorÃ—6, octopus_engineÃ—4, base_agentÃ—2, snapshot_factoryÃ—1), åˆ†å¸ƒåœ¨ api/device_trigger, api/routes, api/xingjian_api, core/master_agent_v0:4948, core/workflow + xingjian-agent/ é•œåƒ; C1 å·²ä»"æ­»ä»£ç "æ›´æ­£ä¸º"âš ï¸æ´»è·ƒ"
- âœ… P1#4 core/rag/ DEPRECATED.md: å·²åˆ›å»º `core/rag/DEPRECATED.md` (Qdrantå®éªŒä»£ç , è®¡åˆ’V4.1ç§»é™¤); æ³¨æ„14æ–‡ä»¶ä»ä¾èµ–(v3å…¼å®¹å±‚+coach_agent+tests)
- âš ï¸ P1#6 RiskLevelç»Ÿä¸€: éƒ¨åˆ†å®Œæˆ â€” `core/assessment_engine.py:24` æœ¬åœ°R0-R4æšä¸¾å·²åˆ é™¤, æ”¹ä¸º `from core.models import RiskLevel`; `core/agents/base.py:16` + `core/master_agent_v0.py:52` ä½¿ç”¨ CRITICAL/HIGH/MODERATE/LOW 4çº§ä½“ç³», ä¸ R0-R4 5çº§ä½“ç³»è¯­ä¹‰ä¸åŒ, ä¸å¯å¼ºè¡Œç»Ÿä¸€ (å‘ç°å…±7å¤„å®šä¹‰, 2å¥—ä¸å…¼å®¹å€¼ä½“ç³»)
- âŒ P1#2(=P0#2) åˆ é™¤core/brain/policy_gate.py: åŒP0#2, 3å¤„æ´»è·ƒè°ƒç”¨, ä¸å¯åˆ é™¤

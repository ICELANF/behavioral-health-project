# ============================================================
# 行为健康数字平台 - 生产环境配置模板
# Behavioral Health Platform - Production Environment Template
#
# 本文件为模板。远程部署时由 CD 流水线从 GitHub Secrets 自动生成 .env
# 本地开发请复制为 .env 并手动填写
#
# GitHub Secrets 映射表 (★ = 必填):
#   ★ JWT_SECRET_KEY         — JWT 签名密钥 (≥32字符)
#   ★ DB_PASSWORD            — PostgreSQL 密码
#   ★ REDIS_PASSWORD         — Redis 密码
#   ★ ACR_REGISTRY           — 阿里云 ACR 域名 (如 registry.cn-shanghai.aliyuncs.com)
#   ★ ACR_NAMESPACE          — ACR 命名空间 (如 behavioral-health)
#   ★ ACR_USERNAME           — ACR 登录用户名
#   ★ ACR_PASSWORD           — ACR 登录密码
#   ★ DEPLOY_HOST            — 部署目标服务器 IP
#   ★ DEPLOY_USER            — SSH 用户名
#   ★ DEPLOY_SSH_KEY         — SSH 私钥 (PEM 格式)
#   ★ DEPLOY_PATH            — 远程项目路径 (如 /opt/behavioral-health)
#     CORS_ORIGINS           — 允许的 CORS 域名 (逗号分隔)
#     CLOUD_LLM_PROVIDER     — 云 LLM 提供商 (deepseek/qwen/openai)
#     CLOUD_LLM_API_KEY      — 云 LLM API Key
#     CLOUD_LLM_BASE_URL     — 云 LLM 基础 URL
#     CLOUD_LLM_MODEL        — 云 LLM 模型名
#     DIFY_API_URL           — Dify API 地址
#     DIFY_API_KEY           — Dify API Key
#     SENTRY_DSN             — Sentry DSN (可选)
# ============================================================

# ---- 应用 ----
APP_VERSION=16.0.0
DEPLOY_ENV=production
ENVIRONMENT=production

# ---- 安全（必填） ----
JWT_SECRET_KEY=                          # ← GitHub Secret: JWT_SECRET_KEY
JWT_ALGORITHM=HS256
CORS_ORIGINS=https://your-domain.com     # ← GitHub Secret: CORS_ORIGINS

# ---- 数据库 ----
# 容器内连接 (db 为 docker-compose service name)
DATABASE_URL=postgresql://postgres:STRONG_PASSWORD@db:5432/health_platform
# ↑ CD 流水线替换为: postgresql://postgres:${DB_PASSWORD}@db:5432/health_platform

# ---- Redis ----
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=                          # ← GitHub Secret: REDIS_PASSWORD

# ---- 云 LLM (V005) ----
CLOUD_LLM_PROVIDER=deepseek             # ← GitHub Secret: CLOUD_LLM_PROVIDER
CLOUD_LLM_API_KEY=                       # ← GitHub Secret: CLOUD_LLM_API_KEY
CLOUD_LLM_BASE_URL=https://api.deepseek.com/v1  # ← GitHub Secret: CLOUD_LLM_BASE_URL
CLOUD_LLM_MODEL=deepseek-chat           # ← GitHub Secret: CLOUD_LLM_MODEL
LLM_ROUTE_STRATEGY=cloud_first
SAFETY_ENABLED=true

# ---- Dify ----
DIFY_API_URL=http://dify-api:5001/v1    # ← GitHub Secret: DIFY_API_URL (容器间默认)
DIFY_API_KEY=                            # ← GitHub Secret: DIFY_API_KEY

# ---- Ollama (本地 fallback) ----
OLLAMA_API_URL=http://host.docker.internal:11434
OLLAMA_MODEL=qwen2.5:0.5b

# ---- ACR 镜像 (CD 流水线注入) ----
ACR_REGISTRY=registry.cn-shanghai.aliyuncs.com   # ← GitHub Secret: ACR_REGISTRY
ACR_NAMESPACE=behavioral-health                   # ← GitHub Secret: ACR_NAMESPACE
IMAGE_TAG=latest

# ---- 日志 ----
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_DIR=/app/logs
PYTHONUNBUFFERED=1

# ---- 限流 ----
RATE_LIMIT_RPM=60

# ---- 监控 ----
ENABLE_METRICS=true
SENTRY_DSN=                              # ← GitHub Secret: SENTRY_DSN (可选)
SENTRY_TRACES_SAMPLE_RATE=0.1
SENTRY_PROFILES_SAMPLE_RATE=0.1

# ---- HTTPS ----
ENABLE_HSTS=true

# ---- 功能开关 ----
BH_V14_ENABLE_TRIGGER_EVENT_ROUTING=true
BH_V14_ENABLE_RHYTHM_MODEL=true
BH_V14_ENABLE_V14_AGENTS=true
BH_V14_ENABLE_DISCLOSURE_CONTROL=true
BH_V14_ENABLE_BLACKLIST_FILTER=true
BH_V14_ENABLE_DUAL_SIGNATURE=true
BH_V14_ENABLE_QUALITY_AUDIT=true

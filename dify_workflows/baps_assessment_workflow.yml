# è¡Œå¥è¡Œä¸ºæ•™ç»ƒ - BAPSè¡Œä¸ºè¯„ä¼°å·¥ä½œæµ
# ç‰ˆæœ¬: 1.0.0
# ç”¨é€”: é€šè¿‡å¯¹è¯æ”¶é›†ç”¨æˆ·ç­”æ¡ˆï¼Œè°ƒç”¨BAPS APIå®Œæˆè¯„ä¼°

app:
  description: |
    è¡Œå¥è¡Œä¸ºæ•™ç»ƒ BAPSå·¥ä½œæµ
    åŸºäºè¡Œä¸ºè¯„ä¼°ç³»ç»Ÿä¸å¤„æ–¹ï¼ˆBAPSï¼‰è¿›è¡Œç”¨æˆ·è¡Œä¸ºè¯„ä¼°
    æ”¯æŒ: å¤§äº”äººæ ¼ã€BPT-6åˆ†å‹ã€CAPACITYæ½œåŠ›ã€SPIæˆåŠŸé¢„æµ‹
  icon: "ğŸ¯"
  icon_background: "#E4FBCC"
  mode: workflow
  name: è¡Œå¥è¡Œä¸ºè¯„ä¼°ç³»ç»Ÿ
  use_icon_as_answer_icon: true

kind: app
version: 0.1.3

workflow:
  conversation_variables: []
  environment_variables:
    - name: BAPS_API_URL
      value: "http://host.docker.internal:8001"
      description: "BAPS APIæœåŠ¡åœ°å€"

  graph:
    edges:
      - source: start
        target: assessment_router
      - source: assessment_router
        target: bpt6_assessment
        condition: "assessment_type == 'bpt6'"
      - source: assessment_router
        target: spi_assessment
        condition: "assessment_type == 'spi'"
      - source: assessment_router
        target: full_assessment
        condition: "assessment_type == 'full'"
      - source: bpt6_assessment
        target: generate_report
      - source: spi_assessment
        target: generate_report
      - source: full_assessment
        target: generate_report
      - source: generate_report
        target: end

    nodes:
      - data:
          title: "å¼€å§‹"
          type: start
          desc: "æ¥æ”¶ç”¨æˆ·è¯„ä¼°è¯·æ±‚"
          variables:
            - variable: user_input
              label: ç”¨æˆ·è¾“å…¥
              type: string
              required: true
        id: start
        position:
          x: 0
          y: 0
        type: start

      - data:
          title: "è¯„ä¼°ç±»å‹è·¯ç”±"
          type: llm
          desc: "è¯†åˆ«ç”¨æˆ·è¯·æ±‚çš„è¯„ä¼°ç±»å‹"
          model:
            provider: ollama
            name: qwen2.5:7b
            mode: chat
            completion_params:
              temperature: 0.1
          prompt_template: |
            ä½ æ˜¯è¡Œå¥è¡Œä¸ºæ•™ç»ƒçš„è¯„ä¼°åŠ©æ‰‹ã€‚åˆ†æç”¨æˆ·è¾“å…¥ï¼Œåˆ¤æ–­éœ€è¦è¿›è¡Œå“ªç§è¯„ä¼°ã€‚

            ç”¨æˆ·è¾“å…¥: {{user_input}}

            å¯é€‰è¯„ä¼°ç±»å‹:
            1. bpt6 - è¡Œä¸ºæ¨¡å¼åˆ†å‹ï¼ˆå¿«é€Ÿï¼Œ18é¢˜ï¼Œäº†è§£è¡Œä¸ºç±»å‹ï¼‰
            2. spi - æˆåŠŸå¯èƒ½æ€§è¯„ä¼°ï¼ˆä¸­ç­‰ï¼Œ50é¢˜ï¼Œé¢„æµ‹æˆåŠŸç‡ï¼‰
            3. full - å®Œæ•´ç»¼åˆè¯„ä¼°ï¼ˆå®Œæ•´ï¼Œ150é¢˜ï¼Œå…¨é¢æŠ¥å‘Šï¼‰

            è¯·åªå›å¤ä¸€ä¸ªè¯„ä¼°ç±»å‹ä»£ç ï¼ˆbpt6/spi/fullï¼‰ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚
          output_variable: assessment_type
        id: assessment_router
        position:
          x: 200
          y: 0
        type: llm

      - data:
          title: "BPT-6è¯„ä¼°"
          type: http-request
          desc: "è°ƒç”¨BAPS APIè¿›è¡Œè¡Œä¸ºåˆ†å‹è¯„ä¼°"
          method: POST
          url: "{{BAPS_API_URL}}/test/full-assessment"
          headers:
            Content-Type: application/json
          timeout: 60
        id: bpt6_assessment
        position:
          x: 400
          y: -100
        type: http-request

      - data:
          title: "SPIè¯„ä¼°"
          type: http-request
          desc: "è°ƒç”¨BAPS APIè¿›è¡ŒæˆåŠŸå¯èƒ½æ€§è¯„ä¼°"
          method: POST
          url: "{{BAPS_API_URL}}/test/full-assessment"
          headers:
            Content-Type: application/json
          timeout: 60
        id: spi_assessment
        position:
          x: 400
          y: 0
        type: http-request

      - data:
          title: "å®Œæ•´è¯„ä¼°"
          type: http-request
          desc: "è°ƒç”¨BAPS APIè¿›è¡Œç»¼åˆè¯„ä¼°"
          method: POST
          url: "{{BAPS_API_URL}}/test/full-assessment"
          headers:
            Content-Type: application/json
          timeout: 120
        id: full_assessment
        position:
          x: 400
          y: 100
        type: http-request

      - data:
          title: "ç”ŸæˆæŠ¥å‘Š"
          type: llm
          desc: "åŸºäºè¯„ä¼°ç»“æœç”Ÿæˆç”¨æˆ·å‹å¥½çš„æŠ¥å‘Š"
          model:
            provider: ollama
            name: qwen2.5:14b
            mode: chat
            completion_params:
              temperature: 0.3
          prompt_template: |
            ä½ æ˜¯è¡Œå¥è¡Œä¸ºæ•™ç»ƒï¼Œè¯·åŸºäºä»¥ä¸‹è¯„ä¼°ç»“æœï¼Œç”¨æ¸©æš–ä¸“ä¸šçš„è¯­æ°”å‘ç”¨æˆ·è§£è¯»æŠ¥å‘Šã€‚

            è¯„ä¼°ç»“æœ:
            {{#assessment_result}}

            è¯·ç”¨ä»¥ä¸‹æ ¼å¼å‘ˆç°:

            ## ğŸ¯ æ‚¨çš„è¯„ä¼°æŠ¥å‘Š

            ### äººæ ¼ç”»åƒ
            [ç®€è¦æè¿°äººæ ¼ç‰¹ç‚¹]

            ### è¡Œä¸ºç±»å‹
            [è§£é‡Šä¸»å¯¼è¡Œä¸ºç±»å‹åŠå…¶ç‰¹ç‚¹]

            ### æ”¹å˜æ½œåŠ›
            [è¯„ä¼°æ”¹å˜å‡†å¤‡åº¦]

            ### æˆåŠŸé¢„æµ‹
            [SPIåˆ†æ•°è§£è¯»]

            ### ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®
            [3-5æ¡å…·ä½“å¯è¡Œçš„å»ºè®®]

            ---
            *å¦‚éœ€æ·±å…¥äº†è§£ï¼Œå¯ä»¥è¯¢é—®å…·ä½“é—®é¢˜*
        id: generate_report
        position:
          x: 600
          y: 0
        type: llm

      - data:
          title: "ç»“æŸ"
          type: end
          desc: "è¿”å›è¯„ä¼°æŠ¥å‘Š"
          outputs:
            - variable: report
              value: "{{generate_report.output}}"
        id: end
        position:
          x: 800
          y: 0
        type: end

  features:
    file_upload:
      image:
        enabled: false
    opening_statement: |
      ä½ å¥½ï¼æˆ‘æ˜¯è¡Œå¥è¡Œä¸ºæ•™ç»ƒ ğŸ¯

      æˆ‘å¯ä»¥å¸®ä½ è¿›è¡Œä¸“ä¸šçš„è¡Œä¸ºè¯„ä¼°ï¼Œäº†è§£ä½ çš„ï¼š
      - **è¡Œä¸ºæ¨¡å¼** - ä½ æ˜¯è¡ŒåŠ¨å‹ã€çŸ¥è¯†å‹è¿˜æ˜¯æƒ…ç»ªå‹ï¼Ÿ
      - **æ”¹å˜æ½œåŠ›** - ä½ å‡†å¤‡å¥½æ”¹å˜äº†å—ï¼Ÿ
      - **æˆåŠŸå¯èƒ½æ€§** - é¢„æµ‹ä½ è¾¾æˆç›®æ ‡çš„æ¦‚ç‡

      ä½ æƒ³è¿›è¡Œå“ªç§è¯„ä¼°ï¼Ÿ
      1. å¿«é€Ÿåˆ†å‹ï¼ˆ3åˆ†é’Ÿï¼‰
      2. æˆåŠŸé¢„æµ‹ï¼ˆ8åˆ†é’Ÿï¼‰
      3. å®Œæ•´è¯„ä¼°ï¼ˆ15åˆ†é’Ÿï¼‰
    suggested_questions:
      - "å¸®æˆ‘åšä¸€ä¸ªå¿«é€Ÿçš„è¡Œä¸ºåˆ†å‹"
      - "è¯„ä¼°ä¸€ä¸‹æˆ‘æ”¹å˜ä¹ æƒ¯çš„æˆåŠŸç‡"
      - "æˆ‘æƒ³åšä¸€ä¸ªå®Œæ•´çš„è¡Œä¸ºè¯„ä¼°"

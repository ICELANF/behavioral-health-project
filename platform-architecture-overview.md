# è¡Œä¸ºå¥åº·æ•°å­—å¹³å° â€” æ¶æ„æ€»è§ˆ

> æœ€åæ›´æ–°: 2026-02-13 04:10
> ç‰ˆæœ¬: v37 (Phase 1 Agentæ¨¡æ¿åŒ– éªŒè¯å®Œæˆ â€” 10/10 API + 12é¢„ç½®æ¨¡æ¿ + v6 AgentMaster DBåŠ è½½)
> çŠ¶æ€: Multi-Agent åä½œè¿è¡Œ + ä¸“å®¶ç™½æ ‡å¹³å° + RAGçŸ¥è¯†åº“ + å†…å®¹æ²»ç† + å¹³å°å…¨é¢å®Œå–„(7å¤§éœ€æ±‚) + é—®å·å¼•æ“ + å­¦åˆ†åˆ¶æ™‹çº§ä½“ç³» + V003æ¿€åŠ±ä½“ç³» + V004æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ + UIè®¾è®¡ç³»ç»ŸÂ§1-Â§40æ³¨å…¥ + åˆ†å±‚æµ‹è¯•å¥—ä»¶(98æµ‹è¯•å…¨é€šè¿‡) + V005äº‘LLMç»Ÿä¸€å®¢æˆ·ç«¯+4å±‚SafetyPipeline+å®‰å…¨ç®¡ç†API+éŸ³é¢‘TTS + V006å…«çˆªé±¼Agent-Expertæ¶æ„(Agentæ¨¡æ¿åŒ–+è·¯ç”±å¯é…åŒ–+çŸ¥è¯†å…±äº«å±‚+åé¦ˆå­¦ä¹ é—­ç¯+Agentç”Ÿæ€, 9è¡¨+~42ç«¯ç‚¹+6ç®¡ç†é¡µ+13å®šæ—¶ä»»åŠ¡) + V007ç­–ç•¥å¼•æ“(15è¡¨+12ç«¯ç‚¹+8æ ¸å¿ƒæœåŠ¡+2è¿ç§») + å·¥ç¨‹è´¨é‡åŸºç¡€è®¾æ–½(7ä¸ªè´¨é‡æ¨¡å—+CI/CD+Helm+ä¾èµ–é”å®š) + **Behavior Rx è¡Œä¸ºå¤„æ–¹åŸºåº§(3è¡¨+8ç«¯ç‚¹+14æœåŠ¡æ–‡ä»¶+4ä¸“å®¶Agent+MasterAgentè¡¥ä¸+12ç­–ç•¥æ¨¡æ¿) + Rx UI å‰ç«¯æ¨¡å—(15æ–‡ä»¶+7ç»„ä»¶+6è·¯ç”±+1 Pinia Store+8 APIæ–¹æ³•)**

---

## ä¸€ã€å¹³å°å…¨æ™¯æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            ç”¨æˆ·æ¥å…¥å±‚ (Frontend)                                â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Admin Portal   â”‚  â”‚  H5 ç§»åŠ¨ç«¯     â”‚  â”‚ ä¸“å®¶å·¥ä½œå°    â”‚  â”‚ H5-Patient-App â”‚  â”‚
â”‚  â”‚ :5174 (Docker) â”‚  â”‚ :5173 (Docker) â”‚  â”‚ :8501        â”‚  â”‚  (å¤‡ç”¨/ç‹¬ç«‹)    â”‚  â”‚
â”‚  â”‚ Vue3+AntDesign â”‚  â”‚  Vue3+Vant4    â”‚  â”‚  Streamlit   â”‚  â”‚  Vue3+Vant4    â”‚  â”‚
â”‚  â”‚ 127 é¡µé¢       â”‚  â”‚  33 é¡µé¢       â”‚  â”‚  ä¸“å®¶ç£å¯¼     â”‚  â”‚  10 é¡µé¢       â”‚  â”‚
â”‚  â”‚ 6+1 stores     â”‚  â”‚  3 stores      â”‚  â”‚  (å·²è¢«Admin  â”‚  â”‚  4 stores      â”‚  â”‚
â”‚  â”‚ +Tailwind CSS  â”‚  â”‚  +Tailwind CSS â”‚  â”‚   é›†æˆæ›¿ä»£)   â”‚  â”‚               â”‚  â”‚
â”‚  â”‚ +BHP Design    â”‚  â”‚  +BHP Design   â”‚  â”‚              â”‚  â”‚               â”‚  â”‚
â”‚  â”‚  System Â§1-Â§40 â”‚  â”‚   System Â§1-Â§40â”‚  â”‚              â”‚  â”‚               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                   â”‚                   â”‚                              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚                              â”‚
â”‚                     â”‚ nginxåä»£ /api â†’ bhp-api   â”‚                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ HTTP / WebSocket           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â–¼     API ç½‘å…³å±‚ (FastAPI)    â–¼                              â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     ä¸» API ç½‘å…³  :8000  (bhp-api)                        â”‚   â”‚
â”‚  â”‚  FastAPI + Uvicorn (4 workers) + APScheduler                            â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  è®¤è¯ â”€â”€â”€ ç”¨æˆ·ç®¡ç† â”€â”€â”€ æ•™ç»ƒç«¯ â”€â”€â”€ è¯„ä¼° â”€â”€â”€ å¾®è¡ŒåŠ¨ â”€â”€â”€ æŒ‘æˆ˜æ´»åŠ¨          â”‚   â”‚
â”‚  â”‚  è®¾å¤‡ â”€â”€â”€ é¢„è­¦ â”€â”€â”€ æ¶ˆæ¯ â”€â”€â”€ æé†’ â”€â”€â”€ å†…å®¹ â”€â”€â”€ å­¦ä¹ æ¿€åŠ±                  â”‚   â”‚
â”‚  â”‚  æ¨é€é˜Ÿåˆ— â”€â”€â”€ æœç´¢ â”€â”€â”€ Agentåä½œ â”€â”€â”€ é«˜é¢‘é¢˜ç›® â”€â”€â”€ AIæ¨é€å»ºè®®            â”‚   â”‚
â”‚  â”‚  é£Ÿç‰©è¯†åˆ« â”€â”€â”€ ä¸“å®¶ç§Ÿæˆ· â”€â”€â”€ ä¸“å®¶å†…å®¹ â”€â”€â”€ åˆ†æçœ‹æ¿ â”€â”€â”€ ç”¨æˆ·æŠ•ç¨¿          â”‚   â”‚
â”‚  â”‚  æ‰¹é‡çŒæ³¨ â”€â”€â”€ å†…å®¹ç®¡ç† â”€â”€â”€ è€ƒè¯•ç³»ç»Ÿ â”€â”€â”€ é¢˜åº“ç®¡ç† â”€â”€â”€ ç”¨æˆ·ç»Ÿè®¡          â”‚   â”‚
â”‚  â”‚  é—®å·ç®¡ç† â”€â”€â”€ é—®å·å¡«å†™ â”€â”€â”€ é—®å·ç»Ÿè®¡                                    â”‚   â”‚
â”‚  â”‚  å­¦åˆ†ç®¡ç† â”€â”€â”€ åŒé“è€…å…³ç³» â”€â”€â”€ æ™‹çº§ç³»ç»Ÿ â”€â”€â”€ æ¿€åŠ±ä½“ç³»                    â”‚   â”‚
â”‚  â”‚  æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ(V004) â”€â”€â”€ æ¨¡æ¿/æŠ¥å/æ¨é€/äº’åŠ¨/åˆ†æ                       â”‚   â”‚
â”‚  â”‚  å®‰å…¨ç®¡ç†(V005) â”€â”€â”€ ä»ªè¡¨ç›˜/æ—¥å¿—/å®¡æ ¸/é…ç½®/æ—¥æŠ¥                        â”‚   â”‚
â”‚  â”‚  Agentæ¨¡æ¿(V006-P1) â”€â”€â”€ æ¨¡æ¿CRUD/é¢„ç½®/å…‹éš†/ç¼“å­˜åˆ·æ–°                   â”‚   â”‚
â”‚  â”‚  è·¯ç”±é…ç½®(V006-P2) â”€â”€â”€ ç§Ÿæˆ·è·¯ç”±/æµ‹è¯•å¯¹æ¯”                              â”‚   â”‚
â”‚  â”‚  çŸ¥è¯†å…±äº«(V006-P3) â”€â”€â”€ è´¡çŒ®/å®¡æ ¸/é¢†åŸŸæ± /ç»Ÿè®¡                          â”‚   â”‚
â”‚  â”‚  åé¦ˆå­¦ä¹ (V006-P4) â”€â”€â”€ åé¦ˆ/æŒ‡æ ‡/æˆé•¿æŠ¥å‘Š/Promptç‰ˆæœ¬                  â”‚   â”‚
â”‚  â”‚  Agentç”Ÿæ€(V006-P5) â”€â”€â”€ å¸‚åœº/ç»„åˆç¼–æ’/æˆé•¿ç§¯åˆ†                        â”‚   â”‚
â”‚  â”‚  ç­–ç•¥å¼•æ“(V007) â”€â”€â”€ è§„åˆ™CRUD/æ¨¡æ‹Ÿ/å†³ç­–è¿½è¸ª/æˆæœ¬é¢„ç®—                   â”‚   â”‚
â”‚  â”‚  è¡Œä¸ºå¤„æ–¹(BehaviorRx) â”€â”€â”€ å¤„æ–¹è®¡ç®—/ç­–ç•¥æ¨¡æ¿/åä½œç¼–æ’/Agentäº¤æ¥         â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  æ€»è®¡: 56 è·¯ç”±æ¨¡å— Â· 505+ API ç«¯ç‚¹ Â· 13 å®šæ—¶ä»»åŠ¡(Redisäº’æ–¥é”)          â”‚   â”‚
â”‚  â”‚  + 3 Westworld ä»¿çœŸæ³¨å…¥ç«¯ç‚¹ (æµ‹è¯•ç”¨, å†…å­˜å­˜å‚¨)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      æ ¸å¿ƒå¼•æ“å±‚ (Core Engines)                           â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ MasterAgent  â”‚ â”‚ è¯„ä¼°ç®¡é“       â”‚ â”‚ Brainå¼•æ“     â”‚ â”‚ BAPSä½“ç³»    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 9æ­¥åè°ƒæµç¨‹  â”‚ â”‚ BAPSâ†’Profile   â”‚ â”‚ StageRuntime  â”‚ â”‚ 4å¤§é‡è¡¨     â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 12ä¸“ä¸šAgent  â”‚ â”‚ â†’Stageâ†’Interv  â”‚ â”‚ PolicyGate    â”‚ â”‚ è¯„åˆ†+æŠ¥å‘Š   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ V007ç­–ç•¥å¼•æ“ â”‚ â”‚ æ¨é€å®¡æ‰¹ç½‘å…³   â”‚ â”‚ è®¾å¤‡é¢„è­¦æœåŠ¡  â”‚ â”‚ æŒ‘æˆ˜æœåŠ¡    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ 6å±‚ç­–ç•¥å†³ç­–  â”‚ â”‚ ç»Ÿä¸€å®¡æ‰¹å…¥å£   â”‚ â”‚ é˜ˆå€¼+å»é‡     â”‚ â”‚ CRUD/æŠ¥å   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ æˆæœ¬/é£é™©æ§åˆ¶â”‚ â”‚ æ•™ç»ƒç¡®è®¤â†’æŠ•é€’  â”‚ â”‚ åŒé€šçŸ¥        â”‚ â”‚ æ‰“å¡/é—®å·   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ BehaviorRx   â”‚ â”‚ 4ä¸“å®¶Agent     â”‚ â”‚ Agentäº¤æ¥     â”‚ â”‚ å†²çªè§£å†³    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ ä¸‰ç»´å¤„æ–¹å¼•æ“ â”‚ â”‚ Coach/Metabolicâ”‚ â”‚ 6ç±»äº¤æ¥åè®®   â”‚ â”‚ å¤„æ–¹ä¼˜å…ˆçº§  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ TTMÃ—BigFive  â”‚ â”‚ Cardiac/Adhere â”‚ â”‚ åœºæ™¯ç¼–æ’      â”‚ â”‚ åˆå¹¶ç­–ç•¥    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ Ã—CAPACITY    â”‚ â”‚ +åä½œç¼–æ’å™¨    â”‚ â”‚ ç´§æ€¥æ¥ç®¡      â”‚ â”‚ é™çº§å›é€€    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ RAGçŸ¥è¯†åº“    â”‚ â”‚ å†…å®¹æ²»ç†       â”‚ â”‚ æ•°æ®åˆ†æ      â”‚ â”‚ è€ƒè¯•ç³»ç»Ÿ    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ åµŒå…¥/æ£€ç´¢    â”‚ â”‚ è¯æ®åˆ†å±‚T1-T4  â”‚ â”‚ Coach+Admin   â”‚ â”‚ é¢˜åº“/è€ƒè¯•   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ å¼•ç”¨æ ‡æ³¨     â”‚ â”‚ å®¡æ ¸/è¿‡æœŸé™æƒ  â”‚ â”‚ 13 åˆ†æç«¯ç‚¹   â”‚ â”‚ è‡ªåŠ¨è¯„åˆ†    â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ æ‰¹é‡çŒæ³¨     â”‚ â”‚ å†…å®¹äº¤äº’       â”‚ â”‚ å­¦ä¹ æŒä¹…åŒ–    â”‚ â”‚ æ´»åŠ¨è¿½è¸ª    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ PDF/DOCX/ZIP â”‚ â”‚ ç‚¹èµ/æ”¶è—/è¯„è®º â”‚ â”‚ æ—¶é•¿/ç§¯åˆ†/è¿  â”‚ â”‚ ç™»å½•/åˆ†äº«/  â”‚  â”‚   â”‚
â”‚  â”‚  â”‚ è‡ªåŠ¨åˆ†å—åµŒå…¥ â”‚ â”‚ åˆ†äº«+è®¡æ•°      â”‚ â”‚ ç»­æ‰“å¡/æ™‹çº§   â”‚ â”‚ å­¦ä¹ /è€ƒè¯•   â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                          â”‚   â”‚
â”‚  â”‚  æ€»è®¡: 139 æœåŠ¡æ–‡ä»¶ Â· 119 æ•°æ®æ¨¡å‹ Â· 30 è¿ç§»ç‰ˆæœ¬                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          AI / LLM å±‚ (Intelligence)                             â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ äº‘ LLM (V005)    â”‚  â”‚ Ollama :11434    â”‚  â”‚  Dify :8080               â”‚   â”‚
â”‚  â”‚ DeepSeek/Qwen/   â”‚  â”‚ qwen2.5:0.5b     â”‚  â”‚  Â·å·¥ä½œæµç¼–æ’              â”‚   â”‚
â”‚  â”‚ GPT (cloud-first)â”‚  â”‚ qwen2.5vl:7b     â”‚  â”‚  Â·çŸ¥è¯†åº“RAG               â”‚   â”‚
â”‚  â”‚ Â·UnifiedLLMClientâ”‚  â”‚ Â·å¯¹è¯/è¯„ä¼°/è·Ÿè¿›  â”‚  â”‚  Â·å¤šAgentè·¯ç”±             â”‚   â”‚
â”‚  â”‚ Â·4è·¯ç”±ç­–ç•¥       â”‚  â”‚ Â·é£Ÿç‰©å›¾åƒè¯†åˆ«    â”‚  â”‚  Â·Proactive Health Coach  â”‚   â”‚
â”‚  â”‚ Â·Ollamaé™çº§å›é€€  â”‚  â”‚ Â·é™çº§å›é€€        â”‚  â”‚                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  V005 SafetyPipeline (4å±‚å®‰å…¨ç®¡çº¿)                                      â”‚   â”‚
â”‚  â”‚  L1 è¾“å…¥è¿‡æ»¤(å…³é”®è¯+PII+æ„å›¾) â†’ L2 RAGå®‰å…¨(è¯æ®åˆ†å±‚+è¿‡æœŸè¿‡æ»¤)          â”‚   â”‚
â”‚  â”‚  â†’ L3 ç”Ÿæˆçº¦æŸ(å®‰å…¨promptæ³¨å…¥+é¢†åŸŸè¾¹ç•Œ) â†’ L4 è¾“å‡ºè¿‡æ»¤(åŒ»ç–—å£°æ˜+å…è´£)    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  V007 PolicyEngine (6å±‚ç­–ç•¥å†³ç­–)                                         â”‚   â”‚
â”‚  â”‚  è§„åˆ™æ³¨å†Œ â†’ å†²çªä»²è£ â†’ Agenté€‚é… â†’ æˆæœ¬æ§åˆ¶ â†’ æ•ˆæœè¿½è¸ª â†’ å†³ç­–å®¡è®¡       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            æ•°æ®å±‚ (Data)                                        â”‚
â”‚                                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ PostgreSQL   â”‚  â”‚ Redis        â”‚  â”‚ Weaviate     â”‚  â”‚ æ–‡ä»¶å­˜å‚¨      â”‚        â”‚
â”‚  â”‚ :5432(æš´éœ²)  â”‚  â”‚ :6379        â”‚  â”‚ å‘é‡æ•°æ®åº“   â”‚  â”‚ knowledge/    â”‚        â”‚
â”‚  â”‚ pgvectoræ‰©å±• â”‚  â”‚ ä¼šè¯ç¼“å­˜     â”‚  â”‚ è¯­ä¹‰æ£€ç´¢     â”‚  â”‚ ObsidiançŸ¥è¯†åº“â”‚        â”‚
â”‚  â”‚124è¡¨/30è¿ç§»  â”‚  â”‚ Tokené»‘åå•  â”‚
â”‚  â”‚              â”‚  â”‚ è°ƒåº¦äº’æ–¥é”   â”‚  â”‚              â”‚  â”‚              â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€Docker è¿è¡Œæ¶æ„

### 2.1 åº”ç”¨æœåŠ¡ (`docker-compose.app.yaml`)

| å®¹å™¨ | ç«¯å£ | æŠ€æœ¯ | å¥åº·æ£€æŸ¥ | è¯´æ˜ |
|------|------|------|---------|------|
| **bhp-api** | 8000-8002 | Python/FastAPI | `GET /health` 30s | ä¸»APIç½‘å…³ + å†³ç­–å¼•æ“ï¼Œ4Gå†…å­˜ä¸Šé™ |
| **bhp-h5** | 5173â†’80 | nginx+Vue3 | â€” | H5ç§»åŠ¨ç«¯ï¼Œä¾èµ– bhp-api healthy |
| **bhp-admin-portal** | 5174â†’80 | nginx+Vue3 | â€” | ç®¡ç†åå°ï¼Œä¾èµ– bhp-api healthy |
| **bhp-expert-workbench** | 8501 | Streamlit | `GET /_stcore/health` | ä¸“å®¶å·¥ä½œå°ï¼Œ1Gå†…å­˜ä¸Šé™ |

### 2.2 åŸºç¡€è®¾æ–½ (`docker-compose.yaml` â€” Dify)

| å®¹å™¨ | ç«¯å£ | ç”¨é€” |
|------|------|------|
| dify-api | 5001 | Difyåç«¯API |
| dify-web | 3000 | Difyå‰ç«¯ |
| dify-nginx | 8080/8443 | Difyç½‘å…³ |
| dify-worker | 5001 | Difyå¼‚æ­¥Worker |
| dify-db | 5432 (å·²æš´éœ²) | PostgreSQL + pgvector (pgvector/pgvector:pg15) |
| dify-redis | 6379 | Redis |
| dify-weaviate | â€” | å‘é‡æ•°æ®åº“ |
| dify-sandbox | â€” | ä»£ç æ²™ç®± |
| dify-ssrf_proxy | 3128 | SSRFé˜²æŠ¤ä»£ç† |

**ç½‘ç»œ**: æ‰€æœ‰å®¹å™¨å…±äº« `dify_dify-network` å¤–éƒ¨ç½‘ç»œã€‚

---

## ä¸‰ã€åç«¯ API å±‚

### 3.1 è·¯ç”±æ¨¡å—æ¸…å• (56 ä¸ª)

| æ¨¡å— | å‰ç¼€ | ç«¯ç‚¹æ•° | åŠŸèƒ½ |
|------|------|--------|------|
| `auth_api.py` | `/api/v1/auth` | 6 | ç™»å½•/æ³¨å†Œ/åˆ·æ–°/æ”¹å¯†/ç™»å‡º/ä¸ªäººä¿¡æ¯ (+ç™»å½•æ´»åŠ¨æ—¥å¿—) |
| `user_api.py` | `/api/v1/admin` | 13 | ç”¨æˆ·CRUD/ç»Ÿè®¡/åˆ†é…/æ•™ç»ƒåˆ—è¡¨ |
| `coach_api.py` | `/api/v1/coach` | 13 | å­¦å‘˜çœ‹æ¿/ç»©æ•ˆ/ç”»åƒ/4ç±»å¥åº·æ•°æ®/å…¬å¼€æ•™ç»ƒç›®å½• |
| `coach_message_api.py` | `/api/v1/coach/messages` | 6 | æ•™ç»ƒâ†”å­¦å‘˜æ¶ˆæ¯/æ”¶ä»¶ç®±/å·²è¯» |
| `coach_push_queue_api.py` | `/api/v1/coach/push-queue` | 6 | æ¨é€å®¡æ‰¹é˜Ÿåˆ—/ç»Ÿè®¡/æ‰¹é‡æ“ä½œ |
| `micro_action_api.py` | `/api/v1/micro-actions` | 6 | ä»Šæ—¥ä»»åŠ¡/å®Œæˆ/è·³è¿‡/å†å²/ç»Ÿè®¡ |
| `reminder_api.py` | `/api/v1/reminders` | 5 | æé†’CRUD/æ•™ç»ƒä»£å»º |
| `challenge_api.py` | `/api/v1/challenges` | 23 | æŒ‘æˆ˜æ¨¡æ¿CRUD/å®¡æ ¸/æŠ¥å/æ‰“å¡/é—®å·/æ•™ç»ƒåˆ†é… |
| `assessment_api.py` | `/api/assessment` | 5 | è¯„ä¼°æäº¤/å†å²/è¯¦æƒ… |
| `assessment_pipeline_api.py` | `/api/v1/assessment` | 4 | BAPSâ†’ç”»åƒâ†’é˜¶æ®µâ†’å¹²é¢„å…¨æµç¨‹ |
| `assessment_assignment_api.py` | `/api/v1/assessment-assignments` | 8 | æ•™ç»ƒåˆ†é…/å®¡æ ¸/æ¨é€è¯„ä¼° |
| `device_rest_api.py` | `/api/v1/devices` | 11 | è®¾å¤‡ç»‘å®š/å¥åº·æ•°æ® |
| `device_data.py` | `/api/v1/mp/device` | 20 | è¡€ç³–/ä½“é‡/è¡€å‹/ç¡çœ /è¿åŠ¨/HR/HRV |
| `device_trigger.py` | `/api/v1/device-trigger` | 1 | è®¾å¤‡æ•°æ®è§¦å‘è¡Œä¸ºæ¡¥æ¥ |
| `device_alert_api.py` | `/api/v1/alerts` | 4 | æˆ‘çš„é¢„è­¦/æ•™ç»ƒé¢„è­¦/å·²è¯»/è§£å†³ |
| `high_freq_api.py` | `/api/v1/high-freq-questions` | 4 | HF-20/HF-50 é¢„è®¾é¢˜ç»„ |
| `push_recommendation_api.py` | `/api/v1/push-recommendations` | 3 | AIæ¨é€å»ºè®®/æŒ‰å­¦å‘˜/åº”ç”¨ |
| `content_api.py` | `/api/v1/content` | 30 | è¯¾ç¨‹/è§†é¢‘/æµ‹éªŒ/æ¡ˆä¾‹/ç‚¹èµ/æ”¶è—/è¯„è®º/åˆ†äº«(çœŸå®DB) |
| `learning_api.py` | `/api/v1/learning` | 15 | ç§¯åˆ†/æ—¶é•¿/è¿ç»­æ‰“å¡/å¥–åŠ±/æ’è¡Œæ¦œ(æŒä¹…åŒ–DB) |
| `chat_rest_api.py` | `/api/v1/chat` | 5 | ä¼šè¯/æ¶ˆæ¯/åˆ é™¤ |
| `agent_api.py` | `/api/v1/agent` | 7 | Agentåˆ—è¡¨/è¿è¡Œ/å®¡æ ¸/åé¦ˆ/ç»Ÿè®¡/å†å²/çŠ¶æ€ |
| `search_api.py` | `/api/v1/search` | 1 | å…¨å¹³å°æœç´¢ï¼ˆç”¨æˆ·/æŒ‘æˆ˜/å¾®è¡ŒåŠ¨/é¢„è­¦/æ¶ˆæ¯ï¼‰ |
| `upload_api.py` | `/api/v1/upload` | 1 | æ–‡ä»¶ä¸Šä¼  |
| `paths_api.py` | `/api/v1/paths` | 66 | å…­å¤§è·¯å¾„ï¼ˆå¹²é¢„/ä¸“å®¶/çŸ¥è¯†/å®è·µ/ç¤¾åŒº/æ•™ç»ƒï¼‰ |
| `segments_api.py` | `/api/v1/segments` | 12 | æƒé™/åŠŸèƒ½/è§’è‰²/å±‚çº§/å‡çº§å»ºè®® |
| `miniprogram.py` | `/api/v1/mp` | 14 | å°ç¨‹åºç«¯ï¼ˆä»»åŠ¡/åé¦ˆ/å¯¹è¯/è¿›åº¦/é£é™©ï¼‰ |
| `websocket_api.py` | WebSocket | 1 | å®æ—¶æ¨é€ |
| `food_recognition_api.py` | `/api/v1/food` | 2 | é£Ÿç‰©å›¾åƒè¯†åˆ«(qwen2.5vl)/å†å² |
| `tenant_api.py` | `/api/v1/tenants` | 10 | ä¸“å®¶ç§Ÿæˆ·CRUD/å®¢æˆ·/Agent/ç»Ÿè®¡ |
| `expert_content_api.py` | `/api/v1/tenants/{id}/content` | 8 | ä¸“å®¶çŸ¥è¯†æ–‡æ¡£CRUD/å‘å¸ƒ/æ’¤å›/æŒ‘æˆ˜åˆ—è¡¨ |
| `analytics_api.py` | `/api/v1/analytics/coach` | 6 | Coachåˆ†æ(é£é™©/å¾®è¡ŒåŠ¨/é¢†åŸŸ/é¢„è­¦/æŒ‘æˆ˜/é˜¶æ®µ) |
| `admin_analytics_api.py` | `/api/v1/analytics/admin` | 7 | Adminåˆ†æ(æ¦‚è§ˆ/å¢é•¿/è§’è‰²/é˜¶æ®µ/é£é™©/æ’è¡Œ/æŒ‘æˆ˜) |
| `content_contribution_api.py` | `/api/v1/contributions` | 7 | ç”¨æˆ·çŸ¥è¯†æŠ•ç¨¿/æˆ‘çš„æŠ•ç¨¿/å®¡æ ¸é€šè¿‡/æ‹’ç» |
| `batch_ingestion_api.py` | `/api/v1/knowledge` | 4 | æ‰¹é‡çŸ¥è¯†çŒæ³¨(ä¸Šä¼ /ä»»åŠ¡åˆ—è¡¨/è¿›åº¦/å–æ¶ˆ) |
| `content_manage_api.py` | `/api/v1/content-manage` | 8 | å†…å®¹å‘å¸ƒCRUD/æ‰¹é‡åˆ›å»º/æ‰¹é‡å‘å¸ƒ |
| `exam_api.py` | `/api/v1/certification/exams` | 9 | è€ƒè¯•ç®¡ç†CRUD/é¢˜ç›®åˆ†é…/å‘å¸ƒ(admin) |
| `question_api.py` | `/api/v1/certification/questions` | 5 | é¢˜åº“ç®¡ç†CRUD(admin) |
| `exam_session_api.py` | `/api/v1/certification/sessions` | 4 | è€ƒè¯•ä¼šè¯(å¼€å§‹/æäº¤/ç»“æœ/å†å²) |
| `user_stats_api.py` | `/api/v1/stats` | 5 | ç”¨æˆ·ç»Ÿè®¡/æ´»åŠ¨æ—¶é—´çº¿/ç®¡ç†å‘˜æŠ¥å‘Š |
| `survey_api.py` | `/api/v1/surveys` | 10 | é—®å·CRUD/å‘å¸ƒ/å…³é—­/é¢˜ç›®ç®¡ç† |
| `survey_response_api.py` | `/api/v1/surveys/s` | 3 | çŸ­ç å¡«å†™/æäº¤/è‰ç¨¿(æ”¯æŒåŒ¿å) |
| `survey_stats_api.py` | `/api/v1/surveys` | 3 | é—®å·ç»Ÿè®¡/å“åº”åˆ—è¡¨/CSVå¯¼å‡º |
| `credits_api.py` | `/api/v1/credits` | 8 | è¯¾ç¨‹æ¨¡å—/å­¦åˆ†æ±‡æ€»/å­¦åˆ†æ˜ç»† + ç®¡ç†ç«¯CRUD/ç»Ÿè®¡(ORM) |
| `companion_api.py` | `/api/v1/companions` | 6 | åŒé“è€…åˆ—è¡¨/å¯¼å¸ˆ/ç»Ÿè®¡/é‚€è¯·/ç®¡ç†å‘˜å…¨é‡/æ¯•ä¸šæ ‡è®°(ORM) |
| `promotion_api.py` | `/api/v1/promotion` | 6 | æ™‹çº§è¿›åº¦/è§„åˆ™/ç”³è¯·/å®¡æ ¸/åˆ—è¡¨/èµ„æ ¼é¢„æ£€(ORM) |
| `milestone_service.py` | `/api/v1/incentive` | 11 | ç­¾åˆ°/å¾½ç« /é‡Œç¨‹ç¢‘/ç¿»ç‰Œ/è¿ç»­æ¢å¤/çºªå¿µç‰©/çœ‹æ¿(V003) |
| `program_api.py` | `/api/v1/programs` | 13 | V004æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ(æ¨¡æ¿CRUD/æŠ¥å/ä»Šæ—¥æ¨é€/äº’åŠ¨/è¿›åº¦/åˆ†æ) |
| `safety_api.py` | `/api/v1/safety` | 8 | V005å®‰å…¨ç®¡ç†(ä»ªè¡¨ç›˜/æ—¥å¿—/å®¡æ ¸é˜Ÿåˆ—/é…ç½®/æ—¥æŠ¥) |
| `agent_template_api.py` | `/api/v1/agent-templates` | 10 | V006-P1: Agentæ¨¡æ¿CRUD(åˆ—è¡¨/é¢„ç½®/åŸŸå€¼/è¯¦æƒ…/åˆ›å»º/æ›´æ–°/åˆ é™¤/å¼€å…³/å…‹éš†/åˆ·æ–°ç¼“å­˜) |
| `tenant_api.py` (è·¯ç”±æ‰©å±•) | `/api/v1/tenants/{id}/routing` | 3 | V006-P2: ç§Ÿæˆ·è·¯ç”±é…ç½®(GET/PUT/æµ‹è¯•å¯¹æ¯”) |
| `knowledge_sharing_api.py` | `/api/v1/knowledge-sharing` | 9 | V006-P3: çŸ¥è¯†å…±äº«(è´¡çŒ®/æˆ‘çš„/æ’¤å›/å®¡æ ¸/é€šè¿‡/æ‹’ç»/é¢†åŸŸæ± /ç»Ÿè®¡/åŸŸåˆ—è¡¨) |
| `agent_feedback_api.py` | `/api/v1/agent-feedback` | 8 | V006-P4: åé¦ˆå­¦ä¹ (æäº¤/åˆ—è¡¨/æˆé•¿æŠ¥å‘Š/æ‘˜è¦/æŒ‡æ ‡/Promptç‰ˆæœ¬/ç‰ˆæœ¬åˆ—è¡¨/èšåˆ) |
| `agent_ecosystem_api.py` | `/api/v1/agent-ecosystem` | 11 | V006-P5: Agentç”Ÿæ€(å¸‚åœºæµè§ˆ/å‘å¸ƒ/å¾…å®¡/é€šè¿‡/æ‹’ç»/å®‰è£…/ç»„åˆåˆ—è¡¨/åˆ›å»º/è¯¦æƒ…/ç§¯åˆ†/é…ç½®) |
| `policy_api.py` | `/api/v1/policy` | 12 | **V007**: è§„åˆ™CRUD/åˆ—è¡¨/è¯¦æƒ…/æ¨¡æ‹Ÿ/DecisionTrace/æˆæœ¬æŠ¥å‘Š/çƒ­åˆ·æ–°/ç§å­åˆå§‹åŒ– |
| `rx_routes.py` | `/api/v1/rx` | 8 | **BehaviorRx**: å¤„æ–¹è®¡ç®—/ç­–ç•¥æ¨¡æ¿/AgentçŠ¶æ€/ç”¨æˆ·å¤„æ–¹å†å²/äº¤æ¥å‘èµ·/äº¤æ¥æ—¥å¿—/åä½œç¼–æ’/å¤„æ–¹è¯¦æƒ… |
| `routes.py` | `/api/v1` | 6 | é€šç”¨è·¯ç”± âœ… å·²æ³¨å†Œ (å®¡è®¡ä¿®å¤#7) |

**æ€»è®¡: 505+ ç«¯ç‚¹** (å¦æœ‰ v14 é—ç•™è·¯ç”±)

### 3.2 è®¤è¯ä¸æƒé™

```
JWT Token (python-jose + passlib/bcrypt)
â”œâ”€â”€ access_token (30min)
â”œâ”€â”€ refresh_token (7d)
â””â”€â”€ token_blacklist (ç™»å‡ºå³å¤±æ•ˆ)

æƒé™å®ˆå« (api/dependencies.py):
â”œâ”€â”€ get_current_user       â†’ è§£æJWTï¼Œè¿”å›å½“å‰ç”¨æˆ·
â”œâ”€â”€ require_admin          â†’ role_level >= 99
â””â”€â”€ require_coach_or_admin â†’ role_level >= 4

è§’è‰²å±‚çº§:
  observer(1) â†’ grower(2) â†’ sharer(3) â†’ coach(4)
  â†’ promoter/supervisor(5) â†’ master(6) â†’ admin(99)
```

### 3.3 APScheduler å®šæ—¶ä»»åŠ¡ (13 ä¸ª, Redis äº’æ–¥é”)

> æ‰€æœ‰ 13 ä¸ªä»»åŠ¡å‡ä½¿ç”¨ `@with_redis_lock` è£…é¥°å™¨ (`core/redis_lock.py`)ï¼ŒåŸºäº Redis SETNX å®ç°åˆ†å¸ƒå¼äº’æ–¥é”ï¼Œå¤š worker éƒ¨ç½²å®‰å…¨ã€‚Redis ä¸å¯ç”¨æ—¶é™çº§ä¸ºæ— é”æ‰§è¡Œã€‚

| ä»»åŠ¡ | è§¦å‘ | é”TTL | è¯´æ˜ |
|------|------|-------|------|
| `daily_task_generation` | Cron æ¯å¤© 06:00 | 600s | ä¸ºæ‰€æœ‰æ´»è·ƒç”¨æˆ·ç”Ÿæˆä»Šæ—¥å¾®è¡ŒåŠ¨ä»»åŠ¡ |
| `reminder_check` | Interval æ¯ 1 åˆ†é’Ÿ | 60s | æ£€æŸ¥åˆ°æœŸæé†’å¹¶è§¦å‘ |
| `expired_task_cleanup` | Cron æ¯å¤© 23:59 | 300s | æ ‡è®°è¿‡æœŸæœªå®Œæˆä»»åŠ¡ä¸º expired |
| `process_approved_pushes` | Interval æ¯ 5 åˆ†é’Ÿ | 300s | æŠ•é€’å·²å®¡æ‰¹ä¸”åˆ°æ—¶çš„æ¨é€ |
| `expire_stale_queue_items` | Cron æ¯å¤© 06:30 | 300s | æ¸…ç† 72h è¶…æ—¶æœªå®¡æ‰¹çš„æ¨é€æ¡ç›® |
| `knowledge_freshness_check` | Cron æ¯å¤© 07:00 | 300s | è¿‡æœŸçŸ¥è¯†æ–‡æ¡£é™æƒ (priority -= 2) |
| `advance_program_day` | Cron æ¯å¤© 00:05 | 600s | V004: æ¨è¿›æ–¹æ¡ˆ day_index + æ£€æŸ¥å®Œæˆ |
| `push_morning` | Cron æ¯å¤© 09:00 | 300s | V004: æ—©é—´æ¨é€(è®¤çŸ¥ä»»åŠ¡) |
| `push_noon` | Cron æ¯å¤© 11:30 | 300s | V004: åˆé—´æ¨é€(è¡Œä¸ºä»»åŠ¡) |
| `push_evening` | Cron æ¯å¤© 17:30 | 300s | V004: æ™šé—´æ¨é€(åæ€å›é¡¾) |
| `batch_analysis` | Cron æ¯å¤© 23:00 | 600s | V004: è¡Œä¸ºæ•°æ®æ‰¹é‡åˆ†æ+æ¨èç”Ÿæˆ |
| `safety_daily_report` | Cron æ¯å¤© 02:00 | 300s | V005: å®‰å…¨äº‹ä»¶æ—¥æŠ¥(ç»Ÿè®¡å‰æ—¥+å†™å…¥safety_logs) |
| `agent_metrics_aggregate` | Cron æ¯å¤© 01:30 | 300s | V006-P4: Agentåé¦ˆèšåˆ(æ¯æ—¥UPSERT feedbacksâ†’metrics_daily) |

---

## å››ã€æ ¸å¿ƒå¼•æ“å±‚

### 4.1 æ•°æ®æ¨¡å‹ (119 ä¸ª)

| åˆ†ç±» | æ¨¡å‹ | è¯´æ˜ |
|------|------|------|
| **ç”¨æˆ·** | User | ç”¨æˆ·ä¸»è¡¨ï¼ˆè§’è‰²/å¯†ç /çŠ¶æ€ï¼‰ |
| **è¯„ä¼°** | Assessment, TriggerRecord, BehavioralProfile | è¯„ä¼°è®°å½•ã€è§¦å‘å› å­ã€è¡Œä¸ºç”»åƒ |
| **å¹²é¢„** | Intervention | å¹²é¢„æ–¹æ¡ˆ |
| **ä¼šè¯** | UserSession, ChatSession, ChatMessage | ç”¨æˆ·ä¼šè¯ã€AIå¯¹è¯ |
| **è®¾å¤‡** | UserDevice, GlucoseReading, HeartRateReading, HRVReading, SleepRecord, ActivityRecord, WorkoutRecord, VitalSign, HealthData | è®¾å¤‡ç»‘å®š + 9 ç±»å¥åº·æ•°æ® |
| **å¾®è¡ŒåŠ¨** | MicroActionTask, MicroActionLog | æ¯æ—¥ä»»åŠ¡ + æ‰§è¡Œæ—¥å¿— |
| **æ¶ˆæ¯** | CoachMessage, Reminder | æ•™ç»ƒæ¶ˆæ¯ + æé†’ |
| **è¯„ä¼°æ¨é€** | AssessmentAssignment, CoachReviewItem | æ•™ç»ƒåˆ†é…è¯„ä¼° + å®¡æ ¸ |
| **è®¾å¤‡é¢„è­¦** | DeviceAlert | é˜ˆå€¼é¢„è­¦ |
| **æŒ‘æˆ˜** | ChallengeTemplate, ChallengeDayPush, ChallengeEnrollment, ChallengeSurveyResponse, ChallengePushLog | æŒ‘æˆ˜æ´»åŠ¨å…¨ç”Ÿå‘½å‘¨æœŸ |
| **æ¨é€é˜Ÿåˆ—** | CoachPushQueue | ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ |
| **è¡Œä¸ºå®¡è®¡** | BehaviorAuditLog, BehaviorHistory, BehaviorTrace | è¡Œä¸ºå˜åŒ–è¿½è¸ª |
| **é£Ÿç‰©è¯†åˆ«** | FoodAnalysis | é£Ÿç‰©å›¾åƒè¯†åˆ«ç»“æœ+è¥å…»æ•°æ® |
| **ä¸“å®¶ç§Ÿæˆ·** | ExpertTenant, TenantClient, TenantAgentMapping, TenantAuditLog | ç™½æ ‡å·¥ä½œå®¤+å®¢æˆ·+Agentæ˜ å°„+å®¡è®¡ |
| **çŸ¥è¯†åº“** | KnowledgeDocument, KnowledgeChunk, KnowledgeCitation | çŸ¥è¯†æ–‡æ¡£(å«8æ²»ç†å­—æ®µ)+æ–‡æœ¬å—+å¼•ç”¨æ ‡æ³¨ |
| **å†…å®¹äº¤äº’** | ContentItem, ContentLike, ContentBookmark, ContentComment | ç»Ÿä¸€å†…å®¹è¡¨+ç‚¹èµ+æ”¶è—+è¯„è®º |
| **å­¦ä¹ æŒä¹…åŒ–** | LearningProgress, LearningTimeLog, LearningPointsLog, UserLearningStats | å­¦ä¹ è¿›åº¦+æ—¶é•¿æ—¥å¿—+ç§¯åˆ†æ—¥å¿—+æ±‡æ€»ç»Ÿè®¡ |
| **è€ƒè¯•ç³»ç»Ÿ** | ExamDefinition, QuestionBank, ExamResult | è€ƒè¯•å®šä¹‰+é¢˜åº“+è€ƒè¯•ç»“æœ |
| **æ´»åŠ¨è¿½è¸ª** | UserActivityLog | ç”¨æˆ·æ´»åŠ¨æ—¥å¿—(ç™»å½•/åˆ†äº«/å­¦ä¹ /è€ƒè¯•ç­‰) |
| **æ‰¹é‡çŒæ³¨** | BatchIngestionJob | æ‰¹é‡çŸ¥è¯†ä¸Šä¼ ä»»åŠ¡(çŠ¶æ€/è¿›åº¦/æ–‡ä»¶æ•°) |
| **çŸ¥è¯†é¢†åŸŸ** | KnowledgeDomain | 17ä¸ªé¢„ç½®é¢†åŸŸ(id/name/description/parent_id) |
| **é—®å·å¼•æ“** | Survey, SurveyQuestion, SurveyResponse, SurveyResponseAnswer, SurveyDistribution | é—®å·å®šä¹‰+13ç§é¢˜å‹+å¡«å†™å“åº”+é€é¢˜ç­”æ¡ˆ+åˆ†å‘æ¸ é“ |
| **å­¦åˆ†åˆ¶æ™‹çº§** | CourseModule, UserCredit, CompanionRelation, PromotionApplication | è¯¾ç¨‹æ¨¡å—+å­¦åˆ†è®°å½•+åŒé“è€…å…³ç³»+æ™‹çº§ç”³è¯·(V002) |
| **V003æ¿€åŠ±ä½“ç³»** | Badge, UserBadge, UserMilestone, UserStreak, FlipCardRecord, NudgeRecord, UserMemorial, PointTransaction, UserPoint | å¾½ç« å®šä¹‰+å¾½ç« è·å¾—+é‡Œç¨‹ç¢‘+è¿ç»­ç­¾åˆ°+ç¿»ç‰Œå¥–åŠ±+æé†’+çºªå¿µç‰©+ç§¯åˆ†æµæ°´+ç§¯åˆ†æ±‡æ€»(V003) |
| **V005å®‰å…¨+éŸ³é¢‘** | SafetyLog, ContentAudio | å®‰å…¨äº‹ä»¶æ—¥å¿—(4çº§ä¸¥é‡åº¦/å®¡æ ¸æµç¨‹/è¿‡æ»¤è¯¦æƒ…JSON) + å†…å®¹éŸ³é¢‘é™„ä»¶(TTS/äººå£°/æ—¶é•¿) |
| **V006-P1 Agentæ¨¡æ¿** | AgentTemplate | Agentæ¨¡æ¿å®šä¹‰(agent_id/display_name/agent_type/keywords/system_prompt/correlations/priority/base_weight/conflict_wins_overç­‰19åˆ—) |
| **V006-P2 è·¯ç”±é…ç½®** | TenantRoutingConfig(æ‰©å±•TenantAgentMapping) | ç§Ÿæˆ·Agentè·¯ç”±é…ç½®(å…³é”®è¯æƒé‡/å…³è”è¦†ç›–/å†²çªä¼˜å…ˆçº§) |
| **V006-P3 çŸ¥è¯†å…±äº«** | KnowledgeContribution | çŸ¥è¯†è´¡çŒ®è®°å½•(document_id/tenant_id/contributor_id/domain_id/status/reviewer_id/review_comment) |
| **V006-P4 åé¦ˆå­¦ä¹ ** | AgentFeedback, AgentMetricsDaily, AgentPromptVersion | ç”¨æˆ·åé¦ˆ(è¯„åˆ†/ç±»å‹/æ­£è´Ÿé¢) + æ¯æ—¥èšåˆæŒ‡æ ‡(æ¥å—ç‡/å¹³å‡åˆ†) + Promptç‰ˆæœ¬è¿½è¸ª(A/Bæµ‹è¯•) |
| **V006-P5 Agentç”Ÿæ€** | AgentMarketplaceListing, AgentComposition, AgentGrowthPoints | å¸‚åœºå‘å¸ƒ(å®¡æ ¸æµç¨‹/å®‰è£…è®¡æ•°/è¯„åˆ†) + Agentç»„åˆç¼–æ’(pipeline/merge_strategy) + æˆé•¿ç§¯åˆ†(7ç§äº‹ä»¶) |
| **V007ç­–ç•¥å¼•æ“(Phase A)** | PolicyRule, RulePriority, AgentApplicabilityMatrix, ConflictMatrix, DecisionTrace, CostBudgetLedger | ç­–ç•¥è§„åˆ™(JSON-Logicæ¡ä»¶/åŠ¨ä½œ/ä¼˜å…ˆçº§/æ—¶é—´çª—) + Agenté€‚ç”¨æ€§çŸ©é˜µ(é˜¶æ®µ/é£é™©/å¼ºåº¦/ç¦å¿Œ) + å†²çªä»²è£çŸ©é˜µ(5ç­–ç•¥) + å†³ç­–å®¡è®¡è¿½è¸ª + æˆæœ¬é¢„ç®—è´¦æœ¬ |
| **V007æŠ€èƒ½å›¾è°±(Phase B)** | ExpertDomain, InterventionProtocol, RiskBoundary, StageApplicability, Contraindication, EvidenceTierBinding, AgentSkillGraph, PolicyInterventionOutcome, PolicyStageTransitionLog | ä¸“å®¶é¢†åŸŸæ˜ å°„ + å¹²é¢„åè®®æ¨¡æ¿ + é£é™©è¾¹ç•Œ(è‡ªåŠ¨é€€å‡º) + é˜¶æ®µé€‚ç”¨æ€§æ•ˆæœ + ç¦å¿Œç—‡ + è¯æ®ç­‰çº§ç»‘å®š + AgentæŠ€èƒ½å‘é‡(9ç»´èƒ½åŠ›æŒ‡çº¹) + å¹²é¢„æ•ˆæœè¿½è¸ª(IESåˆ†) + é˜¶æ®µè½¬æ¢æ—¥å¿—(ç½®ä¿¡åº¦) |
| **BehaviorRxè¡Œä¸ºå¤„æ–¹** | RxPrescription, RxStrategyTemplate, AgentHandoffLog | è¡Œä¸ºå¤„æ–¹è®°å½•(22åˆ—,ä¸‰ç»´è¾“å…¥TTMÃ—BigFiveÃ—CAPACITY,å¤„æ–¹è¾“å‡ºå«å¾®è¡ŒåŠ¨/å¥–åŠ±è§¦å‘/å‡çº§è§„åˆ™) + ç­–ç•¥æ¨¡æ¿åº“(18åˆ—,12ç§ç­–ç•¥ç±»å‹) + Agentäº¤æ¥æ—¥å¿—(14åˆ—,6ç§äº¤æ¥ç±»å‹) |

### 4.2 æ•°æ®åº“è¿ç§» (30 ä¸ªç‰ˆæœ¬)

| ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|
| 001 | åˆå§‹ schema â€” åŸºç¡€è¡¨ |
| 002 | å®Œæ•´ schema â€” æ‰€æœ‰æ¨¡å‹æ˜¾å¼å»ºè¡¨ |
| 003 | behavioral_profiles â€” ç»Ÿä¸€è¡Œä¸ºç”»åƒ |
| 004 | micro_actions + messaging â€” å¾®è¡ŒåŠ¨ + æ•™ç»ƒæ¶ˆæ¯ + æé†’ |
| 005 | assessment_assignments â€” è¯„ä¼°åˆ†é…ä¸å®¡æ ¸ |
| 006 | device_alerts â€” è®¾å¤‡é¢„è­¦ |
| 007 | challenge_tables â€” æŒ‘æˆ˜æ´»åŠ¨ 5 å¼ è¡¨ |
| 008 | coach_push_queue â€” ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ |
| 009 | food_analyses â€” é£Ÿç‰©è¯†åˆ«ç»“æœè¡¨ |
| 010 | tenant_tables â€” ä¸“å®¶ç§Ÿæˆ·4å¼ è¡¨ |
| 011 | knowledge_tables â€” çŸ¥è¯†åº“3å¼ è¡¨ |
| 012 | knowledge_doc_content â€” KnowledgeDocument å¢åŠ  raw_content + updated_at |
| 013 | content_governance â€” KnowledgeDocument å¢åŠ 8åˆ—æ²»ç†å­—æ®µ + 3ç´¢å¼• |
| 014 | content_interaction â€” å†…å®¹äº¤äº’4å¼ è¡¨ |
| 015 | learning_persistence â€” å­¦ä¹ æŒä¹…åŒ–4å¼ è¡¨ |
| 016 | exam_activity_ingestion â€” è€ƒè¯•+æ´»åŠ¨+çŒæ³¨5å¼ è¡¨ |
| 017 | knowledge_domains â€” çŸ¥è¯†é¢†åŸŸè¡¨ + file_type/file_hashåˆ— |
| 018 | survey_engine â€” é—®å·å¼•æ“5å¼ è¡¨ |
| 019 | v3_diagnostic_pipeline â€” è¯Šæ–­ç®¡é“ä¿®å¤ |
| 020 | fix_orm_db_drift â€” ORM-DB æ¼‚ç§»ä¿®å¤ |
| V002 | credit_promotion_system â€” å­¦åˆ†+æ™‹çº§4å¼ è¡¨ + 4è§†å›¾ + 4æšä¸¾ + 1è§¦å‘å™¨ |
| V003 | incentive_system â€” æ¿€åŠ±ä½“ç³»9å¼ è¡¨ + 1è§†å›¾ + 1å‡½æ•° |
| V004 | program_engine â€” æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ3å¼ è¡¨ + 2è§†å›¾ + 2å‡½æ•° + 3æšä¸¾ |
| V005 | safety_and_audio â€” å®‰å…¨+éŸ³é¢‘2å¼ è¡¨ |
| V006-022 | agent_templates â€” Agentæ¨¡æ¿è¡¨(12è¡Œé¢„ç½®ç§å­) |
| V006-023 | routing_config â€” ç§Ÿæˆ·è·¯ç”±é…ç½®è¡¨ |
| V006-024 | knowledge_sharing â€” çŸ¥è¯†è´¡çŒ®è¡¨ + scopeæ ‡å‡†åŒ– |
| V006-025 | feedback_learning â€” åé¦ˆå­¦ä¹ 3å¼ è¡¨ + 11è¡Œç§å­Promptç‰ˆæœ¬ |
| V006-026 | agent_ecosystem â€” Agentç”Ÿæ€3å¼ è¡¨ |
| 027 | v002_v003_catchup â€” V002/V003æ­£å¼çº³å…¥Alembicé“¾(IF NOT EXISTSå®‰å…¨å®ˆå«) |
| **028** | **policy_engine â€” V007 Phase A: ç­–ç•¥å¼•æ“6å¼ è¡¨(policy_rules/rule_priority/agent_applicability_matrix/conflict_matrix/decision_trace/cost_budget_ledger)** |
| **029** | **skill_graph â€” V007 Phase B: æŠ€èƒ½å›¾è°±9å¼ è¡¨(expert_domain/intervention_protocol/risk_boundary/stage_applicability/contraindications/evidence_tier_binding/agent_skill_graph/policy_intervention_outcome/policy_stage_transition_log)** |
| **030** | **behavior_rx_foundation â€” Behavior Rxè¡Œä¸ºå¤„æ–¹åŸºåº§3å¼ è¡¨(rx_prescriptions/rx_strategy_templates/agent_handoff_log) + 5ç»„åˆç´¢å¼•** |

### 4.3 æ ¸å¿ƒæœåŠ¡ (139 ä¸ª .py æ–‡ä»¶ï¼Œå«ä»¥ä¸‹å…³é”®æœåŠ¡)

| æœåŠ¡æ–‡ä»¶ | åŠŸèƒ½ |
|---------|------|
| `auth.py` | è§’è‰²å±‚çº§åˆ¤å®š (get_role_level) + æƒé™è¾…åŠ© |
| `behavioral_profile_service.py` | BAPSè¯„ä¼°â†’ç»Ÿä¸€è¡Œä¸ºç”»åƒ |
| `micro_action_service.py` | æ¯æ—¥å¾®è¡ŒåŠ¨ç”Ÿæˆ/å®Œæˆ/è·³è¿‡/è¿‡æœŸ/æ•™ç»ƒä»»åŠ¡ |
| `challenge_service.py` | æŒ‘æˆ˜æ¨¡æ¿CRUD/ä¸“å®¶å®¡æ ¸/æŠ¥å/æ‰“å¡/é—®å· |
| `coach_push_queue_service.py` | ç»Ÿä¸€æ¨é€å®¡æ‰¹ç½‘å…³ |
| `device_alert_service.py` | é˜ˆå€¼ç›‘æµ‹/1hå»é‡/åŒé€šçŸ¥ |
| `device_behavior_bridge.py` | è®¾å¤‡æ•°æ®â†’è‡ªåŠ¨å®Œæˆå¾®è¡ŒåŠ¨ |
| `push_recommendation_service.py` | 6è§„åˆ™AIæ¨é€å»ºè®®å¼•æ“ |
| `reminder_service.py` | æé†’CRUD + cronè¡¨è¾¾å¼è§£æ |
| `high_freq_question_service.py` | HF-20/HF-50é¢„è®¾é¢˜ç»„ |
| `content_access_service.py` | è§’è‰²çº§å†…å®¹é—¨æ§ |
| `data_visibility_service.py` | å­—æ®µçº§å¯è§æ€§è¿‡æ»¤ |
| `intervention_matcher.py` | åŸŸå¹²é¢„åŒ¹é…ï¼ˆrx_libraryï¼‰ |
| `behavior_facts_service.py` | è¡Œä¸ºäº‹å®èšåˆ |
| `assessment_engine.py` | è¯„ä¼°è®¡ç®—å¼•æ“ |
| `baps/scoring_engine.py` | BAPSå››ç»´è¯„åˆ† |
| `baps/questionnaires.py` | é—®å·å®šä¹‰ï¼ˆBigFive/BPT-6/CAPACITY/SPIï¼‰ |
| `baps/report_generator.py` | è¯„ä¼°æŠ¥å‘Šç”Ÿæˆ |
| `scheduler.py` | APScheduler 13ä»»åŠ¡è°ƒåº¦(Redisäº’æ–¥é”) |
| `redis_lock.py` | Redis SETNX åˆ†å¸ƒå¼äº’æ–¥é”è£…é¥°å™¨ |
| `promotion_service.py` | æ™‹çº§èµ„æ ¼æ ¡éªŒï¼ˆå››ç»´æ£€æŸ¥ï¼‰ |
| `milestone_service.py` | V003æ¿€åŠ±å¼•æ“ï¼ˆç­¾åˆ°/å¾½ç« /ç¿»ç‰Œ/é‡Œç¨‹ç¢‘ï¼‰ |
| `master_agent.py` | ä¸­æ¢Agentå…¥å£(Facade + æ—¥å¿—ä¿æŠ¤) |
| `master_agent_v0.py` | MasterAgent 9æ­¥æµç¨‹å®Œæ•´å®ç° |
| `brain/stage_runtime.py` | StageRuntimeBuilder |
| `brain/policy_gate.py` | RuntimePolicyGate |
| `brain/decision_engine.py` | è¡Œä¸ºå†³ç­–å¼•æ“ |
| `knowledge/embedding_service.py` | sentence-transformers 768ç»´åµŒå…¥ |
| `knowledge/retriever.py` | RAGæ£€ç´¢ + scope_boost + priority_adj |
| `knowledge/rag_middleware.py` | RAGæ³¨å…¥ä¸­é—´ä»¶ |
| `knowledge/chunker.py` | Markdownåˆ†å—ç­–ç•¥ |
| `knowledge/document_service.py` | çŸ¥è¯†æ–‡æ¡£CRUD + å‘å¸ƒ/å®¡æ ¸ |
| `knowledge/file_converter.py` | PDF/DOCX/TXT â†’ Markdown |
| `knowledge/archive_extractor.py` | ZIP/7Z/RARè§£å‹ |
| `knowledge/batch_ingestion_service.py` | æ‰¹é‡çŒæ³¨ç¼–æ’ |
| `knowledge/sharing_service.py` | V006-P3: çŸ¥è¯†å…±äº«æœåŠ¡ |
| `learning_service.py` | å­¦ä¹ æ—¶é•¿/ç§¯åˆ†/è¿ç»­æ‰“å¡ + è§’è‰²æ™‹çº§ |
| `program_service.py` | V004 ProgramEngine |
| `multimodal_client.py` | qwen2.5vlé£Ÿç‰©è¯†åˆ« |
| `model_manager.py` | Ollamaæ¨¡å‹ç®¡ç† |
| `survey_service.py` | é—®å·å¼•æ“ |
| `llm_client.py` | V005ç»Ÿä¸€äº‘LLMå®¢æˆ·ç«¯ |
| `safety/pipeline.py` | V005 SafetyPipelineç¼–æ’å™¨(L1â†’L4) |
| `safety/input_filter.py` | V005 L1è¾“å…¥è¿‡æ»¤ |
| `safety/rag_safety.py` | V005 L2 RAGå®‰å…¨å¢å¼º |
| `safety/generation_guard.py` | V005 L3ç”Ÿæˆçº¦æŸ |
| `safety/output_filter.py` | V005 L4è¾“å‡ºè¿‡æ»¤ |
| `audio_service.py` | V005éŸ³é¢‘TTSæœåŠ¡ |
| `agent_template_service.py` | V006-P1: Agentæ¨¡æ¿åŠ è½½/ç¼“å­˜/æ„å»º |
| `agents/generic_llm_agent.py` | V006-P1: çº¯LLMåŠ¨æ€Agent |
| `feedback_service.py` | V006-P4: åé¦ˆå­¦ä¹ æœåŠ¡ |
| `ecosystem_service.py` | V006-P5: Agentç”Ÿæ€æœåŠ¡ |
| **`policy_engine.py`** | **V007: ç»Ÿä¸€ç­–ç•¥å†³ç­–å¼•æ“(Event/UserContextâ†’è§„åˆ™æ±‚å€¼â†’å†³ç­–)** |
| **`rule_registry.py`** | **V007: è§„åˆ™æ³¨å†Œä¸­å¿ƒ(JSON-Logicæ±‚å€¼å™¨+çƒ­åˆ·æ–°)** |
| **`conflict_resolver.py`** | **V007: å†²çªä»²è£å¼•æ“(5ç­–ç•¥: weighted_score/priority_tree/medical_boundary/tenant_override/risk_suppress)** |
| **`cost_controller.py`** | **V007: LLMæˆæœ¬æ§åˆ¶+é¢„ç®—æ‰§è¡Œ(per-tenant/per-user)** |
| **`effectiveness_metrics.py`** | **V007: å¹²é¢„æ•ˆæœè¯„åˆ†+ç»“æœè¿½è¸ª** |
| **`stage_aware_selector.py`** | **V007: é˜¶æ®µæ„ŸçŸ¥Agenté€‰æ‹©å™¨(TTMé˜¶æ®µâ†’Agenté€‚é…)** |
| **`decision_trace.py`** | **V007: å†³ç­–è¿½è¸ª+å®¡è®¡æ—¥å¿—** |
| **`auto_exit_handler.py`** | **V007: è‡ªåŠ¨é€€å‡ºå¤„ç†å™¨(é£é™©è¾¹ç•Œ+ç¦å¿Œç—‡)** |
| **`stage_personalization.py`** | **QA: TTMé˜¶æ®µä¸ªæ€§åŒ–ç­–ç•¥å¼•æ“(S0-S6, 7é˜¶æ®µæ¨è)** |
| **`cost_attribution.py`** | **QA: LLMæˆæœ¬å½’å› åˆ†æ(ç”¨æˆ·/Agent/ç§Ÿæˆ·3ç»´)** |
| **`privacy_impact.py`** | **QA: PIA/DPIAéšç§å½±å“è¯„ä¼°æ¡†æ¶** |
| **`health_standards.py`** | **QA: åŒ»ç–—æ•°æ®æ ‡å‡†é€‚é…(FHIR R4/HL7 v2/ICD-10/SNOMED CT/LOINC)** |
| **`api_gateway.py`** | **QA: APIç½‘å…³é…ç½®+nginx_proxyç”Ÿæˆ** |
| **`expert_analytics.py`** | **QA: ä¸“å®¶æ•ˆç‡åˆ†æ(expert_efficiency/advisor_tool/ROI)** |
| **`tcm_integration.py`** | **QA: ä¸­è¥¿åŒ»èåˆå¹²é¢„åè®®(9ä½“è´¨Ã—TTMé˜¶æ®µâ†’èåˆæ–¹æ¡ˆ)** |
| `behavior_rx/behavior_rx_engine.py` | **BehaviorRx**: ä¸‰ç»´å¤„æ–¹è®¡ç®—å¼•æ“(TTMÃ—BigFiveÃ—CAPACITYâ†’RxPrescription), 12ç­–ç•¥æ¨¡æ¿, STAGE_STRATEGY_MATRIX |
| `behavior_rx/base_expert_agent.py` | **BehaviorRx**: ä¸“å®¶AgentåŸºç±»(Template Method: assessâ†’compute_rxâ†’apply_domainâ†’check_handoff) |
| `behavior_rx/behavior_coach_agent.py` | **BehaviorRx**: è¡Œä¸ºæ•™ç»ƒAgent(S0-S2ä½é˜¶æ®µç”¨æˆ·, åŠ¨æœºæ¿€å‘, é˜¶æ®µæ™‹å‡) |
| `behavior_rx/metabolic_expert_agent.py` | **BehaviorRx**: ä»£è°¢ä¸“å®¶Agent(è¡€ç³–å¼‚å¸¸, ç³–å°¿ç—…ç®¡ç†, é¥®é£Ÿå¹²é¢„) |
| `behavior_rx/cardiac_expert_agent.py` | **BehaviorRx**: å¿ƒè„åº·å¤ä¸“å®¶Agent(è¿åŠ¨ææƒ§, å¿ƒè¡€ç®¡åº·å¤, é£é™©åˆ†å±‚) |
| `behavior_rx/adherence_expert_agent.py` | **BehaviorRx**: ä¾ä»æ€§ä¸“å®¶Agent(æœè¯æ¼æœ, å¤æŸ¥è¿‡æœŸ, åŒ»å˜±éµä») |
| `behavior_rx/agent_handoff_service.py` | **BehaviorRx**: Agentäº¤æ¥æœåŠ¡(6ç§ç±»å‹: stage_promotion/regression/domain_coordination/cross_cutting/emergency_takeover/scheduled) |
| `behavior_rx/agent_collaboration_orchestrator.py` | **BehaviorRx**: å¤šAgentåä½œç¼–æ’å™¨(6åœºæ™¯: new_user_assessment/glucose_abnormal/exercise_fear/multi_morbidity/stage_regression/pre_visit) |
| `behavior_rx/rx_conflict_resolver.py` | **BehaviorRx**: å¤„æ–¹å†²çªè§£å†³å™¨(ä¼˜å…ˆçº§åˆå¹¶, çŸ›ç›¾æ£€æµ‹, é™çº§ç­–ç•¥) |
| `behavior_rx/master_agent_integration.py` | **BehaviorRx**: MasterAgenté›†æˆè¡¥ä¸(ExpertAgentRouterè·¯ç”±åˆ¤æ–­ + patch_master_agent_v0åŒæ­¥é€‚é…) |
| `behavior_rx/rx_schemas.py` | **BehaviorRx**: Pydantic DTO(RxPrescriptionDTO/RxContext/BigFiveProfile/HandoffRequest/ComputeRxRequestç­‰) |
| `behavior_rx/rx_models.py` | **BehaviorRx**: 3 ORMæ¨¡å‹ + 6æšä¸¾(RxStrategyType/RxIntensity/CommunicationStyle/HandoffType/HandoffStatus/ExpertAgentType) |
| `behavior_rx/rx_routes.py` | **BehaviorRx**: RESTè·¯ç”±(8ç«¯ç‚¹, /api/v1/rx/) |
| `models.py` | 119ä¸ªSQLAlchemyæ•°æ®æ¨¡å‹å®šä¹‰ + ROLE_LEVELæƒå¨æ˜ å°„ |
| `database.py` | SQLAlchemyå¼•æ“/ä¼šè¯ç®¡ç† |
| `middleware.py` | CORSç™½åå•/å®‰å…¨å¤´/æ—¥å¿—/é™æµ |

### 4.4 Multi-Agent ç³»ç»Ÿ

#### 12 ä¸ªä¸“ä¸š Agent (æ ¸å¿ƒåä½œå±‚)

| Agent | ç±»å‹ | èŒè´£ |
|-------|------|------|
| ä»£è°¢ç®¡ç†Agent | metabolic | è¡€ç³–ã€ä½“é‡ã€ä»£è°¢ç›¸å…³åˆ†æä¸å»ºè®® |
| ç¡çœ ç®¡ç†Agent | sleep | ç¡çœ è´¨é‡åˆ†æã€ä½œæ¯ä¼˜åŒ–å»ºè®® |
| æƒ…ç»ªç®¡ç†Agent | emotion | æƒ…ç»ªè¯„ä¼°ã€å‹åŠ›ç®¡ç†ã€å¿ƒç†æ”¯æŒ |
| åŠ¨æœºæ¿€åŠ±Agent | motivation | è¡Œä¸ºåŠ¨æœºåˆ†æã€é˜¶æ®µæ¨è¿›ã€æ¿€åŠ±ç­–ç•¥ |
| æ•™ç»ƒé£æ ¼Agent | coaching | ç»Ÿä¸€æ•™ç»ƒé£æ ¼è¾“å‡ºã€å›å¤åˆæˆ |
| è¥å…»ç®¡ç†Agent | nutrition | è†³é£Ÿåˆ†æã€è¥å…»å»ºè®® |
| è¿åŠ¨åº·å¤Agent | exercise | è¿åŠ¨æ–¹æ¡ˆã€åº·å¤æŒ‡å¯¼ |
| ä¸­åŒ»å…»ç”ŸAgent | tcm | ä¸­åŒ»ä½“è´¨åˆ†æã€å…»ç”Ÿå»ºè®® |
| å±æœºå¹²é¢„Agent | crisis | é«˜é£é™©è¯†åˆ«ä¸å±æœºå¹²é¢„ |
| è¡Œä¸ºå¤„æ–¹Agent | behavior_rx | è¡Œä¸ºå¤„æ–¹åˆ¶å®šã€ä¹ æƒ¯å¹²é¢„ã€ä¾ä»æ€§ç®¡ç† |
| ä½“é‡ç®¡ç†Agent | weight | ä½“é‡/BMIç›‘æµ‹ã€å‡é‡æ–¹æ¡ˆã€èº«ä½“æˆåˆ†åˆ†æ |
| å¿ƒè„åº·å¤Agent | cardiac_rehab | å¿ƒè¡€ç®¡åº·å¤è¯„ä¼°ã€è¿åŠ¨å¤„æ–¹ã€é£é™©åˆ†å±‚ |

#### 4 ä¸ªä¸“å®¶ Agent (BehaviorRx ä¸“å®¶å±‚)

| Agent | ç±» | èŒè´£ | é¢†åŸŸå…³é”®è¯ |
|-------|------|------|-----------|
| è¡Œä¸ºæ•™ç»ƒ | BehaviorCoachAgent | S0-S2ä½é˜¶æ®µç”¨æˆ·åŠ¨æœºæ¿€å‘/é˜¶æ®µæ™‹å‡/å¿ƒç†å±éšœæ¶ˆé™¤ | ä¸æƒ³æ”¹å˜/æ²¡åŠ¨åŠ›/å®³æ€•/åšä¸åˆ°/æ”¾å¼ƒ |
| ä»£è°¢ä¸“å®¶ | MetabolicExpertAgent | è¡€ç³–å¼‚å¸¸å¹²é¢„/ç³–å°¿ç—…ç®¡ç†/é¥®é£Ÿæ–¹æ¡ˆ/ä½“é‡æ§åˆ¶ | è¡€ç³–/ç³–å°¿ç—…/èƒ°å²›ç´ /HbA1c/BMI/å‡é‡ |
| å¿ƒè„åº·å¤ä¸“å®¶ | CardiacExpertAgent | å¿ƒè¡€ç®¡åº·å¤/è¿åŠ¨ææƒ§/è¿åŠ¨å¤„æ–¹/é£é™©åˆ†å±‚ | å¿ƒè„/å¿ƒè¡€ç®¡/åº·å¤/å¿ƒç‡/èƒ¸ç—›/æ”¯æ¶/å¿ƒæ¢— |
| ä¾ä»æ€§ä¸“å®¶ | AdherenceExpertAgent | æœè¯ä¾ä»/æ¼æœæé†’/å¤æŸ¥è¿½è¸ª/åŒ»å˜±éµä» | æœè¯/åƒè¯/å¿˜è®°åƒè¯/æ¼æœ/å¤æŸ¥/åŒ»å˜± |

**åä½œç¼–æ’ (6 åœºæ™¯)**:
- `new_user_assessment`: æ–°ç”¨æˆ· â†’ Coachä¸»å¯¼ + é¢†åŸŸAgentè¾…åŠ©
- `glucose_abnormal`: è¡€ç³–å¼‚å¸¸ â†’ Metabolicä¸»å¯¼ + Coachå¾…å‘½
- `exercise_fear`: è¿åŠ¨ææƒ§ â†’ Coachå‰ç½® + Cardiacå¾…å‘½
- `multi_morbidity`: å¤šç—…å…±ç®¡ â†’ å¹¶è¡Œç¼–æ’ + Adherenceæ¨ªåˆ‡
- `stage_regression`: é˜¶æ®µå›é€€ â†’ Coachç´§æ€¥æ¥ç®¡
- `pre_visit`: å°±è¯Šå‡†å¤‡ â†’ Adherenceä¸»å¯¼

#### MasterAgent 9æ­¥å¤„ç†æµç¨‹ (V005å®‰å…¨å¢å¼º + V007ç­–ç•¥æ³¨å…¥ + BehaviorRxä¸“å®¶è·¯ç”±)

```
Step 1-2:   æ¥æ”¶ç”¨æˆ·è¾“å…¥/è®¾å¤‡æ•°æ®
Step 2.5:   ğŸ›¡ï¸ SafetyPipeline.process_input() â€” L1è¾“å…¥è¿‡æ»¤
              crisis_detected â†’ ç›´èµ°CrisisAgent | input_blocked â†’ æ‹’ç» | normal â†’ ç»§ç»­
Step 3:     æ›´æ–° User Master Profile
Step 3.5:   ğŸ§¬ ExpertAgentRouter.should_route_to_expert() â€” ä¸“å®¶Agentè·¯ç”±åˆ¤æ–­
              å…³é”®è¯åŒ¹é… + é¢†åŸŸæ•°æ®åŒ¹é… + TTMé˜¶æ®µåˆ¤æ–­
              å‘½ä¸­ â†’ CollaborationOrchestratorç¼–æ’ â†’ ç›´æ¥è¿”å›(ç»•è¿‡Step 4-6)
              æœªå‘½ä¸­ â†’ ç»§ç»­åŸå§‹æµç¨‹
Step 4:     Agent Router â†’ é—®é¢˜ç±»å‹ + é£é™©ä¼˜å…ˆçº§
              (V007: PolicyEngine.evaluate() â†’ è§„åˆ™åŒ¹é…+Agenté€‰æ‹©+æˆæœ¬é¢„ç®—æ£€æŸ¥)
Step 4.5:   æ•°æ®æ´å¯Ÿç”Ÿæˆ
Step 5-6:   è°ƒç”¨ä¸“ä¸šAgent + Multi-Agent Coordinator æ•´åˆ
Step 7:     Intervention Planner â†’ ä¸ªæ€§åŒ–å¹²é¢„è·¯å¾„
Step 7.5:   ğŸ›¡ï¸ SafetyPipeline.guard_generation() â€” L3ç”Ÿæˆçº¦æŸæ³¨å…¥
Step 8:     Response Synthesizer â†’ UnifiedLLMClient(äº‘ä¼˜å…ˆ/æœ¬åœ°é™çº§)
Step 8.5:   ğŸ›¡ï¸ SafetyPipeline.filter_output() â€” L4è¾“å‡ºè¿‡æ»¤+å…è´£æ ‡æ³¨
Step 9:     å†™å› Profile + ç”Ÿæˆä»Šæ—¥ä»»åŠ¡/è¿½è¸ªç‚¹
              (V007: DecisionTrace.log() â†’ å†³ç­–å®¡è®¡å…¥åº“)

LLMè·¯ç”±: UnifiedLLMClient (core/llm_client.py)
  ç­–ç•¥: CLOUD_FIRST(é»˜è®¤) / LOCAL_FIRST / CLOUD_ONLY / LOCAL_ONLY
  äº‘ç«¯: DeepSeek / Qwen / GPT (OpenAI-compatible API)
  æœ¬åœ°: Ollama qwen2.5:0.5b (é™çº§è·¯å¾„)
```

#### åŒ MasterAgent æ¶æ„ (v37)

```
â”Œâ”€ api/main.py â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                               â”‚
â”‚  get_master_agent()          get_agent_master()               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ v0 MasterAgent       â”‚     â”‚ v6 AgentMaster            â”‚    â”‚
â”‚  â”‚ (core/master_agent   â”‚     â”‚ (core/agents/master_agent â”‚    â”‚
â”‚  â”‚  _v0.py, ~5000è¡Œ)    â”‚     â”‚  .py, 422è¡Œ)              â”‚    â”‚
â”‚  â”‚                      â”‚     â”‚                           â”‚    â”‚
â”‚  â”‚ Â·9æ­¥Pipelineå®Œæ•´ç‰ˆ   â”‚     â”‚ Â·ä» DB æ¨¡æ¿åŠ è½½ 12 Agent  â”‚    â”‚
â”‚  â”‚ Â·Orchestratorç«¯ç‚¹    â”‚     â”‚ Â·æ”¯æŒ GenericLLMAgent     â”‚    â”‚
â”‚  â”‚ Â·BehaviorRxè¡¥ä¸æ³¨å…¥  â”‚     â”‚ Â·template_system_prompt   â”‚    â”‚
â”‚  â”‚ Â·process_with_pipelineâ”‚    â”‚ Â·process() è½»é‡ç‰ˆ         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                               â”‚
â”‚  å¯åŠ¨é¡ºåº:                                                    â”‚
â”‚  1. æ¨¡æ¿ç¼“å­˜é¢„çƒ­ (load_templates â†’ 12ä¸ªæ¨¡æ¿)                   â”‚
â”‚  2. v6 AgentMaster åˆå§‹åŒ– (build_agents_from_templates)       â”‚
â”‚  3. v0 MasterAgent åˆå§‹åŒ– (ç¡¬ç¼–ç  Agent)                       â”‚
â”‚  4. BehaviorRx ä¸“å®¶Agentåˆå§‹åŒ– + v0 è¡¥ä¸                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ç»´åº¦ | v0 MasterAgent | v6 AgentMaster |
|------|---------------|----------------|
| æ–‡ä»¶ | `core/master_agent_v0.py` | `core/agents/master_agent.py` |
| è¡Œæ•° | ~5000 | 422 |
| Agentæ¥æº | ç¡¬ç¼–ç  12 ä¸ªç±» | DB æ¨¡æ¿ â†’ AGENT_CLASS_REGISTRY / GenericLLMAgent |
| åŠ¨æ€Agent | ä¸æ”¯æŒ | æ”¯æŒ (dynamic_llm ç±»å‹) |
| è°ƒç”¨æ–¹ | `/orchestrator/*` ç«¯ç‚¹ | `/agent/run`, å†…éƒ¨è·¯ç”± |
| é™çº§ç­–ç•¥ | æ°¸è¿œå¯ç”¨ | DBä¸å¯ç”¨ â†’ ç¡¬ç¼–ç é™çº§ |

---

## äº”è‡³åä¸‰ (ä¿æŒ v30 ä¸å˜)

> ç¬¬äº”è‡³åä¸‰ç« èŠ‚å†…å®¹ä¸ v30 å®Œå…¨ä¸€è‡´ï¼ŒåŒ…æ‹¬:
> - äº”ã€æ¨é€å®¡æ‰¹ç½‘å…³æ¶æ„
> - å…­ã€å‰ç«¯åº”ç”¨å±‚ (Admin 126é¡µé¢ / H5 30é¡µé¢ / ä¸“å®¶å·¥ä½œå° / H5-Patient)
> - ä¸ƒã€BAPS è¯„ä¼°ä½“ç³» (å››ç»´è¯„ä¼°æ¡†æ¶)
> - å…«ã€æ•°æ®æµå‘ (è®¾å¤‡/è¯„ä¼°/æ•™ç»ƒå¹²é¢„)
> - ä¹ã€ä¸“å®¶ç™½æ ‡å¹³å°æ¶æ„ (å¤šç§Ÿæˆ·/å“ç‰Œ/API/å†…å®¹å·¥ä½œå®¤)
> - åã€RAG çŸ¥è¯†åº“ç³»ç»Ÿ (æ¶æ„/æ£€ç´¢è¯„åˆ†/æ•°æ®æ¨¡å‹)
> - åä¸€ã€å†…å®¹æ²»ç†å±‚ (T1-T4è¯æ®åˆ†å±‚/å®¡æ ¸/æ—¶æ•ˆ)
> - åäºŒã€æ•°æ®åˆ†æçœ‹æ¿ (Coach 6 + Admin 7)
> - åä¸‰ã€å¹³å°å…¨é¢å®Œå–„ (7å¤§éœ€æ±‚)
>
> è¯¦è§ v30 æ–‡æ¡£å¯¹åº”ç« èŠ‚ã€‚

---

## åå››ã€æŠ€æœ¯æ ˆæ€»è§ˆ

| å±‚ | æŠ€æœ¯ |
|----|------|
| **å‰ç«¯ (æ¡Œé¢)** | Vue 3 + TypeScript + Vite + Ant Design Vue 4 + BHP Design System |
| **å‰ç«¯ (ç§»åŠ¨)** | Vue 3 + TypeScript + Vite + Vant 4 + BHP Design System |
| **ä¸“å®¶å·¥ä½œå°** | Python + Streamlit |
| **åç«¯** | Python 3.10+ + FastAPI + Uvicorn |
| **ORM** | SQLAlchemy + Alembic |
| **æ•°æ®åº“** | PostgreSQL + pgvector + Redis + Weaviate |
| **è®¤è¯** | JWT (python-jose) + bcrypt (passlib) + Tokené»‘åå• |
| **å®šæ—¶ä»»åŠ¡** | APScheduler (AsyncIOScheduler, 13 jobs) |
| **Embedding** | sentence-transformers (text2vec-base-chinese, 768ç»´, ä¼˜å…ˆ) / Ollama nomic-embed-text (å›é€€) |
| **LLM** | äº‘LLM (DeepSeek/Qwen/GPT, cloud-first) + Ollama (qwen2.5:0.5b + qwen2.5vl:7b, é™çº§) + Dify |
| **å®‰å…¨ç®¡çº¿** | 4å±‚SafetyPipeline (è¾“å…¥è¿‡æ»¤â†’RAGå®‰å…¨â†’ç”Ÿæˆçº¦æŸâ†’è¾“å‡ºè¿‡æ»¤) |
| **ç­–ç•¥å¼•æ“** | V007 PolicyEngine (JSON-Logicè§„åˆ™+å†²çªä»²è£+æˆæœ¬æ§åˆ¶+å†³ç­–è¿½è¸ª) |
| **éŸ³é¢‘** | edge-tts (TTSç”Ÿæˆ) + äº‘TTS API (å¯é€‰) |
| **å®¹å™¨** | Docker Compose (4åº”ç”¨ + 9åŸºç¡€è®¾æ–½) |
| **CI/CD** | GitHub Actions (lintâ†’testâ†’build) + Makefile (20+ targets) |
| **K8séƒ¨ç½²** | Helm Chart (bhp v0.7.0, HPA 2-10 replicas, Ingress nginx) |
| **åå‘ä»£ç†** | nginx (å‰ç«¯å®¹å™¨å†…) |
| **å®æ—¶é€šä¿¡** | WebSocket + SSE |
| **ä¾èµ–ç®¡ç†** | requirements.txt (å…¨éƒ¨ `==` ç²¾ç¡®é”å®š) |

---

## åäº”ã€é‡åŒ–ç»Ÿè®¡

| æŒ‡æ ‡ | æ•°å€¼ |
|------|------|
| SQLAlchemy æ•°æ®æ¨¡å‹ | **119 ä¸ª** (v31: 116 â†’ +3 BehaviorRx: RxPrescription/RxStrategyTemplate/AgentHandoffLog) |
| æšä¸¾ç±»å‹ | **45 ä¸ª** (v31: 39 â†’ +6 BehaviorRx: RxStrategyType/RxIntensity/CommunicationStyle/HandoffType/HandoffStatus/ExpertAgentType) |
| æ•°æ®åº“è¿ç§»ç‰ˆæœ¬ | **30 ä¸ª** (v31: 29 â†’ +030 behavior_rx_foundation) |
| API è·¯ç”±æ¨¡å— | **56 ä¸ª** (v31: 55 â†’ +1 rx_routes) |
| API ç«¯ç‚¹æ€»æ•° | **505+** (v31: 497 â†’ +8 BehaviorRx) |
| æ ¸å¿ƒæœåŠ¡æ–‡ä»¶ | **139 ä¸ª** .py (v31: 125 â†’ +14 behavior_rxåŒ…) |
| å®šæ—¶ä»»åŠ¡ | 13 ä¸ª (6åŸå§‹ + 5 V004 + 1 V005 + 1 V006, Redis SETNX äº’æ–¥é”) |
| Docker å®¹å™¨ | 13 ä¸ª (4 åº”ç”¨ + 9 åŸºç¡€è®¾æ–½) |
| Admin Portal é¡µé¢ | **127 ä¸ª** .vue (v32: 126 â†’ +1 RxDashboard) |
| H5 ç§»åŠ¨ç«¯é¡µé¢ | 30 ä¸ª .vue (+2 ç»„ä»¶) |
| H5-Patient-App é¡µé¢ | 10 ä¸ª .vue |
| Pinia Store | 13 ä¸ª (Admin 5 + H5 3 + Patient 4 + Rx 1) |
| ä¸“ä¸š Agent | 12 ä¸ª (æ ¸å¿ƒå±‚) + 4 ä¸ª (BehaviorRxä¸“å®¶å±‚) |
| BAPS è¯„ä¼°é¢˜ç›® | 150 é¢˜ (4 é‡è¡¨) |
| è§’è‰²å±‚çº§ | 7 çº§ (observer â†’ admin) |
| è¯æ®åˆ†å±‚ | 4 çº§ (T1â†’T4) |
| é—®å·é¢˜å‹ | 13 ç§ |
| çŸ¥è¯†æ–‡æœ¬å— | 51+ ä¸ª (åµŒå…¥ 768ç»´, pgvectoråŸç”Ÿå­˜å‚¨) |
| åˆ†å±‚æµ‹è¯• | 98 ä¸ª (6å±‚: é¢„æ£€/æ¨¡å‹/æ•°æ®åº“/æœåŠ¡/API/E2E) |
| æ¿€åŠ±ç³»ç»Ÿå¾½ç«  | 36 ä¸ª (configs/badges.json) |
| V007 ç­–ç•¥è§„åˆ™è¡¨ | 6 å¼  (Phase A) |
| V007 æŠ€èƒ½å›¾è°±è¡¨ | 9 å¼  (Phase B) |
| CI/CD | GitHub Actions + Makefile (20+ targets) |
| K8s Helm Chart | 4 æ¨¡æ¿ (deployment/service/ingress/hpa) |
| ä¾èµ–é”å®š | 40+ åŒ…å…¨éƒ¨ `==` ç²¾ç¡®ç‰ˆæœ¬ |

---

## åå…­ã€ç³»ç»ŸçŠ¶æ€

### å·²è¿è¡Œ âœ…

| æ¨¡å— | çŠ¶æ€ |
|------|------|
| å…¨éƒ¨ 119 ä¸ªæ•°æ®æ¨¡å‹ + 30 ç‰ˆè¿ç§» | âœ… æ•°æ®åº“å°±ç»ª (pgvectorå·²å¯ç”¨) |
| 56 ä¸ª API è·¯ç”±æ¨¡å— (505+ ç«¯ç‚¹) | âœ… å…¨éƒ¨æ³¨å†Œ |
| JWT è®¤è¯ + 7 çº§ RBAC | âœ… è¿è¡Œä¸­ |
| APScheduler 13 ä¸ªå®šæ—¶ä»»åŠ¡ (Redisäº’æ–¥é”) | âœ… å·²å¯åŠ¨ |
| 12 ä¸ªä¸“ä¸š Agent + MasterAgent | âœ… åœ¨çº¿ |
| æ¨é€å®¡æ‰¹ç½‘å…³ | âœ… è¿è¡Œä¸­ |
| Docker 4 åº”ç”¨å®¹å™¨ | âœ… healthy |
| Admin Portal å…¨å¹³å°æœç´¢ (127 é¡µé¢) | âœ… è¿è¡Œä¸­ |
| H5 å¿«é€Ÿä½“éªŒç™»å½• (30 é¡µé¢) | âœ… è¿è¡Œä¸­ |
| äº‘LLMç»Ÿä¸€å®¢æˆ·ç«¯ (DeepSeek/Qwen/GPT, cloud-first) | âœ… è¿è¡Œä¸­ |
| Dify + Ollama LLM (é™çº§è·¯å¾„) | âœ… è¿è¡Œä¸­ |
| é£Ÿç‰©è¯†åˆ« (qwen2.5vl:7b) | âœ… è¿è¡Œä¸­ |
| ä¸“å®¶ç™½æ ‡å¹³å° (5ä¸“å®¶/10ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| ä¸“å®¶å†…å®¹å·¥ä½œå®¤ (8ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| RAG çŸ¥è¯†åº“ (51+ chunks, æ£€ç´¢+å¼•ç”¨) | âœ… è¿è¡Œä¸­ |
| æ•°æ®åˆ†æçœ‹æ¿ (Coach 6 + Admin 7 ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| å†…å®¹æ²»ç†å±‚ (T1-T4åˆ†å±‚/å®¡æ ¸/æŠ•ç¨¿/è¿‡æœŸ) | âœ… è¿è¡Œä¸­ |
| æ‰¹é‡çŸ¥è¯†çŒæ³¨ (PDF/DOCX/ZIP/7Z/RAR) | âœ… è¿è¡Œä¸­ |
| å†…å®¹äº¤äº’ (ç‚¹èµ/æ”¶è—/è¯„è®º/åˆ†äº«, çœŸå®DB) | âœ… è¿è¡Œä¸­ |
| å­¦ä¹ æŒä¹…åŒ– (æ—¶é•¿/ç§¯åˆ†/æ‰“å¡/è§’è‰²æ™‹çº§) | âœ… è¿è¡Œä¸­ |
| è€ƒè¯•ç³»ç»Ÿ (é¢˜åº“/è€ƒè¯•/è‡ªåŠ¨è¯„åˆ†/ä¼šè¯) | âœ… è¿è¡Œä¸­ |
| å†…å®¹ç®¡ç† (CRUD/æ‰¹é‡å‘å¸ƒ) | âœ… è¿è¡Œä¸­ |
| ç”¨æˆ·æ´»åŠ¨è¿½è¸ª + ç»Ÿè®¡æŠ¥å‘Š | âœ… è¿è¡Œä¸­ |
| æ•™ç»ƒå…¬å¼€ç›®å½• + çŸ¥è¯†æŠ•ç¨¿ | âœ… è¿è¡Œä¸­ |
| é—®å·å¼•æ“ (5è¡¨/16ç«¯ç‚¹/13é¢˜å‹/çŸ­ç å¡«å†™) | âœ… è¿è¡Œä¸­ |
| å­¦åˆ†åˆ¶æ™‹çº§ (4è¡¨/4è§†å›¾/20ç«¯ç‚¹/5çº§è§„åˆ™, ORMè¿ç§») | âœ… è¿è¡Œä¸­ |
| åŒé“è€…å…³ç³»ç®¡ç† (é‚€è¯·/ç»Ÿè®¡/å¸¦æ•™/æ¯•ä¸šæ ‡è®°) | âœ… è¿è¡Œä¸­ |
| V003æ¿€åŠ±ä½“ç³» (9è¡¨/1è§†å›¾/11ç«¯ç‚¹/36å¾½ç« /ç­¾åˆ°è¿ç»­) | âœ… è¿è¡Œä¸­ |
| V004æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ (3è¡¨/13ç«¯ç‚¹/5å®šæ—¶ä»»åŠ¡/ç§å­æ¨¡æ¿) | âœ… è¿è¡Œä¸­ |
| åˆ†å±‚æµ‹è¯•å¥—ä»¶ (98æµ‹è¯•, 6å±‚å…¨é€šè¿‡) | âœ… å·²éªŒè¯ |
| BHP Design System Â§1-Â§40 (41é¡µé¢è¦†ç›–) | âœ… å·²æ³¨å…¥ |
| Westworld v0.4 ä»¿çœŸæ³¨å…¥ (9ç®¡çº¿/116æ–­è¨€) | âœ… å·²éªŒè¯ |
| V005 4å±‚SafetyPipeline (L1-L4) | âœ… è¿è¡Œä¸­ |
| V005 å®‰å…¨ç®¡ç†API (8ç«¯ç‚¹/ä»ªè¡¨ç›˜/å®¡æ ¸é˜Ÿåˆ—) | âœ… è¿è¡Œä¸­ |
| V005 éŸ³é¢‘TTSæœåŠ¡ (edge-tts) | âœ… è¿è¡Œä¸­ |
| V006-P1 Agentæ¨¡æ¿åŒ– (12é¢„ç½®+åŠ¨æ€åˆ›å»º+10ç«¯ç‚¹+åŒMasterAgent) | âœ… è¿è¡Œä¸­ (v37: 10/10 API + E2EéªŒè¯) |
| V006-P2 è·¯ç”±å¯é…åŒ– (ç§Ÿæˆ·è·¯ç”±è¦†ç›–+A/Bæµ‹è¯•) | âœ… è¿è¡Œä¸­ |
| V006-P3 çŸ¥è¯†å…±äº«å±‚ (3å±‚æ£€ç´¢+è´¡çŒ®å®¡æ ¸+9ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| V006-P4 åé¦ˆå­¦ä¹ é—­ç¯ (æŒä¹…åé¦ˆ+èšåˆ+Promptç‰ˆæœ¬+8ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| V006-P5 Agentç”Ÿæ€ (å¸‚åœº+ç»„åˆ+ç§¯åˆ†+11ç«¯ç‚¹) | âœ… è¿è¡Œä¸­ |
| **V007 ç­–ç•¥å¼•æ“ Phase A (6è¡¨+12ç«¯ç‚¹+è§„åˆ™CRUD+æ¨¡æ‹Ÿ+æˆæœ¬é¢„ç®—)** | âœ… è¿è¡Œä¸­ |
| **V007 æŠ€èƒ½å›¾è°± Phase B (9è¡¨+å¹²é¢„åè®®+é£é™©è¾¹ç•Œ+AgentæŠ€èƒ½å‘é‡)** | âœ… æ•°æ®åº“å°±ç»ª |
| **å·¥ç¨‹è´¨é‡æ¨¡å— (7ä¸ªè´¨é‡æœåŠ¡: é˜¶æ®µä¸ªæ€§åŒ–/æˆæœ¬å½’å› /éšç§è¯„ä¼°/åŒ»ç–—æ ‡å‡†/ç½‘å…³/ä¸“å®¶åˆ†æ/ä¸­åŒ»èåˆ)** | âœ… å·²éƒ¨ç½² |
| **CI/CD ç®¡çº¿ (GitHub Actions + Makefile)** | âœ… å·²é…ç½® |
| **K8s Helm Chart (deployment/service/ingress/hpa)** | âœ… å·²å°±ç»ª |
| **ä¾èµ–é”å®š (40+ åŒ… == ç²¾ç¡®ç‰ˆæœ¬)** | âœ… å·²é”å®š |
| **BehaviorRx è¡Œä¸ºå¤„æ–¹åŸºåº§ (3è¡¨/8ç«¯ç‚¹å…¨å¯ç”¨/Auth+DB/14æœåŠ¡/4ä¸“å®¶Agent)** | âœ… è¿è¡Œä¸­ (10/10éªŒè¯é€šè¿‡) |
| **BehaviorRx MasterAgentè¡¥ä¸ (ExpertAgentRouter+patch_master_agent_v0)** | âœ… å·²æ³¨å…¥ |
| **BehaviorRx 12ç­–ç•¥æ¨¡æ¿ (TTMé˜¶æ®µÃ—äººæ ¼Ã—é¢†åŸŸ)** | âœ… å·²åŠ è½½ |
| **Rx UI å‰ç«¯æ¨¡å— (15æ–‡ä»¶/7ç»„ä»¶/6è·¯ç”±/RxDashboardç»¼åˆä»ªè¡¨ç›˜)** | âœ… å·²éƒ¨ç½² (v37: 8/8ç«¯ç‚¹+DBæŒä¹…åŒ–æ­£å¸¸) |

### å¾…ä¼˜åŒ– ğŸ”²

| æ¨¡å— | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| V007 ç­–ç•¥å¼•æ“å‰ç«¯ç®¡ç†é¡µé¢ | å½“å‰ä»…API,éœ€Adminé¡µé¢(è§„åˆ™ç¼–è¾‘/æ¨¡æ‹Ÿ/å®¡è®¡) | ğŸŸ¡ ä¸­ |
| Agent ç»„åˆæ‰§è¡Œå¼•æ“ | å½“å‰ä»…å­˜å‚¨pipelineå®šä¹‰,å®é™…ä¸²è¡Œæ‰§è¡Œå¾…å®ç° | ğŸŸ¡ ä¸­ |
| ç”Ÿäº§éƒ¨ç½²é…ç½® | SSL/åŸŸå/æ—¥å¿—æ”¶é›†/ç›‘æ§å‘Šè­¦ | ğŸŸ¡ ä¸­ |
| æ€§èƒ½ä¼˜åŒ– | æ•°æ®åº“ç´¢å¼•/ç¼“å­˜ç­–ç•¥/åˆ†é¡µä¼˜åŒ– | ğŸŸ¢ ä½ |

---

## åä¸ƒè‡³äºŒåå…­ (ä¿æŒ v30 ä¸å˜)

> ä»¥ä¸‹ç« èŠ‚å†…å®¹ä¸ v30 å®Œå…¨ä¸€è‡´:
> - åä¸ƒã€åˆ†å±‚æµ‹è¯•å¥—ä»¶ (98æµ‹è¯•, 6å±‚)
> - åå…«ã€é—®å·å¼•æ“ (5æ¨¡å‹/16ç«¯ç‚¹/13é¢˜å‹)
> - åä¹ã€å…¨å¹³å°å®¡è®¡æŠ¥å‘Š (2026-02-09)
> - äºŒåã€å­¦åˆ†åˆ¶æ™‹çº§ä½“ç³» (V002, 4æ¨¡å‹/20ç«¯ç‚¹)
> - äºŒåä¸€ã€V003 æ¿€åŠ±ä½“ç³» (9æ¨¡å‹/11ç«¯ç‚¹/36å¾½ç« )
> - äºŒåäºŒã€V004 æ™ºèƒ½ç›‘æµ‹æ–¹æ¡ˆ (3æ¨¡å‹/13ç«¯ç‚¹/5å®šæ—¶ä»»åŠ¡)
> - äºŒåä¸‰ã€UI æ•´åˆ + BHP è®¾è®¡ç³»ç»Ÿæ³¨å…¥ (Â§1-Â§40)
> - äºŒåå››ã€ä¸Šçº¿å‰è‡ªæ£€æŠ¥å‘Š
> - äºŒåäº”ã€Westworld v0.4 ä»¿çœŸéªŒè¯
> - äºŒåå…­ã€V005 äº‘LLM + 4å±‚å®‰å…¨ç®¡çº¿
>
> è¯¦è§ v30 æ–‡æ¡£å¯¹åº”ç« èŠ‚ã€‚

---

## äºŒåä¸ƒã€V006 å…«çˆªé±¼ Agent-Expert æ¶æ„ (2026-02-12)

> å†…å®¹ä¸ v30 Â§äºŒåä¸ƒå®Œå…¨ä¸€è‡´:
> - Phase 1: Agent æ¨¡æ¿åŒ– (12é¢„ç½®+GenericLLM+10ç«¯ç‚¹+CRUDç®¡ç†)
> - Phase 2: è·¯ç”±å¯é…åŒ– (ç§Ÿæˆ·è·¯ç”±è¦†ç›–+A/Bæµ‹è¯•+3ç«¯ç‚¹)
> - Phase 3: çŸ¥è¯†å…±äº«å±‚ (è´¡çŒ®å®¡æ ¸+é¢†åŸŸæ± +9ç«¯ç‚¹)
> - Phase 4: åé¦ˆå­¦ä¹ é—­ç¯ (åé¦ˆ+èšåˆ+Promptç‰ˆæœ¬+8ç«¯ç‚¹+å®šæ—¶ä»»åŠ¡)
> - Phase 5: Agent ç”Ÿæ€ (å¸‚åœº+ç»„åˆ+ç§¯åˆ†+11ç«¯ç‚¹)
> - 9 DBè¡¨, ~42 APIç«¯ç‚¹, 6ç®¡ç†é¡µé¢, 1å®šæ—¶ä»»åŠ¡
>
> è¯¦è§ v30 Â§äºŒåä¸ƒã€‚

---

## äºŒåå…«ã€V007 ç­–ç•¥å¼•æ“ (Policy Engine) â€” 2026-02-12

> V007 æ–°å¢ â€” 15 æ¨¡å‹ Â· 2 è¿ç§»(028-029) Â· 15 DBè¡¨ Â· 12 API ç«¯ç‚¹ Â· 8 æ ¸å¿ƒæœåŠ¡æ¨¡å—

### 28.1 æ¶æ„æ€»è§ˆ

```
V007 ç­–ç•¥å¼•æ“ (Policy Engine)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Phase B: æŠ€èƒ½å›¾è°± (Skill Graph)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ä¸“å®¶é¢†åŸŸæ˜ å°„   â”‚ â”‚å¹²é¢„åè®®æ¨¡æ¿    â”‚ â”‚é£é™©è¾¹ç•Œ      â”‚ â”‚
â”‚  â”‚primary/second â”‚ â”‚è§¦å‘/å‡ºå£æ¡ä»¶  â”‚ â”‚è‡ªåŠ¨é€€å‡º      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚é˜¶æ®µé€‚ç”¨æ€§     â”‚ â”‚ç¦å¿Œç—‡çŸ©é˜µ     â”‚ â”‚è¯æ®ç­‰çº§ç»‘å®š  â”‚ â”‚
â”‚  â”‚æ•ˆæœè¯„åˆ†       â”‚ â”‚å®‰å…¨è¾¹ç•Œ       â”‚ â”‚T1-T5        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚AgentæŠ€èƒ½å‘é‡  â”‚ â”‚å¹²é¢„æ•ˆæœè¿½è¸ª   â”‚ â”‚é˜¶æ®µè½¬æ¢æ—¥å¿—  â”‚ â”‚
â”‚  â”‚9ç»´èƒ½åŠ›æŒ‡çº¹    â”‚ â”‚IESåˆ†+ä¾ä»æŒ‡æ•° â”‚ â”‚ç½®ä¿¡åº¦        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Phase A: ç­–ç•¥å†³ç­–å¼•æ“ (Policy Decision Engine)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ç­–ç•¥è§„åˆ™       â”‚ â”‚è§„åˆ™ä¼˜å…ˆçº§     â”‚ â”‚Agenté€‚ç”¨çŸ©é˜µ â”‚ â”‚
â”‚  â”‚JSON-Logicæ¡ä»¶ â”‚ â”‚æ—¶é—´çª—/ç§Ÿæˆ·    â”‚ â”‚é˜¶æ®µ/é£é™©/å¼ºåº¦â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚å†²çªä»²è£çŸ©é˜µ   â”‚ â”‚å†³ç­–å®¡è®¡è¿½è¸ª   â”‚ â”‚æˆæœ¬é¢„ç®—è´¦æœ¬  â”‚ â”‚
â”‚  â”‚5ç§ç­–ç•¥        â”‚ â”‚å…¨é“¾è·¯æ—¥å¿—     â”‚ â”‚token/å…ƒé™é¢  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºåº§: 12 Agent + SafetyPipeline + UnifiedLLMClient    â”‚
â”‚  V006 Agentæ¨¡æ¿ + è·¯ç”±é…ç½® + çŸ¥è¯†å…±äº« + åé¦ˆé—­ç¯        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 28.2 Phase A â€” ç­–ç•¥å†³ç­–å¼•æ“ (6 è¡¨)

| è¡¨ | æ ¸å¿ƒå­—æ®µ | è¯´æ˜ |
|------|---------|------|
| `policy_rules` | rule_name, rule_type(platform/tenant/emergency/dynamic), condition_expr(JSONB), action_type(select_agent/block/adjust_weight/downgrade_model), action_params(JSONB), priority(0-100), tenant_id, is_enabled, evidence_tier, effective_from, effective_until | ç­–ç•¥è§„åˆ™å®šä¹‰ (JSON-Logic æ¡ä»¶è¡¨è¾¾å¼) |
| `rule_priority` | rule_id, priority_group, priority_rank, effective_from, effective_until, description | è§„åˆ™ä¼˜å…ˆçº§æ’åº (æ—¶é—´çª—å£ç”Ÿæ•ˆ) |
| `agent_applicability_matrix` | agent_id, stage_range(JSONB), risk_level, intensity_level, contraindications(JSONB), confidence_score | Agenté€‚ç”¨æ€§çŸ©é˜µ (é˜¶æ®µ/é£é™©/å¼ºåº¦/ç¦å¿Œ) |
| `conflict_matrix` | agent_a, agent_b, resolution_strategy(weighted_score/priority_tree/medical_boundary/tenant_override/risk_suppress), winner_agent, confidence | å†²çªä»²è£çŸ©é˜µ (5ç§è§£å†³ç­–ç•¥) |
| `decision_trace` | trace_id(UUID), user_id, session_id, event_type, matched_rules(JSONB), selected_agents(JSONB), cost_estimate, latency_ms, final_decision(JSONB) | å†³ç­–å®¡è®¡è¿½è¸ª (å…¨é“¾è·¯æ—¥å¿—) |
| `cost_budget_ledger` | tenant_id, user_id, period_start, period_end, token_budget, token_used, cost_budget, cost_used, model_usage(JSONB), overflow_action | æˆæœ¬é¢„ç®—è´¦æœ¬ (per-tenant/per-user) |

### 28.3 Phase B â€” æŠ€èƒ½å›¾è°± (9 è¡¨)

| è¡¨ | æ ¸å¿ƒå­—æ®µ | è¯´æ˜ |
|------|---------|------|
| `expert_domain` | agent_id, domain_name, role(primary/secondary/supportive), confidence_score | ä¸“å®¶é¢†åŸŸæ˜ å°„ |
| `intervention_protocol` | protocol_id, agent_id, name, trigger_conditions(JSONB), exit_conditions(JSONB), steps(JSONB) | å¹²é¢„åè®®æ¨¡æ¿ |
| `risk_boundary` | agent_id, boundary_type, condition_expr(JSONB), auto_exit_action, severity | é£é™©è¾¹ç•Œ (è‡ªåŠ¨é€€å‡ºæ¡ä»¶) |
| `stage_applicability` | agent_id, ttm_stage, effectiveness_score, recommended_intensity, notes | é˜¶æ®µé€‚ç”¨æ€§æ•ˆæœè¯„åˆ† |
| `contraindications` | agent_a, agent_b, severity(warn/block), reason, evidence_ref | ç¦å¿Œç—‡çŸ©é˜µ |
| `evidence_tier_binding` | agent_id, evidence_tier(T1-T5), source_ref, binding_strength | è¯æ®ç­‰çº§ç»‘å®š |
| `agent_skill_graph` | agent_id, skill_vector(JSONB, 9ç»´), last_updated | AgentæŠ€èƒ½å‘é‡ (9ç»´èƒ½åŠ›æŒ‡çº¹) |
| `policy_intervention_outcome` | trace_id, agent_id, ies_score, adherence_index, outcome_label, follow_up_needed | å¹²é¢„æ•ˆæœè¿½è¸ª (IESåˆ†/ä¾ä»æŒ‡æ•°) |
| `policy_stage_transition_log` | user_id, from_stage, to_stage, trigger_agent, confidence, transition_date | é˜¶æ®µè½¬æ¢æ—¥å¿— |

### 28.4 æ ¸å¿ƒæœåŠ¡æ¨¡å— (8 ä¸ª)

| æœåŠ¡ | æ–‡ä»¶ | åŠŸèƒ½ |
|------|------|------|
| ç­–ç•¥å¼•æ“ | `core/policy_engine.py` | Event+UserContextâ†’è§„åˆ™æ±‚å€¼â†’Agenté€‰æ‹©å†³ç­– |
| è§„åˆ™æ³¨å†Œ | `core/rule_registry.py` | JSON-Logicæ±‚å€¼å™¨ + DBåŠ è½½ + çƒ­åˆ·æ–° |
| å†²çªä»²è£ | `core/conflict_resolver.py` | 5ç­–ç•¥: weighted_score / priority_tree / medical_boundary / tenant_override / risk_suppress |
| æˆæœ¬æ§åˆ¶ | `core/cost_controller.py` | é¢„ç®—æ£€æŸ¥ + è¶…é¢é™çº§(downgrade_model) + è´¦æœ¬è®°å½• |
| æ•ˆæœè¿½è¸ª | `core/effectiveness_metrics.py` | IESè¯„åˆ† + ä¾ä»æŒ‡æ•° + ç»“æœæ ‡è®° |
| é˜¶æ®µé€‰æ‹© | `core/stage_aware_selector.py` | TTMé˜¶æ®µâ†’Agenté€‚ç”¨æ€§åŒ¹é… + æ¨èå¼ºåº¦ |
| å†³ç­–è¿½è¸ª | `core/decision_trace.py` | å…¨é“¾è·¯å®¡è®¡æ—¥å¿— (matched_rules/selected_agents/cost/latency) |
| è‡ªåŠ¨é€€å‡º | `core/auto_exit_handler.py` | é£é™©è¾¹ç•Œç›‘æµ‹ + ç¦å¿Œç—‡æ£€æŸ¥ + è‡ªåŠ¨é€€å‡ºè§¦å‘ |

### 28.5 ç­–ç•¥ API (12 ç«¯ç‚¹)

å‰ç¼€: `/api/v1/policy`

| ç«¯ç‚¹ | æ–¹æ³• | æƒé™ | åŠŸèƒ½ |
|------|------|------|------|
| `/rules` | GET | admin | è§„åˆ™åˆ—è¡¨(æ”¯æŒrule_type/is_enabled/tenant_idç­›é€‰) |
| `/rules/{id}` | GET | admin | è§„åˆ™è¯¦æƒ… |
| `/rules` | POST | admin | åˆ›å»ºè§„åˆ™(JSON-Logicæ¡ä»¶+åŠ¨ä½œ) |
| `/rules/{id}` | PUT | admin | æ›´æ–°è§„åˆ™ |
| `/rules/{id}` | DELETE | admin | åˆ é™¤è§„åˆ™(è½¯åˆ é™¤) |
| `/rules/{id}/toggle` | POST | admin | å¯ç”¨/åœç”¨è§„åˆ™ |
| `/simulate` | POST | admin | ç­–ç•¥æ¨¡æ‹Ÿ(è¾“å…¥Event+UserContextâ†’è¿”å›åŒ¹é…è§„åˆ™+Agenté€‰æ‹©) |
| `/traces` | GET | admin | DecisionTraceåˆ—è¡¨(åˆ†é¡µ+æ—¶é—´èŒƒå›´ç­›é€‰) |
| `/traces/{id}` | GET | admin | å†³ç­–è¿½è¸ªè¯¦æƒ…(å«å®Œæ•´matched_rulesé“¾) |
| `/cost-report` | GET | admin | æˆæœ¬æŠ¥å‘Š(æŒ‰tenant/userèšåˆ) |
| `/refresh` | POST | admin | è§„åˆ™çƒ­åˆ·æ–°(æ¸…ç©ºç¼“å­˜+é‡æ–°åŠ è½½) |
| `/seed` | POST | admin | ç§å­è§„åˆ™åˆå§‹åŒ– |

### 28.6 æ•°æ®æµ

```
ç”¨æˆ·æ¶ˆæ¯ â†’ Event æ„å»º
  â†“
PolicyEngine.evaluate(event, user_context, db)
  â†“
RuleRegistry.match(event, context) â†’ åŒ¹é…è§„åˆ™åˆ—è¡¨
  â†“
ConflictResolver.resolve(matched_rules) â†’ å»å†²çª
  â†“
StageAwareSelector.select(agents, context.stage) â†’ é˜¶æ®µé€‚é…
  â†“
CostController.check_budget(tenant, user) â†’ é¢„ç®—æ£€æŸ¥
  â”œâ”€â”€ è¶…é¢ â†’ downgrade_model / rate_limit / block
  â””â”€â”€ æ­£å¸¸ â†’ ç»§ç»­
  â†“
DecisionTrace.log(trace) â†’ å®¡è®¡å…¥åº“
  â†“
è¿”å› PolicyDecision(agents, model, constraints)
  â†’ MasterAgent Step 4 ä½¿ç”¨
```

### 28.7 æ–‡ä»¶æ¸…å•

**æ–°å»º (10 files)**:

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `alembic/versions/028_policy_engine.py` | Migration: ç­–ç•¥å¼•æ“6å¼ è¡¨ |
| `alembic/versions/029_skill_graph.py` | Migration: æŠ€èƒ½å›¾è°±9å¼ è¡¨ |
| `core/policy_engine.py` | ç»Ÿä¸€ç­–ç•¥å†³ç­–å¼•æ“ |
| `core/rule_registry.py` | è§„åˆ™æ³¨å†Œä¸­å¿ƒ |
| `core/conflict_resolver.py` | å†²çªä»²è£å¼•æ“ |
| `core/cost_controller.py` | æˆæœ¬æ§åˆ¶å™¨ |
| `core/effectiveness_metrics.py` | æ•ˆæœè¿½è¸ªæœåŠ¡ |
| `core/stage_aware_selector.py` | é˜¶æ®µæ„ŸçŸ¥é€‰æ‹©å™¨ |
| `core/decision_trace.py` | å†³ç­–è¿½è¸ªæœåŠ¡ |
| `core/auto_exit_handler.py` | è‡ªåŠ¨é€€å‡ºå¤„ç†å™¨ |

**ä¿®æ”¹ (3 files)**:

| æ–‡ä»¶ | å˜æ›´ |
|------|------|
| `core/models.py` | +15ä¸ªORMæ¨¡å‹(PolicyRule/RulePriority/AgentApplicabilityMatrix/ConflictMatrix/DecisionTrace/CostBudgetLedger + 9ä¸ªPhase Bæ¨¡å‹) |
| `api/policy_api.py` | æ–°å»º: 12ä¸ªç­–ç•¥ç®¡ç†ç«¯ç‚¹ |
| `api/main.py` | include_router(policy_router) |

---

## äºŒåä¹ã€å·¥ç¨‹è´¨é‡åŸºç¡€è®¾æ–½ (2026-02-12)

> QA è´¨é‡è¯„ä¼°è¾¾æˆ 121/121 é€šè¿‡ (100%)ï¼Œ87.5/100 æ€»åˆ†ï¼Œ7ç»´åº¦å…¨éƒ¨"ä¼˜ç§€"

### 29.1 è´¨é‡æ¨¡å— (7 ä¸ªæ ¸å¿ƒæœåŠ¡)

| æœåŠ¡ | æ–‡ä»¶ | åŠŸèƒ½ | è´¨é‡ç»´åº¦ |
|------|------|------|---------|
| é˜¶æ®µä¸ªæ€§åŒ– | `core/stage_personalization.py` | TTM 7é˜¶æ®µ(S0-S6)ä¸ªæ€§åŒ–ç­–ç•¥å¼•æ“: stage_configæ˜ å°„â†’æ¨èå†…å®¹/éš¾åº¦/å¹²é¢„ç„¦ç‚¹/æ•™ç»ƒé£æ ¼ | L2-D09 |
| æˆæœ¬å½’å›  | `core/cost_attribution.py` | LLMæˆæœ¬3ç»´å½’å› åˆ†æ: cost_per_user / cost_per_agent / cost_per_tenant / cost_report / cost_breakdown + 6æ¨¡å‹å®šä»· | L2-D13 |
| éšç§è¯„ä¼° | `core/privacy_impact.py` | PIA/DPIAéšç§å½±å“è¯„ä¼°æ¡†æ¶: 8é¡¹æ ‡å‡†æ£€æŸ¥(PIA-01â†’PIA-08) + åˆè§„ç­‰çº§(low/medium/high/critical) | L4-C12 |
| åŒ»ç–—æ ‡å‡† | `core/health_standards.py` | åŒ»ç–—æ•°æ®äº¤æ¢æ ‡å‡†é€‚é…: FHIR R4 Observation/Condition + HL7 v2 ORUè§£æ + ICD-10(12ç ) + SNOMED CT(9æœ¯è¯­) + LOINC(10é¡¹) | L5-S07 |
| APIç½‘å…³ | `core/api_gateway.py` + `configs/api_gateway.yaml` | APIç½‘å…³é…ç½®+nginx_proxyåå‘ä»£ç†ç”Ÿæˆ: è·¯ç”±è§„åˆ™/CORS/JWTé‰´æƒ/é™æµ/æŒ‡æ ‡ | L5-S08 |
| ä¸“å®¶åˆ†æ | `core/expert_analytics.py` | ä¸“å®¶æ•ˆç‡åˆ†æ: expert_efficiencyç»¼åˆåˆ†(4ç»´åŠ æƒ) + advisor_toolä½¿ç”¨æ·±åº¦ + expert_ROIæŠ•èµ„å›æŠ¥ | L7-V09 |
| ä¸­åŒ»èåˆ | `core/tcm_integration.py` | ä¸­è¥¿åŒ»èåˆå¹²é¢„åè®®: 9ç§ä¸­åŒ»ä½“è´¨(å¹³å’Œâ†’ç‰¹ç¦€) Ã— TTMé˜¶æ®µ â†’ constitution_behavior_matrix + IntegratedTCMProtocol | L7-V12 |

### 29.2 CI/CD ç®¡çº¿

#### Makefile (20+ targets)

```makefile
make build          # Docker Compose æ„å»º
make up             # å¯åŠ¨å…¨éƒ¨å®¹å™¨
make down           # åœæ­¢å…¨éƒ¨å®¹å™¨
make test           # è¿è¡Œæµ‹è¯•å¥—ä»¶
make migrate        # Alembic è¿ç§»
make lint           # ä»£ç æ£€æŸ¥
make logs           # æŸ¥çœ‹æ—¥å¿—
make shell          # è¿›å…¥ bhp-api å®¹å™¨
make seed           # åˆå§‹åŒ–ç§å­æ•°æ®
make clean          # æ¸…ç†ç¼“å­˜/ä¸´æ—¶æ–‡ä»¶
make backup         # æ•°æ®åº“å¤‡ä»½
make restore        # æ•°æ®åº“æ¢å¤
...
```

#### GitHub Actions CI (`.github/workflows/ci.yml`)

```yaml
è§¦å‘: push/PR â†’ main/develop
æµç¨‹:
  1. Lint (flake8/mypy)
  2. Test (PostgreSQL pgvector:pg15 + Redis services)
     â†’ alembic upgrade head
     â†’ pytest tests/ -v
  3. Docker Build (bhp-api image)
```

### 29.3 Kubernetes Helm Chart (`helm/bhp/`)

```
helm/bhp/
â”œâ”€â”€ Chart.yaml          # apiVersion: v2, name: bhp, version: 0.7.0, appVersion: V007
â”œâ”€â”€ values.yaml         # replicaCount, image configs, autoscaling, resources
â””â”€â”€ templates/
    â”œâ”€â”€ deployment.yaml # api + admin-portal Deployments (liveness/readiness probes)
    â”œâ”€â”€ service.yaml    # ClusterIP Services (api:8000, admin:5174, h5:5173)
    â”œâ”€â”€ ingress.yaml    # nginx Ingress (path-based: /apiâ†’api, /adminâ†’admin, /â†’h5)
    â””â”€â”€ hpa.yaml        # HorizontalPodAutoscaler (CPU 70% + Memory 80%, 2-10 replicas)
```

### 29.4 ä¾èµ–é”å®š

`requirements.txt` å…¨éƒ¨ 40+ åŒ…ä» `>=` æ”¹ä¸º `==` ç²¾ç¡®ç‰ˆæœ¬ (æ¥æº: `docker exec bhp-api pip freeze`):

```
fastapi==0.128.7
sqlalchemy==2.0.46
openai==2.20.0
pydantic==2.12.5
uvicorn==0.34.0
alembic==1.14.1
...
```

### 29.5 MasterAgent Facade é‡æ„

`core/master_agent.py` ä» 9 è¡Œ shim é‡æ„ä¸ºå®Œæ•´ Facade æ¨¡å¼:

```python
class MasterAgent(_MasterAgentBase):
    """MasterAgent Facade â€” å¸¦æ—¥å¿—ä¸å¼‚å¸¸ä¿æŠ¤çš„ä¸­æ¢ä»£ç†å…¥å£"""
    # 10 ä¸ªæ–¹æ³•, 9 ä¸ª try/except, 21 ä¸ª logger è°ƒç”¨
    def process(self, user_input): ...
    def chat(self, user_id, message): ...
    def process_with_pipeline(self, user_input): ...
    def route_agents(self, ...): ...
    def coordinate(self, ...): ...
    def create_action_plan(self, ...): ...
    def generate_daily_briefing(self, ...): ...
    def sync_device_data(self, ...): ...
    def get_pipeline_orchestrator(self): ...
```

### 29.6 7ç»´åº¦è´¨é‡è¯„ä¼°ç»“æœ

| ç»´åº¦ | æƒé‡ | æ£€æŸ¥é¡¹ | é€šè¿‡ | è¯„åˆ† | ç­‰çº§ |
|------|------|--------|------|------|------|
| L1 å·¥ç¨‹è´¨é‡ | 0.18 | 24 | 24 | 95.4 | ä¼˜ç§€ |
| L2 é¢†åŸŸå®Œæ•´åº¦ | 0.16 | 20 | 20 | 82.5 | ä¼˜ç§€ |
| L3 å¹³å°æ²»ç† | 0.16 | 16 | 16 | 80.0 | ä¼˜ç§€ |
| L4 åˆè§„å®‰å…¨ | 0.14 | 16 | 16 | 85.0 | ä¼˜ç§€ |
| L5 æ¶æ„æ ‡å‡†åŒ– | 0.12 | 15 | 15 | 86.7 | ä¼˜ç§€ |
| L6 è¿ç»´å¯è§‚æµ‹ | 0.14 | 15 | 15 | 83.3 | ä¼˜ç§€ |
| L7 ä»·å€¼äº¤ä»˜ | 0.10 | 15 | 15 | 88.3 | ä¼˜ç§€ |
| **æ€»è®¡** | **1.00** | **121** | **121** | **87.5** | **ä¼˜ç§€** |

---

## ä¸‰åä¸€ã€Behavior Rx è¡Œä¸ºå¤„æ–¹åŸºåº§ (2026-02-13)

> 3 è¡¨ Â· 8 ç«¯ç‚¹ (å…¨éƒ¨å¯ç”¨, 7/8 Auth ä¿æŠ¤) Â· 14 æœåŠ¡æ–‡ä»¶ Â· 4 ä¸“å®¶ Agent Â· 12 ç­–ç•¥æ¨¡æ¿ Â· DI å•ä¾‹æ³¨å…¥ Â· Sync/Async å…¼å®¹ Â· MasterAgent é›†æˆè¡¥ä¸ Â· 10/10 ç«¯ç‚¹éªŒè¯é€šè¿‡

### 31.1 æ¶æ„æ€»è§ˆ

```
BehaviorRx è¡Œä¸ºå¤„æ–¹åŸºåº§
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REST API å±‚ (rx_routes.py, 8 ç«¯ç‚¹, 7/8 require_coach+)          â”‚
â”‚  POST /compute  GET /strategies  GET /agents/status             â”‚
â”‚  GET /user/{id}  POST /handoff  GET /handoff/{id}               â”‚
â”‚  POST /collaborate  GET /{rx_id}                                â”‚
â”‚  DI: set_shared_instances() â† main.py lifespan æ³¨å…¥             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åä½œç¼–æ’å±‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ AgentCollaboration   â”‚  â”‚ ExpertAgentRouter            â”‚   â”‚
â”‚  â”‚ Orchestrator         â”‚  â”‚ (æ³¨å…¥MasterAgent Step 3.5)    â”‚   â”‚
â”‚  â”‚ 6åœºæ™¯è‡ªåŠ¨è¯†åˆ«+è·¯ç”±   â”‚  â”‚ å…³é”®è¯+é¢†åŸŸæ•°æ®+TTMé˜¶æ®µè·¯ç”±  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚             â”‚                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4 ä¸“å®¶ Agent (BaseExpertAgent Template Method)            â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚BehaviorCoachâ”‚ â”‚MetabolicExpertâ”‚ â”‚CardiacExpert      â”‚ â”‚  â”‚
â”‚  â”‚ â”‚S0-S2ä½é˜¶æ®µ  â”‚ â”‚è¡€ç³–/ä»£è°¢/é¥®é£Ÿ â”‚ â”‚å¿ƒè¡€ç®¡/è¿åŠ¨ææƒ§   â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚ â”‚AdherenceExp â”‚ â”‚RxConflict    â”‚ â”‚AgentHandoff        â”‚ â”‚  â”‚
â”‚  â”‚ â”‚æœè¯/å¤æŸ¥ä¾ä» â”‚ â”‚Resolver      â”‚ â”‚Service             â”‚ â”‚  â”‚
â”‚  â”‚ â”‚             â”‚ â”‚å¤„æ–¹å†²çªè§£å†³   â”‚ â”‚6ç§äº¤æ¥åè®®         â”‚ â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å¤„æ–¹å¼•æ“å±‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ BehaviorRxEngine (ä¸‰ç»´å¤„æ–¹è®¡ç®—)                            â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ è¾“å…¥: TTM Stage(S0-S6) Ã— BigFive(O/C/E/A/N, 0-100)       â”‚  â”‚
â”‚  â”‚       Ã— CAPACITY Score(0-1)                                â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ è¾“å‡º: RxPrescription                                       â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ ç›®æ ‡è¡Œä¸º + ä¸»ç­–ç•¥ + è¾…åŠ©ç­–ç•¥                         â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ å¼ºåº¦(minimalâ†’intensive) + èŠ‚å¥ + æ²Ÿé€šé£æ ¼            â”‚  â”‚
â”‚  â”‚   â”œâ”€â”€ å¾®è¡ŒåŠ¨åˆ—è¡¨ + å¥–åŠ±è§¦å‘å™¨                              â”‚  â”‚
â”‚  â”‚   â””â”€â”€ é˜»åŠ›é˜ˆå€¼ + å‡çº§è§„åˆ™                                  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ ç­–ç•¥çŸ©é˜µ: STAGE_STRATEGY_MATRIX (7é˜¶æ®µâ†’12ç­–ç•¥æ˜ å°„)         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ•°æ®å±‚ (3 è¡¨)                                                  â”‚
â”‚  rx_prescriptions Â· rx_strategy_templates Â· agent_handoff_log   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 31.2 æ•°æ®åº“ Schema (3 è¡¨)

| è¡¨ | æ ¸å¿ƒå­—æ®µ | è¯´æ˜ |
|------|---------|------|
| `rx_prescriptions` | id(UUID), user_id, session_id, agent_type, ttm_stage, bigfive_profile(JSONB), capacity_score, goal_behavior, strategy_type, secondary_strategies(JSONB), intensity, pace, communication_style, micro_actions(JSONB), reward_triggers(JSONB), resistance_threshold, escalation_rules(JSONB), domain_context(JSONB), effectiveness_score, adherence_index, outcome_label, is_active, superseded_by, created_at, updated_at | è¡Œä¸ºå¤„æ–¹è®°å½• (22åˆ—, 5ç´¢å¼•) |
| `rx_strategy_templates` | id(UUID), strategy_type, domain, ttm_stage_min/max, name, name_zh, description, core_mechanism, typical_applications(JSONB), default_intensity/pace/micro_actions/reward_triggers/resistance_threshold, personality_modifiers(JSONB), evidence_tier, is_enabled, version, created_at, updated_at | ç­–ç•¥æ¨¡æ¿åº“ (18åˆ—, 2ç´¢å¼•) |
| `agent_handoff_log` | id(UUID), user_id, session_id, from_agent, to_agent, handoff_type, status, rx_context(JSONB), rx_prescription_id, trigger_reason, trigger_data(JSONB), outcome(JSONB), resolution_notes, initiated_at, completed_at, created_at | Agentäº¤æ¥æ—¥å¿— (14åˆ—, 5ç´¢å¼•) |

### 31.3 12 ç§è¡Œä¸ºç­–ç•¥æ¨¡æ¿

| ç­–ç•¥ | è‹±æ–‡ | TTM é˜¶æ®µ | æ ¸å¿ƒæœºåˆ¶ |
|------|------|---------|---------|
| æ„è¯†æå‡ | consciousness_raising | S0-S2 | ä¿¡æ¯æš´éœ²â†’è®¤çŸ¥å¤±è°ƒâ†’è‡ªæˆ‘åæ€ |
| æˆå‰§æ€§è§£è„± | dramatic_relief | S0-S1 | æƒ…æ„Ÿå”¤èµ·â†’ææƒ§/å¸Œæœ›â†’æƒ…ç»ªé©±åŠ¨ |
| è‡ªæˆ‘å†è¯„ä»· | self_reevaluation | S1-S2 | ä»·å€¼è§‚å†²çªâ†’è‡ªæˆ‘å½¢è±¡é‡æ„ |
| å†³ç­–å¹³è¡¡ | decisional_balance | S1-S3 | åˆ©å¼Šåˆ†æâ†’ç†æ€§å†³ç­–â†’æ‰¿è¯º |
| è®¤çŸ¥é‡æ„ | cognitive_restructuring | S1-S4 | è¯†åˆ«æ­ªæ›²è®¤çŸ¥â†’æ›¿ä»£æ€ç»´â†’ä¿¡å¿µæ›´æ–° |
| è‡ªæˆ‘è§£æ”¾ | self_liberation | S2-S3 | å…¬å¼€æ‰¿è¯ºâ†’ç¤¾ä¼šå¥‘çº¦â†’è¡ŒåŠ¨å¯åŠ¨ |
| åˆºæ¿€æ§åˆ¶ | stimulus_control | S3-S5 | ç¯å¢ƒæ”¹é€ â†’çº¿ç´¢ç®¡ç†â†’è‡ªåŠ¨åŒ– |
| å¼ºåŒ–ç®¡ç† | contingency_management | S3-S5 | å³æ—¶åé¦ˆâ†’å¥–åŠ±é˜¶æ¢¯â†’ä¹ æƒ¯å›ºåŒ– |
| ä¹ æƒ¯å †å  | habit_stacking | S3-S5 | é”šå®šè¡Œä¸ºâ†’å¾®è¡Œä¸ºâ†’é“¾å¼ä¹ æƒ¯ |
| ç³»ç»Ÿè„±æ• | systematic_desensitization | S2-S4 | æ¸è¿›æš´éœ²â†’ç„¦è™‘é€’å‡â†’èƒ½åŠ›æ„Ÿæå‡ |
| å¤å‘é¢„é˜² | relapse_prevention | S4-S6 | é«˜é£é™©è¯†åˆ«â†’åº”å¯¹é¢„æ¡ˆâ†’è‡ªæˆ‘ç›‘æ§ |
| è‡ªæˆ‘ç›‘æ§ | self_monitoring | S3-S6 | è¡Œä¸ºè®°å½•â†’æ¨¡å¼å‘ç°â†’è‡ªæˆ‘è°ƒèŠ‚ |

### 31.4 REST API (8 ç«¯ç‚¹)

å‰ç¼€: `/api/v1/rx`

| ç«¯ç‚¹ | æ–¹æ³• | åŠŸèƒ½ | è®¤è¯ | çŠ¶æ€ |
|------|------|------|------|------|
| `/compute` | POST | è®¡ç®—è¡Œä¸ºå¤„æ–¹ (ä¸‰ç»´è¾“å…¥â†’RxPrescription, DBæŒä¹…åŒ–) | coach+ | âœ… å¯ç”¨ |
| `/strategies` | GET | è·å–ç­–ç•¥æ¨¡æ¿åˆ—è¡¨ (æ”¯æŒdomainè¿‡æ»¤) | æ—  | âœ… å¯ç”¨ |
| `/agents/status` | GET | è·å–4ä¸“å®¶Agentæ³¨å†ŒçŠ¶æ€ | coach+ | âœ… å¯ç”¨ |
| `/user/{user_id}` | GET | ç”¨æˆ·å¤„æ–¹å†å² (åˆ†é¡µ+agent_typeè¿‡æ»¤) | coach+ | âœ… å¯ç”¨ |
| `/handoff` | POST | å‘èµ·Agentäº¤æ¥ (DBæŒä¹…åŒ–) | coach+ | âœ… å¯ç”¨ |
| `/handoff/{user_id}` | GET | äº¤æ¥æ—¥å¿—æŸ¥è¯¢ (åˆ†é¡µ) | coach+ | âœ… å¯ç”¨ |
| `/collaborate` | POST | 4-Agentåä½œç¼–æ’æ‰§è¡Œ | coach+ | âœ… å¯ç”¨ |
| `/{rx_id}` | GET | å¤„æ–¹è¯¦æƒ… (UUIDæŸ¥è¯¢, 404å…œåº•) | coach+ | âœ… å¯ç”¨ |

> **coach+** = require_coach_or_admin (è§’è‰² â‰¥ coach/supervisor/promoter/master/admin)

### 31.5 DI æ³¨å…¥ + Auth + DB é›†æˆ

**DI å•ä¾‹æ³¨å…¥** (main.py lifespan â†’ rx_routes.py):
```
lifespan():
  _rx_engine = BehaviorRxEngine()
  _handoff_svc = AgentHandoffService()
  expert_router = setup_expert_agents(rx_engine=_rx_engine, handoff_service=_handoff_svc)
  â†’ set_shared_instances(engine, handoff, orchestrator)
  â†’ 8 ç«¯ç‚¹å…±äº«åŒä¸€ç»„å®ä¾‹ (å« 4 Agent å·²æ³¨å†Œçš„ Orchestrator)
```

**Auth ä¿æŠ¤**: 7/8 ç«¯ç‚¹æ·»åŠ  `require_coach_or_admin` ä¾èµ– (`/strategies` å…¬å¼€)

**DB Session æ³¨å…¥**: `get_db()` ä¾èµ–æ³¨å…¥åˆ°æ‰€æœ‰éœ€ DB çš„ç«¯ç‚¹
- `POST /compute`: `db=db, persist=True` â†’ å¤„æ–¹è‡ªåŠ¨æŒä¹…åŒ–
- `POST /handoff`: `db=db` â†’ äº¤æ¥æ—¥å¿—è‡ªåŠ¨æŒä¹…åŒ–
- `GET /user/{id}`, `GET /handoff/{id}`, `GET /{rx_id}`: çœŸå® ORM æŸ¥è¯¢ + åˆ†é¡µ

**Sync/Async å…¼å®¹å±‚**: `_persist_rx()` / `_persist_handoff()` è‡ªåŠ¨æ£€æµ‹ `db.flush()` æ˜¯å¦å¼‚æ­¥:
```python
if asyncio.iscoroutinefunction(db.flush):
    await db.flush()
else:
    db.flush()
```

### 31.6 MasterAgent é›†æˆ

**patch_master_agent_v0()** åœ¨ MasterAgent.process() ä¸­æ³¨å…¥ Step 3.5:

```
ExpertAgentRouter.should_route_to_expert(user_input, user_profile)
  â”‚
  â”œâ”€â”€ 1. æ–‡æœ¬å…³é”®è¯åŒ¹é… (_domain_keywords: 4 Agent Ã— 5-12 å…³é”®è¯)
  â”œâ”€â”€ 2. é¢†åŸŸæ•°æ®é”®åŒ¹é… (_domain_data_keys: glucose/hba1c/cardiac_event ç­‰)
  â””â”€â”€ 3. ä½é˜¶æ®µç”¨æˆ·å…œåº• (TTM â‰¤ S2 â†’ BehaviorCoach)
  â”‚
  â”œâ”€â”€ å‘½ä¸­ â†’ CollaborationOrchestrator.orchestrate() â†’ åˆå¹¶å¤„æ–¹ â†’ ç›´æ¥è¿”å›
  â”‚          (å¼‚æ­¥â†’åŒæ­¥æ¡¥æ¥: ThreadPoolExecutor + asyncio.run)
  â””â”€â”€ æœªå‘½ä¸­ â†’ ç»§ç»­åŸå§‹ 12 Agent æµç¨‹ (å®Œå…¨ä¸å½±å“)
```

**é™çº§ä¿æŠ¤**: behavior_rx åŠ è½½å¤±è´¥æ—¶, MasterAgent 100% å›é€€åˆ°åŸå§‹ 12-Agent è¡Œä¸ºã€‚

### 31.7 æ–‡ä»¶æ¸…å• (14 ä¸ª .py + 1 JSON + 1 Migration)

| æ–‡ä»¶ | ç”¨é€” |
|------|------|
| `behavior_rx/__init__.py` | åŒ…åˆå§‹åŒ– |
| `behavior_rx/rx_models.py` | 3 ORMæ¨¡å‹ + 6 æšä¸¾ |
| `behavior_rx/rx_schemas.py` | Pydantic DTO (RxPrescriptionDTO/RxContext/BigFiveProfileç­‰) |
| `behavior_rx/behavior_rx_engine.py` | ä¸‰ç»´å¤„æ–¹è®¡ç®—å¼•æ“ + STAGE_STRATEGY_MATRIX |
| `behavior_rx/base_expert_agent.py` | ä¸“å®¶AgentåŸºç±» (Template Method) |
| `behavior_rx/behavior_coach_agent.py` | è¡Œä¸ºæ•™ç»ƒAgent (S0-S2) |
| `behavior_rx/metabolic_expert_agent.py` | ä»£è°¢ä¸“å®¶Agent |
| `behavior_rx/cardiac_expert_agent.py` | å¿ƒè„åº·å¤ä¸“å®¶Agent |
| `behavior_rx/adherence_expert_agent.py` | ä¾ä»æ€§ä¸“å®¶Agent |
| `behavior_rx/agent_handoff_service.py` | Agentäº¤æ¥æœåŠ¡ (6ç§äº¤æ¥ç±»å‹) |
| `behavior_rx/agent_collaboration_orchestrator.py` | å¤šAgentåä½œç¼–æ’å™¨ (6åœºæ™¯) |
| `behavior_rx/rx_conflict_resolver.py` | å¤„æ–¹å†²çªè§£å†³å™¨ |
| `behavior_rx/master_agent_integration.py` | MasterAgenté›†æˆè¡¥ä¸ (ExpertAgentRouter + patch) |
| `behavior_rx/rx_routes.py` | REST APIè·¯ç”± (8ç«¯ç‚¹) |
| `configs/rx_strategies.json` | 12ç§ç­–ç•¥æ¨¡æ¿ç§å­æ•°æ® |
| `alembic/versions/030_behavior_rx_foundation.py` | Migration: 3å¼ è¡¨ + 15ç´¢å¼• |

### 31.8 Rx UI å‰ç«¯æ¨¡å— (admin-portal/src/modules/rx/)

> 15 æ–‡ä»¶ Â· 7 ç»„ä»¶ Â· 6 è·¯ç”± Â· 1 Pinia Store Â· 8 API æ–¹æ³• Â· 4 Composable

**ç›®å½•ç»“æ„**:
```
modules/rx/
â”œâ”€â”€ index.ts                           â€” æ¨¡å—å…¥å£ (re-export all)
â”œâ”€â”€ types/rx.ts                        â€” TypeScript ç±»å‹ (6æšä¸¾+16æ¥å£+4è¾…åŠ©å¸¸é‡)
â”œâ”€â”€ api/rxApi.ts                       â€” APIå±‚ (8ç«¯ç‚¹+å†…å­˜ç¼“å­˜+admin_tokenæ³¨å…¥)
â”œâ”€â”€ stores/rxStore.ts                  â€” Pinia Store (7 actions, 5 computed)
â”œâ”€â”€ composables/useRx.ts              â€” ç»„åˆé€»è¾‘ (è½®è¯¢/æ„å»ºå™¨/æ ¼å¼åŒ–/åˆ†é¡µ)
â”œâ”€â”€ components/rx/
â”‚   â”œâ”€â”€ index.ts                       â€” 7ç»„ä»¶å¯¼å‡º
â”‚   â”œâ”€â”€ BigFiveRadar.vue               â€” äº”å› å­äººæ ¼é›·è¾¾å›¾ (Canvasç»˜åˆ¶)
â”‚   â”œâ”€â”€ TTMProgressBar.vue             â€” TTMé˜¶æ®µè¿›åº¦æ¡ (7èŠ‚ç‚¹+å°±ç»ªåº¦/ç¨³å®šåº¦)
â”‚   â”œâ”€â”€ RxPrescriptionCard.vue         â€” å¤„æ–¹å¡ç‰‡ (å¯å±•å¼€: ç­–ç•¥/å¾®è¡ŒåŠ¨/ç¦å¿Œ/åä½œAgent)
â”‚   â”œâ”€â”€ RxComputeForm.vue              â€” ä¸‰ç»´ä¸Šä¸‹æ–‡è®¡ç®—è¡¨å• (TTMÃ—BigFiveÃ—CAPACITY)
â”‚   â”œâ”€â”€ AgentStatusPanel.vue           â€” 4-AgentçŠ¶æ€ç›‘æ§é¢æ¿ (å¡ç‰‡ç½‘æ ¼+å…¨å±€ç»Ÿè®¡)
â”‚   â”œâ”€â”€ HandoffLogTable.vue            â€” äº¤æ¥æ—¥å¿—è¡¨æ ¼ (æ¥æºâ†’ç›®æ ‡+ç±»å‹+çŠ¶æ€+ä¼˜å…ˆçº§)
â”‚   â””â”€â”€ StrategyGrid.vue               â€” 12ç­–ç•¥æ¨¡æ¿å¡ç‰‡ç½‘æ ¼ (é˜¶æ®µè¿‡æ»¤+äººæ ¼äº²å’Œ)
â”œâ”€â”€ views/RxDashboard.vue              â€” ç»¼åˆä»ªè¡¨ç›˜ (6 Tab: å½“å‰å¤„æ–¹/å†å²/Agenté›†ç¾¤/äº¤æ¥/ç­–ç•¥/åä½œ)
â””â”€â”€ router/rx-routes.ts                â€” è·¯ç”±(6æ¡)+æƒé™å®ˆå«+èœå•é…ç½®
```

**é›†æˆç‚¹**:
- `router.ts`: `import { rxRoutes }` â†’ `...rxRoutes` å±•å¼€ä¸º AdminLayout children
- `AdminLayout.vue`: ä¾§è¾¹æ  `v-if="isCoach"` ä¸‹ "è¡Œä¸ºå¤„æ–¹" å­èœå• (MedicineBoxOutlined)
- `rxApi.ts`: `admin_token` + `VITE_API_BASE_URL` + Vite proxy `/api` â†’ localhost:8000

**é€‚é…ä¿®å¤** (4å¤„):
1. token key: `access_token` â†’ `admin_token` (åŒ¹é… admin portal auth store)
2. RxDashboard.vue å¯¼å…¥è·¯å¾„: `../../` â†’ `../` (views/ åªæœ‰1å±‚æ·±åº¦)
3. rx-routes.ts è·¯å¾„: `/rx` â†’ `rx` (ä½œä¸º AdminLayout å­è·¯ç”±, æ— å‰å¯¼æ–œæ )
4. **å­—æ®µåå¯¹é½**: `types/rx.ts` + `stores/rxStore.ts` â€” åç«¯ `RxListResponse.items` / `HandoffListResponse.items`,å‰ç«¯åŸå…ˆç”¨ `prescriptions` / `handoffs` å¯¼è‡´ undefined â†’ ç»Ÿä¸€æ”¹ä¸º `items`

---

## ä¸‰åäºŒã€ç‰ˆæœ¬å˜æ›´æ—¥å¿—

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´æ‘˜è¦ |
|------|------|---------|
| v30 | 2026-02-12 | V006 å…«çˆªé±¼Agent-Expertæ¶æ„ (5é˜¶æ®µå…¨éƒ¨å®Œæˆ) |
| v31 | 2026-02-12 18:00 | V007 ç­–ç•¥å¼•æ“(15è¡¨/12ç«¯ç‚¹/8æ ¸å¿ƒæœåŠ¡) + å·¥ç¨‹è´¨é‡åŸºç¡€è®¾æ–½(7è´¨é‡æ¨¡å—/CI-CD/Helm/ä¾èµ–é”å®š/MasterAgent Facade) + è¿ç§»027-029 + æ¨¡å‹82â†’116 + æœåŠ¡72â†’125 + ç«¯ç‚¹485â†’497+ + Adminé¡µé¢94â†’126 |
| v32 | 2026-02-13 10:00 | Behavior Rxè¡Œä¸ºå¤„æ–¹åŸºåº§: 3è¡¨ + 8ç«¯ç‚¹(7/8 require_coach+, å…¨éƒ¨DBæŒä¹…åŒ–) + 14æœåŠ¡æ–‡ä»¶ + 4ä¸“å®¶Agent + 12ç­–ç•¥æ¨¡æ¿ + MasterAgentè¡¥ä¸ + DIå•ä¾‹æ³¨å…¥ + Sync/Asyncå…¼å®¹å±‚ + è¿ç§»030 + æ¨¡å‹116â†’119 + æœåŠ¡125â†’139 + ç«¯ç‚¹497â†’505+ Â· 10/10ç«¯ç‚¹éªŒè¯é€šè¿‡ |
| v33 | 2026-02-13 17:00 | Rx UI å‰ç«¯æ¨¡å—: 15æ–‡ä»¶(admin-portal/src/modules/rx/) + 7ç»„ä»¶ + RxDashboardç»¼åˆä»ªè¡¨ç›˜(6Tab) + 6è·¯ç”±(/rx/*) + 1 Pinia Store + 8 APIæ–¹æ³• + 4 Composable + AdminLayoutèœå•é›†æˆ + é€‚é…ä¿®å¤Ã—3 + Adminé¡µé¢126â†’127 Â· 41/41å‰åç«¯è”è°ƒéªŒè¯é€šè¿‡ |
| v34 | 2026-02-13 01:20 | Rx UI å­—æ®µåä¿®å¤: RxListResponse.prescriptionsâ†’items + HandoffListResponse.handoffsâ†’items + rxStoreå¯¹åº”è®¿é—®ä¿®å¤ Â· é€‚é…ä¿®å¤3â†’4å¤„ Â· é‡æ–°æ„å»º+éƒ¨ç½²+ç«¯åˆ°ç«¯éªŒè¯é€šè¿‡ |
| v35 | 2026-02-13 01:30 | å…¨é¢è‡ªæ£€(59/60): Rx API 7/8ç«¯ç‚¹PASS(GET/{rx_id}å› DBè¡¨ç¼ºå¤±404) + å‰ç«¯æºç å®¡è®¡18/18 PASS + å‰ç«¯ä»£ç†+SPAè·¯ç”±18/18 PASS + ç³»ç»Ÿå›å½’16/16 PASS + Docker 4/4 healthy Â· è®°å½•å¾…ä¿®å¤: Rx DB 3è¡¨ç¼ºå¤± |
| v36 | 2026-02-13 03:30 | Rx DB 3è¡¨ä¿®å¤å®Œæˆ: 3è¡¨ç›´æ¥SQLå»ºè¡¨ + 12ç­–ç•¥æ¨¡æ¿ç§å­ + _persist_rx()æ·»åŠ db.commit() Â· 8/8 Rxç«¯ç‚¹PASS Â· DBéªŒè¯: 9å¤„æ–¹+2äº¤æ¥+12æ¨¡æ¿ |
| **v37** | **2026-02-13 04:10** | **Phase 1 Agentæ¨¡æ¿åŒ– éªŒè¯å®Œæˆ: å·²æœ‰å®ç°å®¡è®¡(8æ–‡ä»¶å…¨éƒ¨å®Œå¤‡) + main.py get_master_agent()ä¿®å¤(åˆ†ç¦»v0/v6åŒMasterAgent: v0ç”¨äºorchestrator 9æ­¥pipeline, v6 AgentMasterä»DBæ¨¡æ¿åŠ è½½12ä¸ªAgent) + lifespanç¼“å­˜é¢„çƒ­é“¾è·¯æ‰“é€š(æ¨¡æ¿â†’v6 AgentMasterâ†’BehaviorRxè¡¥ä¸) + admin-portalé‡æ–°æ„å»ºéƒ¨ç½² Â· 10/10 Agentæ¨¡æ¿CRUD APIå…¨PASS(list/presets/domains/detail/create/update/delete/toggle/clone/refresh-cache) + E2Eå…¨é“¾è·¯éªŒè¯(åˆ›å»ºâ†’åˆ·æ–°â†’è¯¦æƒ…â†’å¼€å…³â†’å…‹éš†â†’åˆ é™¤â†’é¢„ç½®ä¿æŠ¤â†’è®¡æ•°) + 3 SPAè·¯ç”±200 + ç³»ç»Ÿå›å½’7/9 PASS(2ä¸ªpre-existing 404)** |

# ============================================
# Patient App (:5176) → H5 (:5173) 永久重定向
# P0-2 路由合并配置 (2026-02-17)
#
# 用途: 替换 Patient App 的 SPA nginx 配置
#       确保所有旧链接/书签跳转到 H5 等价页面
# 移除时间: 2026-04-01 (Patient App 完全下线后)
# ============================================

server {
    listen 80;
    server_name _;

    # ── 精确路径映射 ──
    location = /login       { return 301 $scheme://$host:5173/login; }
    location = /register    { return 301 $scheme://$host:5173/register; }
    location = /data-input  { return 301 $scheme://$host:5173/health-records; }
    location = /history     { return 301 $scheme://$host:5173/history-reports; }
    location = /analysis    { return 301 $scheme://$host:5173/dashboard; }
    location = /health-data { return 301 $scheme://$host:5173/dashboard; }
    location = /settings    { return 301 $scheme://$host:5173/account-settings; }
    location = /chat        { return 301 $scheme://$host:5173/chat; }

    # ── 动态路径: /result/:id → /v3/assessment/:id ──
    location ~ ^/result/(.+)$ {
        return 301 $scheme://$host:5173/v3/assessment/$1;
    }

    # ── 默认: 同路径跳转到 H5 首页 ──
    location / {
        return 301 $scheme://$host:5173/;
    }
}

# H5患者应用 - 快速启动指南

> 创建时间：2026-01-28
> 状态：✅ 全部代码已完成

---

## 📦 已创建文件清单（24个）

### ✅ 配置文件（5个）
- [x] `vite.config.ts` - Vite配置（含Vant自动导入）
- [x] `tsconfig.json` - TypeScript配置
- [x] `tsconfig.node.json` - Node TypeScript配置
- [x] `index.html` - HTML入口
- [x] `.env` - 环境变量

### ✅ 核心文件（3个）
- [x] `src/main.ts` - 应用入口
- [x] `src/App.vue` - 根组件
- [x] `src/style.css` - 全局样式

### ✅ 路由配置（1个）
- [x] `src/router/index.ts` - Vue Router配置（含路由守卫）

### ✅ 状态管理（2个）
- [x] `src/stores/user.ts` - 用户Store（登录、注册、登出）
- [x] `src/stores/assessment.ts` - 评估Store（提交、查询）

### ✅ API封装（3个）
- [x] `src/api/request.ts` - Axios封装（拦截器、错误处理）
- [x] `src/api/auth.ts` - 认证API
- [x] `src/api/assessment.ts` - 评估API

### ✅ 类型定义和工具（2个）
- [x] `src/types/index.ts` - TypeScript类型定义
- [x] `src/utils/storage.ts` - 本地存储封装

### ✅ 页面组件（5个）
- [x] `src/views/LoginPage.vue` - 登录页
- [x] `src/views/RegisterPage.vue` - 注册页
- [x] `src/views/HomePage.vue` - 首页
- [x] `src/views/DataInputPage.vue` - 数据录入页
- [x] `src/views/ResultPage.vue` - 评估结果页

### ✅ 通用组件（3个）
- [x] `src/components/DataInputForm.vue` - 数据输入表单
- [x] `src/components/RiskCard.vue` - 风险卡片
- [x] `src/components/TriggerList.vue` - Trigger列表

---

## 🚀 快速启动（3步）

### Step 1: 安装依赖

```bash
cd h5-patient-app
npm install
```

**预期输出：**
```
added 200+ packages in 30s
```

### Step 2: 启动后端API（另一个终端）

```bash
# 返回项目根目录
cd ..

# 确保数据库已初始化
python __main__.py db stats

# 如果没有数据，初始化数据库
# echo y | python __main__.py db init --drop --sample-data

# 启动API服务器
python __main__.py serve --reload
```

**预期输出：**
```
[START] 行为健康平台 - 启动中...
INFO:     Uvicorn running on http://127.0.0.1:8000
[API] 认证路由已注册
```

### Step 3: 启动前端开发服务器

```bash
# 在h5-patient-app目录
npm run dev
```

**预期输出：**
```
VITE v6.0.0  ready in 500 ms

➜  Local:   http://localhost:5173/
➜  Network: use --host to expose
```

---

## 🌐 访问应用

### 浏览器访问

```
http://localhost:5173
```

### 测试账号

**患者账号：**
- 用户名：`patient_alice`
- 密码：`password123`

**教练账号：**
- 用户名：`coach_carol`
- 密码：`coach123`

**管理员账号：**
- 用户名：`admin`
- 密码：`admin123456`

---

## 🧪 功能测试清单

### 1. 用户认证测试

#### 测试登录
```
1. 打开 http://localhost:5173
2. 应该看到登录页面
3. 输入用户名：patient_alice
4. 输入密码：password123
5. 点击"登录"
6. 应该跳转到首页
```

#### 测试注册
```
1. 在登录页点击"还没有账号？立即注册"
2. 填写注册表单
   - 用户名：test_user_001
   - 邮箱：test@example.com
   - 姓名：测试用户
   - 密码：password123
   - 确认密码：password123
3. 点击"立即注册"
4. 应该自动登录并跳转到首页
```

### 2. 首页功能测试

#### 查看用户信息
```
✓ 应该显示用户名
✓ 应该显示用户ID和角色
✓ 应该显示邮箱标签
```

#### 快捷操作
```
✓ 点击"数据录入"应该跳转到录入页
✓ 其他按钮显示"Beta"或"Coming"标签
```

#### 最近评估列表
```
✓ 如果有历史评估，显示最近5条
✓ 点击评估记录应该跳转到结果页
✓ 如果没有评估，显示空状态
```

### 3. 数据录入测试

#### 填写心情日记
```
1. 点击"数据录入"
2. 在"心情日记"框中输入文本
   例如：今天工作压力很大，感觉很疲惫
3. 验证字数限制（500字）
```

#### 添加血糖值
```
1. 在血糖值输入框输入：6.5
2. 点击"添加"
3. 应该在下方看到标签"6.5 mmol/L"
4. 再添加几个值：7.2, 11.5, 13.2
5. 点击标签的X可以删除
```

#### 添加HRV值
```
1. 在HRV输入框输入：65
2. 点击"添加"
3. 应该在下方看到标签"65 ms"
4. 再添加几个值：68, 62, 60
5. 点击标签的X可以删除
```

#### 提交评估
```
1. 点击"提交评估"
2. 弹出确认对话框
3. 点击"确定"
4. 显示加载状态"提交中..."
5. 提交成功后自动跳转到结果页
```

### 4. 评估结果测试

#### 查看风险评估
```
✓ 应该显示风险等级徽章（R0-R4）
✓ 应该显示风险分数
✓ 应该显示主要关注
✓ 应该显示紧急程度
✓ 应该显示评估时间
```

#### 查看识别的风险信号
```
✓ 应该显示Trigger列表
✓ 每个Trigger显示名称、严重程度、置信度
✓ 严重程度用不同颜色的标签
```

#### 查看专业建议
```
✓ 应该显示主要Agent
✓ 应该显示辅助Agent
✓ 应该显示优先级
✓ 应该显示建议响应时间
```

#### 查看推荐行动
```
✓ 应该显示编号的行动列表
✓ 每条行动清晰易懂
```

#### 操作按钮
```
✓ 点击"继续评估"应该跳转到数据录入页
✓ 点击"返回首页"应该跳转到首页
```

### 5. 登出测试

```
1. 在首页点击右上角"退出"
2. 弹出确认对话框
3. 点击"确定"
4. 应该显示"已退出登录"提示
5. 应该跳转到登录页
6. 刷新页面应该仍在登录页
```

### 6. 路由守卫测试

#### 未登录访问受保护路由
```
1. 确保已登出
2. 在浏览器直接访问：http://localhost:5173/data-input
3. 应该提示"请先登录"
4. 应该跳转到登录页
5. URL应该包含 ?redirect=/data-input
6. 登录后应该自动跳转回 /data-input
```

#### 已登录访问登录页
```
1. 确保已登录
2. 在浏览器访问：http://localhost:5173/login
3. 应该自动跳转到首页
```

---

## 🎨 界面预览

### 登录页
```
┌─────────────────────────────┐
│      用户登录                │
├─────────────────────────────┤
│                             │
│         🏥                  │
│     行为健康平台             │
│   您的健康管理助手           │
│                             │
│  ┌───────────────────────┐ │
│  │ 用户名: [输入框]       │ │
│  ├───────────────────────┤ │
│  │ 密码:   [输入框]       │ │
│  └───────────────────────┘ │
│                             │
│  [      登录      ]         │
│  [  还没有账号？立即注册  ]  │
│                             │
│  测试账号:                  │
│  patient_alice / password123│
└─────────────────────────────┘
```

### 首页
```
┌─────────────────────────────┐
│  行为健康            退出    │
├─────────────────────────────┤
│  Alice Wang                 │
│  用户ID: 2 | 角色: patient   │
│  alice@example.com          │
├─────────────────────────────┤
│  快捷操作                    │
│  ┌─────┬─────┐┌─────┬─────┐│
│  │数据 │历史 ││数据 │个人 ││
│  │录入 │记录 ││分析 │设置 ││
│  └─────┴─────┘└─────┴─────┘│
├─────────────────────────────┤
│  最近评估                    │
│  > 2小时前  轻度风险  45.0  │
│  > 1天前    正常      12.0  │
└─────────────────────────────┘
```

### 数据录入页
```
┌─────────────────────────────┐
│  ← 数据录入                  │
├─────────────────────────────┤
│  心情日记                    │
│  ┌───────────────────────┐ │
│  │ 今天工作压力很大...     │ │
│  │                        │ │
│  └───────────────────────┘ │
├─────────────────────────────┤
│  血糖值 (mmol/L)             │
│  [6.5] [添加]               │
│  [6.5 mmol/L ×] [7.2 ×]     │
├─────────────────────────────┤
│  心率变异性 (HRV)            │
│  [65] [添加]                │
│  [65 ms ×] [68 ms ×]        │
├─────────────────────────────┤
│  [    提交评估    ]          │
└─────────────────────────────┘
```

### 评估结果页
```
┌─────────────────────────────┐
│  ← 评估结果                  │
├─────────────────────────────┤
│  风险评估                    │
│  [轻度风险]      45.0        │
│                风险分数      │
│  主要关注: 血糖控制          │
│  紧急程度: medium            │
├─────────────────────────────┤
│  识别的风险信号              │
│  > 血糖偏高                  │
│    [high] 置信度: 95%       │
│  > 压力水平高                │
│    [moderate] 置信度: 78%   │
├─────────────────────────────┤
│  专业建议                    │
│  主要Agent: GlucoseAgent     │
│  优先级: P2                  │
├─────────────────────────────┤
│  推荐行动                    │
│  1. 监测血糖水平             │
│  2. 咨询营养师               │
├─────────────────────────────┤
│  [    继续评估    ]          │
│  [    返回首页    ]          │
└─────────────────────────────┘
```

---

## 🔧 开发命令

```bash
# 安装依赖
npm install

# 启动开发服务器（热重载）
npm run dev

# 构建生产版本
npm run build

# 预览生产构建
npm run preview

# 代码检查
npm run lint
```

---

## 📱 移动端测试

### 使用Chrome DevTools

```
1. 在Chrome中打开 http://localhost:5173
2. 按F12打开开发者工具
3. 点击设备模拟图标（或按Ctrl+Shift+M）
4. 选择设备：iPhone 12 Pro 或 Pixel 5
5. 刷新页面测试
```

### 局域网访问

```bash
# 启动时添加 --host
npm run dev -- --host

# 会显示：
# ➜  Local:   http://localhost:5173/
# ➜  Network: http://192.168.1.100:5173/

# 在手机浏览器访问 Network 地址
```

---

## 🐛 常见问题

### 问题1：npm install失败

**症状：** 依赖安装失败

**解决方案：**
```bash
# 清除npm缓存
npm cache clean --force

# 删除node_modules和package-lock.json
rm -rf node_modules package-lock.json

# 重新安装
npm install
```

### 问题2：Vite启动失败

**症状：** EADDRINUSE: address already in use

**解决方案：**
```bash
# 端口被占用，修改端口
npm run dev -- --port 5174
```

### 问题3：API请求失败

**症状：** Network Error 或 404

**解决方案：**
```bash
# 1. 确保后端API正在运行
python __main__.py serve

# 2. 检查.env中的API地址
cat .env
# VITE_API_BASE_URL=http://localhost:8000

# 3. 检查浏览器控制台Network标签
```

### 问题4：登录后立即退出

**症状：** 登录成功但马上又回到登录页

**解决方案：**
```bash
# 1. 打开浏览器控制台查看错误
# 2. 检查Token是否保存成功
localStorage.getItem('behavioral_health_access_token')

# 3. 检查API返回的Token格式
# 4. 清除浏览器存储重试
localStorage.clear()
```

### 问题5：TypeScript错误

**症状：** 编译时出现类型错误

**解决方案：**
```bash
# 1. 确保类型定义正确
cat src/types/index.ts

# 2. 重启TypeScript服务器（VSCode）
# Ctrl+Shift+P -> TypeScript: Restart TS Server

# 3. 重新安装依赖
npm install
```

---

## 📊 技术栈

| 类别 | 技术 | 版本 |
|------|------|------|
| **框架** | Vue 3 | 3.5.0+ |
| **语言** | TypeScript | 5.6.0+ |
| **构建** | Vite | 6.0.0+ |
| **UI库** | Vant | 4.9.0+ |
| **路由** | Vue Router | 4.4.0+ |
| **状态** | Pinia | 3.0.0+ |
| **HTTP** | Axios | 1.7.0+ |

---

## 🎯 下一步

### 已完成 ✅
- [x] 项目配置和构建设置
- [x] 认证系统（登录、注册、登出）
- [x] 首页和用户信息展示
- [x] 数据录入功能
- [x] 评估结果展示
- [x] 路由守卫和权限控制
- [x] API集成和错误处理
- [x] 本地存储管理

### 可选优化 📋
- [ ] 添加历史记录列表页
- [ ] 添加数据分析图表
- [ ] 添加个人设置页面
- [ ] 优化加载动画
- [ ] 添加骨架屏
- [ ] 添加下拉刷新
- [ ] 添加图片上传
- [ ] 添加语音输入
- [ ] PWA支持（离线访问）

### 部署准备 🚀
- [ ] 环境变量配置
- [ ] 生产构建优化
- [ ] CDN资源配置
- [ ] Nginx配置
- [ ] HTTPS配置

---

## 📞 支持

如果遇到问题：

1. 查看浏览器控制台错误
2. 查看Network标签检查API请求
3. 检查后端服务是否运行
4. 查看本文档的"常见问题"部分

---

**创建时间：** 2026-01-28
**版本：** 1.0.0
**状态：** ✅ 可立即使用

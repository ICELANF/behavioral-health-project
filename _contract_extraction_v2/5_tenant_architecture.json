{
  "tenant_models": [
    {
      "schema_name": "TenantUpdateRequest",
      "base_classes": [
        "BaseModel"
      ],
      "file": "api/tenant_api.py",
      "line": 28,
      "docstring": "",
      "fields": [
        {
          "name": "brand_name",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "brand_tagline",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "brand_avatar",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "brand_logo_url",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "brand_colors",
          "type": "Optional[dict]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "brand_theme_id",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "expert_title",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "expert_self_intro",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "expert_specialties",
          "type": "Optional[list]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "expert_credentials",
          "type": "Optional[list]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "enabled_agents",
          "type": "Optional[list]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "agent_persona_overrides",
          "type": "Optional[dict]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "service_packages",
          "type": "Optional[list]",
          "has_default": true,
          "default": null,
          "required": false
        },
        {
          "name": "welcome_message",
          "type": "Optional[str]",
          "has_default": true,
          "default": null,
          "required": false
        }
      ],
      "config": {},
      "field_count": 14
    },
    {
      "model_name": "ExpertTenant",
      "table_name": "expert_tenants",
      "has_explicit_tablename": true,
      "base_classes": [
        "Base"
      ],
      "file": "core/models.py",
      "line": 2361,
      "docstring": "æ¯ä¸ªå…¥é©»ä¸“å®¶ = ä¸€ä¸ªç§Ÿæˆ·\nä¸€ä¸ªä¸“å®¶å¯¹åº”ä¸€å¥—ç‹¬ç«‹å“ç‰Œã€Agenté…ç½®ã€å®¢æˆ·ç¾¤",
      "columns": [
        {
          "kind": "column",
          "name": "id",
          "type": "String(64)",
          "nullable": true,
          "primary_key": true,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "ç§Ÿæˆ·ID, å¦‚ dr-chen-endo"
        },
        {
          "kind": "column",
          "name": "expert_user_id",
          "type": "Integer",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": "users.id",
          "comment": "ä¸“å®¶åœ¨å¹³å°çš„ç”¨æˆ·ID"
        },
        {
          "kind": "column",
          "name": "brand_name",
          "type": "String(128)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "å·¥ä½œå®¤åç§°"
        },
        {
          "kind": "column",
          "name": "brand_tagline",
          "type": "String(256)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "å“ç‰Œæ ‡è¯­"
        },
        {
          "kind": "column",
          "name": "brand_avatar",
          "type": "String(16)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "ğŸ¥",
          "server_default": null,
          "foreign_key": null,
          "comment": "Emojiå¤´åƒ"
        },
        {
          "kind": "column",
          "name": "brand_logo_url",
          "type": "String(512)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "Logoå›¾ç‰‡URL"
        },
        {
          "kind": "column",
          "name": "brand_colors",
          "type": "JSON",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": null,
          "foreign_key": null,
          "comment": "{\"primary\":\"#hex\",\"accent\":\"#hex\",\"bg\":\"#hex\"}"
        },
        {
          "kind": "column",
          "name": "brand_theme_id",
          "type": "String(32)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "default",
          "server_default": null,
          "foreign_key": null,
          "comment": "ä¸»é¢˜æ¨¡æ¿ID"
        },
        {
          "kind": "column",
          "name": "custom_domain",
          "type": "String(256)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "è‡ªå®šä¹‰åŸŸå"
        },
        {
          "kind": "column",
          "name": "expert_title",
          "type": "String(64)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "ä¸“å®¶å¤´è¡”"
        },
        {
          "kind": "column",
          "name": "expert_self_intro",
          "type": "Text",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "ä¸“å®¶è‡ªæˆ‘ä»‹ç»"
        },
        {
          "kind": "column",
          "name": "expert_specialties",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": null,
          "foreign_key": null,
          "comment": "[\"å†…åˆ†æ³Œ\",\"ä»£è°¢ç®¡ç†\"]"
        },
        {
          "kind": "column",
          "name": "expert_credentials",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": null,
          "foreign_key": null,
          "comment": "[\"ä¸»ä»»åŒ»å¸ˆ\",\"åšå£«ç”Ÿå¯¼å¸ˆ\"]"
        },
        {
          "kind": "column",
          "name": "enabled_agents",
          "type": "JSON",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": null,
          "foreign_key": null,
          "comment": "å¯ç”¨çš„Agent IDåˆ—è¡¨"
        },
        {
          "kind": "column",
          "name": "agent_persona_overrides",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": null,
          "foreign_key": null,
          "comment": "Agentè¯æœ¯è¦†ç›–"
        },
        {
          "kind": "column",
          "name": "routing_correlations",
          "type": "JSON",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": "{}",
          "foreign_key": null,
          "comment": "ä¸“å®¶è‡ªå®šä¹‰å…³è”ç½‘ç»œ {\"sleep\":[\"glucose\",\"stress\"]}"
        },
        {
          "kind": "column",
          "name": "routing_conflicts",
          "type": "JSON",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": "{}",
          "foreign_key": null,
          "comment": "ä¸“å®¶è‡ªå®šä¹‰å†²çªè§„åˆ™ {\"sleep|exercise\":\"sleep\"}"
        },
        {
          "kind": "column",
          "name": "default_fallback_agent",
          "type": "String(32)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "behavior_rx",
          "server_default": "behavior_rx",
          "foreign_key": null,
          "comment": "é»˜è®¤å›é€€Agent"
        },
        {
          "kind": "column",
          "name": "enabled_paths",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": null,
          "foreign_key": null,
          "comment": "å¯ç”¨çš„å­¦ä¹ è·¯å¾„ID"
        },
        {
          "kind": "column",
          "name": "service_packages",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": null,
          "foreign_key": null,
          "comment": "æœåŠ¡åŒ…é…ç½®"
        },
        {
          "kind": "column",
          "name": "questionnaire_overrides",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": null,
          "foreign_key": null,
          "comment": "é—®å·å¢åˆ é¢˜é…ç½®"
        },
        {
          "kind": "column",
          "name": "welcome_message",
          "type": "Text",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "å®¢æˆ·é¦–æ¬¡è¿›å…¥çš„æ¬¢è¿è¯­"
        },
        {
          "kind": "column",
          "name": "status",
          "type": "SQLEnum",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": "TenantStatus.trial",
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "tier",
          "type": "SQLEnum",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "TenantTier.basic",
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "max_clients",
          "type": "Integer",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": 50,
          "server_default": null,
          "foreign_key": null,
          "comment": "å®¢æˆ·æ•°ä¸Šé™"
        },
        {
          "kind": "column",
          "name": "revenue_share_expert",
          "type": "Float",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": 0.8,
          "server_default": null,
          "foreign_key": null,
          "comment": "ä¸“å®¶åˆ†æˆæ¯”ä¾‹"
        },
        {
          "kind": "column",
          "name": "trial_expires_at",
          "type": "DateTime",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "è¯•ç”¨åˆ°æœŸæ—¶é—´"
        },
        {
          "kind": "column",
          "name": "application_status",
          "type": "String(20)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "pending_review/approved/rejected/NULL(æ—§æ•°æ®)"
        },
        {
          "kind": "column",
          "name": "application_data",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": null,
          "foreign_key": null,
          "comment": "ç”³è¯·è¡¨å•åŸå§‹æ•°æ®"
        },
        {
          "kind": "column",
          "name": "applied_at",
          "type": "DateTime",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "ç”³è¯·æäº¤æ—¶é—´"
        },
        {
          "kind": "column",
          "name": "created_at",
          "type": "DateTime",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": "now(...)",
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "updated_at",
          "type": "DateTime",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": "now(...)",
          "foreign_key": null,
          "comment": null
        }
      ],
      "relationships": [
        {
          "kind": "relationship",
          "name": "clients",
          "target": "TenantClient",
          "back_populates": "tenant",
          "backref": null,
          "lazy": "dynamic",
          "uselist": null,
          "cascade": null,
          "foreign_keys": null
        },
        {
          "kind": "relationship",
          "name": "agent_mappings",
          "target": "TenantAgentMapping",
          "back_populates": "tenant",
          "backref": null,
          "lazy": "selectin",
          "uselist": null,
          "cascade": null,
          "foreign_keys": null
        }
      ],
      "foreign_keys": [
        {
          "column": "expert_user_id",
          "references": "users.id"
        }
      ],
      "indexes": [],
      "constraints": [
        {
          "type": "Index",
          "args": [
            "idx_tenant_status",
            "status"
          ]
        },
        {
          "type": "Index",
          "args": [
            "idx_tenant_expert_user",
            "expert_user_id"
          ]
        }
      ],
      "column_count": 32
    },
    {
      "model_name": "TenantClient",
      "table_name": "tenant_clients",
      "has_explicit_tablename": true,
      "base_classes": [
        "Base"
      ],
      "file": "core/models.py",
      "line": 2443,
      "docstring": "ä¸“å®¶çš„å®¢æˆ· â€” å…³è”å¹³å°ç”¨æˆ· + ç§Ÿæˆ·å½’å±",
      "columns": [
        {
          "kind": "column",
          "name": "id",
          "type": "Integer",
          "nullable": true,
          "primary_key": true,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "tenant_id",
          "type": "String(64)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": "expert_tenants.id",
          "comment": null
        },
        {
          "kind": "column",
          "name": "user_id",
          "type": "Integer",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": "users.id",
          "comment": "å¹³å°ç»Ÿä¸€ç”¨æˆ·ID"
        },
        {
          "kind": "column",
          "name": "source",
          "type": "String(32)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "expert_referred",
          "server_default": null,
          "foreign_key": null,
          "comment": "æ¥æº"
        },
        {
          "kind": "column",
          "name": "service_package",
          "type": "String(64)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "trial",
          "server_default": null,
          "foreign_key": null,
          "comment": "è´­ä¹°çš„æœåŠ¡åŒ…ID"
        },
        {
          "kind": "column",
          "name": "status",
          "type": "SQLEnum",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": "ClientStatus.active",
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "enrolled_at",
          "type": "DateTime",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": "now(...)",
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "graduated_at",
          "type": "DateTime",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "total_sessions",
          "type": "Integer",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": 0,
          "server_default": null,
          "foreign_key": null,
          "comment": "ç´¯è®¡ä¼šè¯æ¬¡æ•°"
        },
        {
          "kind": "column",
          "name": "last_active_at",
          "type": "DateTime",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "notes",
          "type": "Text",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "ä¸“å®¶å¤‡æ³¨"
        }
      ],
      "relationships": [
        {
          "kind": "relationship",
          "name": "tenant",
          "target": "ExpertTenant",
          "back_populates": "clients",
          "backref": null,
          "lazy": null,
          "uselist": null,
          "cascade": null,
          "foreign_keys": null
        }
      ],
      "foreign_keys": [
        {
          "column": "tenant_id",
          "references": "expert_tenants.id"
        },
        {
          "column": "user_id",
          "references": "users.id"
        }
      ],
      "indexes": [],
      "constraints": [
        {
          "type": "Index",
          "args": [
            "idx_tc_tenant_status",
            "tenant_id",
            "status"
          ]
        }
      ],
      "column_count": 11
    },
    {
      "model_name": "TenantAgentMapping",
      "table_name": "tenant_agent_mappings",
      "has_explicit_tablename": true,
      "base_classes": [
        "Base"
      ],
      "file": "core/models.py",
      "line": 2472,
      "docstring": "ç§Ÿæˆ· x Agent çš„è¯¦ç»†é…ç½®",
      "columns": [
        {
          "kind": "column",
          "name": "id",
          "type": "Integer",
          "nullable": true,
          "primary_key": true,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "tenant_id",
          "type": "String(64)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": "expert_tenants.id",
          "comment": null
        },
        {
          "kind": "column",
          "name": "agent_id",
          "type": "String(32)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "Agentæ ‡è¯†: sleep/glucose/stress/..."
        },
        {
          "kind": "column",
          "name": "display_name",
          "type": "String(64)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "è‡ªå®šä¹‰æ˜¾ç¤ºå"
        },
        {
          "kind": "column",
          "name": "display_avatar",
          "type": "String(16)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "è‡ªå®šä¹‰Emojiå¤´åƒ"
        },
        {
          "kind": "column",
          "name": "greeting",
          "type": "Text",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "è‡ªå®šä¹‰å¼€åœºç™½"
        },
        {
          "kind": "column",
          "name": "tone",
          "type": "String(128)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "è¯­æ°”é£æ ¼æè¿°"
        },
        {
          "kind": "column",
          "name": "bio",
          "type": "String(256)",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "",
          "server_default": null,
          "foreign_key": null,
          "comment": "Agentç®€ä»‹"
        },
        {
          "kind": "column",
          "name": "is_enabled",
          "type": "Boolean",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": true,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "is_primary",
          "type": "Boolean",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": false,
          "server_default": null,
          "foreign_key": null,
          "comment": "æ˜¯å¦ä¸ºä¸»åŠ›Agent"
        },
        {
          "kind": "column",
          "name": "sort_order",
          "type": "Integer",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": 0,
          "server_default": null,
          "foreign_key": null,
          "comment": "æ’åºæƒé‡"
        },
        {
          "kind": "column",
          "name": "custom_keywords",
          "type": "JSON",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "list",
          "server_default": "[]",
          "foreign_key": null,
          "comment": "ä¸“å®¶è‡ªå®šä¹‰è·¯ç”±å…³é”®è¯"
        },
        {
          "kind": "column",
          "name": "keyword_boost",
          "type": "Float",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": 1.5,
          "server_default": "1.5",
          "foreign_key": null,
          "comment": "ä¸“å®¶å…³é”®è¯å¾—åˆ†åŠ æƒå€æ•°"
        },
        {
          "kind": "column",
          "name": "created_at",
          "type": "DateTime",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": "now(...)",
          "foreign_key": null,
          "comment": null
        }
      ],
      "relationships": [
        {
          "kind": "relationship",
          "name": "tenant",
          "target": "ExpertTenant",
          "back_populates": "agent_mappings",
          "backref": null,
          "lazy": null,
          "uselist": null,
          "cascade": null,
          "foreign_keys": null
        }
      ],
      "foreign_keys": [
        {
          "column": "tenant_id",
          "references": "expert_tenants.id"
        }
      ],
      "indexes": [],
      "constraints": [
        {
          "type": "Index",
          "args": [
            "idx_tam_tenant_enabled",
            "tenant_id",
            "is_enabled"
          ]
        }
      ],
      "column_count": 14
    },
    {
      "model_name": "TenantAuditLog",
      "table_name": "tenant_audit_logs",
      "has_explicit_tablename": true,
      "base_classes": [
        "Base"
      ],
      "file": "core/models.py",
      "line": 2508,
      "docstring": "ç§Ÿæˆ·æ“ä½œå®¡è®¡æ—¥å¿—",
      "columns": [
        {
          "kind": "column",
          "name": "id",
          "type": "Integer",
          "nullable": true,
          "primary_key": true,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": null
        },
        {
          "kind": "column",
          "name": "tenant_id",
          "type": "String(64)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": true,
          "default": null,
          "server_default": null,
          "foreign_key": "expert_tenants.id",
          "comment": null
        },
        {
          "kind": "column",
          "name": "actor_id",
          "type": "Integer",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "æ“ä½œè€…ç”¨æˆ·ID"
        },
        {
          "kind": "column",
          "name": "action",
          "type": "String(64)",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": null,
          "foreign_key": null,
          "comment": "æ“ä½œç±»å‹"
        },
        {
          "kind": "column",
          "name": "detail",
          "type": "JSON",
          "nullable": true,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": "dict",
          "server_default": null,
          "foreign_key": null,
          "comment": "æ“ä½œè¯¦æƒ…"
        },
        {
          "kind": "column",
          "name": "created_at",
          "type": "DateTime",
          "nullable": false,
          "primary_key": false,
          "unique": false,
          "index": false,
          "default": null,
          "server_default": "now(...)",
          "foreign_key": null,
          "comment": null
        }
      ],
      "relationships": [],
      "foreign_keys": [
        {
          "column": "tenant_id",
          "references": "expert_tenants.id"
        }
      ],
      "indexes": [],
      "constraints": [
        {
          "type": "Index",
          "args": [
            "idx_audit_tenant_time",
            "tenant_id",
            "created_at"
          ]
        }
      ],
      "column_count": 6
    }
  ],
  "isolation_patterns": [
    {
      "file": "api/coach_api.py",
      "pattern_type": "coach_id_filter",
      "count": 1
    },
    {
      "file": "api/coach_api.py",
      "pattern_type": "user_id_filter",
      "count": 3
    },
    {
      "file": "api/coach_message_api.py",
      "pattern_type": "coach_id_filter",
      "count": 1
    },
    {
      "file": "api/content_api.py",
      "pattern_type": "user_id_filter",
      "count": 1
    },
    {
      "file": "api/context_builder.py",
      "pattern_type": "user_id_filter",
      "count": 3
    },
    {
      "file": "api/device_rest_api.py",
      "pattern_type": "user_id_filter",
      "count": 3
    },
    {
      "file": "api/food_recognition_api.py",
      "pattern_type": "user_id_filter",
      "count": 1
    },
    {
      "file": "api/learning_api.py",
      "pattern_type": "user_id_filter",
      "count": 2
    },
    {
      "file": "api/policy_api.py",
      "pattern_type": "tenant_id_filter",
      "count": 1
    },
    {
      "file": "api/reminder_api.py",
      "pattern_type": "user_id_filter",
      "count": 3
    },
    {
      "file": "api/tenant_api.py",
      "pattern_type": "tenant_id_filter",
      "count": 1
    },
    {
      "file": "api/user_stats_api.py",
      "pattern_type": "user_id_filter",
      "count": 2
    },
    {
      "file": "behavior_rx/rx_routes.py",
      "pattern_type": "user_id_filter",
      "count": 2
    },
    {
      "file": "core/coach_push_queue_service.py",
      "pattern_type": "coach_id_filter",
      "count": 2
    },
    {
      "file": "core/cost_controller.py",
      "pattern_type": "user_id_filter",
      "count": 3
    },
    {
      "file": "core/decision_trace.py",
      "pattern_type": "tenant_id_filter",
      "count": 1
    },
    {
      "file": "core/effectiveness_metrics.py",
      "pattern_type": "tenant_id_filter",
      "count": 2
    },
    {
      "file": "core/effectiveness_metrics.py",
      "pattern_type": "user_id_filter",
      "count": 1
    },
    {
      "file": "core/feedback_service.py",
      "pattern_type": "tenant_id_filter",
      "count": 1
    },
    {
      "file": "core/micro_action_service.py",
      "pattern_type": "user_id_filter",
      "count": 2
    },
    {
      "file": "core/push_recommendation_service.py",
      "pattern_type": "coach_id_filter",
      "count": 1
    },
    {
      "file": "core/knowledge/document_service.py",
      "pattern_type": "tenant_id_filter",
      "count": 2
    },
    {
      "file": "core/knowledge/sharing_service.py",
      "pattern_type": "tenant_id_filter",
      "count": 1
    },
    {
      "file": "scripts/create_mock_cases.py",
      "pattern_type": "user_id_filter",
      "count": 1
    },
    {
      "file": "tests/final_api_check.py",
      "pattern_type": "user_id_filter",
      "count": 1
    }
  ],
  "auth_chain": [
    {
      "function": "get_current_user",
      "file": "api/auth.py",
      "body_preview": ""
    },
    {
      "function": "require_role",
      "file": "api/auth.py",
      "body_preview": "async def _check(user: User = Depends(get_current_user)) -> User:\n        user_role = (user.role.value if hasattr(user.role, \"value\") else str(user.role)).lower()\n        if user_role not in {r.lower() for r in roles}:\n            raise HTTPException(\n                status_code=status.HTTP_403"
    },
    {
      "function": "get_current_user",
      "file": "api/auth_api.py",
      "body_preview": ""
    },
    {
      "function": "get_current_user_info",
      "file": "api/auth_api.py",
      "body_preview": ""
    },
    {
      "function": "get_current_user",
      "file": "api/dependencies.py",
      "body_preview": ""
    },
    {
      "function": "require_admin",
      "file": "api/dependencies.py",
      "body_preview": ""
    },
    {
      "function": "require_coach_or_admin",
      "file": "api/dependencies.py",
      "body_preview": ""
    },
    {
      "function": "get_current_user_id",
      "file": "api/device_data.py",
      "body_preview": ""
    },
    {
      "function": "get_current_glucose",
      "file": "api/device_data.py",
      "body_preview": ""
    },
    {
      "function": "get_current_user",
      "file": "v3/auth.py",
      "body_preview": ""
    },
    {
      "function": "require_role",
      "file": "v3/auth.py",
      "body_preview": "\"\"\"\n    è§’è‰²æƒé™è£…é¥°å™¨å·¥å‚ â€” å…¼å®¹ V1 + V3 è§’è‰²ä½“ç³»\n\n    ç”¨æ³•:\n        @router.get(\"/admin/stats\")\n        def admin_stats(user: User = Depends(require_role(\"admin\", \"bhp_master\"))):\n            ...\n    \"\"\"\n    async def _check(user: User = Depends(get_current_user)) -> User:\n        user_role_lower = (user.role"
    }
  ],
  "rbac_definitions": [
    {
      "file": "api/learning_api.py",
      "type": "role_constant",
      "value": "str",
      "context": "et_user_rewards(\n    user_id: int,\n    user_type: str = \"grower\",\n    db: Session = Depends(get_db),\n    current_u"
    },
    {
      "file": "api/reminder_api.py",
      "type": "role_constant",
      "value": "source",
      "context": "ron_expr,\n        next_fire_at=next_fire,\n        source=\"coach\",\n        created_by=current_user.id,\n    )\n    db"
    },
    {
      "file": "api/segments_api.py",
      "type": "class",
      "value": "UserPermissionsResponse",
      "context": ": bool\n    min_tier: str\n    min_tier_name: str\n\n\nclass UserPermissionsResponse(BaseModel):\n    \"\"\"ç”¨æˆ·æƒé™å“åº”\"\"\"\n    role: str\n    ro"
    },
    {
      "file": "api/segments_api.py",
      "type": "class",
      "value": "RoleInfo",
      "context": ": str\n    upgrade_needed: bool\n    message: str\n\n\nclass RoleInfo(BaseModel):\n    \"\"\"è§’è‰²ä¿¡æ¯\"\"\"\n    id: str\n    name:"
    },
    {
      "file": "api/user_api.py",
      "type": "role_constant",
      "value": "str",
      "context": "str\n    full_name: Optional[str] = None\n    role: str = \"grower\"\n    email: Optional[str] = None\n    phone: Option"
    },
    {
      "file": "core/coach_push_queue_service.py",
      "type": "role_constant",
      "value": "source",
      "context": "\"push\",\n    )\n    db.add(msg)\n\n    # åˆ›å»º Reminder (source=\"coach\")\n    reminder = Reminder(\n        user_id=item.st"
    },
    {
      "file": "core/coach_push_queue_service.py",
      "type": "role_constant",
      "value": "source",
      "context": "itle,\n        content=item.content or \"\",\n        source=\"coach\",\n        created_by=item.coach_id,\n        is_act"
    },
    {
      "file": "core/micro_action_service.py",
      "type": "role_constant",
      "value": "source",
      "context": "n,\n            difficulty=difficulty,\n            source=\"coach\",\n            source_id=str(coach_id),"
    },
    {
      "file": "core/models.py",
      "type": "class",
      "value": "UserRole",
      "context": "ä¹‰\n# ============================================\n\nclass UserRole(str, enum.Enum):\n    \"\"\"\n    ç”¨æˆ·è§’è‰² - v18ç»Ÿä¸€è§’è‰²å±‚çº§"
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "OBSERVER",
      "context": ")\n    L99: ç®¡ç†å‘˜ (admin)\n    \"\"\"\n    # è¡Œä¸ºå¥åº·æ™‹çº§åºåˆ—\n    OBSERVER = \"observer\"        # L0 è¡Œä¸ºå¥åº·è§‚å¯Ÿå‘˜\n    GROWER = \"grower\""
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "GROWER",
      "context": "OBSERVER = \"observer\"        # L0 è¡Œä¸ºå¥åº·è§‚å¯Ÿå‘˜\n    GROWER = \"grower\"            # L1 æˆé•¿è€…ï¼ˆåŸæ‚£è€…ï¼‰\n    SHARER = \"sharer\""
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "SHARER",
      "context": "GROWER = \"grower\"            # L1 æˆé•¿è€…ï¼ˆåŸæ‚£è€…ï¼‰\n    SHARER = \"sharer\"            # L2 åˆ†äº«è€…\n    COACH = \"coach\""
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "COACH",
      "context": "æ‚£è€…ï¼‰\n    SHARER = \"sharer\"            # L2 åˆ†äº«è€…\n    COACH = \"coach\"              # L3 å¥åº·æ•™ç»ƒ\n    PROMOTER = \"promoter\""
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "MASTER",
      "context": "UPERVISOR = \"supervisor\"    # L4 ç£å¯¼ä¸“å®¶ï¼ˆä¸ä¿ƒè¿›å¸ˆå¹³çº§ï¼‰\n    MASTER = \"master\"            # L5 è¡Œä¸ºå¥åº·ä¿ƒè¿›å¤§å¸ˆ\n\n    # ç³»ç»Ÿè§’è‰²\n    ADMIN ="
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "ADMIN",
      "context": "\"master\"            # L5 è¡Œä¸ºå¥åº·ä¿ƒè¿›å¤§å¸ˆ\n\n    # ç³»ç»Ÿè§’è‰²\n    ADMIN = \"admin\"              # L99 ç³»ç»Ÿç®¡ç†å‘˜\n    SYSTEM = \"system\""
    },
    {
      "file": "core/models.py",
      "type": "role_constant",
      "value": "coach",
      "context": "\"sms\"\n    email = \"email\"\n    embed = \"embed\"\n    coach = \"coach\"\n\n\nclass Survey(Base):\n    \"\"\"é—®å·ä¸»è¡¨\"\"\"\n    __tablen"
    },
    {
      "file": "core/user_segments.py",
      "type": "class",
      "value": "PermissionConfig",
      "context": "=====================================\n\n@dataclass\nclass PermissionConfig:\n    \"\"\"æƒé™é…ç½®\"\"\"\n    features: List[FeatureModule]"
    },
    {
      "file": "core/user_segments.py",
      "type": "class",
      "value": "UserPermissionContext",
      "context": "=====================================\n\n@dataclass\nclass UserPermissionContext:\n    \"\"\"ç”¨æˆ·æƒé™ä¸Šä¸‹æ–‡\"\"\"\n    role: str\n    source: User"
    },
    {
      "file": "core/brain/policy_gate.py",
      "type": "role_constant",
      "value": "escalation_target",
      "context": "intervention_allowed=True,\n                escalation_target=\"coach\",\n                allowed_modes=[\"empathy\", \"chall"
    },
    {
      "file": "disclosure/controller.py",
      "type": "class",
      "value": "ViewerRole",
      "context": "å°æŠ«éœ²\n    NONE = \"none\"                    # æš‚ä¸æŠ«éœ²\n\n\nclass ViewerRole(str, Enum):\n    \"\"\"æŸ¥çœ‹è€…è§’è‰²ï¼ˆå››çº§æƒé™ï¼‰\"\"\"\n    PATIENT = \""
    },
    {
      "file": "disclosure/controller.py",
      "type": "role_constant",
      "value": "COACH",
      "context": "æƒé™ï¼‰\"\"\"\n    PATIENT = \"patient\"      # æ‚£è€…ç«¯ï¼ˆCç«¯ï¼‰\n    COACH = \"coach\"          # æ•™ç»ƒç«¯ï¼ˆBç«¯ï¼‰\n    EXPERT = \"expert\"        #"
    },
    {
      "file": "disclosure/controller.py",
      "type": "role_constant",
      "value": "EXPERT",
      "context": "è€…ç«¯ï¼ˆCç«¯ï¼‰\n    COACH = \"coach\"          # æ•™ç»ƒç«¯ï¼ˆBç«¯ï¼‰\n    EXPERT = \"expert\"        # ä¸“å®¶/ç£å¯¼ç«¯\n    ADMIN = \"admin\"          # ç®¡ç†"
    },
    {
      "file": "disclosure/controller.py",
      "type": "role_constant",
      "value": "ADMIN",
      "context": "æ•™ç»ƒç«¯ï¼ˆBç«¯ï¼‰\n    EXPERT = \"expert\"        # ä¸“å®¶/ç£å¯¼ç«¯\n    ADMIN = \"admin\"          # ç®¡ç†ç«¯\n\n\n# =============================="
    },
    {
      "file": "disclosure/permissions.py",
      "type": "class",
      "value": "PermissionLevel",
      "context": "etime import datetime\nfrom loguru import logger\n\n\nclass PermissionLevel(int, Enum):\n    \"\"\"æƒé™ç­‰çº§\"\"\"\n    PATIENT = 1      #"
    },
    {
      "file": "disclosure/permissions.py",
      "type": "class",
      "value": "UserPermission",
      "context": ": {PermissionLevel.EXPERT},\n    },\n}\n\n\n@dataclass\nclass UserPermission:\n    \"\"\"ç”¨æˆ·æƒé™\"\"\"\n    user_id: int\n    level: Permi"
    },
    {
      "file": "disclosure/permissions.py",
      "type": "class",
      "value": "PermissionManager",
      "context": "())\n        return self.level in allowed_levels\n\n\nclass PermissionManager:\n    \"\"\"\n    æƒé™ç®¡ç†å™¨\n    \n    ç®¡ç†å››çº§æƒé™çš„æ£€æŸ¥å’Œæˆæƒ\n    \"\"\""
    },
    {
      "file": "disclosure/signature.py",
      "type": "class",
      "value": "SignatureRole",
      "context": "loguru import logger\nimport hashlib\nimport json\n\n\nclass SignatureRole(str, Enum):\n    \"\"\"ç­¾åè§’è‰²\"\"\"\n    PRIMARY = \"primary"
    },
    {
      "file": "scripts/seed_data.py",
      "type": "role_constant",
      "value": "username",
      "context": "isting\n\n            admin = User(\n                username=\"admin\",\n                email=\"admin@behavioral-health.c"
    },
    {
      "file": "scripts/seed_experts.py",
      "type": "role_constant",
      "value": "username",
      "context": ")\n                user = db.query(User).filter_by(username=\"admin\").first()\n            if not user:"
    },
    {
      "file": "services/state_sync/manager.py",
      "type": "class",
      "value": "ViewRole",
      "context": "er.warning(\"[StateSync] SQLAlchemy æœªå®‰è£…ï¼Œä½¿ç”¨å†…å­˜å­˜å‚¨\")\n\n\nclass ViewRole(str, Enum):\n    \"\"\"è§†å›¾è§’è‰²\"\"\"\n    PATIENT = \"patient"
    },
    {
      "file": "services/state_sync/manager.py",
      "type": "role_constant",
      "value": "COACH",
      "context": "\"\"\"è§†å›¾è§’è‰²\"\"\"\n    PATIENT = \"patient\"   # æ‚£è€…ç«¯è§†å›¾\n    COACH = \"coach\"       # æ•™ç»ƒç«¯è§†å›¾\n    EXPERT = \"expert\"     # ä¸“å®¶ç«¯è§†å›¾"
    },
    {
      "file": "services/state_sync/manager.py",
      "type": "role_constant",
      "value": "EXPERT",
      "context": "\"   # æ‚£è€…ç«¯è§†å›¾\n    COACH = \"coach\"       # æ•™ç»ƒç«¯è§†å›¾\n    EXPERT = \"expert\"     # ä¸“å®¶ç«¯è§†å›¾\n    ADMIN = \"admin\"       # ç®¡ç†ç«¯è§†å›¾\n\n\nc"
    },
    {
      "file": "services/state_sync/manager.py",
      "type": "role_constant",
      "value": "ADMIN",
      "context": "# æ•™ç»ƒç«¯è§†å›¾\n    EXPERT = \"expert\"     # ä¸“å®¶ç«¯è§†å›¾\n    ADMIN = \"admin\"       # ç®¡ç†ç«¯è§†å›¾\n\n\nclass EventType(str, Enum):\n    \""
    },
    {
      "file": "tests/test_auth.py",
      "type": "class",
      "value": "TestCreateAccessToken",
      "context": "-----------------------------------------------\n\nclass TestCreateAccessToken:\n    def test_create_access_token(self):"
    },
    {
      "file": "tests/test_auth.py",
      "type": "class",
      "value": "TestCheckPermission",
      "context": "-----------------------------------------------\n\nclass TestCheckPermission:\n    def test_check_permission(self):\n        \"\"\""
    },
    {
      "file": "tests/test_state_sync.py",
      "type": "class",
      "value": "TestGetViewByRole",
      "context": "-----------------------------------------------\n\nclass TestGetViewByRole:\n    def test_get_view_by_role(self, manager):"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "h token\n    rt = create_refresh_token(user_id=42, role=\"admin\")\n    payload_r = decode_token(rt)\n    check(\"refr"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "password_hash=hash_password(\"user\"), role=\"grower\")\n    admin_user = User(phone=\"13900000001\", usern"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "password_hash=hash_password(\"admin\"), role=\"admin\")\n    master_user = User(phone=\"13900000002\", user"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "password_hash=hash_password(\"master\"), role=\"master\")\n    db.add_all([regular_user, admin_user, master"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "en = create_access_token(user_id=regular_user.id, role=\"grower\")\n    user_headers = {\"Authorization\": f\"Bearer {u"
    },
    {
      "file": "tests/test_v3_auth.py",
      "type": "role_constant",
      "value": "role",
      "context": "oken = create_access_token(user_id=admin_user.id, role=\"admin\")\n    admin_headers = {\"Authorization\": f\"Bearer {"
    },
    {
      "file": "workbench/expert_review.py",
      "type": "role_constant",
      "value": "value",
      "context": "rm\"):\n            username = st.text_input(\"ç”¨æˆ·å\", value=\"admin\")\n            password = st.text_input(\"å¯†ç \", type="
    }
  ],
  "tenant_endpoints": [],
  "summary": {
    "total_tenant_models": 5,
    "total_isolation_patterns": 25,
    "total_auth_functions": 11,
    "isolation_types": [
      "tenant_id_filter",
      "user_id_filter",
      "coach_id_filter"
    ]
  }
}